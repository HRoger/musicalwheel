(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t="nectar-blocks-post-grid",n=window.wp.apiFetch;var i=e.n(n);class s{loadMorePage=1;currentPage=1;postsPerPage=0;offset=0;blockId="";constructor(e){if(this.element=e,this.blockId=this.element.getAttribute("id"),null===this.blockId)throw new Error("Unable to find block id");const n=this.element.querySelector(`.${t}__content`);if(null===n)throw new Error("Unable to find post-grid content");this.content=n;const i=this.element.querySelector(`.${t}__inner`);if(null===i)throw new Error("Unable to find post-grid inner");this.inner=i;const s=this.element.querySelector(`.${t}__pagination`);if(this.pagination=s,this.element.dataset.offset){const e=parseInt(this.element.dataset.offset);e>0&&(this.offset=e)}this.initPagination()}initPagination(){null!==this.pagination&&void 0!==this.element.dataset.paginationType&&(this.type=this.element.dataset.paginationType,void 0!==this.element.dataset.paginationPostsPerPage?(this.postsPerPage=parseInt(this.element.dataset.paginationPostsPerPage),"load-more"===this.type?this.initializeLoadMore():this.initializeNumbered()):console.warn("PostsPerPage in post-grind not found"))}initializeLoadMore(){const e=this.element.querySelector(`.${t}__pagination__load-more`);null!==e?e.addEventListener("click",(async()=>{if(this.element.classList.contains("loading"))return;this.loadMorePage=this.loadMorePage+1,this.element.classList.add("loading");const e=await i()({path:"/nectar/v1/post_renderer/render",method:"POST",data:{pageID:window.nectarBlocksData.postID,blockID:this.blockId,overrideAttrs:{postOffset:this.currentPage-1+this.postsPerPage+this.offset,current_page:this.loadMorePage}}});if(this.currentPage=this.currentPage+this.postsPerPage,"success"===e.status){const n=document.createElement("div");n.innerHTML=e.html;const i=n.querySelector(`.${t}__content`),s=n.querySelector(`.${t}__pagination`);if(null===i||null===s)return void console.warn("Unable to find post-grid content");this.content?.append(...i.children),this.pagination.innerHTML=s.innerHTML,this.initializeLoadMore()}else console.warn(e.message);this.element.classList.remove("loading")})):console.warn("Unable to find post-grid button")}initializeNumbered(){const e=this.element.querySelectorAll("a.page-numbers, button.page-numbers");if(null!==e)for(const n of e){let e;n.classList.contains("dots")||(e=n.classList.contains("prev")?this.currentPage-1:n.classList.contains("next")?this.currentPage+1:parseInt(n.innerText),n.addEventListener("click",(async n=>{if(n.preventDefault(),this.element.classList.contains("loading"))return;this.element.classList.add("loading");const s=(e-1)*this.postsPerPage+this.offset,o=await i()({path:"/nectar/v1/post_renderer/render",method:"POST",data:{pageID:window.nectarBlocksData.postID,blockID:this.blockId,overrideAttrs:{postOffset:s,current_page:e}}});if("success"===o.status){this.currentPage=e;const n=document.createElement("div");n.innerHTML=o.html;const i=n.querySelector(`.${t}__inner`),s=n.querySelector(`.${t}__pagination`);if(null===i||null===s)return void console.warn("Unable to find updated content");this.inner.innerHTML=i.innerHTML,this.pagination.innerHTML=s.innerHTML,this.initializeNumbered(),this.element.getBoundingClientRect().top<0&&this.element.scrollIntoView({behavior:"smooth"})}else console.warn(o.message);return this.element.classList.remove("loading"),!1})))}else console.warn("Unable to find post-grid numbered buttons")}destroy(){}}document.addEventListener("DOMContentLoaded",(()=>{document.querySelectorAll(`.${t}`).forEach((e=>{new s(e)}))}))})();