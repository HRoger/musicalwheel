(e=>{"function"==typeof define&&define.amd?define("ecommerceSettings",e):e()})(function(){var i={template:`
		<input type="text" readonly :value="modelValue" @click="edit">
	`,props:["modelValue","tagGroups"],data(){return{previewMarkup:""}},methods:{edit(){Voxel_Dynamic.edit(this.modelValue,{groups:this.tagGroups,onSave:e=>{this.$emit("update:modelValue",e)}})}}};document.addEventListener("DOMContentLoaded",()=>{var e,t=document.getElementById("vx-ecommerce-settings");t&&((e=Vue.createApp({el:t,data(){return{config:null,props:{},state:{},tab:null,subtab:null,webhooks:{tab:"live",liveDetails:!1,testDetails:!1,editLiveDetails:!1,editTestDetails:!1},portal:{editIds:!1},db:{showAdvanced:!1},ipgeo:{activeProvider:null}}},created(){this.config=jQuery.extend(!0,this.config,JSON.parse(this.$options.el.dataset.config));try{this.props=jQuery.extend(!0,this.props,JSON.parse(this.$options.el.dataset.props))}catch(e){}var e=this.config.tab||Voxel_Backend.getSearchParam("tab");e&&(e=e.split("."),this.setTab(e[0],e[1]))},methods:{setTab(e,t=""){this.tab=e,this.subtab=t,this.config.tab=[e,t].filter(Boolean).join(".");var i=new URL(window.location);i.searchParams.set("tab",t?e+"."+t:e),window.history.replaceState(null,null,i)},currencyFormat(){return Voxel_Backend.helpers.currencyFormat(...arguments)},editOfflinePaymentNotes(e){Voxel_Dynamic.edit(this.config.offline_payments.notes_to_customer.content||"",{groups:{vendor:{label:"Vendor",type:"user"},customer:{label:"Customer",type:"user"},site:{label:"Site",type:"site"}},onSave:e=>{this.config.offline_payments.notes_to_customer.content=e}})},getRegionsGroupedByContinent(e){if(!e||!e.regions||!Array.isArray(e.regions))return{};let s={};e.regions.forEach(e=>{var t=this.props.shipping_countries?.[e.country],i=t?.continent||"Other";s[i]||(s[i]=[]),s[i].push({region:e,name:t?.name||e.country||"(untitled)"})}),Object.keys(s).forEach(e=>{s[e].sort((e,t)=>e.name.localeCompare(t.name))});e=Object.keys(s).sort((e,t)=>e.localeCompare(t));let t={};return e.forEach(e=>{t[e]=s[e]}),t},getContinentsWithCounts(e){let t=this.getRegionsGroupedByContinent(e),i=[];return Object.keys(t).forEach(e=>{i.push({name:e,count:t[e].length})}),i.sort((e,t)=>e.name.localeCompare(t.name))},getActiveContinent(e){return e&&e.key&&this.state.activeContinent?.[e.key]||null},setActiveContinent(e,t){e&&e.key&&(this.state.activeContinent||(this.state.activeContinent={}),this.state.activeContinent[e.key]=t)},getFilteredRegionsByContinent(e){var t=this.getRegionsGroupedByContinent(e),e=this.getActiveContinent(e);return e?t[e]?{[e]:t[e]}:{}:t},handleCountrySelect(e,t,i){var s;t&&e&&(t.startsWith("continent:")?(s=t.replace("continent:",""),s=this.props.shipping_countries_by_continent?.[s]||{},Object.keys(s).forEach(t=>{e.regions.find(e=>e.country===t)||e.regions.push({type:"country",country:t,states:[],zip_codes:""})})):e.regions.push({type:"country",country:t,states:[],zip_codes:""}),i)&&i.target&&(i.target.value="")},shouldShowContinentOption(e){e=this.props.shipping_countries_by_continent?.[e]||{};return 1<Object.keys(e).length},getAvailableStates(e){let t=this.props.shipping_countries?.[e];if(!t||!t.states)return{};e=Object.entries(t.states).map(([e,t])=>({code:e,name:t.name||e}));e.sort((e,t)=>e.name.localeCompare(t.name));let i={};return e.forEach(e=>{i[e.code]=t.states[e.code]}),i},getStateName(e,t){e=this.props.shipping_countries?.[e];return e&&e.states&&e.states[t]&&e.states[t].name||t},handleStateSelect(e,t,i){t&&e&&Array.isArray(e.states)&&(e.states.find(e=>e===t)||e.states.push(t),i)&&i.target&&(i.target.value="")},selectAllCountries(i){i&&this.props.shipping_countries_by_continent&&Object.keys(this.props.shipping_countries_by_continent).forEach(e=>{e=this.props.shipping_countries_by_continent[e]||{};Object.keys(e).forEach(t=>{i.regions.find(e=>e.country===t)||i.regions.push({type:"country",country:t,states:[],zip_codes:""})})})},unselectAllCountries(e){e&&Array.isArray(e.regions)&&(e.regions=[])},addShippingClass(){var e={key:this.$w.Voxel_Backend.helpers.randomId(8),label:null,description:null};this.config.shipping.shipping_classes.push(e),this.state.activeShippingClass=e},selectAllStates(e,t){e&&t&&(t=this.props.shipping_countries?.[t])&&t.states&&(e.states=Object.keys(t.states))},addShippingClassToRate(e,t){e&&e.fixed_rate&&t&&(Array.isArray(e.fixed_rate.shipping_classes)||(e.fixed_rate.shipping_classes=[]),e.fixed_rate.shipping_classes.find(e=>e.shipping_class===t.key)||e.fixed_rate.shipping_classes.push({shipping_class:t.key,amount_per_unit:null}))},addShippingZone(){var e;this.config.shipping&&Array.isArray(this.config.shipping.shipping_zones)&&(e={key:this.$w.Voxel_Backend.helpers.randomId(8),label:null,regions:[],rates:[]},this.config.shipping.shipping_zones.push(e),this.state.activeShippingZone=e)},getRateZones(t){if(!t||!t.key)return[];var e=this.config.shipping;if(!e||!e.shipping_zones)return[];let i=[];return e.shipping_zones.forEach(e=>{e.rates&&e.rates.includes(t.key)&&i.push(e)}),i},isRateInZone(e,t){var i,s;return!!(e&&e.key&&t)&&!!((i=this.config.shipping)&&i.shipping_zones&&(s=i.shipping_zones.find(e=>e.key===t))&&s.rates)&&s.rates.includes(e.key)},handleZoneSelect(e,t,i){var s;t&&e&&e.key&&(s=this.config.shipping)&&s.shipping_zones&&(s=s.shipping_zones.find(e=>e.key===t))&&(s.rates||(s.rates=[]),s.rates.includes(e.key)||s.rates.push(e.key),i)&&i.target&&(i.target.value="")},removeRateFromZone(e,t){var i;e&&e.key&&t&&(i=this.config.shipping)&&i.shipping_zones&&(i=i.shipping_zones.find(e=>e.key===t))&&i.rates&&-1!==(e=i.rates.indexOf(e.key))&&i.rates.splice(e,1)},selectAllZonesForRate(t){var e;t&&t.key&&(e=this.config.shipping)&&e.shipping_zones&&e.shipping_zones.forEach(e=>{e.rates||(e.rates=[]),e.rates.includes(t.key)||e.rates.push(t.key)})},unselectAllZonesForRate(i){var e;i&&i.key&&(e=this.config.shipping)&&e.shipping_zones&&e.shipping_zones.forEach(e=>{var t;e.rates&&-1!==(t=e.rates.indexOf(i.key))&&e.rates.splice(t,1)})},removeShippingRate(i){var e,t;i&&i.key&&(e=this.config.shipping)&&(e.shipping_zones&&e.shipping_zones.forEach(e=>{var t;e.rates&&-1!==(t=e.rates.indexOf(i.key))&&e.rates.splice(t,1)}),e.shipping_rates&&-1!==(t=e.shipping_rates.findIndex(e=>e.key===i.key))&&e.shipping_rates.splice(t,1),this.state.activeShippingRate===i)&&(this.state.activeShippingRate=null)},addShippingRate(){var e,t=this.config.shipping;t&&(t.shipping_rates||(t.shipping_rates=[]),e={key:this.$w.Voxel_Backend.helpers.randomId(8),label:null,type:"free_shipping",free_shipping:{requirements:"none",minimum_order_amount:0,delivery_estimate:{minimum:{unit:"business_day",value:1},maximum:{unit:"business_day",value:2}}},fixed_rate:{calculation_method:"per_item",tax_behavior:"default",tax_code:"shipping",delivery_estimate:{minimum:{unit:"business_day",value:1},maximum:{unit:"business_day",value:2}},amount_per_unit:0,shipping_classes:[]}},t.shipping_rates.push(e),this.state.activeShippingRate=e)}},computed:{$w(){return window},allShippingRates(){var e=this.config.shipping;return e&&e.shipping_rates||[]}}})).component("draggable",vuedraggable),e.component("field-key",Voxel_Backend.components.Field_Key),e.component("dtag-input",i),e.component("color-picker",Voxel_Backend.components.Color_Picker),e.mount(t))})});
