(e=>{"function"==typeof define&&define.amd?define("stripeConnectDashboard",e):e()})(function(){window.render_stripe_connect_dashboard=()=>{Array.from(document.querySelectorAll(".ts-vendor-settings")).forEach(e=>{var t;e.__vue_app__||((t=(e=>{let t=JSON.parse(e.closest(".elementor-element").querySelector(".vxconfig").innerHTML);return Vue.createApp({el:e,mixins:[Voxel.mixins.base],data(){return{screen:"main",activePopup:null,config:t,activeZone:null,activeRate:null,savingShipping:!1,state:{activeContinent:{}}}},mounted(){window.VX_Stripe_Account=this,e.classList.remove("hidden"),this.config.shipping_zones||(this.config.shipping_zones=[]),this.config.shipping_rates||(this.config.shipping_rates=[]),this.config.shipping_zones.forEach(e=>{e.countries&&!e.regions&&(e.regions=e.countries.map(e=>({type:"country",country:e,states:[],zip_codes:""})),delete e.countries),e.regions||(e.regions=[]),e.rates||(e.rates=[])}),this.config.shipping_rates.forEach(e=>{"fixed_rate"!==e.type||e.fixed_rate.calculation_method||(e.fixed_rate.calculation_method="per_item")})},methods:{shouldShowContinentOption(e){e=this.config.shipping_countries_by_continent[e];return e&&1<Object.keys(e).length},handleCountrySelect(e,t,n){n.target.value="",t&&(e.regions||(e.regions=[]),t.startsWith("continent:")?(n=t.replace("continent:",""),(n=this.config.shipping_countries_by_continent[n])&&Object.keys(n).forEach(t=>{e.regions.find(e=>e.country===t)||e.regions.push({type:"country",country:t,states:[],zip_codes:""})})):e.regions.find(e=>e.country===t)||e.regions.push({type:"country",country:t,states:[],zip_codes:""}))},selectAllCountries(e){e.regions||(e.regions=[]);var t=Object.keys(this.config.shipping_countries);e.regions.length===t.length?e.regions=[]:e.regions=t.map(e=>({type:"country",country:e,states:[],zip_codes:""}))},unselectAllCountries(e){e.regions&&(e.regions=[])},getCountryName(e){return this.config.shipping_countries[e]?.name||e},getAvailableStates(e){return this.config.shipping_countries[e]?.states||{}},getStateName(e,t){return this.getAvailableStates(e)[t]?.name||t},handleStateSelect(e,t,n){n.target.value="",t&&(e.states||(e.states=[]),e.states.includes(t)||e.states.push(t))},selectAllStates(e,t){t=this.getAvailableStates(t),t=Object.keys(t);e.states||(e.states=[]),e.states.length===t.length?e.states=[]:e.states=[...t]},getRegionsGroupedByContinent(e){if(!e||!e.regions||!Array.isArray(e.regions))return{};let i={};e.regions.forEach(e=>{var t=this.config.shipping_countries?.[e.country],n=t?.continent||"Other";i[n]||(i[n]=[]),i[n].push({region:e,name:t?.name||e.country||"(untitled)"})}),Object.keys(i).forEach(e=>{i[e].sort((e,t)=>e.name.localeCompare(t.name))});e=Object.keys(i).sort((e,t)=>e.localeCompare(t));let t={};return e.forEach(e=>{t[e]=i[e]}),t},getContinentsWithCounts(e){let t=this.getRegionsGroupedByContinent(e),n=[];return Object.keys(t).forEach(e=>{n.push({name:e,count:t[e].length})}),n.sort((e,t)=>e.name.localeCompare(t.name))},getActiveContinent(e){return e&&e.key&&this.state.activeContinent?.[e.key]||null},setActiveContinent(e,t){e&&e.key&&(this.state.activeContinent||(this.state.activeContinent={}),this.state.activeContinent[e.key]=t)},getFilteredRegionsByContinent(e){var t=this.getRegionsGroupedByContinent(e),e=this.getActiveContinent(e);return e?t[e]?{[e]:t[e]}:{}:t},addShippingRate(){var e={key:Voxel.helpers.randomId(8),label:null,type:"free_shipping",free_shipping:{requirements:"none",minimum_order_amount:0,delivery_estimate:{enabled:!1,minimum:{unit:"business_day",value:1},maximum:{unit:"business_day",value:2}}},fixed_rate:{delivery_estimate:{enabled:!1,minimum:{unit:"business_day",value:1},maximum:{unit:"business_day",value:2}},amount_per_unit:0,calculation_method:"per_item",shipping_classes:[]}};this.config.shipping_rates.push(e),this.activeRate=e},removeShippingRate(n){var e;n&&n.key&&(this.config.shipping_zones.forEach(e=>{var t;e.rates&&-1!==(t=e.rates.indexOf(n.key))&&e.rates.splice(t,1)}),-1!==(e=this.config.shipping_rates.findIndex(e=>e.key===n.key))&&this.config.shipping_rates.splice(e,1),this.activeRate===n)&&(this.activeRate=null)},getRateZones(t){return t&&t.key?this.config.shipping_zones.filter(e=>e.rates&&e.rates.includes(t.key)):[]},isRateInZone(e,t){var n;return!!(e&&e.key&&t)&&(n=this.config.shipping_zones.find(e=>e.key===t))&&n.rates&&n.rates.includes(e.key)},handleZoneSelectForRate(e,t,n){n.target.value="",t&&e&&e.key&&(n=this.config.shipping_zones.find(e=>e.key===t))&&(n.rates||(n.rates=[]),n.rates.includes(e.key)||n.rates.push(e.key))},removeRateFromZone(e,t){var n;e&&e.key&&t&&(n=this.config.shipping_zones.find(e=>e.key===t))&&n.rates&&-1!==(e=n.rates.indexOf(e.key))&&n.rates.splice(e,1)},selectAllZonesForRate(t){t&&t.key&&this.config.shipping_zones.forEach(e=>{e.rates||(e.rates=[]),e.rates.includes(t.key)||e.rates.push(t.key)})},unselectAllZonesForRate(n){n&&n.key&&this.config.shipping_zones.forEach(e=>{var t;e.rates&&-1!==(t=e.rates.indexOf(n.key))&&e.rates.splice(t,1)})},addShippingZone(){var e={key:Voxel.helpers.randomId(8),label:null,regions:[],rates:[]};this.config.shipping_zones.push(e),this.activeZone=e},saveShipping(){this.savingShipping=!0,jQuery.post(Voxel_Config.ajax_url+"&action=stripe_connect.account.save_shipping",{shipping_zones:JSON.stringify(this.config.shipping_zones),shipping_rates:JSON.stringify(this.config.shipping_rates),_wpnonce:this.config.nonce}).always(e=>{this.savingShipping=!1,e.success?Voxel.alert(e.message,"success",[],2e3):Voxel.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})}},computed:{$w(){return window}}})})(e)).component("form-popup",Voxel.components.popup),t.component("form-group",Voxel.components.formGroup),t.component("draggable","object"==typeof vuedraggable?vuedraggable:{}),t.mount(e))})},window.render_stripe_connect_dashboard(),jQuery(document).on("voxel:markup-update",window.render_stripe_connect_dashboard)});
