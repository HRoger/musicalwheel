/**
 * Build YARL Lightbox CSS
 *
 * Concatenates yet-another-react-lightbox core CSS with our VoxelLightbox
 * overrides into a single file: assets/dist/yarl-lightbox.css
 *
 * WordPress enqueues this file via Block_Loader (handle: mw-yarl-lightbox)
 * with vx:commons.css as a dependency, ensuring it loads AFTER commons.css
 * in the cascade. This naturally overrides Voxel's :where(path) { fill: inherit }.
 *
 * Usage: node scripts/build-yarl-css.js
 */

import { readFileSync, writeFileSync, mkdirSync } from 'fs';
import { resolve } from 'path';

// Use cwd — script is always run from the theme root via npm
const root = process.cwd();

const yarlCss = readFileSync(
	resolve(root, 'node_modules/yet-another-react-lightbox/dist/styles.css'),
	'utf8'
);

const overrideCss = readFileSync(
	resolve(root, 'app/blocks/shared/components/Lightbox/VoxelLightbox.css'),
	'utf8'
);

const output = `/* yarl-lightbox.css — Auto-generated by scripts/build-yarl-css.js */\n/* Do not edit directly. Modify VoxelLightbox.css instead and rebuild. */\n\n${yarlCss}\n\n/* === VoxelLightbox overrides === */\n\n${overrideCss}`;

const outDir = resolve(root, 'assets/dist');
mkdirSync(outDir, { recursive: true });
writeFileSync(resolve(outDir, 'yarl-lightbox.css'), output);

console.log('✅ Built assets/dist/yarl-lightbox.css');
