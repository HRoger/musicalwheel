(function(Ee,p){"use strict";var z,se,q,le;z={"(":9,"!":8,"*":7,"/":7,"%":7,"+":6,"-":6,"<":5,"<=":5,">":5,">=":5,"==":4,"!=":4,"&&":3,"||":2,"?":1,"?:":1},se=["(","?"],q={")":["("],":":["?","?:"]},le=/<=|>=|==|!=|&&|\|\||\?:|\(|!|\*|\/|%|\+|-|<|>|\?|\)|:/;function be(a){for(var t=[],s=[],r,u,o,c;r=a.match(le);){for(u=r[0],o=a.substr(0,r.index).trim(),o&&t.push(o);c=s.pop();){if(q[u]){if(q[u][0]===c){u=q[u][1]||u;break}}else if(se.indexOf(c)>=0||z[c]<z[u]){s.push(c);break}t.push(c)}q[u]||s.push(u),a=a.substr(r.index+u.length)}return a=a.trim(),a&&t.push(a),t.concat(s.reverse())}var _e={"!":function(a){return!a},"*":function(a,t){return a*t},"/":function(a,t){return a/t},"%":function(a,t){return a%t},"+":function(a,t){return a+t},"-":function(a,t){return a-t},"<":function(a,t){return a<t},"<=":function(a,t){return a<=t},">":function(a,t){return a>t},">=":function(a,t){return a>=t},"==":function(a,t){return a===t},"!=":function(a,t){return a!==t},"&&":function(a,t){return a&&t},"||":function(a,t){return a||t},"?:":function(a,t,s){if(a)throw t;return s}};function xe(a,t){var s=[],r,u,o,c,g,y;for(r=0;r<a.length;r++){if(g=a[r],c=_e[g],c){for(u=c.length,o=Array(u);u--;)o[u]=s.pop();try{y=c.apply(null,o)}catch(h){return h}}else t.hasOwnProperty(g)?y=t[g]:y=+g;s.push(y)}return s[0]}function we(a){var t=be(a);return function(s){return xe(t,s)}}function ke(a){var t=we(a);return function(s){return+t({n:s})}}var re={contextDelimiter:"",onMissingKey:null};function Ne(a){var t,s,r;for(t=a.split(";"),s=0;s<t.length;s++)if(r=t[s].trim(),r.indexOf("plural=")===0)return r.substr(7)}function ee(a,t){var s;this.data=a,this.pluralForms={},this.options={};for(s in re)this.options[s]=t!==void 0&&s in t?t[s]:re[s]}ee.prototype.getPluralForm=function(a,t){var s=this.pluralForms[a],r,u,o;return s||(r=this.data[a][""],o=r["Plural-Forms"]||r["plural-forms"]||r.plural_forms,typeof o!="function"&&(u=Ne(r["Plural-Forms"]||r["plural-forms"]||r.plural_forms),o=ke(u)),s=this.pluralForms[a]=o),s(t)},ee.prototype.dcnpgettext=function(a,t,s,r,u){var o,c,g;return u===void 0?o=0:o=this.getPluralForm(a,u),c=s,t&&(c=t+this.options.contextDelimiter+s),g=this.data[a][c],g&&g[o]?g[o]:(this.options.onMissingKey&&this.options.onMissingKey(s,a),o===0?s:r)};var ce={"":{plural_forms(a){return a===1?0:1}}},Se=/^i18n\.(n?gettext|has_translation)(_|$)/,Ae=(a,t,s)=>{const r=new ee({}),u=new Set,o=()=>{u.forEach(v=>v())},c=v=>(u.add(v),()=>u.delete(v)),g=(v="default")=>r.data[v],y=(v,f="default")=>{r.data[f]={...r.data[f],...v},r.data[f][""]={...ce[""],...r.data[f]?.[""]},delete r.pluralForms[f]},h=(v,f)=>{y(v,f),o()},R=(v,f="default")=>{r.data[f]={...r.data[f],...v,"":{...ce[""],...r.data[f]?.[""],...v?.[""]}},delete r.pluralForms[f],o()},C=(v,f)=>{r.data={},r.pluralForms={},h(v,f)},S=(v="default",f,E,x,k)=>(r.data[v]||y(void 0,v),r.dcnpgettext(v,f,E,x,k)),O=v=>v||"default",Z=(v,f)=>{let E=S(f,void 0,v);return s?(E=s.applyFilters("i18n.gettext",E,v,f),s.applyFilters("i18n.gettext_"+O(f),E,v,f)):E},P=(v,f,E)=>{let x=S(E,f,v);return s?(x=s.applyFilters("i18n.gettext_with_context",x,v,f,E),s.applyFilters("i18n.gettext_with_context_"+O(E),x,v,f,E)):x},T=(v,f,E,x)=>{let k=S(x,void 0,v,f,E);return s?(k=s.applyFilters("i18n.ngettext",k,v,f,E,x),s.applyFilters("i18n.ngettext_"+O(x),k,v,f,E,x)):k},L=(v,f,E,x,k)=>{let $=S(k,x,v,f,E);return s?($=s.applyFilters("i18n.ngettext_with_context",$,v,f,E,x,k),s.applyFilters("i18n.ngettext_with_context_"+O(k),$,v,f,E,x,k)):$},U=()=>P("ltr","text direction")==="rtl",H=(v,f,E)=>{const x=f?f+""+v:v;let k=!!r.data?.[E??"default"]?.[x];return s&&(k=s.applyFilters("i18n.has_translation",k,v,f,E),k=s.applyFilters("i18n.has_translation_"+O(E),k,v,f,E)),k};if(s){const v=f=>{Se.test(f)&&o()};s.addAction("hookAdded","core/i18n",v),s.addAction("hookRemoved","core/i18n",v)}return{getLocaleData:g,setLocaleData:h,addLocaleData:R,resetLocaleData:C,subscribe:c,__:Z,_x:P,_n:T,_nx:L,isRTL:U,hasTranslation:H}};function Ce(a){return typeof a!="string"||a===""?(console.error("The namespace must be a non-empty string."),!1):/^[a-zA-Z][a-zA-Z0-9_.\-\/]*$/.test(a)?!0:(console.error("The namespace can only contain numbers, letters, dashes, periods, underscores and slashes."),!1)}var ie=Ce;function Fe(a){return typeof a!="string"||a===""?(console.error("The hook name must be a non-empty string."),!1):/^__/.test(a)?(console.error("The hook name cannot begin with `__`."),!1):/^[a-zA-Z][a-zA-Z0-9_.-]*$/.test(a)?!0:(console.error("The hook name can only contain numbers, letters, dashes, periods and underscores."),!1)}var te=Fe;function De(a,t){return function(r,u,o,c=10){const g=a[t];if(!te(r)||!ie(u))return;if(typeof o!="function"){console.error("The hook callback must be a function.");return}if(typeof c!="number"){console.error("If specified, the hook priority must be a number.");return}const y={callback:o,priority:c,namespace:u};if(g[r]){const h=g[r].handlers;let R;for(R=h.length;R>0&&!(c>=h[R-1].priority);R--);R===h.length?h[R]=y:h.splice(R,0,y),g.__current.forEach(C=>{C.name===r&&C.currentIndex>=R&&C.currentIndex++})}else g[r]={handlers:[y],runs:0};r!=="hookAdded"&&a.doAction("hookAdded",r,u,o,c)}}var oe=De;function Ie(a,t,s=!1){return function(u,o){const c=a[t];if(!te(u)||!s&&!ie(o))return;if(!c[u])return 0;let g=0;if(s)g=c[u].handlers.length,c[u]={runs:c[u].runs,handlers:[]};else{const y=c[u].handlers;for(let h=y.length-1;h>=0;h--)y[h].namespace===o&&(y.splice(h,1),g++,c.__current.forEach(R=>{R.name===u&&R.currentIndex>=h&&R.currentIndex--}))}return u!=="hookRemoved"&&a.doAction("hookRemoved",u,o),g}}var V=Ie;function Oe(a,t){return function(r,u){const o=a[t];return typeof u<"u"?r in o&&o[r].handlers.some(c=>c.namespace===u):r in o}}var ue=Oe;function Le(a,t,s,r){return function(o,...c){const g=a[t];g[o]||(g[o]={handlers:[],runs:0}),g[o].runs++;const y=g[o].handlers;if(!y||!y.length)return s?c[0]:void 0;const h={name:o,currentIndex:0};async function R(){try{g.__current.add(h);let S=s?c[0]:void 0;for(;h.currentIndex<y.length;)S=await y[h.currentIndex].callback.apply(null,c),s&&(c[0]=S),h.currentIndex++;return s?S:void 0}finally{g.__current.delete(h)}}function C(){try{g.__current.add(h);let S=s?c[0]:void 0;for(;h.currentIndex<y.length;)S=y[h.currentIndex].callback.apply(null,c),s&&(c[0]=S),h.currentIndex++;return s?S:void 0}finally{g.__current.delete(h)}}return(r?R:C)()}}var Y=Le;function He(a,t){return function(){const r=a[t];return Array.from(r.__current).at(-1)?.name??null}}var me=He;function je(a,t){return function(r){const u=a[t];return typeof r>"u"?u.__current.size>0:Array.from(u.__current).some(o=>o.name===r)}}var de=je;function Pe(a,t){return function(r){const u=a[t];if(te(r))return u[r]&&u[r].runs?u[r].runs:0}}var pe=Pe,Te=class{actions;filters;addAction;addFilter;removeAction;removeFilter;hasAction;hasFilter;removeAllActions;removeAllFilters;doAction;doActionAsync;applyFilters;applyFiltersAsync;currentAction;currentFilter;doingAction;doingFilter;didAction;didFilter;constructor(){this.actions=Object.create(null),this.actions.__current=new Set,this.filters=Object.create(null),this.filters.__current=new Set,this.addAction=oe(this,"actions"),this.addFilter=oe(this,"filters"),this.removeAction=V(this,"actions"),this.removeFilter=V(this,"filters"),this.hasAction=ue(this,"actions"),this.hasFilter=ue(this,"filters"),this.removeAllActions=V(this,"actions",!0),this.removeAllFilters=V(this,"filters",!0),this.doAction=Y(this,"actions",!1,!1),this.doActionAsync=Y(this,"actions",!1,!0),this.applyFilters=Y(this,"filters",!0,!1),this.applyFiltersAsync=Y(this,"filters",!0,!0),this.currentAction=me(this,"actions"),this.currentFilter=me(this,"filters"),this.doingAction=de(this,"actions"),this.doingFilter=de(this,"filters"),this.didAction=pe(this,"actions"),this.didFilter=pe(this,"filters")}};function Ue(){return new Te}var Ze=Ue,fe=Ze(),{addAction:Ct,addFilter:Ft,removeAction:Dt,removeFilter:It,hasAction:Ot,hasFilter:Lt,removeAllActions:Ht,removeAllFilters:jt,doAction:Pt,doActionAsync:Tt,applyFilters:Ut,applyFiltersAsync:Zt,currentAction:$t,currentFilter:Mt,doingAction:Bt,doingFilter:qt,didAction:Wt,didFilter:Gt,actions:Jt,filters:Vt}=fe,N=Ae(void 0,void 0,fe);N.getLocaleData.bind(N),N.setLocaleData.bind(N),N.resetLocaleData.bind(N),N.subscribe.bind(N);var m=N.__.bind(N);N._x.bind(N),N._n.bind(N),N._nx.bind(N),N.isRTL.bind(N),N.hasTranslation.bind(N);function ve(){return Math.random().toString(36).substring(2,10)}function ge(){return{enabled:!1,minimum:{value:null,unit:"day"},maximum:{value:null,unit:"day"}}}function $e({config:a,zones:t,rates:s,onZonesChange:r,onRatesChange:u,onGoBack:o,onSave:c,saving:g,context:y}){const[h,R]=p.useState(null),[C,S]=p.useState(null),[O,Z]=p.useState({}),[P,T]=p.useState({}),[L,U]=p.useState(null),[H,v]=p.useState(null),f=a.shipping_countries||{},E=a.shipping_countries_by_continent||{},x=a.shipping_classes||{},k=a.primary_currency||"USD",$=p.useCallback(()=>{const e={key:ve(),label:"",regions:[]};r([...t,e]),R(e)},[t,r]),tt=p.useCallback(e=>{const l=[...t];l.splice(e,1),r(l),h===t[e]&&R(null)},[t,r,h]),I=p.useCallback((e,l)=>{const n=[...t];n[e]={...n[e],...l},r(n)},[t,r]),A=p.useCallback(e=>t.findIndex(l=>l.key===e.key),[t]),nt=p.useCallback((e,l)=>{const n=E[l]||{};return Object.keys(n).some(i=>!e.regions.some(d=>d.country===i))},[E]),at=p.useCallback((e,l)=>{if(!l)return;const n=A(e);if(n!==-1)if(l.startsWith("continent:")){const i=l.substring(10),d=E[i]||{},b=Object.keys(d).filter(D=>!e.regions.some(J=>J.country===D)).map(D=>({country:D,states:[],zip_codes_enabled:!1,zip_codes:""}));I(n,{regions:[...e.regions,...b]})}else e.regions.some(i=>i.country===l)||I(n,{regions:[...e.regions,{country:l,states:[],zip_codes_enabled:!1,zip_codes:""}]})},[A,E,I]),st=p.useCallback(e=>{const l=A(e);if(l===-1)return;const n=Object.keys(f),i=e.regions.map(b=>b.country),d=n.filter(b=>!i.includes(b)).map(b=>({country:b,states:[],zip_codes_enabled:!1,zip_codes:""}));I(l,{regions:[...e.regions,...d]})},[A,f,I]),lt=p.useCallback(e=>{const l=A(e);l!==-1&&I(l,{regions:[]})},[A,I]),rt=p.useCallback((e,l)=>{const n=A(e);if(n===-1)return;const i=[...e.regions];i.splice(l,1),I(n,{regions:i})},[A,I]),j=p.useCallback((e,l,n)=>{const i=A(e);if(i===-1)return;const d=[...e.regions];d[l]={...d[l],...n},I(i,{regions:d})},[A,I]),M=p.useCallback(e=>f[e]?.states||{},[f]),ct=p.useCallback((e,l)=>M(e)[l]?.name||l,[M]),it=p.useCallback((e,l,n)=>{if(!n||A(e)===-1)return;const d=e.regions.findIndex(D=>D.country===l.country);if(d===-1)return;const b=l.states||[];b.includes(n)||j(e,d,{states:[...b,n]})},[A,j]),ot=p.useCallback((e,l,n)=>{if(A(e)===-1)return;const d=e.regions.findIndex(D=>D.country===l.country);if(d===-1)return;const b=[...l.states||[]];b.splice(n,1),j(e,d,{states:b})},[A,j]),ut=p.useCallback((e,l)=>{if(A(e)===-1)return;const i=e.regions.findIndex(b=>b.country===l.country);if(i===-1)return;const d=Object.keys(M(l.country));j(e,i,{states:d})},[A,M,j]),X=p.useCallback(e=>P[e.key]??null,[P]),he=p.useCallback((e,l)=>{T(n=>({...n,[e.key]:l}))},[]),mt=p.useCallback(e=>{const l={};return e.regions.forEach(n=>{const i=f[n.country]?.continent||"Other";l[i]=(l[i]||0)+1}),Object.entries(l).map(([n,i])=>({name:n,count:i})).sort((n,i)=>n.name.localeCompare(i.name))},[f]),dt=p.useCallback(e=>{const l=X(e),n={};return e.regions.forEach(i=>{const d=f[i.country]?.continent||"Other";l!==null&&d!==l||(n[d]||(n[d]=[]),n[d].push({region:i,name:f[i.country]?.name||i.country}))}),Object.keys(n).forEach(i=>{n[i].sort((d,b)=>d.name.localeCompare(b.name))}),n},[f,X]),pt=p.useCallback(()=>{const e={key:ve(),label:"",zone_keys:[],type:"free_shipping",free_shipping:{requirements:"none",minimum_order_amount:null,delivery_estimate:ge()},fixed_rate:{calculation_method:"per_item",amount_per_unit:null,shipping_classes:[],delivery_estimate:ge()}};u([...s,e]),S(e)},[s,u]),ft=p.useCallback(e=>{const l=s.findIndex(i=>i.key===e.key);if(l===-1)return;const n=[...s];n.splice(l,1),u(n),C===e&&S(null)},[s,u,C]),w=p.useCallback((e,l)=>{const n=s.findIndex(d=>d.key===e.key);if(n===-1)return;const i=[...s];i[n]={...i[n],...l},u(i)},[s,u]),G=p.useCallback(e=>t.filter(l=>e.zone_keys.includes(l.key)),[t]),ne=p.useCallback((e,l)=>e.zone_keys.includes(l),[]),vt=p.useCallback((e,l)=>{!l||ne(e,l)||w(e,{zone_keys:[...e.zone_keys,l]})},[ne,w]),gt=p.useCallback((e,l)=>{w(e,{zone_keys:e.zone_keys.filter(n=>n!==l)})},[w]),ht=p.useCallback(e=>{w(e,{zone_keys:t.map(l=>l.key)})},[t,w]),Rt=p.useCallback(e=>{w(e,{zone_keys:[]})},[w]),yt=p.useCallback((e,l)=>{if(e.fixed_rate.shipping_classes.some(i=>i.shipping_class===l))return;const n=[...e.fixed_rate.shipping_classes,{shipping_class:l,amount_per_unit:null}];w(e,{fixed_rate:{...e.fixed_rate,shipping_classes:n}})},[w]),Et=p.useCallback((e,l)=>{const n=[...e.fixed_rate.shipping_classes];n.splice(l,1),w(e,{fixed_rate:{...e.fixed_rate,shipping_classes:n}})},[w]),bt=p.useCallback((e,l,n)=>{const i=[...e.fixed_rate.shipping_classes];i[l]={...i[l],amount_per_unit:n},w(e,{fixed_rate:{...e.fixed_rate,shipping_classes:i}})},[w]),Re=p.useCallback(e=>Object.values(x).filter(l=>!e.fixed_rate.shipping_classes.some(n=>n.shipping_class===l.key)),[x]),B=p.useCallback((e,l,n)=>{const d={...e[l].delivery_estimate,...n};w(e,{[l]:{...e[l],delivery_estimate:d}})},[w]),_t=p.useCallback((e,l)=>{U(l),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",String(l))},[]),xt=p.useCallback((e,l)=>{if(e.preventDefault(),L===null||L===l)return;const n=[...t],[i]=n.splice(L,1);n.splice(l,0,i),r(n),U(l)},[L,t,r]),wt=p.useCallback(()=>{U(null)},[]),kt=p.useCallback((e,l)=>{v(l),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",String(l))},[]),Nt=p.useCallback((e,l)=>{if(e.preventDefault(),H===null||H===l)return;const n=[...s],[i]=n.splice(H,1);n.splice(l,0,i),u(n),v(l)},[H,s,u]),St=p.useCallback(()=>{v(null)},[]);p.useCallback(e=>f[e]?.name||e,[f]);const F=(e,l)=>{const n=e||l;return n.startsWith("svg:")?React.createElement("img",{src:n.substring(4),alt:"",className:"ts-icon"}):React.createElement("i",{className:n})},ye=(e,l)=>{const n=e[l].delivery_estimate;return React.createElement("div",{className:"ts-form-group vx-1-1"},React.createElement("label",null,React.createElement("div",{className:"switch-slider"},React.createElement("div",{className:"onoffswitch"},React.createElement("input",{type:"checkbox",className:"onoffswitch-checkbox",checked:n.enabled,onChange:i=>B(e,l,{enabled:i.target.checked})}),React.createElement("label",{className:"onoffswitch-label",onClick:i=>{i.preventDefault(),B(e,l,{enabled:!n.enabled})}}))),m("Add delivery estimate?","voxel-fse")),n.enabled&&React.createElement("div",{className:"medium form-field-grid"},React.createElement("div",{className:"ts-form-group vx-1-2"},React.createElement("label",null,m("Between","voxel-fse")),React.createElement("input",{type:"number",className:"ts-filter",value:n.minimum.value??"",onChange:i=>B(e,l,{minimum:{...n.minimum,value:i.target.value?parseInt(i.target.value):null}})})),React.createElement("div",{className:"ts-form-group vx-1-2"},React.createElement("label",null,m("Period","voxel-fse")),React.createElement("div",{className:"ts-filter"},React.createElement("select",{value:n.minimum.unit,onChange:i=>B(e,l,{minimum:{...n.minimum,unit:i.target.value}})},React.createElement("option",{value:"hour"},m("Hour(s)","voxel-fse")),React.createElement("option",{value:"day"},m("Day(s)","voxel-fse")),React.createElement("option",{value:"business_day"},m("Business day(s)","voxel-fse")),React.createElement("option",{value:"week"},m("Week(s)","voxel-fse")),React.createElement("option",{value:"month"},m("Month(s)","voxel-fse"))),React.createElement("div",{className:"ts-down-icon"}))),React.createElement("div",{className:"ts-form-group vx-1-2"},React.createElement("label",null,m("And","voxel-fse")),React.createElement("input",{type:"number",className:"ts-filter",value:n.maximum.value??"",onChange:i=>B(e,l,{maximum:{...n.maximum,value:i.target.value?parseInt(i.target.value):null}})})),React.createElement("div",{className:"ts-form-group vx-1-2"},React.createElement("label",null,m("Period","voxel-fse")),React.createElement("div",{className:"ts-filter"},React.createElement("select",{value:n.maximum.unit,onChange:i=>B(e,l,{maximum:{...n.maximum,unit:i.target.value}})},React.createElement("option",{value:"hour"},m("Hour(s)","voxel-fse")),React.createElement("option",{value:"day"},m("Day(s)","voxel-fse")),React.createElement("option",{value:"business_day"},m("Business day(s)","voxel-fse")),React.createElement("option",{value:"week"},m("Week(s)","voxel-fse")),React.createElement("option",{value:"month"},m("Month(s)","voxel-fse"))),React.createElement("div",{className:"ts-down-icon"})))))};return React.createElement("div",{className:"ts-vendor-shipping-zones",style:{marginTop:"20px"}},React.createElement("div",{className:"ac-body"},React.createElement("div",{className:"ts-form"},React.createElement("div",{className:"create-form-step form-field-grid"},React.createElement("div",{className:"ts-form-group ui-heading-field field-key-ui-heading"},React.createElement("label",null,m("Configure Shipping","voxel-fse"))),React.createElement("div",{className:"ts-form-group"},React.createElement("label",null,m("Shipping zones","voxel-fse")),t.length>0&&React.createElement("div",{className:"ts-repeater-container"},t.map((e,l)=>React.createElement("div",{key:e.key,className:`ts-field-repeater ${h!==e?"collapsed":""}`,draggable:!0,onDragStart:n=>_t(n,l),onDragOver:n=>xt(n,l),onDragEnd:wt,style:L===l?{opacity:.5}:void 0},React.createElement("div",{className:"ts-repeater-head ts-repeater-head--zone",onClick:()=>R(h===e?null:e)},F(a.icons?.zone,"las la-flag"),React.createElement("label",null,e.label||m("Untitled zone","voxel-fse")),React.createElement("div",{className:"ts-repeater-controller"},React.createElement("a",{href:"#",onClick:n=>{n.stopPropagation(),n.preventDefault(),tt(l)},className:"ts-icon-btn ts-smaller no-drag"},F(a.icons?.trash,"las la-trash")),React.createElement("a",{href:"#",className:"ts-icon-btn ts-smaller no-drag",onClick:n=>n.preventDefault()},F(a.icons?.down,"las la-angle-down")))),h===e&&React.createElement("div",{className:"medium form-field-grid"},React.createElement("div",{className:"ts-form-group vx-1-1"},React.createElement("label",null,m("Label","voxel-fse")),React.createElement("input",{type:"text",className:"ts-filter",maxLength:32,value:e.label,onChange:n=>I(l,{label:n.target.value})})),React.createElement("div",{className:"ts-form-group vx-1-1"},React.createElement("label",null,m("Countries","voxel-fse"),React.createElement("span",{style:{marginLeft:"auto"}},React.createElement("a",{href:"#",onClick:n=>{n.preventDefault(),st(e)}},m("Select all","voxel-fse"))," / ",React.createElement("a",{href:"#",onClick:n=>{n.preventDefault(),lt(e)}},m("Unselect all","voxel-fse")))),React.createElement("div",{className:"ts-filter"},React.createElement("select",{onChange:n=>{at(e,n.target.value),n.target.value=""},value:""},React.createElement("option",{value:""},m("Add country","voxel-fse")),Object.keys(E).map(n=>nt(e,n)&&React.createElement("option",{key:`continent:${n}`,value:`continent:${n}`,style:{fontWeight:"bold"}},m("All in","voxel-fse")," ",n)),Object.entries(E).map(([n,i])=>React.createElement("optgroup",{key:n,label:n},Object.entries(i).map(([d,b])=>React.createElement("option",{key:d,value:d,disabled:e.regions.some(D=>D.country===d)},b))))),React.createElement("div",{className:"ts-down-icon"}))),React.createElement("div",{className:"ts-form-group vx-1-1"},e.regions.length>0?React.createElement(React.Fragment,null,React.createElement("div",{className:"ts-region-categories",style:{marginBottom:"20px"}},React.createElement("ul",{className:"simplify-ul addon-buttons flexify"},React.createElement("li",{onClick:n=>{n.preventDefault(),he(e,null)},className:X(e)===null?"adb-selected":""},m("All","voxel-fse")," (",e.regions.length,")"),mt(e).map(({name:n,count:i})=>React.createElement("li",{key:n,onClick:d=>{d.preventDefault(),he(e,n)},className:X(e)===n?"adb-selected":""},n," (",i,")")))),React.createElement("div",{className:"ts-repeater-container"},Object.entries(dt(e)).map(([n,i])=>i.map(({region:d,name:b})=>{const D=e.regions.findIndex(_=>_.country===d.country),J=O[e.key]?.country===d.country,At=Object.keys(M(d.country)).length>0;return React.createElement("div",{key:d.country,className:`ts-field-repeater ${J?"":"collapsed"}`},React.createElement("div",{className:"ts-repeater-head",onClick:()=>Z(_=>({..._,[e.key]:J?null:d}))},React.createElement("label",null,b),React.createElement("div",{className:"ts-repeater-controller"},React.createElement("a",{href:"#",onClick:_=>{_.stopPropagation(),_.preventDefault(),rt(e,D)},className:"ts-icon-btn ts-smaller"},F(a.icons?.trash,"las la-trash")))),J&&React.createElement("div",{className:"form-field-grid medium"},At&&React.createElement(React.Fragment,null,React.createElement("div",{className:"ts-form-group vx-1-1"},React.createElement("label",null,m("States","voxel-fse"),React.createElement("span",{style:{marginLeft:"auto"}},React.createElement("a",{href:"#",onClick:_=>{_.preventDefault(),ut(e,d)}},m("Select all","voxel-fse"))," / ",React.createElement("a",{href:"#",onClick:_=>{_.preventDefault(),j(e,D,{states:[]})}},m("Unselect all","voxel-fse")))),React.createElement("div",{className:"ts-filter"},React.createElement("select",{onChange:_=>{it(e,d,_.target.value),_.target.value=""},value:""},React.createElement("option",{value:""},m("Add state","voxel-fse")),Object.entries(M(d.country)).map(([_,ae])=>React.createElement("option",{key:_,value:_,disabled:(d.states||[]).includes(_)},ae.name||_))),React.createElement("div",{className:"ts-down-icon"}))),React.createElement("div",{className:"ts-form-group vx-1-1"},(d.states?.length??0)>0?React.createElement("div",{className:"flexify simplify-ul attribute-select"},d.states?.map((_,ae)=>React.createElement("a",{key:_,href:"#",onClick:Q=>Q.preventDefault()},ct(d.country,_),React.createElement("span",{onClick:Q=>{Q.preventDefault(),Q.stopPropagation(),ot(e,d,ae)}},F(a.icons?.trash,"las la-trash"))))):React.createElement("label",{style:{paddingBottom:0}},m("No states selected. Leave empty to allow all states in this country.","voxel-fse")))),React.createElement("div",{className:"ts-form-group vx-1-1 switch-slider"},React.createElement("label",null,m("Limit by ZIP codes","voxel-fse")),React.createElement("div",{className:"onoffswitch"},React.createElement("input",{type:"checkbox",className:"onoffswitch-checkbox",id:`switcher-zip-${d.country}`,checked:d.zip_codes_enabled||!1,onChange:_=>j(e,D,{zip_codes_enabled:_.target.checked})}),React.createElement("label",{className:"onoffswitch-label",htmlFor:`switcher-zip-${d.country}`}))),d.zip_codes_enabled&&React.createElement("div",{className:"ts-form-group vx-1-1"},React.createElement("label",null,m("Limit to specific ZIP/postcodes in this country (one per line).","voxel-fse")),React.createElement("textarea",{className:"ts-filter",rows:3,style:{minHeight:"120px"},placeholder:m("Enter ZIP codes one per line","voxel-fse"),value:d.zip_codes||"",onChange:_=>j(e,D,{zip_codes:_.target.value})}))))})))):React.createElement("label",{style:{paddingBottom:0}},m("You have not added any countries yet.","voxel-fse"))))))),React.createElement("a",{href:"#",className:"ts-repeater-add ts-btn ts-btn-4 form-btn",onClick:e=>{e.preventDefault(),$()}},F(a.icons?.add,"las la-plus"),m("Add shipping zone","voxel-fse"))),React.createElement("div",{className:"ts-form-group"},React.createElement("label",null,m("Shipping rates","voxel-fse")),s.length>0&&React.createElement("div",{className:"ts-repeater-container"},s.map((e,l)=>React.createElement("div",{key:e.key,className:`ts-field-repeater ${C!==e?"collapsed":""}`,draggable:!0,onDragStart:n=>kt(n,l),onDragOver:n=>Nt(n,l),onDragEnd:St,style:H===l?{opacity:.5}:void 0},React.createElement("div",{className:"ts-repeater-head ts-repeater-head--rate",onClick:()=>S(C===e?null:e)},F(a.icons?.rate,"las la-box"),React.createElement("label",null,e.label||m("Untitled rate","voxel-fse")),G(e).length>0&&React.createElement("em",null,G(e).length===1?m("1 zone","voxel-fse"):`${G(e).length} ${m("zones","voxel-fse")}`),React.createElement("div",{className:"ts-repeater-controller"},React.createElement("a",{href:"#",onClick:n=>{n.stopPropagation(),n.preventDefault(),ft(e)},className:"ts-icon-btn ts-smaller no-drag"},F(a.icons?.trash,"las la-trash")),React.createElement("a",{href:"#",className:"ts-icon-btn ts-smaller no-drag",onClick:n=>n.preventDefault()},F(a.icons?.down,"las la-angle-down")))),C===e&&React.createElement("div",{className:"medium form-field-grid"},React.createElement("div",{className:"ts-form-group vx-1-1"},React.createElement("label",null,m("Label","voxel-fse")),React.createElement("input",{type:"text",className:"ts-filter",maxLength:32,value:e.label,onChange:n=>w(e,{label:n.target.value})})),React.createElement("div",{className:"ts-form-group vx-1-1"},React.createElement("label",null,m("Zones","voxel-fse"),React.createElement("span",{style:{marginLeft:"auto"}},React.createElement("a",{href:"#",onClick:n=>{n.preventDefault(),ht(e)}},m("Select all","voxel-fse"))," / ",React.createElement("a",{href:"#",onClick:n=>{n.preventDefault(),Rt(e)}},m("Unselect all","voxel-fse")))),React.createElement("div",{className:"ts-filter"},React.createElement("select",{onChange:n=>{vt(e,n.target.value),n.target.value=""},value:""},React.createElement("option",{value:""},m("Add zone","voxel-fse")),t.map(n=>React.createElement("option",{key:n.key,value:n.key,disabled:ne(e,n.key)},n.label||m("Untitled zone","voxel-fse")))),React.createElement("div",{className:"ts-down-icon"}))),React.createElement("div",{className:"ts-form-group vx-1-1"},G(e).length>0?React.createElement("div",{className:"flexify simplify-ul attribute-select"},G(e).map(n=>React.createElement("a",{key:n.key,href:"#",onClick:i=>i.preventDefault()},n.label||m("Untitled zone","voxel-fse"),React.createElement("span",{onClick:i=>{i.preventDefault(),i.stopPropagation(),gt(e,n.key)}},F(a.icons?.trash,"las la-trash"))))):React.createElement("label",{style:{paddingBottom:0}},m("No zones selected. Select zones where this rate applies.","voxel-fse"))),React.createElement("div",{className:"ts-form-group vx-1-1"},React.createElement("label",null,m("Type","voxel-fse")),React.createElement("div",{className:"ts-filter"},React.createElement("select",{value:e.type,onChange:n=>w(e,{type:n.target.value})},React.createElement("option",{value:"free_shipping"},m("Free shipping","voxel-fse")),React.createElement("option",{value:"fixed_rate"},m("Flat rate","voxel-fse"))),React.createElement("div",{className:"ts-down-icon"}))),e.type==="free_shipping"&&React.createElement(React.Fragment,null,React.createElement("div",{className:"ts-form-group vx-1-1"},React.createElement("label",null,m("Free shipping requires","voxel-fse")),React.createElement("div",{className:"ts-filter"},React.createElement("select",{value:e.free_shipping.requirements,onChange:n=>w(e,{free_shipping:{...e.free_shipping,requirements:n.target.value}})},React.createElement("option",{value:"none"},m("No requirement","voxel-fse")),React.createElement("option",{value:"minimum_order_amount"},m("Minimum order amount","voxel-fse"))),React.createElement("div",{className:"ts-down-icon"}))),e.free_shipping.requirements==="minimum_order_amount"&&React.createElement("div",{className:"ts-form-group vx-1-1"},React.createElement("label",null,m("Min. order amount","voxel-fse")),React.createElement("div",{className:"input-container"},React.createElement("input",{type:"number",step:"any",className:"ts-filter",value:e.free_shipping.minimum_order_amount??"",onChange:n=>w(e,{free_shipping:{...e.free_shipping,minimum_order_amount:n.target.value?parseFloat(n.target.value):null}})}),React.createElement("span",{className:"input-suffix"},k))),ye(e,"free_shipping")),e.type==="fixed_rate"&&React.createElement(React.Fragment,null,React.createElement("div",{className:"ts-form-group vx-1-1"},React.createElement("label",null,m("Calculation method","voxel-fse")),React.createElement("div",{className:"ts-filter"},React.createElement("select",{value:e.fixed_rate.calculation_method,onChange:n=>w(e,{fixed_rate:{...e.fixed_rate,calculation_method:n.target.value}})},React.createElement("option",{value:"per_item"},m("Per item: Charge per item/quantity (default)","voxel-fse")),React.createElement("option",{value:"per_order"},m("Per order: Fixed cost regardless of quantity or number of items","voxel-fse")),React.createElement("option",{value:"per_class"},m("Per class: Use the highest shipping class cost","voxel-fse"))),React.createElement("div",{className:"ts-down-icon"}))),React.createElement("div",{className:"ts-form-group vx-1-1"},React.createElement("label",null,m("Price per unit","voxel-fse")),React.createElement("div",{className:"input-container"},React.createElement("input",{type:"number",step:"any",className:"ts-filter",value:e.fixed_rate.amount_per_unit??"",onChange:n=>w(e,{fixed_rate:{...e.fixed_rate,amount_per_unit:n.target.value?parseFloat(n.target.value):null}})}),React.createElement("span",{className:"input-suffix"},k))),e.fixed_rate.calculation_method!=="per_order"&&Object.keys(x).length>0&&React.createElement("div",{className:"ts-form-group vx-1-1"},React.createElement("div",{className:"medium form-field-grid"},React.createElement("div",{className:"ts-form-group vx-1-1 ui-heading-field"},React.createElement("label",null,m("Price by class","voxel-fse"))),e.fixed_rate.shipping_classes.map((n,i)=>{const d=x[n.shipping_class];return d?React.createElement(React.Fragment,null,React.createElement("div",{key:`class-${i}`,className:"ts-form-group vx-1-2"},React.createElement("label",null,d.label),React.createElement("div",{className:"input-container"},React.createElement("input",{className:"ts-filter",type:"number",step:"any",value:n.amount_per_unit??"",onChange:b=>bt(e,i,b.target.value?parseFloat(b.target.value):null)}),React.createElement("span",{className:"input-suffix"},k))),React.createElement("div",{key:`remove-${i}`,className:"ts-form-group vx-1-2"},React.createElement("label",null,"Â "),React.createElement("a",{href:"#",onClick:b=>{b.preventDefault(),Et(e,i)},className:"ts-btn ts-btn-1 form-btn"},F(a.icons?.trash,"las la-trash"),m("Remove","voxel-fse")))):null}),Re(e).length>0&&React.createElement("div",{className:"ts-form-group"},React.createElement("div",{className:"flexify simplify-ul attribute-select"},Re(e).map(n=>React.createElement("a",{key:n.key,href:"#",onClick:i=>{i.preventDefault(),yt(e,n.key)}},n.label)))))),ye(e,"fixed_rate")))))),React.createElement("a",{href:"#",className:"ts-repeater-add ts-btn ts-btn-4 form-btn",onClick:e=>{e.preventDefault(),pt()}},F(a.icons?.add,"las la-plus"),m("Add shipping rate","voxel-fse"))),React.createElement("div",{className:"ts-form-group vx-1-2"},React.createElement("a",{href:"#",className:"ts-btn ts-btn-1 ts-btn-large",onClick:e=>{e.preventDefault(),o()}},F(a.icons?.chevronLeft,"las la-angle-left"),m("Go back","voxel-fse"))),React.createElement("div",{className:"ts-form-group vx-1-2"},React.createElement("a",{href:"#",className:`ts-btn ts-btn-2 ts-btn-large ${g?"vx-disabled":""}`,onClick:e=>{e.preventDefault(),g||c()}},F(a.icons?.save,"las la-save"),m("Save changes","voxel-fse")))))))}function W(a,t){if(!a&&!t)return null;const s=a||t||"";if(s.startsWith("svg:")){const r=s.substring(4);return React.createElement("img",{src:r,alt:"",className:"ts-icon"})}return React.createElement("i",{className:s})}function Me(){return"/wp-content/themes/voxel/assets/images/Connect-social-card.png"}function Be({attributes:a,config:t,context:s,onSaveShipping:r}){const[u,o]=p.useState("main"),[c,g]=p.useState(!1),[y,h]=p.useState(t.shipping_zones||[]),[R,C]=p.useState(t.shipping_rates||[]),S=a.genImage?.url||t.icons?.setup||Me(),O=p.useCallback(async()=>{if(!(c||!r)){g(!0);try{await r(y,R)}finally{g(!1)}}},[c,r,y,R]),Z=t.is_admin,P=t.admin_onboarding_enabled,T=t.account,L=()=>Z&&!P?m("Stripe vendor onboarding is not necessary for admin accounts.","voxel-fse"):T.charges_enabled?m("Your account is ready to accept payments.","voxel-fse"):T.details_submitted?m("Your account is pending verification.","voxel-fse"):m("Setup your Stripe vendor account in order to accept payments.","voxel-fse"),U={genImage:a.genImage||{id:0,url:""},icons:t.icons};return React.createElement(React.Fragment,null,React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(U)}}),u==="main"&&React.createElement("div",{className:"ts-panel"},React.createElement("img",{src:S,alt:"",style:{width:"100%",height:"auto",borderRadius:"8px 8px 0 0"}}),React.createElement("div",{className:"ac-body"},Z&&!P?React.createElement("p",null,L()):React.createElement(React.Fragment,null,React.createElement("p",null,L()),T.exists?T.details_submitted?React.createElement(React.Fragment,null,React.createElement("div",{className:"ac-bottom"},React.createElement("ul",{className:"simplify-ul current-plan-btn"},React.createElement("li",null,React.createElement("a",{href:t.dashboard_link,target:"_blank",rel:"noopener noreferrer",className:"ts-btn ts-btn-1 ts-btn-large"},W(t.icons?.stripe,"lab la-stripe"),m("Stripe Express Dashboard","voxel-fse"))))),React.createElement("div",{className:"ac-bottom"},React.createElement("ul",{className:"simplify-ul current-plan-btn"},React.createElement("li",null,React.createElement("a",{href:t.onboard_link,className:"ts-btn ts-btn-1 ts-btn-large"},W(t.icons?.update,"las la-pen"),m("Update information","voxel-fse"))),t.shipping_enabled&&React.createElement("li",null,React.createElement("a",{href:"#",className:"ts-btn ts-btn-1 ts-btn-large",onClick:H=>{H.preventDefault(),o("shipping")}},W(t.icons?.shipping,"las la-shipping-fast"),m("Configure shipping","voxel-fse")))))):React.createElement("div",{className:"ac-bottom"},React.createElement("ul",{className:"simplify-ul current-plan-btn"},React.createElement("li",null,React.createElement("a",{href:t.onboard_link,className:"ts-btn ts-btn-1 ts-btn-large"},W(t.icons?.submit,"las la-info-circle"),m("Complete onboarding","voxel-fse"))))):React.createElement("div",{className:"ac-bottom"},React.createElement("ul",{className:"simplify-ul current-plan-btn"},React.createElement("li",null,React.createElement("a",{href:t.onboard_link,className:"ts-btn ts-btn-1 ts-btn-large"},W(t.icons?.setup,"las la-plus"),m("Start setup","voxel-fse")))))))),u==="shipping"&&t.shipping_enabled&&React.createElement($e,{config:t,zones:y,rates:R,onZonesChange:h,onRatesChange:C,onGoBack:()=>o("main"),onSave:O,saving:c,context:s}))}function qe(){if(typeof window<"u"&&window.wpApiSettings?.root)return window.wpApiSettings.root.replace(/\/wp-json\/?$/,"")+"?vx=1";if(typeof document<"u"){const a=document.querySelector('link[rel="https://api.w.org/"]');if(a){const t=a.getAttribute("href");if(t)return t.replace(/\/wp-json\/?$/,"")+"?vx=1"}}return typeof window<"u"?window.location.origin+"?vx=1":"/?vx=1"}function We(){if(typeof window<"u"&&window.wpApiSettings?.root)return window.wpApiSettings.root;if(typeof document<"u"){const a=document.querySelector('link[rel="https://api.w.org/"]');if(a){const t=a.getAttribute("href");if(t)return t}}if(typeof window<"u"&&window.location?.origin){const a=window.location.pathname.split("/").filter(Boolean),t=["wp-admin","wp-content","wp-includes","wp-json"];return a.length>0&&!t.includes(a[0])?window.location.origin+"/"+a[0]+"/wp-json/":window.location.origin+"/wp-json/"}return"/wp-json/"}function Ge(){return We()}function Je(){return typeof window<"u"&&window.voxelStripeAccount?.ajaxUrl?window.voxelStripeAccount.ajaxUrl:qe()}function Ve(){return typeof window<"u"&&window.wpApiSettings?.nonce?window.wpApiSettings.nonce:""}function Ye(a){const t=(o,c)=>typeof o=="string"?o:typeof o=="number"?String(o):c,s=(o,c)=>{if(typeof o=="number")return o;if(typeof o=="string"){const g=parseInt(o,10);if(!isNaN(g))return g}return c},r=o=>{if(o&&typeof o=="object"){const c=o;return{id:s(c.id,0),url:t(c.url,"")}}return{id:0,url:""}},u=o=>{if(!o||typeof o!="object")return{};const c=o;return{setup:t(c.setup??c.ts_setup_ico,""),submit:t(c.submit??c.ts_submit_ico,""),update:t(c.update??c.ts_update_ico,""),stripe:t(c.stripe??c.ts_stripe_ico,""),shipping:t(c.shipping??c.ts_shipping_ico,""),chevronLeft:t(c.chevronLeft??c.ts_chevron_left,""),save:t(c.save??c.save_icon,""),handle:t(c.handle??c.handle_icon,""),zone:t(c.zone??c.ts_zone_ico,""),rate:t(c.rate??c.box_icon,""),trash:t(c.trash??c.trash_icon,""),down:t(c.down??c.down_icon,""),search:t(c.search??c.ts_search_icon,""),add:t(c.add??c.ts_add_icon,"")}};return{genImage:r(a.genImage??a.gen_image),genImageDynamicTag:t(a.genImageDynamicTag??a.gen_image_dynamic_tag,""),icons:u(a.icons)}}function Ke(a){const t=a.querySelector("script.vxconfig");if(t&&t.textContent)try{const s=JSON.parse(t.textContent);return Ye(s)}catch(s){console.error("[Stripe Account] Failed to parse vxconfig:",s)}return null}function Xe(a){const t=s=>s?s.startsWith("svg:")?{library:"svg",url:s.substring(4)}:{library:"icon",value:s}:null;return{genImage:a.genImage||{id:0,url:""},genImageDynamicTag:a.genImageDynamicTag||"",previewAsUser:null,tsSetupIco:t(a.icons?.setup),tsSubmitIco:t(a.icons?.submit),tsUpdateIco:t(a.icons?.update),tsStripeIco:t(a.icons?.stripe),tsShippingIco:t(a.icons?.shipping),tsChevronLeft:t(a.icons?.chevronLeft),saveIcon:t(a.icons?.save),handleIcon:t(a.icons?.handle),tsZoneIco:t(a.icons?.zone),trashIcon:t(a.icons?.trash),downIcon:t(a.icons?.down),tsSearchIcon:t(a.icons?.search),tsAddIcon:t(a.icons?.add)}}async function Qe(){const t=`${Ge()}voxel-fse/v1/stripe-account/config`;try{const s=await fetch(t,{headers:{"Content-Type":"application/json","X-WP-Nonce":Ve()},credentials:"same-origin"});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const r=await s.json();return r.success&&r.data?r.data:null}catch(s){return console.error("[Stripe Account] Failed to fetch config:",s),null}}async function ze(a,t,s){const r=Je(),u=new FormData;u.append("action","stripe_connect.account.save_shipping"),u.append("_wpnonce",s),u.append("shipping_zones",JSON.stringify(a)),u.append("shipping_rates",JSON.stringify(t));try{const o=await fetch(r,{method:"POST",body:u,credentials:"same-origin"});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const c=await o.json();return{success:c.success??!1,message:c.message||""}}catch(o){return console.error("[Stripe Account] Failed to save shipping:",o),{success:!1,message:o instanceof Error?o.message:"Failed to save shipping configuration"}}}function et({attributes:a}){const[t,s]=p.useState(null),[r,u]=p.useState(!0),[o,c]=p.useState(null);p.useEffect(()=>{let y=!1;async function h(){u(!0),c(null);try{const R=await Qe();y||(R?s(R):c("Failed to load Stripe account configuration"))}catch(R){y||c(R instanceof Error?R.message:"Failed to load")}finally{y||u(!1)}}return h(),()=>{y=!0}},[]);const g=async(y,h)=>{if(!t?.nonce)throw alert("Security nonce missing. Please refresh the page."),new Error("Missing nonce");const R=await ze(y,h,t.nonce);if(!R.success)throw typeof window<"u"&&window.Voxel?.alert?window.Voxel.alert(R.message||"Failed to save shipping configuration"):alert(R.message||"Failed to save shipping configuration"),new Error(R.message);typeof window<"u"&&window.Voxel?.alert?window.Voxel.alert(R.message||"Shipping configuration saved successfully"):alert(R.message||"Shipping configuration saved successfully")};return r?React.createElement("div",{className:"ts-panel"},React.createElement("div",{className:"ac-body",style:{textAlign:"center",padding:"40px"}},React.createElement("p",null,"Loading Stripe account..."))):o?React.createElement("div",{className:"ts-panel"},React.createElement("div",{className:"ac-body",style:{textAlign:"center",padding:"40px",color:"#d32f2f"}},React.createElement("p",null,"Error: ",o))):t?React.createElement(Be,{attributes:a,config:t,context:"frontend",onSaveShipping:g}):React.createElement("div",{className:"ts-panel"},React.createElement("div",{className:"ac-body",style:{textAlign:"center",padding:"40px"}},React.createElement("p",null,"Stripe Connect is not configured.")))}function K(){document.querySelectorAll(".voxel-fse-stripe-account-frontend:not([data-react-mounted])").forEach(t=>{t.setAttribute("data-react-mounted","true");const s=Ke(t);if(!s){console.error("[Stripe Account] Failed to find vxconfig");return}const r=Xe(s);t.innerHTML="",Ee.createRoot(t).render(React.createElement(et,{attributes:r}))})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",K):K(),window.addEventListener("turbo:load",K),window.addEventListener("pjax:complete",K)})(ReactDOM,React);
