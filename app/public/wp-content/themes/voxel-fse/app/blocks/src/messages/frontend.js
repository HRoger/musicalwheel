(function(ye,v){"use strict";var Z,ne,U,re;Z={"(":9,"!":8,"*":7,"/":7,"%":7,"+":6,"-":6,"<":5,"<=":5,">":5,">=":5,"==":4,"!=":4,"&&":3,"||":2,"?":1,"?:":1},ne=["(","?"],U={")":["("],":":["?","?:"]},re=/<=|>=|==|!=|&&|\|\||\?:|\(|!|\*|\/|%|\+|-|<|>|\?|\)|:/;function _e(a){for(var o=[],l=[],n,t,i,f;n=a.match(re);){for(t=n[0],i=a.substr(0,n.index).trim(),i&&o.push(i);f=l.pop();){if(U[t]){if(U[t][0]===f){t=U[t][1]||t;break}}else if(ne.indexOf(f)>=0||Z[f]<Z[t]){l.push(f);break}o.push(f)}U[t]||l.push(t),a=a.substr(n.index+t.length)}return a=a.trim(),a&&o.push(a),o.concat(l.reverse())}var Ce={"!":function(a){return!a},"*":function(a,o){return a*o},"/":function(a,o){return a/o},"%":function(a,o){return a%o},"+":function(a,o){return a+o},"-":function(a,o){return a-o},"<":function(a,o){return a<o},"<=":function(a,o){return a<=o},">":function(a,o){return a>o},">=":function(a,o){return a>=o},"==":function(a,o){return a===o},"!=":function(a,o){return a!==o},"&&":function(a,o){return a&&o},"||":function(a,o){return a||o},"?:":function(a,o,l){if(a)throw o;return l}};function be(a,o){var l=[],n,t,i,f,p,_;for(n=0;n<a.length;n++){if(p=a[n],f=Ce[p],f){for(t=f.length,i=Array(t);t--;)i[t]=l.pop();try{_=f.apply(null,i)}catch(C){return C}}else o.hasOwnProperty(p)?_=o[p]:_=+p;l.push(_)}return l[0]}function xe(a){var o=_e(a);return function(l){return be(o,l)}}function Re(a){var o=xe(a);return function(l){return+o({n:l})}}var oe={contextDelimiter:"",onMissingKey:null};function Ee(a){var o,l,n;for(o=a.split(";"),l=0;l<o.length;l++)if(n=o[l].trim(),n.indexOf("plural=")===0)return n.substr(7)}function G(a,o){var l;this.data=a,this.pluralForms={},this.options={};for(l in oe)this.options[l]=o!==void 0&&l in o?o[l]:oe[l]}G.prototype.getPluralForm=function(a,o){var l=this.pluralForms[a],n,t,i;return l||(n=this.data[a][""],i=n["Plural-Forms"]||n["plural-forms"]||n.plural_forms,typeof i!="function"&&(t=Ee(n["Plural-Forms"]||n["plural-forms"]||n.plural_forms),i=Re(t)),l=this.pluralForms[a]=i),l(o)},G.prototype.dcnpgettext=function(a,o,l,n,t){var i,f,p;return t===void 0?i=0:i=this.getPluralForm(a,t),f=l,o&&(f=o+this.options.contextDelimiter+l),p=this.data[a][f],p&&p[i]?p[i]:(this.options.onMissingKey&&this.options.onMissingKey(l,a),i===0?l:n)};var le={"":{plural_forms(a){return a===1?0:1}}},we=/^i18n\.(n?gettext|has_translation)(_|$)/,Se=(a,o,l)=>{const n=new G({}),t=new Set,i=()=>{t.forEach(m=>m())},f=m=>(t.add(m),()=>t.delete(m)),p=(m="default")=>n.data[m],_=(m,g="default")=>{n.data[g]={...n.data[g],...m},n.data[g][""]={...le[""],...n.data[g]?.[""]},delete n.pluralForms[g]},C=(m,g)=>{_(m,g),i()},k=(m,g="default")=>{n.data[g]={...n.data[g],...m,"":{...le[""],...n.data[g]?.[""],...m?.[""]}},delete n.pluralForms[g],i()},T=(m,g)=>{n.data={},n.pluralForms={},C(m,g)},y=(m="default",g,b,w,M)=>(n.data[m]||_(void 0,m),n.dcnpgettext(m,g,b,w,M)),A=m=>m||"default",I=(m,g)=>{let b=y(g,void 0,m);return l?(b=l.applyFilters("i18n.gettext",b,m,g),l.applyFilters("i18n.gettext_"+A(g),b,m,g)):b},P=(m,g,b)=>{let w=y(b,g,m);return l?(w=l.applyFilters("i18n.gettext_with_context",w,m,g,b),l.applyFilters("i18n.gettext_with_context_"+A(b),w,m,g,b)):w},ee=(m,g,b,w)=>{let M=y(w,void 0,m,g,b);return l?(M=l.applyFilters("i18n.ngettext",M,m,g,b,w),l.applyFilters("i18n.ngettext_"+A(w),M,m,g,b,w)):M},V=(m,g,b,w,M)=>{let H=y(M,w,m,g,b);return l?(H=l.applyFilters("i18n.ngettext_with_context",H,m,g,b,w,M),l.applyFilters("i18n.ngettext_with_context_"+A(M),H,m,g,b,w,M)):H},te=()=>P("ltr","text direction")==="rtl",ae=(m,g,b)=>{const w=g?g+""+m:m;let M=!!n.data?.[b??"default"]?.[w];return l&&(M=l.applyFilters("i18n.has_translation",M,m,g,b),M=l.applyFilters("i18n.has_translation_"+A(b),M,m,g,b)),M};if(l){const m=g=>{we.test(g)&&i()};l.addAction("hookAdded","core/i18n",m),l.addAction("hookRemoved","core/i18n",m)}return{getLocaleData:p,setLocaleData:C,addLocaleData:k,resetLocaleData:T,subscribe:f,__:I,_x:P,_n:ee,_nx:V,isRTL:te,hasTranslation:ae}};function ke(a){return typeof a!="string"||a===""?(console.error("The namespace must be a non-empty string."),!1):/^[a-zA-Z][a-zA-Z0-9_.\-\/]*$/.test(a)?!0:(console.error("The namespace can only contain numbers, letters, dashes, periods, underscores and slashes."),!1)}var ie=ke;function Me(a){return typeof a!="string"||a===""?(console.error("The hook name must be a non-empty string."),!1):/^__/.test(a)?(console.error("The hook name cannot begin with `__`."),!1):/^[a-zA-Z][a-zA-Z0-9_.-]*$/.test(a)?!0:(console.error("The hook name can only contain numbers, letters, dashes, periods and underscores."),!1)}var X=Me;function Te(a,o){return function(n,t,i,f=10){const p=a[o];if(!X(n)||!ie(t))return;if(typeof i!="function"){console.error("The hook callback must be a function.");return}if(typeof f!="number"){console.error("If specified, the hook priority must be a number.");return}const _={callback:i,priority:f,namespace:t};if(p[n]){const C=p[n].handlers;let k;for(k=C.length;k>0&&!(f>=C[k-1].priority);k--);k===C.length?C[k]=_:C.splice(k,0,_),p.__current.forEach(T=>{T.name===n&&T.currentIndex>=k&&T.currentIndex++})}else p[n]={handlers:[_],runs:0};n!=="hookAdded"&&a.doAction("hookAdded",n,t,i,f)}}var ce=Te;function je(a,o,l=!1){return function(t,i){const f=a[o];if(!X(t)||!l&&!ie(i))return;if(!f[t])return 0;let p=0;if(l)p=f[t].handlers.length,f[t]={runs:f[t].runs,handlers:[]};else{const _=f[t].handlers;for(let C=_.length-1;C>=0;C--)_[C].namespace===i&&(_.splice(C,1),p++,f.__current.forEach(k=>{k.name===t&&k.currentIndex>=C&&k.currentIndex--}))}return t!=="hookRemoved"&&a.doAction("hookRemoved",t,i),p}}var W=je;function Ae(a,o){return function(n,t){const i=a[o];return typeof t<"u"?n in i&&i[n].handlers.some(f=>f.namespace===t):n in i}}var ue=Ae;function Fe(a,o,l,n){return function(i,...f){const p=a[o];p[i]||(p[i]={handlers:[],runs:0}),p[i].runs++;const _=p[i].handlers;if(!_||!_.length)return l?f[0]:void 0;const C={name:i,currentIndex:0};async function k(){try{p.__current.add(C);let y=l?f[0]:void 0;for(;C.currentIndex<_.length;)y=await _[C.currentIndex].callback.apply(null,f),l&&(f[0]=y),C.currentIndex++;return l?y:void 0}finally{p.__current.delete(C)}}function T(){try{p.__current.add(C);let y=l?f[0]:void 0;for(;C.currentIndex<_.length;)y=_[C.currentIndex].callback.apply(null,f),l&&(f[0]=y),C.currentIndex++;return l?y:void 0}finally{p.__current.delete(C)}}return(n?k:T)()}}var K=Fe;function He(a,o){return function(){const n=a[o];return Array.from(n.__current).at(-1)?.name??null}}var de=He;function Le(a,o){return function(n){const t=a[o];return typeof n>"u"?t.__current.size>0:Array.from(t.__current).some(i=>i.name===n)}}var he=Le;function De(a,o){return function(n){const t=a[o];if(X(n))return t[n]&&t[n].runs?t[n].runs:0}}var me=De,Ie=class{actions;filters;addAction;addFilter;removeAction;removeFilter;hasAction;hasFilter;removeAllActions;removeAllFilters;doAction;doActionAsync;applyFilters;applyFiltersAsync;currentAction;currentFilter;doingAction;doingFilter;didAction;didFilter;constructor(){this.actions=Object.create(null),this.actions.__current=new Set,this.filters=Object.create(null),this.filters.__current=new Set,this.addAction=ce(this,"actions"),this.addFilter=ce(this,"filters"),this.removeAction=W(this,"actions"),this.removeFilter=W(this,"filters"),this.hasAction=ue(this,"actions"),this.hasFilter=ue(this,"filters"),this.removeAllActions=W(this,"actions",!0),this.removeAllFilters=W(this,"filters",!0),this.doAction=K(this,"actions",!1,!1),this.doActionAsync=K(this,"actions",!1,!0),this.applyFilters=K(this,"filters",!0,!1),this.applyFiltersAsync=K(this,"filters",!0,!0),this.currentAction=de(this,"actions"),this.currentFilter=de(this,"filters"),this.doingAction=he(this,"actions"),this.doingFilter=he(this,"filters"),this.didAction=me(this,"actions"),this.didFilter=me(this,"filters")}};function Ne(){return new Ie}var Be=Ne,fe=Be(),{addAction:lt,addFilter:it,removeAction:ct,removeFilter:ut,hasAction:dt,hasFilter:ht,removeAllActions:mt,removeAllFilters:ft,doAction:pt,doActionAsync:gt,applyFilters:vt,applyFiltersAsync:yt,currentAction:_t,currentFilter:Ct,doingAction:bt,doingFilter:xt,didAction:Rt,didFilter:Et,actions:wt,filters:St}=fe,S=Se(void 0,void 0,fe);S.getLocaleData.bind(S),S.setLocaleData.bind(S),S.resetLocaleData.bind(S),S.subscribe.bind(S);var R=S.__.bind(S);S._x.bind(S),S._n.bind(S),S._nx.bind(S),S.isRTL.bind(S),S.hasTranslation.bind(S);const L={search:'<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path></svg>',inbox:'<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z"></path><path d="M15 7v2a4 4 0 01-4 4H9.828l-1.766 1.767c.28.149.599.233.938.233h2l3 3v-3h2a2 2 0 002-2V9a2 2 0 00-2-2h-1z"></path></svg>',chevronLeft:'<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>',menu:'<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M6 10a2 2 0 11-4 0 2 2 0 014 0zM12 10a2 2 0 11-4 0 2 2 0 014 0zM16 12a2 2 0 100-4 2 2 0 000 4z"></path></svg>',reload:'<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"></path></svg>',send:'<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"></path></svg>',emoji:'<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 100-2 1 1 0 000 2zm7-1a1 1 0 11-2 0 1 1 0 012 0zm-.464 5.535a1 1 0 10-1.415-1.414 3 3 0 01-4.242 0 1 1 0 00-1.415 1.414 5 5 0 007.072 0z" clip-rule="evenodd"></path></svg>',attach:'<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M8 4a3 3 0 00-3 3v4a5 5 0 0010 0V7a1 1 0 112 0v4a7 7 0 11-14 0V7a5 5 0 0110 0v4a3 3 0 11-6 0V7a1 1 0 012 0v4a1 1 0 102 0V7a3 3 0 00-3-3z" clip-rule="evenodd"></path></svg>',close:'<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>',trash:'<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>',block:'<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M13.477 14.89A6 6 0 015.11 6.524l8.367 8.368zm1.414-1.414L6.524 5.11a6 6 0 018.367 8.367zM18 10a8 8 0 11-16 0 8 8 0 0116 0z" clip-rule="evenodd"></path></svg>'};function D(a,o){return a&&a.value?a.value:o}function Pe(a=8){const o="abcdefghijklmnopqrstuvwxyz0123456789";let l="";for(let n=0;n<a;n++)l+=o.charAt(Math.floor(Math.random()*o.length));return l}function Oe(a,o=300){let l=null;return((...n)=>{l&&clearTimeout(l),l=setTimeout(()=>a(...n),o)})}function Y(a){return new URLSearchParams(window.location.search).get(a)}function $e(a,o){const l=new URL(window.location.href);l.searchParams.set(a,o),window.history.replaceState({},"",l.toString())}function Q(a){const o=new URL(window.location.href);o.searchParams.delete(a),window.history.replaceState({},"",o.toString())}function O(a,o="error"){const l=window.Voxel;l?.alert?l.alert(a,o):console.error(`[messages] ${o}: ${a}`)}const ze=[];function Ue({attributes:a,context:o,config:l,messagesConfig:n}){const[t,i]=v.useState({chats:{loading:!1,loadingMore:!1,list:o==="editor"?ze:[],hasMore:!1,page:1},activeChat:null,search:{term:"",loading:!1,list:[]},emojis:{loading:!1,list:null,search:{term:"",list:[]},recents:[]},files:[],activePopup:null,dragActive:!1}),f=v.useRef(null),p=v.useRef(null),_=v.useRef(null),C=v.useRef(null),k=v.useRef(null),T=v.useRef(null),y=v.useCallback(e=>{const s=window.Voxel_Config;return s?.ajax_url?`${s.ajax_url}&action=${e}`:`${s?.site_url||window.location.origin}/?vx=1&action=${e}`},[]),A=v.useCallback(()=>{f.current&&(f.current.scrollTop=f.current.scrollHeight)},[]),I=v.useCallback(()=>{!p.current||!_.current||(_.current.value=p.current.value,_.current.style.width=`${p.current.scrollWidth}px`,_.current.style.minWidth=`${p.current.scrollWidth}px`,_.current.style.maxWidth=`${p.current.scrollWidth}px`,p.current.style.height=`${_.current.scrollHeight}px`)},[]),P=v.useCallback(async(e=!1,s=1)=>{if(n){i(r=>({...r,chats:{...r.chats,loading:s===1,loadingMore:s>1}}));try{const r=new FormData;if(r.append("pg",String(s)),r.append("_wpnonce",n.nonce),e){const d=Y("chat");d&&r.append("load",d)}const c=await(await fetch(y("inbox.list_chats"),{method:"POST",body:r})).json();if(c.success){const d=c.list||c.data?.chats||[];if(i(h=>({...h,chats:{loading:!1,loadingMore:!1,list:s===1?d:[...h.chats.list,...d],hasMore:c.has_more||c.data?.has_more||!1,page:s}})),e){const h=d.find(x=>x.autoload);h?V(h):c.default_chat&&V(c.default_chat)}}else O(c.message||"Failed to load chats","error"),i(d=>({...d,chats:{...d.chats,loading:!1,loadingMore:!1}}))}catch(r){console.error("[messages] Failed to load chats:",r),i(u=>({...u,chats:{...u.chats,loading:!1,loadingMore:!1}}))}}},[n,y]),ee=v.useCallback(()=>{const e=t.chats.page+1;P(!1,e)},[t.chats.page,P]),V=v.useCallback(async e=>{const s=[e.author.type==="post"?e.author.id:"",e.target.type==="post"?"p":"u",e.target.id].join("");if($e("chat",s),i(r=>({...r,activeChat:{...e,messages:{loading:!0,loadingMore:!1,list:[],hasMore:!1},state:{content:""},processing:!1,follow_status:e.follow_status||{author:0,target:0}},files:[]})),!!n)try{const r=new FormData;r.append("author_type",e.author.type),r.append("author_id",String(e.author.id)),r.append("target_type",e.target.type),r.append("target_id",String(e.target.id)),r.append("_wpnonce",n.nonce);const c=await(await fetch(y("inbox.load_chat"),{method:"POST",body:r})).json();if(c.success){i(h=>h.activeChat?{...h,activeChat:{...h.activeChat,messages:{loading:!1,loadingMore:!1,list:c.list||[],hasMore:c.has_more||!1},is_new:!1,seen:!0,follow_status:{author:c.follow_status?.author??h.activeChat.follow_status?.author??0,target:c.follow_status?.target??h.activeChat.follow_status?.target??0}}}:h),setTimeout(()=>{A(),I(),p.current?.focus()},50);const d=Y("text");d&&(i(h=>h.activeChat?{...h,activeChat:{...h.activeChat,state:{content:d}}}:h),Q("text"))}else O(c.message||"Failed to load messages","error")}catch(r){console.error("[messages] Failed to load messages:",r)}},[n,y,A,I]),te=v.useCallback(()=>{Q("chat"),i(e=>({...e,activeChat:null,files:[]}))},[]),ae=v.useCallback(async()=>{if(!t.activeChat||!n||t.activeChat.messages.loadingMore)return;const e=f.current;if(!e)return;const s=e.scrollHeight-e.scrollTop;i(r=>r.activeChat?{...r,activeChat:{...r.activeChat,messages:{...r.activeChat.messages,loadingMore:!0}}}:r);try{const r=t.activeChat.messages.list[t.activeChat.messages.list.length-1],u=new FormData;r&&u.append("cursor",String(r.id)),u.append("author_type",t.activeChat.author.type),u.append("author_id",String(t.activeChat.author.id)),u.append("target_type",t.activeChat.target.type),u.append("target_id",String(t.activeChat.target.id)),u.append("_wpnonce",n.nonce);const d=await(await fetch(y("inbox.load_chat"),{method:"POST",body:u})).json();d.success&&(i(h=>h.activeChat?{...h,activeChat:{...h.activeChat,messages:{loading:!1,loadingMore:!1,list:[...h.activeChat.messages.list,...d.list||[]],hasMore:d.has_more||!1}}}:h),setTimeout(()=>{e&&(e.scrollTop=e.scrollHeight-s)},10))}catch(r){console.error("[messages] Failed to load more messages:",r),i(u=>u.activeChat?{...u,activeChat:{...u.activeChat,messages:{...u.activeChat.messages,loadingMore:!1}}}:u)}},[t.activeChat,n,y]),m=v.useCallback(async()=>{if(!t.activeChat||!n)return;const e=t.activeChat.state.content.trim(),s=t.files.length>0;if(!e&&!s)return;const r={id:Date.now(),content:e.replace(/(?:\r\n|\r|\n){2,}/g,"</p><p>").replace(/(?:\r\n|\r|\n)/g,"<br>"),has_content:e.length>0,time:R("Sending","voxel-fse"),sent_by:"author",seen:!1,sending:!0,tmp:!0,is_deleted:!1,is_hidden:!1};i(x=>x.activeChat?{...x,activeChat:{...x.activeChat,messages:{...x.activeChat.messages,list:[r,...x.activeChat.messages.list]},state:{content:""}},files:[]}:x);const u=new FormData,c={content:e},d="files",h=[];t.files.forEach(x=>{x.source==="new_upload"&&x.item?(u.append(`files[${d}][]`,x.item),h.push("uploaded_file")):x.source==="existing"&&x.id&&h.push(x.id)}),c[d]=h,u.append("fields",JSON.stringify(c)),u.append("sender_type",t.activeChat.author.type),u.append("sender_id",String(t.activeChat.author.id)),u.append("receiver_type",t.activeChat.target.type),u.append("receiver_id",String(t.activeChat.target.id)),u.append("_wpnonce",n.nonce),setTimeout(()=>{A(),I(),p.current?.focus()},10);try{const F=await(await fetch(y("inbox.send_message"),{method:"POST",body:u})).json();F.success?(i(E=>{if(!E.activeChat)return E;const j=E.activeChat.messages.list.map(B=>B.tmp&&B.id===r.id?{...F.message||B,tmp:!1,sending:!1}:B),N={...E.activeChat,messages:{...E.activeChat.messages,list:j},excerpt:F.message?.excerpt||E.activeChat.excerpt,time:F.message?.chat_time||E.activeChat.time},z=E.chats.list.filter(B=>B.key!==E.activeChat?.key);return z.unshift(N),{...E,activeChat:N,chats:{...E.chats,list:z}}}),delete window._vx_file_upload_cache,setTimeout(A,50)):(i(E=>E.activeChat?{...E,activeChat:{...E.activeChat,messages:{...E.activeChat.messages,list:E.activeChat.messages.list.filter(j=>j.id!==r.id)},state:{content:e}}}:E),O(F.message||"Failed to send message","error"),setTimeout(I,10))}catch(x){console.error("[messages] Failed to send message:",x),i(F=>F.activeChat?{...F,activeChat:{...F.activeChat,messages:{...F.activeChat.messages,list:F.activeChat.messages.list.filter(E=>E.id!==r.id)},state:{content:e}}}:F)}},[t.activeChat,t.files,n,y,A,I]),g=v.useCallback(async e=>{if(!t.activeChat||!n||!window.confirm(R("Are you sure?","voxel-fse")))return;const s=new FormData;s.append("deleter_type",t.activeChat.author.type),s.append("deleter_id",String(t.activeChat.author.id)),s.append("message_id",String(e.id)),s.append("_wpnonce",n.nonce),i(r=>r.activeChat?{...r,activeChat:{...r.activeChat,messages:{...r.activeChat.messages,list:r.activeChat.messages.list.map(u=>u.id===e.id?{...u,processing:!0}:u)}}}:r);try{const u=await(await fetch(y("inbox.delete_message"),{method:"POST",body:s})).json();u.success?i(c=>c.activeChat?{...c,activeChat:{...c.activeChat,messages:{...c.activeChat.messages,list:c.activeChat.messages.list.map(d=>d.id===e.id?{...d,is_deleted:u.is_deleted,is_hidden:u.is_hidden,processing:!1}:d)}}}:c):(O(u.message||"Failed to delete message","error"),i(c=>c.activeChat?{...c,activeChat:{...c.activeChat,messages:{...c.activeChat.messages,list:c.activeChat.messages.list.map(d=>d.id===e.id?{...d,processing:!1}:d)}}}:c))}catch(r){console.error("[messages] Failed to delete message:",r)}},[t.activeChat,n,y]),b=v.useCallback(async()=>{if(!t.activeChat||!n||!window.confirm(R("Are you sure?","voxel-fse")))return;const e=t.activeChat.follow_status?.author===-1,s=new FormData;s.append("sender_type",t.activeChat.author.type),s.append("sender_id",String(t.activeChat.author.id)),s.append("receiver_type",t.activeChat.target.type),s.append("receiver_id",String(t.activeChat.target.id)),e&&s.append("unblock","yes"),s.append("_wpnonce",n.nonce),i(r=>r.activeChat?{...r,activeChat:{...r.activeChat,processing:!0}}:r),k.current?.blur();try{const u=await(await fetch(y("inbox.block_chat"),{method:"POST",body:s})).json();u.success?(i(c=>c.activeChat?{...c,activeChat:{...c.activeChat,processing:!1,follow_status:{...c.activeChat.follow_status,author:u.status}}}:c),setTimeout(A,50)):(O(u.message||"Failed to update block status","error"),i(c=>c.activeChat?{...c,activeChat:{...c.activeChat,processing:!1}}:c))}catch(r){console.error("[messages] Failed to block/unblock:",r)}},[t.activeChat,n,y,A]),w=v.useCallback(()=>t.activeChat?.follow_status?t.activeChat.follow_status.author===-1||t.activeChat.follow_status.target===-1:!1,[t.activeChat]),M=v.useCallback(async(e=!1)=>{if(!t.activeChat||!n||!window.confirm(R("Are you sure?","voxel-fse")))return;const s=new FormData;s.append("sender_type",t.activeChat.author.type),s.append("sender_id",String(t.activeChat.author.id)),s.append("receiver_type",t.activeChat.target.type),s.append("receiver_id",String(t.activeChat.target.id)),s.append("_wpnonce",n.nonce),i(r=>r.activeChat?{...r,activeChat:{...r.activeChat,processing:!0}}:r),k.current?.blur();try{const u=await(await fetch(y("inbox.clear_conversation"),{method:"POST",body:s})).json();u.success?(i(c=>{if(!c.activeChat)return c;const d=c.chats.list.filter(h=>h.key!==c.activeChat?.key);return e?{...c,activeChat:null,chats:{...c.chats,list:d}}:{...c,activeChat:{...c.activeChat,processing:!1,messages:{...c.activeChat.messages,list:[],hasMore:!1}},chats:{...c.chats,list:d}}}),e&&Q("chat")):(O(u.message||"Failed to clear conversation","error"),i(c=>c.activeChat?{...c,activeChat:{...c.activeChat,processing:!1}}:c))}catch(r){console.error("[messages] Failed to clear conversation:",r)}},[t.activeChat,n,y]),H=v.useCallback(async()=>{if(!n?.polling?.enabled)return;if(document.visibilityState!=="visible"){T.current=setTimeout(H,n.polling.frequency||3e4);return}const e=Math.round(Date.now()/1e3);try{await(await fetch(`${n.polling.url}?u=${n.user?.id||0}&v=${e}`)).text()==="1"?Xe():T.current=setTimeout(H,n.polling.frequency||3e4)}catch(s){console.error("[messages] Polling failed:",s),T.current=setTimeout(H,n.polling.frequency||3e4)}},[n]),pe=v.useCallback((e,s)=>{const r={...e,excerpt:s.excerpt,is_new:s.is_new,seen:s.seen,time:s.time};if(s.messages?.list&&e.messages?.list){s.messages.list.forEach(d=>{const h=e.messages.list.find(x=>x.id===d.id);h&&(h.seen=d.seen,h.is_deleted=d.is_deleted,h.is_hidden=d.is_hidden)});const u=e.messages.list[0]?.id||0,c=s.messages.list.filter(d=>d.id>u);c.length<15?r.messages={...e.messages,list:[...c,...e.messages.list],hasMore:s.messages.hasMore}:r.messages=s.messages}return r.last_id=s.last_id,r},[]),Xe=v.useCallback(async()=>{if(n)try{const e=new FormData;e.append("pg","1"),e.append("_wpnonce",n.nonce);const s=Y("chat");s&&e.append("load",s);const u=await(await fetch(y("inbox.list_chats"),{method:"POST",body:e})).json();u.success&&i(c=>{const d=[];let h=null;const x=u.list||[];x.forEach(j=>{const N=c.chats.list.findIndex(z=>z.key===j.key);if(N!==-1){const z=c.chats.list[N],B=pe(z,j);d.push(B),j.autoload&&(h=B)}else d.push(j),j.autoload&&(h=j)});const F=c.chats.list.filter(j=>!x.find(N=>N.key===j.key)),E={...c,chats:{...c.chats,list:[...d,...F]}};if(c.activeChat){const j=d.find(N=>N.key===c.activeChat?.key);j&&(E.activeChat={...c.activeChat,...j,messages:j.messages||c.activeChat.messages,state:c.activeChat.state})}return E}),n.polling?.enabled&&(T.current=setTimeout(H,n.polling.frequency||3e4))}catch(e){console.error("[messages] Failed to refresh inbox:",e),n.polling?.enabled&&(T.current=setTimeout(H,n.polling.frequency||3e4))}},[n,y,pe,H]),J=v.useCallback(async()=>{if(t.emojis.list!==null)return;i(s=>({...s,emojis:{...s.emojis,loading:!0}}));try{const s=n?.emojis?.url||"/wp-content/themes/voxel/assets/emojis.json",u=await(await fetch(s)).json();i(c=>({...c,emojis:{...c.emojis,loading:!1,list:u}}))}catch(s){console.error("[messages] Failed to load emojis:",s),i(r=>({...r,emojis:{...r.emojis,loading:!1}}))}const e=localStorage.getItem("voxel:recent_emojis");e&&i(s=>({...s,emojis:{...s.emojis,recents:[...e]}}))},[t.emojis.list,n]),se=v.useCallback(e=>{if(!p.current||!t.activeChat)return;const s=p.current;let r=t.activeChat.state.content;if(s.selectionStart!==null){const h=s.selectionStart,x=s.selectionEnd;r=r.substring(0,h)+e+r.substring(x),setTimeout(()=>{s.setSelectionRange(h+e.length,h+e.length),s.focus()},10)}else r+=e;i(h=>h.activeChat?{...h,activeChat:{...h.activeChat,state:{content:r}}}:h);let u=[];const c=localStorage.getItem("voxel:recent_emojis");c&&(u=[...c]),u=u.filter(h=>h!==e),u.unshift(e);const d=u.slice(0,16);localStorage.setItem("voxel:recent_emojis",d.join("")),i(h=>({...h,emojis:{...h.emojis,recents:d}}))},[t.activeChat]),ge=v.useCallback(()=>{if(!t.emojis.list||!t.emojis.search.term.trim()){i(r=>({...r,emojis:{...r.emojis,search:{...r.emojis.search,list:[]}}}));return}const e=[],s=t.emojis.search.term.trim().toLowerCase();Object.values(t.emojis.list).some(r=>(r.some(u=>(u.name.toLowerCase().includes(s)&&e.push(u.emoji),e.length>=80)),e.length>=80)),i(r=>({...r,emojis:{...r.emojis,search:{...r.emojis.search,list:e}}}))},[t.emojis.list,t.emojis.search.term]),q=v.useCallback(e=>{const s=n?.files?.max_count||5,r={source:"new_upload",name:e.name,type:e.type,size:e.size,preview:URL.createObjectURL(e),item:e,_id:Pe(8)},u=window;u._vx_file_upload_cache||(u._vx_file_upload_cache=[]);const c=u._vx_file_upload_cache.find(d=>d.item?.name===e.name&&d.item?.type===e.type&&d.item?.size===e.size&&d.item?.lastModified===e.lastModified);c?i(d=>s===1?{...d,files:[c]}:d.files.length>=s?d:{...d,files:[...d.files,c]}):(u._vx_file_upload_cache.unshift(r),i(d=>s===1?{...d,files:[r]}:d.files.length>=s?d:{...d,files:[...d.files,r]}))},[n]),Ye=v.useCallback(e=>{const s=e.target.files;if(s){for(let r=0;r<s.length;r++)q(s[r]);e.target.value=""}},[q]),Qe=v.useCallback(e=>{e.preventDefault(),i(s=>({...s,dragActive:!1})),e.dataTransfer.items?[...e.dataTransfer.items].forEach(s=>{if(s.kind==="file"){const r=s.getAsFile();r&&q(r)}}):[...e.dataTransfer.files].forEach(s=>{q(s)})},[q]),et=v.useCallback(e=>{i(s=>({...s,files:s.files.filter(r=>r._id!==e._id&&r.id!==e.id)})),e.source==="new_upload"&&URL.revokeObjectURL(e.preview)},[]),ve=v.useMemo(()=>Oe(async(e,s)=>{try{const r=new FormData;r.append("search",e),r.append("_wpnonce",s);const c=await(await fetch(y("inbox.search_chats"),{method:"POST",body:r})).json();c.success&&i(d=>({...d,search:{...d.search,loading:!1,list:c.list||[]}}))}catch(r){console.error("[messages] Failed to search chats:",r),i(u=>({...u,search:{...u.search,loading:!1}}))}},300),[y]),tt=v.useCallback(e=>{if(i(s=>({...s,search:{...s.search,term:e,loading:e.trim().length>0}})),!e.trim()||!n){i(s=>({...s,search:{term:e,loading:!1,list:[]}}));return}if(!t.chats.hasMore||e.trim().length<=2){const s=t.chats.list.filter(r=>r.target.name.toLowerCase().includes(e.trim().toLowerCase())).slice(0,10);i(r=>({...r,search:{term:e,loading:!1,list:s}}))}else ve(e.trim(),n.nonce)},[n,t.chats.hasMore,t.chats.list,ve]),at=v.useCallback(e=>{e.nativeEvent.isComposing||e.keyCode===229||e.shiftKey||e.key==="Enter"&&(e.preventDefault(),m())},[m]),st=v.useCallback(e=>{i(s=>({...s,activeChat:s.activeChat?{...s.activeChat,state:{...s.activeChat.state,content:e}}:null})),setTimeout(I,10)},[I]),nt=v.useCallback(()=>{i(e=>({...e,activePopup:e.activePopup==="emoji"?null:"emoji"})),t.activePopup!=="emoji"&&J()},[t.activePopup,J]),rt=v.useCallback(()=>{i(e=>({...e,activePopup:e.activePopup==="actions"?null:"actions"}))},[]);v.useEffect(()=>(o==="frontend"&&n&&(P(!0),n.polling?.enabled&&(T.current=setTimeout(H,n.polling.frequency||3e4)),setTimeout(J,100)),()=>{T.current&&clearTimeout(T.current)}),[o,n,P,H,J]),v.useEffect(()=>{t.emojis.search.term.trim()&&t.emojis.list&&ge()},[t.emojis.search.term,t.emojis.list,ge]);const ot=JSON.stringify(l||{icons:a.icons,settings:{enableCalcHeight:a.enableCalcHeight,calcHeight:a.calcHeight}});return React.createElement(React.Fragment,null,React.createElement("textarea",{ref:_,style:{position:"absolute",visibility:"hidden",height:"auto",overflow:"hidden"},"aria-hidden":"true",tabIndex:-1}),React.createElement("input",{ref:C,type:"file",multiple:!0,accept:n?.files?.allowed_file_types?.join(",")||"*",style:{display:"none"},onChange:Ye}),React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:ot}}),React.createElement("div",{className:`ts-inbox ${t.dragActive?"drag-active":""}`,onDragOver:e=>{e.preventDefault(),i(s=>({...s,dragActive:!0}))},onDragLeave:()=>i(e=>({...e,dragActive:!1})),onDrop:Qe},React.createElement("div",{className:`inbox-left ${t.activeChat?"":"ts-no-chat"}`},t.chats.loading?React.createElement("div",{className:"ts-empty-user-tab"},React.createElement("span",{className:"ts-loader"})):t.chats.list.length?React.createElement(React.Fragment,null,React.createElement("div",{className:"ts-form ts-inbox-top"},React.createElement("div",{className:"ts-input-icon flexify"},React.createElement("span",{dangerouslySetInnerHTML:{__html:D(a.icons.search,L.search)}}),React.createElement("input",{type:"text",value:t.search.term,onChange:e=>tt(e.target.value),placeholder:R("Search inbox","voxel-fse"),className:"autofocus"}))),React.createElement("ul",{className:`ts-convo-list simplify-ul min-scroll ${t.search.loading?"vx-disabled":""}`},(t.search.term.trim()?t.search.list:t.chats.list).map(e=>React.createElement("li",{key:e.key||e.id,className:`
												${e.is_new?"ts-new-message":""}
												${e.seen?"":"ts-unread-message"}
												${t.activeChat?.id===e.id?"ts-active-chat":""}
											`},React.createElement("a",{href:"#",onClick:s=>{s.preventDefault(),V(e)}},e.target.avatar&&React.createElement("div",{className:"convo-avatars"},React.createElement("div",{className:"convo-avatar",dangerouslySetInnerHTML:{__html:e.target.avatar}}),e.author.type==="post"&&React.createElement("div",{className:"post-avatar",dangerouslySetInnerHTML:{__html:e.author.avatar}})),React.createElement("div",{className:"message-details"},React.createElement("b",null,e.target.name),React.createElement("span",null,e.excerpt),React.createElement("span",null,e.time))))),t.chats.hasMore&&!t.search.term.trim()&&React.createElement("div",{className:"ts-btn-group"},React.createElement("div",{className:"n-load-more"},React.createElement("a",{href:"#",onClick:e=>{e.preventDefault(),ee()},className:`ts-btn ts-btn-4 ${t.chats.loadingMore?"vx-pending":""}`},React.createElement("span",{dangerouslySetInnerHTML:{__html:D(a.icons.loadMore,L.reload)}}),R("Load more","voxel-fse")))))):React.createElement("div",{className:"ts-empty-user-tab"},React.createElement("span",{dangerouslySetInnerHTML:{__html:D(a.icons.chat,L.inbox)}}),React.createElement("p",null,R("No chats available","voxel-fse")))),React.createElement("div",{className:`ts-message-body ${t.activeChat?.processing?"vx-disabled":""} ${t.activeChat?"":"ts-no-chat"}`},t.activeChat?React.createElement(React.Fragment,null,React.createElement("div",{className:"ts-inbox-top add-spacing flexify"},React.createElement("div",{className:"convo-head"},React.createElement("div",{className:"ts-convo-name flexify"},React.createElement("a",{className:"convo-pic",href:t.activeChat.target.link},React.createElement("span",{dangerouslySetInnerHTML:{__html:t.activeChat.target.avatar}})),React.createElement("a",{className:"convo-name",href:t.activeChat.target.link},React.createElement("span",null,t.activeChat.target.name))),React.createElement("ul",{className:"flexify simplify-ul inbox-top-btns"},React.createElement("li",{className:"flexify"},React.createElement("a",{href:"#",onClick:e=>{e.preventDefault(),te()},className:"ts-icon-btn"},React.createElement("span",{dangerouslySetInnerHTML:{__html:D(a.icons.back,L.chevronLeft)}}))),React.createElement("li",{className:"flexify ts-popup-target"},React.createElement("button",{ref:k,onClick:rt,className:"ts-icon-btn"},React.createElement("span",{dangerouslySetInnerHTML:{__html:D(a.icons.more,L.menu)}})),t.activePopup==="actions"&&React.createElement("div",{className:"ts-popup-content ts-popup-visible"},React.createElement("ul",{className:"simplify-ul ts-popup-list"},React.createElement("li",null,React.createElement("a",{href:"#",onClick:e=>{e.preventDefault(),b(),i(s=>({...s,activePopup:null}))}},React.createElement("span",{dangerouslySetInnerHTML:{__html:D(a.icons.ban,L.block)}}),w()?R("Unblock user","voxel-fse"):R("Block user","voxel-fse"))),React.createElement("li",null,React.createElement("a",{href:"#",onClick:e=>{e.preventDefault(),M(!0),i(s=>({...s,activePopup:null}))}},React.createElement("span",{dangerouslySetInnerHTML:{__html:D(a.icons.clear,L.trash)}}),R("Clear conversation","voxel-fse"))))))))),w()&&React.createElement("div",{className:"ts-chat-blocked-notice"},React.createElement("p",null,R("This conversation is blocked.","voxel-fse"))),t.activeChat.messages.loading?React.createElement("div",{className:"start-convo"},React.createElement("span",{className:"ts-loader"})):t.activeChat.messages.list.length?React.createElement("div",{className:"ts-conversation-body min-scroll",ref:f},t.activeChat.messages.hasMore&&React.createElement("div",{className:"load-more-messages"},React.createElement("a",{href:"#",onClick:e=>{e.preventDefault(),ae()},className:`ts-btn ts-btn-4 ${t.activeChat.messages.loadingMore?"vx-pending":""}`},t.activeChat.messages.loadingMore?R("Loading...","voxel-fse"):R("Load older messages","voxel-fse"))),React.createElement("ul",{className:"ts-message-list simplify-ul"},[...t.activeChat.messages.list].reverse().map(e=>React.createElement("li",{key:e.id,className:`
													ts-single-message
													ts-responder-${e.sent_by==="author"?2:1}
													ts-message-id-${e.id}
													${e.sent_by==="author"&&e.seen?"ts-message-seen":""}
													${e.tmp?"inserted-message":""}
													${e.is_deleted?"ts-message-deleted":""}
													${e.is_hidden?"ts-message-hidden":""}
													${e.processing?"vx-disabled":""}
												`},e.is_deleted?React.createElement(React.Fragment,null,React.createElement("p",{className:"vx-disabled"},R("Deleted","voxel-fse")),React.createElement("ul",{className:"flexify simplify-ul ms-info"},React.createElement("li",null,e.time))):e.is_hidden?React.createElement(React.Fragment,null,React.createElement("p",{className:"vx-disabled"},R("Hidden","voxel-fse")),React.createElement("ul",{className:"flexify simplify-ul ms-info"},React.createElement("li",null,e.time))):React.createElement(React.Fragment,null,e.has_content&&React.createElement("p",{dangerouslySetInnerHTML:{__html:e.content}}),React.createElement("ul",{className:"flexify simplify-ul ms-info"},e.sent_by==="author"&&!e.tmp&&React.createElement(React.Fragment,null,React.createElement("li",{className:"message-actions"},React.createElement("a",{href:"#",onClick:s=>{s.preventDefault(),g(e)}},R("Delete","voxel-fse"))),React.createElement("li",{className:"message-actions"},"Â·")),React.createElement("li",null,e.sending?R("Sending","voxel-fse"):e.time)),e.sent_by==="author"&&e.seen&&n?.seen_badge?.enabled&&React.createElement("div",{className:"seen-badge"},R("Seen","voxel-fse"))))))):React.createElement("div",{className:"start-convo"},React.createElement("a",{href:t.activeChat.target.link},React.createElement("span",{dangerouslySetInnerHTML:{__html:t.activeChat.target.avatar}})),React.createElement("span",null,R("Start a conversation with","voxel-fse")),React.createElement("a",{href:t.activeChat.target.link},React.createElement("h4",null,t.activeChat.target.name))),t.files.length>0&&React.createElement("div",{className:"ts-file-attachments"},t.files.map(e=>React.createElement("div",{key:e._id||e.id,className:"ts-file-preview"},e.type.startsWith("image/")?React.createElement("img",{src:e.preview,alt:e.name}):React.createElement("span",null,e.name),React.createElement("button",{className:"ts-remove-file",onClick:()=>et(e)},React.createElement("span",{dangerouslySetInnerHTML:{__html:D(a.icons.trash,L.close)}}))))),!w()&&React.createElement("div",{className:"ts-inbox-bottom"},React.createElement("div",{className:"flexify ts-convo-form"},React.createElement("span",{className:"active-avatar",dangerouslySetInnerHTML:{__html:t.activeChat.author.avatar}}),React.createElement("div",{className:"ts-popup-target"},React.createElement("button",{onClick:nt,className:"ts-icon-btn ts-emoji-btn"},React.createElement("span",{dangerouslySetInnerHTML:{__html:D(a.icons.emoji,L.emoji)}})),t.activePopup==="emoji"&&React.createElement("div",{className:"ts-popup-content ts-emoji-popup ts-popup-visible"},React.createElement("div",{className:"ts-form"},React.createElement("input",{type:"text",placeholder:R("Search emojis","voxel-fse"),value:t.emojis.search.term,onChange:e=>i(s=>({...s,emojis:{...s.emojis,search:{...s.emojis.search,term:e.target.value}}}))})),t.emojis.loading?React.createElement("div",{className:"ts-loader"}):React.createElement("div",{className:"ts-emoji-list"},t.emojis.recents.length>0&&!t.emojis.search.term.trim()&&React.createElement("div",{className:"ts-emoji-category"},React.createElement("span",null,R("Recent","voxel-fse")),React.createElement("div",{className:"ts-emoji-grid"},t.emojis.recents.map((e,s)=>React.createElement("button",{key:`recent-${s}`,onClick:()=>se(e)},e)))),t.emojis.search.term.trim()?React.createElement("div",{className:"ts-emoji-grid"},t.emojis.search.list.map((e,s)=>React.createElement("button",{key:`search-${s}`,onClick:()=>se(e)},e))):t.emojis.list&&Object.entries(t.emojis.list).map(([e,s])=>React.createElement("div",{key:e,className:"ts-emoji-category"},React.createElement("span",null,e),React.createElement("div",{className:"ts-emoji-grid"},s.map((r,u)=>React.createElement("button",{key:`${e}-${u}`,onClick:()=>se(r.emoji)},r.emoji)))))))),React.createElement("button",{onClick:()=>C.current?.click(),className:"ts-icon-btn ts-attach-btn"},React.createElement("span",{dangerouslySetInnerHTML:{__html:D(a.icons.upload,L.attach)}})),React.createElement("div",{className:"compose-message min-scroll"},React.createElement("textarea",{ref:p,value:t.activeChat.state.content,onKeyDown:at,onChange:e=>st(e.target.value)}),!t.activeChat.state.content&&React.createElement("span",{className:"compose-placeholder"},t.activeChat.author.type==="post"?R("Reply as","voxel-fse")+" "+t.activeChat.author.name:R("Your message","voxel-fse"))),React.createElement("a",{href:"#",onClick:e=>{e.preventDefault(),m()},className:"ts-icon-btn"},React.createElement("span",{dangerouslySetInnerHTML:{__html:D(a.icons.send,L.send)}}))))):React.createElement("div",{className:"ts-empty-user-tab"},t.chats.loading?React.createElement("span",{className:"ts-loader"}):React.createElement(React.Fragment,null,React.createElement("span",{dangerouslySetInnerHTML:{__html:D(a.icons.chat,L.inbox)}}),React.createElement("p",null,R("No conversation selected","voxel-fse")))))))}const Ve={search:{library:"",value:""},chat:{library:"",value:""},loadMore:{library:"",value:""},back:{library:"",value:""},more:{library:"",value:""},user:{library:"",value:""},clear:{library:"",value:""},ban:{library:"",value:""},trash:{library:"",value:""},upload:{library:"",value:""},gallery:{library:"",value:""},emoji:{library:"",value:""},send:{library:"",value:""}};function qe(a){const o=a.querySelector("script.vxconfig");if(o&&o.textContent)try{return JSON.parse(o.textContent)}catch(l){console.error("[messages] Failed to parse vxconfig:",l)}return null}function We(a){const o={search:a.icons?.search??a.icons?.searchIcon??{},chat:a.icons?.chat??a.icons?.chatIcon??{},back:a.icons?.back??a.icons?.backIcon??{},more:a.icons?.more??a.icons?.moreIcon??{},loadMore:a.icons?.loadMore??a.icons?.load_more??{},send:a.icons?.send??a.icons?.sendIcon??{},emoji:a.icons?.emoji??a.icons?.emojiIcon??{},attachment:a.icons?.attachment??a.icons?.attachmentIcon??{}},l={enableCalcHeight:a.settings?.enableCalcHeight??a.settings?.enable_calc_height??!1,calcHeight:a.settings?.calcHeight??a.settings?.calc_height??""};return{icons:o,settings:l}}function Ke(a){const o=a.querySelector(".ts-inbox");if(o&&o.dataset.config)try{return JSON.parse(o.dataset.config)}catch(n){console.error("Failed to parse messages config:",n)}const l=window;return l.voxelMessagesConfig?l.voxelMessagesConfig:null}function Je(a){return{blockId:"",icons:a.icons||Ve,generalHeightUnit:"px",enableCalcHeight:a.settings?.enableCalcHeight||!1,calcHeight:a.settings?.calcHeight||"",generalBackground:"",generalBorderType:"default",generalBorderWidth:0,generalBorderColor:"",generalBorderRadius:0,generalBoxShadow:{},separatorColor:"",scrollbarColor:"",inboxMessagePadding:{top:"",right:"",bottom:"",left:""},inboxMessageTitleColor:"",inboxMessageTitleTypography:{},inboxMessageSubtitleColor:"",inboxMessageSubtitleTypography:{},inboxMessageSecondaryLogoBorder:{},inboxMessageHoverBg:"",inboxMessageHoverTitleColor:"",inboxMessageHoverSubtitleColor:"",inboxMessageActiveBg:"",inboxMessageActiveBorderColor:"",inboxMessageActiveTitleColor:"",inboxMessageActiveSubtitleColor:"",inboxMessageUnreadTitleTypography:{},inboxMessageNewAvatarBorder:{},inboxSearchTypography:{},inboxSearchValueColor:"",inboxSearchPlaceholderColor:"",inboxSearchIconColor:"",conversationTopTypography:{},conversationTopTextColor:"",conversationIntroNameTypography:{},conversationIntroNameColor:"",conversationIntroSubtitleTypography:{},conversationIntroSubtitleColor:"",conversationBodyMessagePadding:{top:"",right:"",bottom:"",left:""},conversationBodyMessageTypography:{},responder1Background:{},responder1Color:"",responder2Background:{},responder2Color:"",errorBackground:{},errorColor:"",messageInfoTypography:{},messageInfoDefaultColor:"",messageInfoDeleteColor:"",seenTypography:{},seenColor:"",composePlaceholderTypography:{},composePlaceholderColor:"",composeValueTypography:{},composeValueColor:"",iconButtonColor:"",iconButtonBackground:"",iconButtonBorderType:"default",iconButtonBorderWidth:0,iconButtonBorderColor:"",iconButtonHoverColor:"",iconButtonHoverBackground:"",iconButtonHoverBorderColor:"",tertiaryButtonIconColor:"",tertiaryButtonBackground:"",tertiaryButtonBorderType:"default",tertiaryButtonBorderWidth:0,tertiaryButtonBorderColor:"",tertiaryButtonTypography:{},tertiaryButtonTextColor:"",tertiaryButtonHoverIconColor:"",tertiaryButtonHoverBackground:"",tertiaryButtonHoverBorderColor:"",tertiaryButtonHoverTextColor:"",emptyIconSize:35,emptyIconColor:"",emptyTitleColor:"",emptyTitleTypography:{},loadingColor1:"",loadingColor2:""}}function Ze({config:a,messagesConfig:o}){const l=Je(a);return React.createElement(Ue,{attributes:l,context:"frontend",config:a,messagesConfig:o})}function $(){document.querySelectorAll(".voxel-fse-messages").forEach(o=>{if(o.dataset.hydrated==="true")return;const l=qe(o);if(!l){console.error("[messages] No vxconfig found for messages block");return}const n=We(l),t=Ke(o);o.dataset.hydrated="true";const i=o.querySelector(".voxel-fse-block-placeholder");i&&i.remove(),ye.createRoot(o).render(React.createElement(Ze,{config:n,messagesConfig:t}))})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",$):$(),window.addEventListener("turbo:load",$),window.addEventListener("pjax:complete",$),document.addEventListener("voxel:markup-update",$);const Ge=window;Ge.render_messages=$})(ReactDOM,React);
