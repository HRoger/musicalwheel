(function(Fe,d,He){"use strict";var fe,ye,ie,we;fe={"(":9,"!":8,"*":7,"/":7,"%":7,"+":6,"-":6,"<":5,"<=":5,">":5,">=":5,"==":4,"!=":4,"&&":3,"||":2,"?":1,"?:":1},ye=["(","?"],ie={")":["("],":":["?","?:"]},we=/<=|>=|==|!=|&&|\|\||\?:|\(|!|\*|\/|%|\+|-|<|>|\?|\)|:/;function je(a){for(var i=[],c=[],l,t,u,C;l=a.match(we);){for(t=l[0],u=a.substr(0,l.index).trim(),u&&i.push(u);C=c.pop();){if(ie[t]){if(ie[t][0]===C){t=ie[t][1]||t;break}}else if(ye.indexOf(C)>=0||fe[C]<fe[t]){c.push(C);break}i.push(C)}ie[t]||c.push(t),a=a.substr(l.index+t.length)}return a=a.trim(),a&&i.push(a),i.concat(c.reverse())}var Ne={"!":function(a){return!a},"*":function(a,i){return a*i},"/":function(a,i){return a/i},"%":function(a,i){return a%i},"+":function(a,i){return a+i},"-":function(a,i){return a-i},"<":function(a,i){return a<i},"<=":function(a,i){return a<=i},">":function(a,i){return a>i},">=":function(a,i){return a>=i},"==":function(a,i){return a===i},"!=":function(a,i){return a!==i},"&&":function(a,i){return a&&i},"||":function(a,i){return a||i},"?:":function(a,i,c){if(a)throw i;return c}};function Ae(a,i){var c=[],l,t,u,C,v,_;for(l=0;l<a.length;l++){if(v=a[l],C=Ne[v],C){for(t=C.length,u=Array(t);t--;)u[t]=c.pop();try{_=C.apply(null,u)}catch(E){return E}}else i.hasOwnProperty(v)?_=i[v]:_=+v;c.push(_)}return c[0]}function Ie(a){var i=je(a);return function(c){return Ae(i,c)}}function Be(a){var i=Ie(a);return function(c){return+i({n:c})}}var _e={contextDelimiter:"",onMissingKey:null};function De(a){var i,c,l;for(i=a.split(";"),c=0;c<i.length;c++)if(l=i[c].trim(),l.indexOf("plural=")===0)return l.substr(7)}function pe(a,i){var c;this.data=a,this.pluralForms={},this.options={};for(c in _e)this.options[c]=i!==void 0&&c in i?i[c]:_e[c]}pe.prototype.getPluralForm=function(a,i){var c=this.pluralForms[a],l,t,u;return c||(l=this.data[a][""],u=l["Plural-Forms"]||l["plural-forms"]||l.plural_forms,typeof u!="function"&&(t=De(l["Plural-Forms"]||l["plural-forms"]||l.plural_forms),u=Be(t)),c=this.pluralForms[a]=u),c(i)},pe.prototype.dcnpgettext=function(a,i,c,l,t){var u,C,v;return t===void 0?u=0:u=this.getPluralForm(a,t),C=c,i&&(C=i+this.options.contextDelimiter+c),v=this.data[a][C],v&&v[u]?v[u]:(this.options.onMissingKey&&this.options.onMissingKey(c,a),u===0?c:l)};var Ee={"":{plural_forms(a){return a===1?0:1}}},Pe=/^i18n\.(n?gettext|has_translation)(_|$)/,ze=(a,i,c)=>{const l=new pe({}),t=new Set,u=()=>{t.forEach(f=>f())},C=f=>(t.add(f),()=>t.delete(f)),v=(f="default")=>l.data[f],_=(f,p="default")=>{l.data[p]={...l.data[p],...f},l.data[p][""]={...Ee[""],...l.data[p]?.[""]},delete l.pluralForms[p]},E=(f,p)=>{_(f,p),u()},L=(f,p="default")=>{l.data[p]={...l.data[p],...f,"":{...Ee[""],...l.data[p]?.[""],...f?.[""]}},delete l.pluralForms[p],u()},T=(f,p)=>{l.data={},l.pluralForms={},E(f,p)},w=(f="default",p,x,k,S)=>(l.data[f]||_(void 0,f),l.dcnpgettext(f,p,x,k,S)),H=f=>f||"default",B=(f,p)=>{let x=w(p,void 0,f);return c?(x=c.applyFilters("i18n.gettext",x,f,p),c.applyFilters("i18n.gettext_"+H(p),x,f,p)):x},W=(f,p,x)=>{let k=w(x,p,f);return c?(k=c.applyFilters("i18n.gettext_with_context",k,f,p,x),c.applyFilters("i18n.gettext_with_context_"+H(x),k,f,p,x)):k},$=(f,p,x,k)=>{let S=w(k,void 0,f,p,x);return c?(S=c.applyFilters("i18n.ngettext",S,f,p,x,k),c.applyFilters("i18n.ngettext_"+H(k),S,f,p,x,k)):S},q=(f,p,x,k,S)=>{let N=w(S,k,f,p,x);return c?(N=c.applyFilters("i18n.ngettext_with_context",N,f,p,x,k,S),c.applyFilters("i18n.ngettext_with_context_"+H(S),N,f,p,x,k,S)):N},Z=()=>W("ltr","text direction")==="rtl",G=(f,p,x)=>{const k=p?p+""+f:f;let S=!!l.data?.[x??"default"]?.[k];return c&&(S=c.applyFilters("i18n.has_translation",S,f,p,x),S=c.applyFilters("i18n.has_translation_"+H(x),S,f,p,x)),S};if(c){const f=p=>{Pe.test(p)&&u()};c.addAction("hookAdded","core/i18n",f),c.addAction("hookRemoved","core/i18n",f)}return{getLocaleData:v,setLocaleData:E,addLocaleData:L,resetLocaleData:T,subscribe:C,__:B,_x:W,_n:$,_nx:q,isRTL:Z,hasTranslation:G}};function Oe(a){return typeof a!="string"||a===""?(console.error("The namespace must be a non-empty string."),!1):/^[a-zA-Z][a-zA-Z0-9_.\-\/]*$/.test(a)?!0:(console.error("The namespace can only contain numbers, letters, dashes, periods, underscores and slashes."),!1)}var xe=Oe;function Ve(a){return typeof a!="string"||a===""?(console.error("The hook name must be a non-empty string."),!1):/^__/.test(a)?(console.error("The hook name cannot begin with `__`."),!1):/^[a-zA-Z][a-zA-Z0-9_.-]*$/.test(a)?!0:(console.error("The hook name can only contain numbers, letters, dashes, periods and underscores."),!1)}var ve=Ve;function Ue(a,i){return function(l,t,u,C=10){const v=a[i];if(!ve(l)||!xe(t))return;if(typeof u!="function"){console.error("The hook callback must be a function.");return}if(typeof C!="number"){console.error("If specified, the hook priority must be a number.");return}const _={callback:u,priority:C,namespace:t};if(v[l]){const E=v[l].handlers;let L;for(L=E.length;L>0&&!(C>=E[L-1].priority);L--);L===E.length?E[L]=_:E.splice(L,0,_),v.__current.forEach(T=>{T.name===l&&T.currentIndex>=L&&T.currentIndex++})}else v[l]={handlers:[_],runs:0};l!=="hookAdded"&&a.doAction("hookAdded",l,t,u,C)}}var be=Ue;function We(a,i,c=!1){return function(t,u){const C=a[i];if(!ve(t)||!c&&!xe(u))return;if(!C[t])return 0;let v=0;if(c)v=C[t].handlers.length,C[t]={runs:C[t].runs,handlers:[]};else{const _=C[t].handlers;for(let E=_.length-1;E>=0;E--)_[E].namespace===u&&(_.splice(E,1),v++,C.__current.forEach(L=>{L.name===t&&L.currentIndex>=E&&L.currentIndex--}))}return t!=="hookRemoved"&&a.doAction("hookRemoved",t,u),v}}var de=We;function Ze(a,i){return function(l,t){const u=a[i];return typeof t<"u"?l in u&&u[l].handlers.some(C=>C.namespace===t):l in u}}var Se=Ze;function qe(a,i,c,l){return function(u,...C){const v=a[i];v[u]||(v[u]={handlers:[],runs:0}),v[u].runs++;const _=v[u].handlers;if(!_||!_.length)return c?C[0]:void 0;const E={name:u,currentIndex:0};async function L(){try{v.__current.add(E);let w=c?C[0]:void 0;for(;E.currentIndex<_.length;)w=await _[E.currentIndex].callback.apply(null,C),c&&(C[0]=w),E.currentIndex++;return c?w:void 0}finally{v.__current.delete(E)}}function T(){try{v.__current.add(E);let w=c?C[0]:void 0;for(;E.currentIndex<_.length;)w=_[E.currentIndex].callback.apply(null,C),c&&(C[0]=w),E.currentIndex++;return c?w:void 0}finally{v.__current.delete(E)}}return(l?L:T)()}}var me=qe;function Ke(a,i){return function(){const l=a[i];return Array.from(l.__current).at(-1)?.name??null}}var Re=Ke;function Je(a,i){return function(l){const t=a[i];return typeof l>"u"?t.__current.size>0:Array.from(t.__current).some(u=>u.name===l)}}var Le=Je;function Ge(a,i){return function(l){const t=a[i];if(ve(l))return t[l]&&t[l].runs?t[l].runs:0}}var Me=Ge,Xe=class{actions;filters;addAction;addFilter;removeAction;removeFilter;hasAction;hasFilter;removeAllActions;removeAllFilters;doAction;doActionAsync;applyFilters;applyFiltersAsync;currentAction;currentFilter;doingAction;doingFilter;didAction;didFilter;constructor(){this.actions=Object.create(null),this.actions.__current=new Set,this.filters=Object.create(null),this.filters.__current=new Set,this.addAction=be(this,"actions"),this.addFilter=be(this,"filters"),this.removeAction=de(this,"actions"),this.removeFilter=de(this,"filters"),this.hasAction=Se(this,"actions"),this.hasFilter=Se(this,"filters"),this.removeAllActions=de(this,"actions",!0),this.removeAllFilters=de(this,"filters",!0),this.doAction=me(this,"actions",!1,!1),this.doActionAsync=me(this,"actions",!1,!0),this.applyFilters=me(this,"filters",!0,!1),this.applyFiltersAsync=me(this,"filters",!0,!0),this.currentAction=Re(this,"actions"),this.currentFilter=Re(this,"filters"),this.doingAction=Le(this,"actions"),this.doingFilter=Le(this,"filters"),this.didAction=Me(this,"actions"),this.didFilter=Me(this,"filters")}};function Ye(){return new Xe}var Qe=Ye,ke=Qe(),{addAction:ht,addFilter:ft,removeAction:pt,removeFilter:vt,hasAction:gt,hasFilter:Ct,removeAllActions:yt,removeAllFilters:wt,doAction:_t,doActionAsync:Et,applyFilters:xt,applyFiltersAsync:bt,currentAction:St,currentFilter:Rt,doingAction:Lt,doingFilter:Mt,didAction:kt,didFilter:Tt,actions:Ft,filters:Ht}=ke,F=ze(void 0,void 0,ke);F.getLocaleData.bind(F),F.setLocaleData.bind(F),F.resetLocaleData.bind(F),F.subscribe.bind(F);var b=F.__.bind(F);F._x.bind(F),F._n.bind(F),F._nx.bind(F),F.isRTL.bind(F),F.hasTranslation.bind(F);const $e=({isOpen:a,popupId:i,target:c,title:l="",icon:t="",saveLabel:u="Save",clearLabel:C="Clear",clearButton:v=!0,showHeader:_=!0,showFooter:E=!0,onSave:L,onClear:T,onClose:w,children:H,popupClass:B="",minWidth:W,headerActions:$})=>{const q=d.useRef(null),Z=d.useRef(null),[G,f]=d.useState({position:"absolute",left:"-9999px"}),p=d.useRef(""),x=d.useCallback(()=>{if(!Z.current||!c||!q.current)return;const M=c,O=q.current,I=Z.current,V=document.querySelector('iframe[name="editor-canvas"]'),J=!!V;let A=0,j=0;if(J&&V){const y=V.getBoundingClientRect();A=y.top,j=y.left}const K=J?V?.contentDocument?.documentElement.clientWidth??document.body.clientWidth:document.body.clientWidth,U=M.getBoundingClientRect(),te=M.offsetWidth,ce=window.pageXOffset||document.documentElement.scrollLeft,ae=window.pageYOffset||document.documentElement.scrollTop,X={left:U.left+ce+j,top:U.top+ae+A},Q=O.getBoundingClientRect(),ne=window.getComputedStyle(I),se=parseFloat(ne.minWidth)||0,ue=W||se,re=Math.min(1140,K-40),e=Math.max(U.width,ue||re),n=X.left+te/2>(K+j)/2+1;let s;n?s=X.left-e+te:s=X.left,s<0&&(s=10),s+e>K+j&&(s=K+j-e-10);let r=X.top+U.height;const o=window.innerHeight,m=U.bottom+A,h=U.top+A;m+Q.height>o&&h-Q.height>=0&&(r=X.top-Q.height);const g={top:`${r}px`,left:`${s}px`,width:`${e}px`,position:"absolute"},R=JSON.stringify(g);R!==p.current&&(p.current=R,f(g))},[c,W]);d.useEffect(()=>{if(!a)return;const M=O=>{O.key==="Escape"&&w()};return document.addEventListener("keydown",M),()=>document.removeEventListener("keydown",M)},[a,w]);const k=!!document.querySelector('iframe[name="editor-canvas"]');if(d.useEffect(()=>{if(!a)return;const M=document.querySelector('iframe[name="editor-canvas"]'),O=M?.contentDocument,I=A=>{const j=A.target;if(!Z.current?.contains(j)&&!(c&&c.contains(j))){if(M){const K=[".interface-interface-skeleton__sidebar",".block-editor-block-inspector",".components-popover",".components-modal__screen-overlay",".edit-post-sidebar",".interface-interface-skeleton__header",".interface-interface-skeleton__secondary-sidebar"];for(const U of K)if(j.closest(U))return}w()}},V=A=>{const j=A.target;c&&c.contains(j)||w()},J=requestAnimationFrame(()=>{document.addEventListener("mousedown",I),M&&O?.addEventListener("mousedown",V)});return()=>{cancelAnimationFrame(J),document.removeEventListener("mousedown",I),O?.removeEventListener("mousedown",V)}},[a,w,c]),d.useEffect(()=>{if(!a)return;requestAnimationFrame(()=>{requestAnimationFrame(()=>{x()})});const M=()=>x();window.addEventListener("scroll",M,!0);const O=()=>x();window.addEventListener("resize",O,!0);let I=null;return Z.current&&(I=new ResizeObserver(()=>{requestAnimationFrame(()=>x())}),I.observe(Z.current)),()=>{window.removeEventListener("scroll",M,!0),window.removeEventListener("resize",O,!0),I?.disconnect()}},[a,x]),!a)return null;const S=()=>d.createElement("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"},d.createElement("path",{d:"M14 1.41L12.59 0L7 5.59L1.41 0L0 1.41L5.59 7L0 12.59L1.41 14L7 8.41L12.59 14L14 12.59L8.41 7L14 1.41Z",fill:"currentColor"})),N=document.body;return He.createPortal(d.createElement("div",{className:`elementor vx-popup ${B}`.trim()},k&&d.createElement("style",null,".vx-popup .ts-popup-root > div::after { pointer-events: none !important; }"),d.createElement("div",{className:"ts-popup-root elementor-element"},d.createElement("div",{ref:q,className:"ts-form elementor-element",style:G},d.createElement("div",{className:"ts-field-popup-container"},d.createElement("div",{id:i,ref:Z,className:"ts-field-popup triggers-blur"},_&&d.createElement("div",{className:"ts-popup-head flexify ts-sticky-top"},d.createElement("div",{className:"ts-popup-name flexify"},t&&d.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),d.createElement("span",null,l)),d.createElement("ul",{className:"flexify simplify-ul"},$,d.createElement("li",{className:"flexify ts-popup-close"},d.createElement("a",{href:"#",onClick:M=>{M.preventDefault(),w()},className:"ts-icon-btn","aria-label":"Close"},d.createElement(S,null))))),d.createElement("div",{className:"ts-popup-content-wrapper min-scroll"},H),E&&d.createElement("div",{className:"ts-popup-controller"},d.createElement("ul",{className:"flexify simplify-ul"},d.createElement("li",{className:"flexify ts-popup-close"},d.createElement("a",{href:"#",onClick:M=>{M.preventDefault(),w()},className:"ts-icon-btn","aria-label":"Close"},d.createElement(S,null))),v&&T&&d.createElement("li",{className:"flexify"},d.createElement("a",{href:"#",onClick:M=>{M.preventDefault(),T()},className:"ts-btn ts-btn-1"},C)),L&&d.createElement("li",{className:"flexify"},d.createElement("a",{href:"#",onClick:M=>{M.preventDefault(),L()},className:"ts-btn ts-btn-2"},u))))))))),N)};function Te(){return window.voxelFseCreatePost?.ajaxUrl?window.voxelFseCreatePost.ajaxUrl:window.Voxel_Config?.ajax_url?String(window.Voxel_Config.ajax_url):window.wpApiSettings?.root?`${window.wpApiSettings.root.replace(/\/wp-json\/?$/,"")}/?vx=1`:`${window.location.origin}/?vx=1`}typeof window<"u"&&typeof window._vx_file_upload_cache>"u"&&(window._vx_file_upload_cache=[]);function et({onBlur:a,onSave:i,multiple:c=!1,saveLabel:l="Save",children:t,minWidth:u=450,target:C}){const[v,_]=d.useState(!1),E=d.useRef(null),L=d.useRef(null),[T,w]=d.useState([]),[H,B]=d.useState(!0),[W,$]=d.useState(!1),[q,Z]=d.useState(0),[G,f]=d.useState({}),[p,x]=d.useState(""),[k,S]=d.useState([]),[N,M]=d.useState(!1),[O,I]=d.useState(!1),[V,J]=d.useState(0),[A,j]=d.useState(!1),K=async(r=0)=>{r>0?j(!0):B(!0);try{const m=Te(),h=new URLSearchParams({action:"list_media",offset:r.toString()}),g=`${m}&${h.toString()}`,R=await fetch(g,{method:"GET",credentials:"same-origin"});if(!R.ok)throw new Error(`HTTP error! status: ${R.status}`);const y=await R.json();y.success&&(w(D=>r>0?[...D,...y.data]:y.data),$(y.has_more),Z(r+y.data.length))}catch(m){console.error("[MediaPopup] Error loading files:",m)}finally{B(!1),j(!1)}},U=async(r=!1)=>{if(!p.trim()){S([]);return}try{const o=r?V:0;M(!r),j(r);const m=Te(),h=new URLSearchParams({action:"list_media",search:p,offset:o.toString()}),g=`${m}&${h.toString()}`,R=await fetch(g,{method:"GET",credentials:"same-origin"});if(!R.ok)throw new Error(`HTTP error! status: ${R.status}`);const y=await R.json();y.success?(S(D=>r?[...D,...y.data]:y.data),I(y.has_more),J(o+y.data.length)):S([])}catch{S([])}finally{M(!1),j(!1)}},te=r=>{f(c?o=>{const m={...o};return m[r.id]?delete m[r.id]:m[r.id]=r,m}:{[r.id]:r})},ce=()=>{const r=Object.values(G).map(o=>"_id"in o&&o._id?{source:"new_upload",_id:o._id,file:o.item,name:o.name,type:o.type,preview:o.preview}:{source:"existing",id:o.id,name:o.name,type:o.type,preview:o.preview});i&&i(r),_(!1),f({})},ae=()=>{_(!1),f({}),a&&a()},X=()=>{f({})},Q=r=>r.type.startsWith("image/")&&r.preview?{backgroundImage:`url(${r.preview})`}:{},ne=r=>r.type.startsWith("image/"),se=()=>{const r=window._vx_file_upload_cache;return Array.isArray(r)?[...r]:(window._vx_file_upload_cache=[],[])},ue=r=>{const o=r._id||`upload-${r.name}`;f(m=>{const h={...m};if(h[o])delete h[o];else{if(!c)return{[o]:r};h[o]=r}return h})};d.useEffect(()=>{if(!p.trim()){S([]),J(0);return}const r=setTimeout(()=>{U(!1)},300);return()=>clearTimeout(r)},[p]),d.useEffect(()=>{v&&L.current&&setTimeout(()=>{L.current?.focus()},100)},[v]),d.useEffect(()=>{K(0)},[]);const re=p.trim()?k:T,e=p.trim()?O:W,n=p.trim()?N:H,s=r=>{r.preventDefault(),_(!0)};return React.createElement(React.Fragment,null,React.createElement("span",{ref:E,onMouseDown:s,style:{cursor:"pointer"}},t||React.createElement("a",{href:"#",onClick:r=>r.preventDefault(),className:"ts-btn ts-btn-4 form-btn"},React.createElement("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},React.createElement("path",{d:"M5.5 3.25C4.25736 3.25 3.25 4.25736 3.25 5.5V18.5C3.25 19.7426 4.25736 20.75 5.5 20.75H18.5C19.7426 20.75 20.75 19.7426 20.75 18.5V5.5C20.75 4.25736 19.7426 3.25 18.5 3.25H5.5ZM6.20103 13.6808C7.10463 12.4977 8.88749 12.5025 9.78466 13.6905L11.0002 15.3001C11.3508 15.7643 12.0734 15.6701 12.2931 15.1315L14.2708 10.2852C14.9381 8.65008 17.1428 8.3859 18.1774 9.81704L18.9656 10.9072C19.1505 11.1629 19.25 11.4705 19.25 11.786V13.8608V18.5C19.25 18.9142 18.9142 19.25 18.5 19.25H5.5C5.08579 19.25 4.75 18.9142 4.75 18.5V18.0031V16.088C4.75 15.7589 4.85819 15.439 5.05792 15.1775L6.20103 13.6808ZM7.01953 8.55957C7.01953 7.66211 7.74707 6.93457 8.64453 6.93457H8.65453C9.55199 6.93457 10.2795 7.66211 10.2795 8.55957C10.2795 9.45703 9.55199 10.1846 8.65453 10.1846H8.64453C7.74707 10.1846 7.01953 9.45703 7.01953 8.55957Z",fill:"#343C54"})),React.createElement("span",null,"Media library"))),v&&React.createElement($e,{isOpen:v,popupId:"media-library-popup",target:C||E.current,onClose:ae,onSave:ce,onClear:X,saveLabel:l,popupClass:"ts-media-library prmr-popup",showHeader:!1,minWidth:u},React.createElement("div",{className:"ts-sticky-top uib b-bottom"},React.createElement("div",{className:"ts-input-icon flexify"},React.createElement("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},React.createElement("path",{d:"M12.5 11H11.71L11.43 10.73C12.41 9.59 13 8.11 13 6.5C13 2.91 10.09 0 6.5 0C2.91 0 0 2.91 0 6.5C0 10.09 2.91 13 6.5 13C8.11 13 9.59 12.41 10.73 11.43L11 11.71V12.5L16 17.49L17.49 16L12.5 11ZM6.5 11C4.01 11 2 8.99 2 6.5C2 4.01 4.01 2 6.5 2C8.99 2 11 4.01 11 6.5C11 8.99 8.99 11 6.5 11Z",fill:"currentColor"})),React.createElement("input",{ref:L,type:"text",className:"autofocus",placeholder:"Search files",value:p,onChange:r=>x(r.target.value)}))),React.createElement("div",{className:`ts-form-group min-scroll ts-list-container ${n?"vx-disabled":""}`},re.length>0||se().length>0?React.createElement(React.Fragment,null,React.createElement("div",{className:"ts-file-list"},se().map(r=>{const o=r._id||`upload-${r.name}`;return React.createElement("div",{key:o,className:`ts-file ${G[o]?"selected":""} ${ne(r)?"ts-file-img":""}`,style:Q(r),onClick:()=>ue(r)},React.createElement("div",{className:"ts-file-info"},React.createElement("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},React.createElement("path",{d:"M9 0L0 5V13L9 18L18 13V5L9 0ZM16 12L9 16L2 12V6L9 2L16 6V12Z",fill:"currentColor"})),React.createElement("code",null,r.name)),React.createElement("div",{className:"ts-remove-file"},React.createElement("svg",{width:"20",height:"20",viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},React.createElement("path",{d:"M12.4239 3.25C12.2079 3.25 11.9908 3.33022 11.8251 3.49073L7.30978 7.88732C6.97375 8.21414 6.97375 8.74449 7.30978 9.07131C7.64581 9.39812 8.19149 9.39812 8.52752 9.07131L11.6739 6.00692L11.6739 15.9C11.6739 16.3556 12.0525 16.725 12.5197 16.725C12.9869 16.725 13.3655 16.3556 13.3655 15.9L13.3655 6.00692L16.5119 9.07131C16.8479 9.39812 17.3936 9.39812 17.7296 9.07131C18.0657 8.74449 18.0657 8.21414 17.7296 7.88732L13.2143 3.49073C13.0486 3.33022 12.8316 3.25 12.6156 3.25L12.4239 3.25Z",fill:"currentColor"}),React.createElement("path",{d:"M5.17188 16C5.17188 15.5858 4.84402 15.25 4.43948 15.25C4.03495 15.25 3.70709 15.5858 3.70709 16V16.0549C3.70703 16.8531 3.70698 17.5055 3.76469 18.0316C3.82466 18.5774 3.95363 19.0607 4.24635 19.4857C4.54794 19.9226 4.94971 20.2516 5.44348 20.4865C5.91891 20.7134 6.47396 20.8128 7.08817 20.857C7.68568 20.9 8.42494 20.9 9.33715 20.9H15.7023C16.6145 20.9 17.3538 20.9 17.9513 20.857C18.5655 20.8128 19.1206 20.7134 19.596 20.4865C20.0898 20.2516 20.4915 19.9226 20.7931 19.4857C21.0858 19.0607 21.2148 18.5774 21.2748 18.0316C21.3325 17.5055 21.3325 16.8531 21.3324 16.0549V16C21.3324 15.5858 21.0046 15.25 20.6 15.25C20.1955 15.25 19.8676 15.5858 19.8676 16C19.8676 16.8631 19.8666 17.4573 19.818 17.9105C19.7703 18.355 19.6812 18.5956 19.5524 18.7816C19.4153 18.9782 19.2355 19.1296 19.0087 19.2351C18.7906 19.3355 18.4991 19.4049 17.9944 19.4431C17.4776 19.4821 16.8019 19.4833 15.7397 19.4833H9.29978C8.23757 19.4833 7.56186 19.4821 7.04512 19.4431C6.54041 19.4049 6.24886 19.3355 6.03081 19.2351C5.80404 19.1296 5.62416 18.9782 5.48711 18.7816C5.35829 18.5956 5.26921 18.355 5.22145 17.9105C5.17292 17.4573 5.17188 16.8631 5.17188 16Z",fill:"currentColor"}))),React.createElement("div",{className:"ts-remove-file ts-select-file"},React.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},React.createElement("path",{d:"M19.5455 6.4965C19.9848 6.93584 19.9848 7.64815 19.5455 8.08749L10.1286 17.5043C9.6893 17.9437 8.97699 17.9437 8.53765 17.5043L4.45451 13.4212C4.01517 12.9819 4.01516 12.2695 4.4545 11.8302C4.89384 11.3909 5.60616 11.3909 6.0455 11.8302L9.33315 15.1179L17.9545 6.4965C18.3938 6.05716 19.1062 6.05716 19.5455 6.4965Z",fill:"#343C54"}))))}),re.map(r=>React.createElement("div",{key:r.id,className:`ts-file ${G[r.id]?"selected":""} ${ne(r)?"ts-file-img":""}`,style:Q(r),onClick:()=>te(r)},React.createElement("div",{className:"ts-file-info"},React.createElement("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},React.createElement("path",{d:"M9 0L0 5V13L9 18L18 13V5L9 0ZM16 12L9 16L2 12V6L9 2L16 6V12Z",fill:"currentColor"})),React.createElement("code",null,r.name)),React.createElement("div",{className:"ts-remove-file ts-select-file"},React.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},React.createElement("path",{d:"M19.5455 6.4965C19.9848 6.93584 19.9848 7.64815 19.5455 8.08749L10.1286 17.5043C9.6893 17.9437 8.97699 17.9437 8.53765 17.5043L4.45451 13.4212C4.01517 12.9819 4.01516 12.2695 4.4545 11.8302C4.89384 11.3909 5.60616 11.3909 6.0455 11.8302L9.33315 15.1179L17.9545 6.4965C18.3938 6.05716 19.1062 6.05716 19.5455 6.4965Z",fill:"#343C54"})))))),e&&React.createElement("div",null,React.createElement("a",{href:"#",onClick:r=>{r.preventDefault(),r.stopPropagation(),p.trim()?U(!0):K(q)},className:`ts-btn ts-btn-4 ${A?"vx-pending":""}`},React.createElement("svg",{width:"18",height:"18",viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},React.createElement("path",{d:"M21.6009 10.4593C22.001 10.3521 22.2384 9.94088 22.1312 9.54078C21.59 7.52089 20.3974 5.73603 18.7384 4.46302C17.0793 3.19001 15.0466 2.5 12.9555 2.5C10.8644 2.5 8.83164 3.19001 7.17262 4.46302C6.12405 5.26762 5.26179 6.2767 4.63257 7.42036L2.86504 6.92617C2.76093 6.89707 2.65423 6.89133 2.55153 6.9068C2.46222 6.91962 2.37374 6.94889 2.29039 6.99582C1.92945 7.19903 1.80158 7.65636 2.00479 8.0173L3.73942 11.0983C3.83701 11.2717 3.99946 11.3991 4.19104 11.4527C4.30333 11.4841 4.42023 11.4886 4.53266 11.4673C4.61373 11.4524 4.69254 11.4242 4.7657 11.383L7.84641 9.64831C8.11073 9.49948 8.25936 9.20608 8.22302 8.90493C8.18668 8.60378 7.9725 8.35417 7.68037 8.27249L6.1241 7.83737C6.6343 6.99996 7.29751 6.2579 8.08577 5.65305C9.48282 4.58106 11.1946 4 12.9555 4C14.7164 4 16.4282 4.58106 17.8252 5.65305C19.2223 6.72504 20.2266 8.22807 20.6823 9.92901C20.7895 10.3291 21.2008 10.5665 21.6009 10.4593Z",fill:"#343C54"}),React.createElement("path",{d:"M4.30739 13.5387C3.90729 13.6459 3.66985 14.0572 3.77706 14.4573C4.31829 16.4771 5.51089 18.262 7.16991 19.535C8.82892 20.808 10.8616 21.498 12.9528 21.498C15.0439 21.498 17.0766 20.808 18.7356 19.535C19.7859 18.7291 20.6493 17.7181 21.2787 16.5722L23.0083 17.0557C23.1218 17.0961 23.2447 17.1091 23.3661 17.0917C23.5554 17.0658 23.7319 16.968 23.8546 16.8116C24.0419 16.573 24.0669 16.245 23.9181 15.9807L22.1835 12.8996C22.0859 12.7263 21.9234 12.5988 21.7319 12.5453C21.64 12.5196 21.5451 12.5119 21.4521 12.5216C21.3493 12.5317 21.2488 12.5629 21.1571 12.6146L18.0764 14.3493C17.7155 14.5525 17.5876 15.0099 17.7909 15.3708C17.9016 15.5675 18.0879 15.695 18.2929 15.7373L19.7875 16.1552C19.2768 16.9949 18.6125 17.7388 17.8225 18.345C16.4255 19.417 14.7137 19.998 12.9528 19.998C11.1918 19.998 9.4801 19.417 8.08305 18.345C6.686 17.273 5.68171 15.77 5.22595 14.069C5.11874 13.6689 4.70749 13.4315 4.30739 13.5387Z",fill:"#343C54"})),"Load more"))):React.createElement("div",{className:"ts-empty-user-tab"},React.createElement("p",null,n?"Loading files...":"No files found")))))}const P={search:'<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path></svg>',inbox:'<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z"></path><path d="M15 7v2a4 4 0 01-4 4H9.828l-1.766 1.767c.28.149.599.233.938.233h2l3 3v-3h2a2 2 0 002-2V9a2 2 0 00-2-2h-1z"></path></svg>',chevronLeft:'<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>',menu:'<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M6 10a2 2 0 11-4 0 2 2 0 014 0zM12 10a2 2 0 11-4 0 2 2 0 014 0zM16 12a2 2 0 100-4 2 2 0 000 4z"></path></svg>',reload:'<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"></path></svg>',send:'<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"></path></svg>',emoji:'<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 100-2 1 1 0 000 2zm7-1a1 1 0 11-2 0 1 1 0 012 0zm-.464 5.535a1 1 0 10-1.415-1.414 3 3 0 01-4.242 0 1 1 0 00-1.415 1.414 5 5 0 007.072 0z" clip-rule="evenodd"></path></svg>',attach:'<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M8 4a3 3 0 00-3 3v4a5 5 0 0010 0V7a1 1 0 112 0v4a7 7 0 11-14 0V7a5 5 0 0110 0v4a3 3 0 11-6 0V7a1 1 0 012 0v4a1 1 0 102 0V7a3 3 0 00-3-3z" clip-rule="evenodd"></path></svg>',close:'<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>',trash:'<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>',block:'<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M13.477 14.89A6 6 0 015.11 6.524l8.367 8.368zm1.414-1.414L6.524 5.11a6 6 0 018.367 8.367zM18 10a8 8 0 11-16 0 8 8 0 0116 0z" clip-rule="evenodd"></path></svg>',gallery:'<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"></path><path d="M6 6.5a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0z"></path></svg>'};function z(a,i){return a&&a.value?a.value:i}function tt(a=8){const i="abcdefghijklmnopqrstuvwxyz0123456789";let c="";for(let l=0;l<a;l++)c+=i.charAt(Math.floor(Math.random()*i.length));return c}function at(a,i=300){let c=null;return((...l)=>{c&&clearTimeout(c),c=setTimeout(()=>a(...l),i)})}function ge(a){return new URLSearchParams(window.location.search).get(a)}function nt(a,i){const c=new URL(window.location.href);c.searchParams.set(a,i),window.history.replaceState({},"",c.toString())}function Ce(a){const i=new URL(window.location.href);i.searchParams.delete(a),window.history.replaceState({},"",i.toString())}function Y(a,i="error"){const c=window.Voxel;c?.alert?c.alert(a,i):console.error(`[messages] ${i}: ${a}`)}const st=[];function rt({attributes:a,context:i,config:c,messagesConfig:l}){const[t,u]=d.useState({chats:{loading:!1,loadingMore:!1,list:i==="editor"?st:[],hasMore:!1,page:1},activeChat:null,search:{term:"",loading:!1,list:[]},emojis:{loading:!1,list:null,search:{term:"",list:[]},recents:[]},files:[],activePopup:null,dragActive:!1});d.useEffect(()=>{const e="voxel-messages-css";if(!document.getElementById(e)){const n=document.createElement("link");n.id=e,n.rel="stylesheet";const r=(window.Voxel_Config?.site_url||window.location.origin).replace(/\/$/,"");n.href=`${r}/wp-content/themes/voxel/assets/dist/messages.css?ver=1.7.5.2`,document.head.appendChild(n)}},[]);const C=d.useRef(null),v=d.useRef(null),_=d.useRef(null),E=d.useRef(null),L=d.useRef(null),T=d.useRef(null),w=d.useCallback(e=>{const n=window.Voxel_Config;return n?.ajax_url?`${n.ajax_url}&action=${e}`:`${n?.site_url||window.location.origin}/?vx=1&action=${e}`},[]),H=d.useCallback(()=>{C.current&&(C.current.scrollTop=C.current.scrollHeight)},[]),B=d.useCallback(()=>{!v.current||!_.current||(_.current.value=v.current.value,_.current.style.width=`${v.current.scrollWidth}px`,_.current.style.minWidth=`${v.current.scrollWidth}px`,_.current.style.maxWidth=`${v.current.scrollWidth}px`,v.current.style.height=`${_.current.scrollHeight}px`)},[]),W=d.useCallback(async(e=!1,n=1)=>{if(l){u(s=>({...s,chats:{...s.chats,loading:n===1,loadingMore:n>1}}));try{const s=new FormData;if(s.append("pg",String(n)),s.append("_wpnonce",l.nonce),e){const m=ge("chat");m&&s.append("load",m)}const o=await(await fetch(w("inbox.list_chats"),{method:"POST",body:s})).json();if(o.success){const m=o.list||o.data?.chats||[];if(u(h=>({...h,chats:{loading:!1,loadingMore:!1,list:n===1?m:[...h.chats.list,...m],hasMore:o.has_more||o.data?.has_more||!1,page:n}})),e){const h=m.find(g=>g.autoload);h?q(h):o.default_chat&&q(o.default_chat)}}else Y(o.message||"Failed to load chats","error"),u(m=>({...m,chats:{...m.chats,loading:!1,loadingMore:!1}}))}catch(s){console.error("[messages] Failed to load chats:",s),u(r=>({...r,chats:{...r.chats,loading:!1,loadingMore:!1}}))}}},[l,w]),$=d.useCallback(()=>{const e=t.chats.page+1;W(!1,e)},[t.chats.page,W]),q=d.useCallback(async e=>{const n=[e.author.type==="post"?e.author.id:"",e.target.type==="post"?"p":"u",e.target.id].join("");if(nt("chat",n),u(s=>({...s,activeChat:{...e,messages:{loading:!0,loadingMore:!1,list:[],hasMore:!1},state:{content:""},processing:!1,follow_status:e.follow_status||{author:0,target:0}},files:[]})),!!l)try{const s=new FormData;s.append("author_type",e.author.type),s.append("author_id",String(e.author.id)),s.append("target_type",e.target.type),s.append("target_id",String(e.target.id)),s.append("_wpnonce",l.nonce);const o=await(await fetch(w("inbox.load_chat"),{method:"POST",body:s})).json();if(o.success){u(h=>h.activeChat?{...h,activeChat:{...h.activeChat,messages:{loading:!1,loadingMore:!1,list:o.list||[],hasMore:o.has_more||!1},is_new:!1,seen:!0,follow_status:{author:o.follow_status?.author??h.activeChat.follow_status?.author??0,target:o.follow_status?.target??h.activeChat.follow_status?.target??0}}}:h),setTimeout(()=>{H(),B(),v.current?.focus()},50);const m=ge("text");m&&(u(h=>h.activeChat?{...h,activeChat:{...h.activeChat,state:{content:m}}}:h),Ce("text"))}else Y(o.message||"Failed to load messages","error")}catch(s){console.error("[messages] Failed to load messages:",s)}},[l,w,H,B]),Z=d.useCallback(()=>{Ce("chat"),u(e=>({...e,activeChat:null,files:[]}))},[]),G=d.useCallback(async()=>{if(!t.activeChat||!l||t.activeChat.messages.loadingMore)return;const e=C.current;if(!e)return;const n=e.scrollHeight-e.scrollTop;u(s=>s.activeChat?{...s,activeChat:{...s.activeChat,messages:{...s.activeChat.messages,loadingMore:!0}}}:s);try{const s=t.activeChat.messages.list[t.activeChat.messages.list.length-1],r=new FormData;s&&r.append("cursor",String(s.id)),r.append("author_type",t.activeChat.author.type),r.append("author_id",String(t.activeChat.author.id)),r.append("target_type",t.activeChat.target.type),r.append("target_id",String(t.activeChat.target.id)),r.append("_wpnonce",l.nonce);const m=await(await fetch(w("inbox.load_chat"),{method:"POST",body:r})).json();m.success&&(u(h=>h.activeChat?{...h,activeChat:{...h.activeChat,messages:{loading:!1,loadingMore:!1,list:[...h.activeChat.messages.list,...m.list||[]],hasMore:m.has_more||!1}}}:h),setTimeout(()=>{e&&(e.scrollTop=e.scrollHeight-n)},10))}catch(s){console.error("[messages] Failed to load more messages:",s),u(r=>r.activeChat?{...r,activeChat:{...r.activeChat,messages:{...r.activeChat.messages,loadingMore:!1}}}:r)}},[t.activeChat,l,w]),f=d.useCallback(async()=>{if(!t.activeChat||!l)return;const e=t.activeChat.state.content.trim(),n=t.files.length>0;if(!e&&!n)return;const s={id:Date.now(),content:e.replace(/(?:\r\n|\r|\n){2,}/g,"</p><p>").replace(/(?:\r\n|\r|\n)/g,"<br>"),has_content:e.length>0,time:b("Sending","voxel-fse"),sent_by:"author",seen:!1,sending:!0,tmp:!0,is_deleted:!1,is_hidden:!1};u(g=>g.activeChat?{...g,activeChat:{...g.activeChat,messages:{...g.activeChat.messages,list:[s,...g.activeChat.messages.list]},state:{content:""}},files:[]}:g);const r=new FormData,o={content:e},m="files",h=[];t.files.forEach(g=>{g.source==="new_upload"&&g.item?(r.append(`files[${m}][]`,g.item),h.push("uploaded_file")):g.source==="existing"&&g.id&&h.push(g.id)}),o[m]=h,r.append("fields",JSON.stringify(o)),r.append("sender_type",t.activeChat.author.type),r.append("sender_id",String(t.activeChat.author.id)),r.append("receiver_type",t.activeChat.target.type),r.append("receiver_id",String(t.activeChat.target.id)),r.append("_wpnonce",l.nonce),setTimeout(()=>{H(),B(),l.blur_on_send?v.current?.blur():v.current?.focus()},10);try{const R=await(await fetch(w("inbox.send_message"),{method:"POST",body:r})).json();R.success?(u(y=>{if(!y.activeChat)return y;const D=y.activeChat.messages.list.map(le=>le.tmp&&le.id===s.id?{...R.message||le,tmp:!1,sending:!1}:le),oe={...y.activeChat,messages:{...y.activeChat.messages,list:D},excerpt:R.message?.excerpt||y.activeChat.excerpt,time:R.message?.chat_time||y.activeChat.time},he=y.chats.list.filter(le=>le.key!==y.activeChat?.key);return he.unshift(oe),{...y,activeChat:oe,chats:{...y.chats,list:he}}}),delete window._vx_file_upload_cache,setTimeout(H,50)):(u(y=>y.activeChat?{...y,activeChat:{...y.activeChat,messages:{...y.activeChat.messages,list:y.activeChat.messages.list.filter(D=>D.id!==s.id)},state:{content:e}}}:y),Y(R.message||"Failed to send message","error"),setTimeout(B,10))}catch(g){console.error("[messages] Failed to send message:",g),u(R=>R.activeChat?{...R,activeChat:{...R.activeChat,messages:{...R.activeChat.messages,list:R.activeChat.messages.list.filter(y=>y.id!==s.id)},state:{content:e}}}:R)}},[t.activeChat,t.files,l,w,H,B]),p=d.useCallback(async e=>{if(!t.activeChat||!l||!window.confirm(b("Are you sure?","voxel-fse")))return;const n=new FormData;n.append("deleter_type",t.activeChat.author.type),n.append("deleter_id",String(t.activeChat.author.id)),n.append("message_id",String(e.id)),n.append("_wpnonce",l.nonce),u(s=>s.activeChat?{...s,activeChat:{...s.activeChat,messages:{...s.activeChat.messages,list:s.activeChat.messages.list.map(r=>r.id===e.id?{...r,processing:!0}:r)}}}:s);try{const r=await(await fetch(w("inbox.delete_message"),{method:"POST",body:n})).json();r.success?u(o=>o.activeChat?{...o,activeChat:{...o.activeChat,messages:{...o.activeChat.messages,list:o.activeChat.messages.list.map(m=>m.id===e.id?{...m,is_deleted:r.is_deleted,is_hidden:r.is_hidden,processing:!1}:m)}}}:o):(Y(r.message||"Failed to delete message","error"),u(o=>o.activeChat?{...o,activeChat:{...o.activeChat,messages:{...o.activeChat.messages,list:o.activeChat.messages.list.map(m=>m.id===e.id?{...m,processing:!1}:m)}}}:o))}catch(s){console.error("[messages] Failed to delete message:",s)}},[t.activeChat,l,w]),x=d.useCallback(async()=>{if(!t.activeChat||!l||!window.confirm(b("Are you sure?","voxel-fse")))return;const e=t.activeChat.follow_status?.author===-1,n=new FormData;n.append("sender_type",t.activeChat.author.type),n.append("sender_id",String(t.activeChat.author.id)),n.append("receiver_type",t.activeChat.target.type),n.append("receiver_id",String(t.activeChat.target.id)),e&&n.append("unblock","yes"),n.append("_wpnonce",l.nonce),u(s=>s.activeChat?{...s,activeChat:{...s.activeChat,processing:!0}}:s),L.current?.blur();try{const r=await(await fetch(w("inbox.block_chat"),{method:"POST",body:n})).json();r.success?(u(o=>o.activeChat?{...o,activeChat:{...o.activeChat,processing:!1,follow_status:{...o.activeChat.follow_status,author:r.status}}}:o),setTimeout(H,50)):(Y(r.message||"Failed to update block status","error"),u(o=>o.activeChat?{...o,activeChat:{...o.activeChat,processing:!1}}:o))}catch(s){console.error("[messages] Failed to block/unblock:",s)}},[t.activeChat,l,w,H]),k=d.useCallback(()=>t.activeChat?.follow_status?t.activeChat.follow_status.author===-1||t.activeChat.follow_status.target===-1:!1,[t.activeChat]),S=d.useCallback(async(e=!1)=>{if(!t.activeChat||!l||!window.confirm(b("Are you sure?","voxel-fse")))return;const n=new FormData;n.append("sender_type",t.activeChat.author.type),n.append("sender_id",String(t.activeChat.author.id)),n.append("receiver_type",t.activeChat.target.type),n.append("receiver_id",String(t.activeChat.target.id)),n.append("_wpnonce",l.nonce),u(s=>s.activeChat?{...s,activeChat:{...s.activeChat,processing:!0}}:s),L.current?.blur();try{const r=await(await fetch(w("inbox.clear_conversation"),{method:"POST",body:n})).json();r.success?(u(o=>{if(!o.activeChat)return o;const m=o.chats.list.filter(h=>h.key!==o.activeChat?.key);return e?{...o,activeChat:null,chats:{...o.chats,list:m}}:{...o,activeChat:{...o.activeChat,processing:!1,messages:{...o.activeChat.messages,list:[],hasMore:!1}},chats:{...o.chats,list:m}}}),e&&Ce("chat")):(Y(r.message||"Failed to clear conversation","error"),u(o=>o.activeChat?{...o,activeChat:{...o.activeChat,processing:!1}}:o))}catch(s){console.error("[messages] Failed to clear conversation:",s)}},[t.activeChat,l,w]),N=d.useCallback(async()=>{if(!l?.polling?.enabled)return;if(document.visibilityState!=="visible"){T.current=setTimeout(N,l.polling.frequency||3e4);return}const e=Math.round(Date.now()/1e3);try{await(await fetch(`${l.polling.url}?u=${l.user?.id||0}&v=${e}`)).text()==="1"?O():T.current=setTimeout(N,l.polling.frequency||3e4)}catch(n){console.error("[messages] Polling failed:",n),T.current=setTimeout(N,l.polling.frequency||3e4)}},[l]),M=d.useCallback((e,n)=>{const s={...e,excerpt:n.excerpt,is_new:n.is_new,seen:n.seen,time:n.time};if(n.messages?.list&&e.messages?.list){n.messages.list.forEach(m=>{const h=e.messages.list.find(g=>g.id===m.id);h&&(h.seen=m.seen,h.is_deleted=m.is_deleted,h.is_hidden=m.is_hidden)});const r=e.messages.list[0]?.id||0,o=n.messages.list.filter(m=>m.id>r);o.length<15?s.messages={...e.messages,list:[...o,...e.messages.list],hasMore:n.messages.hasMore}:s.messages=n.messages}return s.last_id=n.last_id,s},[]),O=d.useCallback(async()=>{if(l)try{const e=new FormData;e.append("pg","1"),e.append("_wpnonce",l.nonce);const n=ge("chat");n&&e.append("load",n);const r=await(await fetch(w("inbox.list_chats"),{method:"POST",body:e})).json();r.success&&u(o=>{const m=[],h=r.list||[];h.forEach(y=>{const D=o.chats.list.findIndex(oe=>oe.key===y.key);if(D!==-1){const oe=o.chats.list[D],he=M(oe,y);m.push(he)}else m.push(y)});const g=o.chats.list.filter(y=>!h.find(D=>D.key===y.key)),R={...o,chats:{...o.chats,list:[...m,...g]}};if(o.activeChat){const y=m.find(D=>D.key===o.activeChat?.key);y&&(R.activeChat={...o.activeChat,...y,messages:y.messages||o.activeChat.messages,state:o.activeChat.state})}return R}),l.polling?.enabled&&(T.current=setTimeout(N,l.polling.frequency||3e4))}catch(e){console.error("[messages] Failed to refresh inbox:",e),l.polling?.enabled&&(T.current=setTimeout(N,l.polling.frequency||3e4))}},[l,w,M,N]),I=d.useCallback(async()=>{if(t.emojis.list!==null)return;u(n=>({...n,emojis:{...n.emojis,loading:!0}}));try{const n=l?.emojis?.url||"/wp-content/themes/voxel/assets/emojis.json",r=await(await fetch(n)).json();u(o=>({...o,emojis:{...o.emojis,loading:!1,list:r}}))}catch(n){console.error("[messages] Failed to load emojis:",n),u(s=>({...s,emojis:{...s.emojis,loading:!1}}))}const e=localStorage.getItem("voxel:recent_emojis");e&&u(n=>({...n,emojis:{...n.emojis,recents:[...e]}}))},[t.emojis.list,l]),V=d.useCallback(e=>{if(!v.current||!t.activeChat)return;const n=v.current;let s=t.activeChat.state.content;if(n.selectionStart!==null){const h=n.selectionStart,g=n.selectionEnd;s=s.substring(0,h)+e+s.substring(g),setTimeout(()=>{n.setSelectionRange(h+e.length,h+e.length),n.focus()},10)}else s+=e;u(h=>h.activeChat?{...h,activeChat:{...h.activeChat,state:{content:s}}}:h);let r=[];const o=localStorage.getItem("voxel:recent_emojis");o&&(r=[...o]),r=r.filter(h=>h!==e),r.unshift(e);const m=r.slice(0,16);localStorage.setItem("voxel:recent_emojis",m.join("")),u(h=>({...h,emojis:{...h.emojis,recents:m}}))},[t.activeChat]),J=d.useCallback(()=>{if(!t.emojis.list||!t.emojis.search.term.trim()){u(s=>({...s,emojis:{...s.emojis,search:{...s.emojis.search,list:[]}}}));return}const e=[],n=t.emojis.search.term.trim().toLowerCase();Object.values(t.emojis.list).some(s=>(s.some(r=>(r.name.toLowerCase().includes(n)&&e.push(r.emoji),e.length>=80)),e.length>=80)),u(s=>({...s,emojis:{...s.emojis,search:{...s.emojis.search,list:e}}}))},[t.emojis.list,t.emojis.search.term]),A=d.useCallback(e=>{const n=l?.files?.max_count||5,s=l?.files?.max_size;if(s&&e.size>s*1e3){const g=s,R=(s/1e3).toFixed(1);Y(b('File "%s" exceeds the maximum size limit (%s KB / %s MB)',"voxel-fse").replace("%s",e.name).replace("%s",String(g)).replace("%s",R),"error");return}const r=l?.files?.allowed_file_types;if(r&&r.length>0&&!r.includes(e.type)){Y(b('File "%s" is not an allowed file type',"voxel-fse").replace("%s",e.name),"error");return}const o={source:"new_upload",name:e.name,type:e.type,size:e.size,preview:URL.createObjectURL(e),item:e,_id:tt(8)},m=window;m._vx_file_upload_cache||(m._vx_file_upload_cache=[]);const h=m._vx_file_upload_cache.find(g=>g.item?.name===e.name&&g.item?.type===e.type&&g.item?.size===e.size&&g.item?.lastModified===e.lastModified);h?u(g=>n===1?{...g,files:[h]}:g.files.length>=n?g:{...g,files:[...g.files,h]}):(m._vx_file_upload_cache.unshift(o),u(g=>n===1?{...g,files:[o]}:g.files.length>=n?g:{...g,files:[...g.files,o]}))},[l]),j=d.useCallback(e=>{const n=e.target.files;if(n){for(let s=0;s<n.length;s++)A(n[s]);e.target.value=""}},[A]),K=d.useCallback(e=>{e.preventDefault(),u(n=>({...n,dragActive:!1})),e.dataTransfer.items?[...e.dataTransfer.items].forEach(n=>{if(n.kind==="file"){const s=n.getAsFile();s&&A(s)}}):[...e.dataTransfer.files].forEach(n=>{A(n)})},[A]),U=d.useCallback(e=>{u(n=>({...n,files:n.files.filter(s=>s._id!==e._id&&s.id!==e.id)})),e.source==="new_upload"&&URL.revokeObjectURL(e.preview)},[]),te=d.useCallback((e,n)=>{if(e.preventDefault(),!t.activeChat)return;const s=[];t.activeChat.messages.list.forEach(m=>{m.files&&m.files.forEach(h=>{h.is_image&&s.push({src:h.url,alt:h.alt||h.name})})});const r=s.findIndex(m=>m.src===n),o=window.VoxelLightbox;o&&o.open(s,Math.max(0,r))},[t.activeChat]),ce=d.useCallback(e=>{const n=l?.files?.max_count||5,s={};t.files.forEach(o=>{o.source==="existing"&&o.id&&(s[o.id]=!0),o.source==="new_upload"&&o._id&&(s[o._id]=!0)});const r=[];e.forEach(o=>{o.source==="existing"&&o.id&&!s[o.id]&&r.push(o),o.source==="new_upload"&&o._id&&!s[o._id]&&r.push(o)}),u(o=>{const m=[...o.files,...r];return{...o,files:m.slice(0,n)}})},[l,t.files]),ae=d.useMemo(()=>at(async(e,n)=>{try{const s=new FormData;s.append("search",e),s.append("_wpnonce",n);const o=await(await fetch(w("inbox.search_chats"),{method:"POST",body:s})).json();o.success&&u(m=>({...m,search:{...m.search,loading:!1,list:o.list||[]}}))}catch(s){console.error("[messages] Failed to search chats:",s),u(r=>({...r,search:{...r.search,loading:!1}}))}},300),[w]),X=d.useCallback(e=>{if(u(n=>({...n,search:{...n.search,term:e,loading:e.trim().length>0}})),!e.trim()||!l){u(n=>({...n,search:{term:e,loading:!1,list:[]}}));return}if(!t.chats.hasMore||e.trim().length<=2){const n=t.chats.list.filter(s=>s.target.name.toLowerCase().includes(e.trim().toLowerCase())).slice(0,10);u(s=>({...s,search:{term:e,loading:!1,list:n}}))}else ae(e.trim(),l.nonce)},[l,t.chats.hasMore,t.chats.list,ae]),Q=d.useCallback(e=>{e.nativeEvent.isComposing||e.keyCode===229||e.shiftKey||e.key==="Enter"&&(e.preventDefault(),f())},[f]),ne=d.useCallback(e=>{u(n=>({...n,activeChat:n.activeChat?{...n.activeChat,state:{...n.activeChat.state,content:e}}:null})),setTimeout(B,10)},[B]),se=d.useCallback(()=>{u(e=>({...e,activePopup:e.activePopup==="emoji"?null:"emoji"})),t.activePopup!=="emoji"&&I()},[t.activePopup,I]),ue=d.useCallback(()=>{u(e=>({...e,activePopup:e.activePopup==="actions"?null:"actions"}))},[]);d.useEffect(()=>(i==="frontend"&&l&&(W(!0),l.polling?.enabled&&(T.current=setTimeout(N,l.polling.frequency||3e4)),setTimeout(I,100)),()=>{T.current&&clearTimeout(T.current)}),[i,l,W,N,I]),d.useEffect(()=>{t.emojis.search.term.trim()&&t.emojis.list&&J()},[t.emojis.search.term,t.emojis.list,J]);const re=JSON.stringify(c||{icons:a.icons,settings:{enableCalcHeight:a.enableCalcHeight,calcHeight:a.calcHeight}});return React.createElement(React.Fragment,null,React.createElement("textarea",{ref:_,style:{position:"absolute",visibility:"hidden",height:"auto",overflow:"hidden"},"aria-hidden":"true",tabIndex:-1}),React.createElement("input",{ref:E,type:"file",multiple:!0,accept:l?.files?.allowed_file_types?.join(",")||"*",style:{display:"none"},onChange:j}),React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:re}}),React.createElement("div",{className:`ts-inbox ${t.dragActive?"drag-active":""}`,onDragOver:e=>{e.preventDefault(),u(n=>({...n,dragActive:!0}))},onDragLeave:()=>u(e=>({...e,dragActive:!1})),onDrop:K},React.createElement("div",{className:`inbox-left ${t.activeChat?"":"ts-no-chat"}`},t.chats.loading?React.createElement("div",{className:"ts-empty-user-tab"},React.createElement("span",{className:"ts-loader"})):t.chats.list.length?React.createElement(React.Fragment,null,React.createElement("div",{className:"ts-form ts-inbox-top"},React.createElement("div",{className:"ts-input-icon flexify"},React.createElement("span",{dangerouslySetInnerHTML:{__html:z(a.icons.search,P.search)}}),React.createElement("input",{type:"text",value:t.search.term,onChange:e=>X(e.target.value),placeholder:b("Search inbox","voxel-fse"),className:"autofocus"}))),React.createElement("ul",{className:`ts-convo-list simplify-ul min-scroll ${t.search.loading?"vx-disabled":""}`},(t.search.term.trim()?t.search.list:t.chats.list).map(e=>React.createElement("li",{key:e.key||e.id,className:`
												${e.is_new?"ts-new-message":""}
												${e.seen?"":"ts-unread-message"}
												${t.activeChat?.id===e.id?"ts-active-chat":""}
											`},React.createElement("a",{href:"#",onClick:n=>{n.preventDefault(),q(e)}},e.target.avatar&&React.createElement("div",{className:"convo-avatars"},React.createElement("div",{className:"convo-avatar",dangerouslySetInnerHTML:{__html:e.target.avatar}}),e.author.type==="post"&&React.createElement("div",{className:"post-avatar",dangerouslySetInnerHTML:{__html:e.author.avatar}})),React.createElement("div",{className:"message-details"},React.createElement("b",null,e.target.name),React.createElement("span",null,e.excerpt),React.createElement("span",null,e.time))))),t.chats.hasMore&&!t.search.term.trim()&&React.createElement("div",{className:"ts-btn-group"},React.createElement("div",{className:"n-load-more"},React.createElement("a",{href:"#",onClick:e=>{e.preventDefault(),$()},className:`ts-btn ts-btn-4 ${t.chats.loadingMore?"vx-pending":""}`},React.createElement("span",{dangerouslySetInnerHTML:{__html:z(a.icons.loadMore,P.reload)}}),b("Load more","voxel-fse")))))):React.createElement("div",{className:"ts-empty-user-tab"},React.createElement("span",{dangerouslySetInnerHTML:{__html:z(a.icons.chat,P.inbox)}}),React.createElement("p",null,b("No chats available","voxel-fse")))),React.createElement("div",{className:`ts-message-body ${t.activeChat?.processing?"vx-disabled":""} ${t.activeChat?"":"ts-no-chat"}`},t.activeChat?React.createElement(React.Fragment,null,React.createElement("div",{className:"ts-inbox-top add-spacing flexify"},React.createElement("div",{className:"convo-head"},React.createElement("div",{className:"ts-convo-name flexify"},React.createElement("a",{className:"convo-pic",href:t.activeChat.target.link},React.createElement("span",{dangerouslySetInnerHTML:{__html:t.activeChat.target.avatar}})),React.createElement("a",{className:"convo-name",href:t.activeChat.target.link},React.createElement("span",null,t.activeChat.target.name))),React.createElement("ul",{className:"flexify simplify-ul inbox-top-btns"},React.createElement("li",{className:"flexify"},React.createElement("a",{href:"#",onClick:e=>{e.preventDefault(),Z()},className:"ts-icon-btn"},React.createElement("span",{dangerouslySetInnerHTML:{__html:z(a.icons.back,P.chevronLeft)}}))),React.createElement("li",{className:"flexify ts-popup-target"},React.createElement("button",{ref:L,onClick:ue,className:"ts-icon-btn"},React.createElement("span",{dangerouslySetInnerHTML:{__html:z(a.icons.more,P.menu)}})),t.activePopup==="actions"&&React.createElement("div",{className:"ts-popup-content ts-popup-visible"},React.createElement("ul",{className:"simplify-ul ts-popup-list"},React.createElement("li",null,React.createElement("a",{href:"#",onClick:e=>{e.preventDefault(),x(),u(n=>({...n,activePopup:null}))}},React.createElement("span",{dangerouslySetInnerHTML:{__html:z(a.icons.ban,P.block)}}),k()?b("Unblock user","voxel-fse"):b("Block user","voxel-fse"))),React.createElement("li",null,React.createElement("a",{href:"#",onClick:e=>{e.preventDefault(),S(!0),u(n=>({...n,activePopup:null}))}},React.createElement("span",{dangerouslySetInnerHTML:{__html:z(a.icons.clear,P.trash)}}),b("Clear conversation","voxel-fse"))))))))),k()&&React.createElement("div",{className:"ts-chat-blocked-notice"},React.createElement("p",null,b("This conversation is blocked.","voxel-fse"))),t.activeChat.messages.loading?React.createElement("div",{className:"start-convo"},React.createElement("span",{className:"ts-loader"})):t.activeChat.messages.list.length?React.createElement("div",{className:"ts-conversation-body min-scroll",ref:C},t.activeChat.messages.hasMore&&React.createElement("div",{className:"load-more-messages"},React.createElement("a",{href:"#",onClick:e=>{e.preventDefault(),G()},className:`ts-btn ts-btn-4 ${t.activeChat.messages.loadingMore?"vx-pending":""}`},t.activeChat.messages.loadingMore?b("Loading...","voxel-fse"):b("Load older messages","voxel-fse"))),React.createElement("ul",{className:"ts-message-list simplify-ul"},[...t.activeChat.messages.list].reverse().map(e=>React.createElement("li",{key:e.id,className:`
													ts-single-message
													ts-responder-${e.sent_by==="author"?2:1}
													ts-message-id-${e.id}
													${e.sent_by==="author"&&e.seen?"ts-message-seen":""}
													${e.tmp?"inserted-message":""}
													${e.is_deleted?"ts-message-deleted":""}
													${e.is_hidden?"ts-message-hidden":""}
													${e.processing?"vx-disabled":""}
												`},e.is_deleted?React.createElement(React.Fragment,null,React.createElement("p",{className:"vx-disabled"},b("Deleted","voxel-fse")),React.createElement("ul",{className:"flexify simplify-ul ms-info"},React.createElement("li",null,e.time))):e.is_hidden?React.createElement(React.Fragment,null,React.createElement("p",{className:"vx-disabled"},b("Hidden","voxel-fse")),React.createElement("ul",{className:"flexify simplify-ul ms-info"},React.createElement("li",null,e.time))):React.createElement(React.Fragment,null,e.files&&e.files.length>0&&React.createElement(React.Fragment,null,e.files.map((n,s)=>n.is_image?React.createElement("a",{key:`${e.id}-file-${s}`,href:n.url,className:"ts-image-attachment",onClick:r=>te(r,n.url)},React.createElement("img",{src:n.preview||n.url,alt:n.alt||n.name,width:n.width,height:n.height,loading:"lazy"})):React.createElement("p",{key:`${e.id}-file-${s}`},React.createElement("a",{href:n.url,target:"_blank",rel:"noopener noreferrer"},n.name)))),e.has_content&&React.createElement("p",{dangerouslySetInnerHTML:{__html:e.content}}),React.createElement("ul",{className:"flexify simplify-ul ms-info"},e.sent_by==="author"&&!e.tmp&&React.createElement(React.Fragment,null,React.createElement("li",{className:"message-actions"},React.createElement("a",{href:"#",onClick:n=>{n.preventDefault(),p(e)}},b("Delete","voxel-fse"))),React.createElement("li",{className:"message-actions"},"")),React.createElement("li",null,e.sending?b("Sending","voxel-fse"):e.time)),e.sent_by==="author"&&e.seen&&l?.seen_badge?.enabled&&React.createElement("div",{className:"seen-badge"},b("Seen","voxel-fse"))))))):React.createElement("div",{className:"start-convo"},React.createElement("a",{href:t.activeChat.target.link},React.createElement("span",{dangerouslySetInnerHTML:{__html:t.activeChat.target.avatar}})),React.createElement("span",null,b("Start a conversation with","voxel-fse")),React.createElement("a",{href:t.activeChat.target.link},React.createElement("h4",null,t.activeChat.target.name))),t.files.length>0&&React.createElement("div",{className:"ts-file-attachments"},t.files.map(e=>React.createElement("div",{key:e._id||e.id,className:"ts-file-preview"},e.type.startsWith("image/")?React.createElement("img",{src:e.preview,alt:e.name}):React.createElement("span",null,e.name),React.createElement("button",{className:"ts-remove-file",onClick:()=>U(e)},React.createElement("span",{dangerouslySetInnerHTML:{__html:z(a.icons.trash,P.close)}}))))),!k()&&React.createElement("div",{className:"ts-inbox-bottom"},React.createElement("div",{className:"flexify ts-convo-form"},React.createElement("span",{className:"active-avatar",dangerouslySetInnerHTML:{__html:t.activeChat.author.avatar}}),React.createElement("div",{className:"ts-popup-target"},React.createElement("button",{onClick:se,className:"ts-icon-btn ts-emoji-btn"},React.createElement("span",{dangerouslySetInnerHTML:{__html:z(a.icons.emoji,P.emoji)}})),t.activePopup==="emoji"&&React.createElement("div",{className:"ts-popup-content ts-emoji-popup ts-popup-visible"},React.createElement("div",{className:"ts-form"},React.createElement("input",{type:"text",placeholder:b("Search emojis","voxel-fse"),value:t.emojis.search.term,onChange:e=>u(n=>({...n,emojis:{...n.emojis,search:{...n.emojis.search,term:e.target.value}}}))})),t.emojis.loading?React.createElement("div",{className:"ts-loader"}):React.createElement("div",{className:"ts-emoji-list"},t.emojis.recents.length>0&&!t.emojis.search.term.trim()&&React.createElement("div",{className:"ts-emoji-category"},React.createElement("span",null,b("Recent","voxel-fse")),React.createElement("div",{className:"ts-emoji-grid"},t.emojis.recents.map((e,n)=>React.createElement("button",{key:`recent-${n}`,onClick:()=>V(e)},e)))),t.emojis.search.term.trim()?React.createElement("div",{className:"ts-emoji-grid"},t.emojis.search.list.map((e,n)=>React.createElement("button",{key:`search-${n}`,onClick:()=>V(e)},e))):t.emojis.list&&Object.entries(t.emojis.list).map(([e,n])=>React.createElement("div",{key:e,className:"ts-emoji-category"},React.createElement("span",null,l?.l10n?.emoji_groups?.[e]||e),React.createElement("div",{className:"ts-emoji-grid"},n.map((s,r)=>React.createElement("button",{key:`${e}-${r}`,onClick:()=>V(s.emoji)},s.emoji)))))))),l?.files?.enabled!==!1&&React.createElement("button",{onClick:()=>E.current?.click(),className:"ts-icon-btn ts-attach-btn",title:b("Upload file","voxel-fse")},React.createElement("span",{dangerouslySetInnerHTML:{__html:z(a.icons.upload,P.attach)}})),l?.files?.enabled!==!1&&React.createElement(et,{multiple:!0,saveLabel:b("Add files","voxel-fse"),onSave:e=>{const n=e.map(s=>({source:s.source||"existing",id:s.id,_id:s.id?String(s.id):void 0,name:s.name,type:s.type||"",size:0,preview:s.preview||""}));ce(n)}},React.createElement("button",{className:"ts-icon-btn ts-gallery-btn",title:b("Media library","voxel-fse")},React.createElement("span",{dangerouslySetInnerHTML:{__html:z(a.icons.gallery,P.gallery)}}))),React.createElement("div",{className:"compose-message min-scroll"},React.createElement("textarea",{ref:v,value:t.activeChat.state.content,onKeyDown:Q,onChange:e=>ne(e.target.value)}),!t.activeChat.state.content&&React.createElement("span",{className:"compose-placeholder"},t.activeChat.author.type==="post"?b("Reply as","voxel-fse")+" "+t.activeChat.author.name:b("Your message","voxel-fse"))),React.createElement("a",{href:"#",onClick:e=>{e.preventDefault(),f()},className:"ts-icon-btn"},React.createElement("span",{dangerouslySetInnerHTML:{__html:z(a.icons.send,P.send)}}))))):React.createElement("div",{className:"ts-empty-user-tab"},t.chats.loading?React.createElement("span",{className:"ts-loader"}):React.createElement(React.Fragment,null,React.createElement("span",{dangerouslySetInnerHTML:{__html:z(a.icons.chat,P.inbox)}}),React.createElement("p",null,b("No conversation selected","voxel-fse")))))))}const ot={search:{library:"",value:""},chat:{library:"",value:""},loadMore:{library:"",value:""},back:{library:"",value:""},more:{library:"",value:""},user:{library:"",value:""},clear:{library:"",value:""},ban:{library:"",value:""},trash:{library:"",value:""},upload:{library:"",value:""},gallery:{library:"",value:""},emoji:{library:"",value:""},send:{library:"",value:""}};function lt(a){const i=a.querySelector("script.vxconfig");if(i&&i.textContent)try{return JSON.parse(i.textContent)}catch(c){console.error("[messages] Failed to parse vxconfig:",c)}return null}function it(a){const i={search:a.icons?.search??a.icons?.searchIcon??{},chat:a.icons?.chat??a.icons?.chatIcon??{},back:a.icons?.back??a.icons?.backIcon??{},more:a.icons?.more??a.icons?.moreIcon??{},loadMore:a.icons?.loadMore??a.icons?.load_more??{},send:a.icons?.send??a.icons?.sendIcon??{},emoji:a.icons?.emoji??a.icons?.emojiIcon??{},upload:a.icons?.upload??a.icons?.uploadIcon??{},gallery:a.icons?.gallery??a.icons?.galleryIcon??{},user:a.icons?.user??a.icons?.userIcon??{},clear:a.icons?.clear??a.icons?.clearIcon??{},ban:a.icons?.ban??a.icons?.banIcon??{},trash:a.icons?.trash??a.icons?.trashIcon??{}},c={enableCalcHeight:a.settings?.enableCalcHeight??a.settings?.enable_calc_height??!1,calcHeight:a.settings?.calcHeight??a.settings?.calc_height??""};return{icons:i,settings:c}}function ct(a){const i=a.querySelector(".ts-inbox");if(i&&i.dataset.config)try{return JSON.parse(i.dataset.config)}catch(l){console.error("Failed to parse messages config:",l)}const c=window;return c.voxelMessagesConfig?c.voxelMessagesConfig:null}function ut(a){return{blockId:"",icons:a.icons||ot,generalHeightUnit:"px",enableCalcHeight:a.settings?.enableCalcHeight||!1,calcHeight:a.settings?.calcHeight||"",generalBackground:"",generalBorderType:"default",generalBorderWidth:0,generalBorderColor:"",generalBorderRadius:0,generalBoxShadow:{},separatorColor:"",scrollbarColor:"",inboxMessagePadding:{top:"",right:"",bottom:"",left:""},inboxMessageTitleColor:"",inboxMessageTitleTypography:{},inboxMessageSubtitleColor:"",inboxMessageSubtitleTypography:{},inboxMessageSecondaryLogoBorder:{},inboxMessageHoverBg:"",inboxMessageHoverTitleColor:"",inboxMessageHoverSubtitleColor:"",inboxMessageActiveBg:"",inboxMessageActiveBorderColor:"",inboxMessageActiveTitleColor:"",inboxMessageActiveSubtitleColor:"",inboxMessageUnreadTitleTypography:{},inboxMessageNewAvatarBorder:{},inboxSearchTypography:{},inboxSearchValueColor:"",inboxSearchPlaceholderColor:"",inboxSearchIconColor:"",conversationTopTypography:{},conversationTopTextColor:"",conversationIntroNameTypography:{},conversationIntroNameColor:"",conversationIntroSubtitleTypography:{},conversationIntroSubtitleColor:"",conversationBodyMessagePadding:{top:"",right:"",bottom:"",left:""},conversationBodyMessageTypography:{},responder1Background:{},responder1Color:"",responder2Background:{},responder2Color:"",errorBackground:{},errorColor:"",messageInfoTypography:{},messageInfoDefaultColor:"",messageInfoDeleteColor:"",seenTypography:{},seenColor:"",composePlaceholderTypography:{},composePlaceholderColor:"",composeValueTypography:{},composeValueColor:"",iconButtonColor:"",iconButtonBackground:"",iconButtonBorderType:"default",iconButtonBorderWidth:0,iconButtonBorderColor:"",iconButtonHoverColor:"",iconButtonHoverBackground:"",iconButtonHoverBorderColor:"",tertiaryButtonIconColor:"",tertiaryButtonBackground:"",tertiaryButtonBorderType:"default",tertiaryButtonBorderWidth:0,tertiaryButtonBorderColor:"",tertiaryButtonTypography:{},tertiaryButtonTextColor:"",tertiaryButtonHoverIconColor:"",tertiaryButtonHoverBackground:"",tertiaryButtonHoverBorderColor:"",tertiaryButtonHoverTextColor:"",emptyIconSize:35,emptyIconColor:"",emptyTitleColor:"",emptyTitleTypography:{},loadingColor1:"",loadingColor2:""}}function dt({config:a,messagesConfig:i}){const c=ut(a);return React.createElement(rt,{attributes:c,context:"frontend",config:a,messagesConfig:i})}function ee(){document.querySelectorAll(".voxel-fse-messages").forEach(i=>{if(i.dataset.hydrated==="true")return;const c=lt(i);if(!c){console.error("[messages] No vxconfig found for messages block");return}const l=it(c),t=ct(i);i.dataset.hydrated="true",Fe.createRoot(i).render(React.createElement(dt,{config:l,messagesConfig:t}))})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ee):ee(),window.addEventListener("turbo:load",ee),window.addEventListener("pjax:complete",ee),document.addEventListener("voxel:markup-update",ee);const mt=window;mt.render_messages=ee})(ReactDOM,React,ReactDOM);
