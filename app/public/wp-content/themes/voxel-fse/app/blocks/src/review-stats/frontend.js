(function(B,S){"use strict";var T,k,R,L;T={"(":9,"!":8,"*":7,"/":7,"%":7,"+":6,"-":6,"<":5,"<=":5,">":5,">=":5,"==":4,"!=":4,"&&":3,"||":2,"?":1,"?:":1},k=["(","?"],R={")":["("],":":["?","?:"]},L=/<=|>=|==|!=|&&|\|\||\?:|\(|!|\*|\/|%|\+|-|<|>|\?|\)|:/;function U(e){for(var t=[],r=[],n,o,i,s;n=e.match(L);){for(o=n[0],i=e.substr(0,n.index).trim(),i&&t.push(i);s=r.pop();){if(R[o]){if(R[o][0]===s){o=R[o][1]||o;break}}else if(k.indexOf(s)>=0||T[s]<T[o]){r.push(s);break}t.push(s)}R[o]||r.push(o),e=e.substr(n.index+o.length)}return e=e.trim(),e&&t.push(e),t.concat(r.reverse())}var V={"!":function(e){return!e},"*":function(e,t){return e*t},"/":function(e,t){return e/t},"%":function(e,t){return e%t},"+":function(e,t){return e+t},"-":function(e,t){return e-t},"<":function(e,t){return e<t},"<=":function(e,t){return e<=t},">":function(e,t){return e>t},">=":function(e,t){return e>=t},"==":function(e,t){return e===t},"!=":function(e,t){return e!==t},"&&":function(e,t){return e&&t},"||":function(e,t){return e||t},"?:":function(e,t,r){if(e)throw t;return r}};function J(e,t){var r=[],n,o,i,s,l,p;for(n=0;n<e.length;n++){if(l=e[n],s=V[l],s){for(o=s.length,i=Array(o);o--;)i[o]=r.pop();try{p=s.apply(null,i)}catch(a){return a}}else t.hasOwnProperty(l)?p=t[l]:p=+l;r.push(p)}return r[0]}function q(e){var t=U(e);return function(r){return J(t,r)}}function K(e){var t=q(e);return function(r){return+t({n:r})}}var z={contextDelimiter:"",onMissingKey:null};function Z(e){var t,r,n;for(t=e.split(";"),r=0;r<t.length;r++)if(n=t[r].trim(),n.indexOf("plural=")===0)return n.substr(7)}function x(e,t){var r;this.data=e,this.pluralForms={},this.options={};for(r in z)this.options[r]=t!==void 0&&r in t?t[r]:z[r]}x.prototype.getPluralForm=function(e,t){var r=this.pluralForms[e],n,o,i;return r||(n=this.data[e][""],i=n["Plural-Forms"]||n["plural-forms"]||n.plural_forms,typeof i!="function"&&(o=Z(n["Plural-Forms"]||n["plural-forms"]||n.plural_forms),i=K(o)),r=this.pluralForms[e]=i),r(t)},x.prototype.dcnpgettext=function(e,t,r,n,o){var i,s,l;return o===void 0?i=0:i=this.getPluralForm(e,o),s=r,t&&(s=t+this.options.contextDelimiter+r),l=this.data[e][s],l&&l[i]?l[i]:(this.options.onMissingKey&&this.options.onMissingKey(r,e),i===0?r:n)};var I={"":{plural_forms(e){return e===1?0:1}}},W=/^i18n\.(n?gettext|has_translation)(_|$)/,X=(e,t,r)=>{const n=new x({}),o=new Set,i=()=>{o.forEach(c=>c())},s=c=>(o.add(c),()=>o.delete(c)),l=(c="default")=>n.data[c],p=(c,u="default")=>{n.data[u]={...n.data[u],...c},n.data[u][""]={...I[""],...n.data[u]?.[""]},delete n.pluralForms[u]},a=(c,u)=>{p(c,u),i()},f=(c,u="default")=>{n.data[u]={...n.data[u],...c,"":{...I[""],...n.data[u]?.[""],...c?.[""]}},delete n.pluralForms[u],i()},d=(c,u)=>{n.data={},n.pluralForms={},a(c,u)},h=(c="default",u,_,b,g)=>(n.data[c]||p(void 0,c),n.dcnpgettext(c,u,_,b,g)),m=c=>c||"default",ve=(c,u)=>{let _=h(u,void 0,c);return r?(_=r.applyFilters("i18n.gettext",_,c,u),r.applyFilters("i18n.gettext_"+m(u),_,c,u)):_},$=(c,u,_)=>{let b=h(_,u,c);return r?(b=r.applyFilters("i18n.gettext_with_context",b,c,u,_),r.applyFilters("i18n.gettext_with_context_"+m(_),b,c,u,_)):b},Re=(c,u,_,b)=>{let g=h(b,void 0,c,u,_);return r?(g=r.applyFilters("i18n.ngettext",g,c,u,_,b),r.applyFilters("i18n.ngettext_"+m(b),g,c,u,_,b)):g},Se=(c,u,_,b,g)=>{let H=h(g,b,c,u,_);return r?(H=r.applyFilters("i18n.ngettext_with_context",H,c,u,_,b,g),r.applyFilters("i18n.ngettext_with_context_"+m(g),H,c,u,_,b,g)):H},Ee=()=>$("ltr","text direction")==="rtl",Ae=(c,u,_)=>{const b=u?u+""+c:c;let g=!!n.data?.[_??"default"]?.[b];return r&&(g=r.applyFilters("i18n.has_translation",g,c,u,_),g=r.applyFilters("i18n.has_translation_"+m(_),g,c,u,_)),g};if(r){const c=u=>{W.test(u)&&i()};r.addAction("hookAdded","core/i18n",c),r.addAction("hookRemoved","core/i18n",c)}return{getLocaleData:l,setLocaleData:a,addLocaleData:f,resetLocaleData:d,subscribe:s,__:ve,_x:$,_n:Re,_nx:Se,isRTL:Ee,hasTranslation:Ae}};function Q(e){return typeof e!="string"||e===""?(console.error("The namespace must be a non-empty string."),!1):/^[a-zA-Z][a-zA-Z0-9_.\-\/]*$/.test(e)?!0:(console.error("The namespace can only contain numbers, letters, dashes, periods, underscores and slashes."),!1)}var w=Q;function Y(e){return typeof e!="string"||e===""?(console.error("The hook name must be a non-empty string."),!1):/^__/.test(e)?(console.error("The hook name cannot begin with `__`."),!1):/^[a-zA-Z][a-zA-Z0-9_.-]*$/.test(e)?!0:(console.error("The hook name can only contain numbers, letters, dashes, periods and underscores."),!1)}var C=Y;function ee(e,t){return function(n,o,i,s=10){const l=e[t];if(!C(n)||!w(o))return;if(typeof i!="function"){console.error("The hook callback must be a function.");return}if(typeof s!="number"){console.error("If specified, the hook priority must be a number.");return}const p={callback:i,priority:s,namespace:o};if(l[n]){const a=l[n].handlers;let f;for(f=a.length;f>0&&!(s>=a[f-1].priority);f--);f===a.length?a[f]=p:a.splice(f,0,p),l.__current.forEach(d=>{d.name===n&&d.currentIndex>=f&&d.currentIndex++})}else l[n]={handlers:[p],runs:0};n!=="hookAdded"&&e.doAction("hookAdded",n,o,i,s)}}var D=ee;function te(e,t,r=!1){return function(o,i){const s=e[t];if(!C(o)||!r&&!w(i))return;if(!s[o])return 0;let l=0;if(r)l=s[o].handlers.length,s[o]={runs:s[o].runs,handlers:[]};else{const p=s[o].handlers;for(let a=p.length-1;a>=0;a--)p[a].namespace===i&&(p.splice(a,1),l++,s.__current.forEach(f=>{f.name===o&&f.currentIndex>=a&&f.currentIndex--}))}return o!=="hookRemoved"&&e.doAction("hookRemoved",o,i),l}}var E=te;function re(e,t){return function(n,o){const i=e[t];return typeof o<"u"?n in i&&i[n].handlers.some(s=>s.namespace===o):n in i}}var G=re;function ne(e,t,r,n){return function(i,...s){const l=e[t];l[i]||(l[i]={handlers:[],runs:0}),l[i].runs++;const p=l[i].handlers;if(!p||!p.length)return r?s[0]:void 0;const a={name:i,currentIndex:0};async function f(){try{l.__current.add(a);let h=r?s[0]:void 0;for(;a.currentIndex<p.length;)h=await p[a.currentIndex].callback.apply(null,s),r&&(s[0]=h),a.currentIndex++;return r?h:void 0}finally{l.__current.delete(a)}}function d(){try{l.__current.add(a);let h=r?s[0]:void 0;for(;a.currentIndex<p.length;)h=p[a.currentIndex].callback.apply(null,s),r&&(s[0]=h),a.currentIndex++;return r?h:void 0}finally{l.__current.delete(a)}}return(n?f:d)()}}var A=ne;function oe(e,t){return function(){const n=e[t];return Array.from(n.__current).at(-1)?.name??null}}var N=oe;function ie(e,t){return function(n){const o=e[t];return typeof n>"u"?o.__current.size>0:Array.from(o.__current).some(i=>i.name===n)}}var M=ie;function se(e,t){return function(n){const o=e[t];if(C(n))return o[n]&&o[n].runs?o[n].runs:0}}var O=se,ae=class{actions;filters;addAction;addFilter;removeAction;removeFilter;hasAction;hasFilter;removeAllActions;removeAllFilters;doAction;doActionAsync;applyFilters;applyFiltersAsync;currentAction;currentFilter;doingAction;doingFilter;didAction;didFilter;constructor(){this.actions=Object.create(null),this.actions.__current=new Set,this.filters=Object.create(null),this.filters.__current=new Set,this.addAction=D(this,"actions"),this.addFilter=D(this,"filters"),this.removeAction=E(this,"actions"),this.removeFilter=E(this,"filters"),this.hasAction=G(this,"actions"),this.hasFilter=G(this,"filters"),this.removeAllActions=E(this,"actions",!0),this.removeAllFilters=E(this,"filters",!0),this.doAction=A(this,"actions",!1,!1),this.doActionAsync=A(this,"actions",!1,!0),this.applyFilters=A(this,"filters",!0,!1),this.applyFiltersAsync=A(this,"filters",!0,!0),this.currentAction=N(this,"actions"),this.currentFilter=N(this,"filters"),this.doingAction=M(this,"actions"),this.doingFilter=M(this,"filters"),this.didAction=O(this,"actions"),this.didFilter=O(this,"filters")}};function ce(){return new ae}var le=ce,P=le(),{addAction:Fe,addFilter:He,removeAction:Te,removeFilter:xe,hasAction:Ce,hasFilter:ke,removeAllActions:Le,removeAllFilters:ze,doAction:Ie,doActionAsync:we,applyFilters:De,applyFiltersAsync:Ge,currentAction:Ne,currentFilter:Me,doingAction:Oe,doingFilter:Pe,didAction:je,didFilter:$e,actions:Be,filters:Ue}=P,y=X(void 0,void 0,P);y.getLocaleData.bind(y),y.setLocaleData.bind(y),y.resetLocaleData.bind(y),y.subscribe.bind(y);var v=y.__.bind(y);y._x.bind(y),y._n.bind(y),y._nx.bind(y),y.isRTL.bind(y),y.hasTranslation.bind(y);const j=[{key:"excellent",label:v("Excellent","voxel-fse"),score:2},{key:"very_good",label:v("Very good","voxel-fse"),score:1},{key:"good",label:v("Good","voxel-fse"),score:0},{key:"fair",label:v("Fair","voxel-fse"),score:-1},{key:"poor",label:v("Poor","voxel-fse"),score:-2}];function ue(e){const t={};return e.columns&&(t.gridTemplateColumns=`repeat(${e.columns}, 1fr)`),e.itemGap!==void 0&&(t.gap=`${e.itemGap}px`),t}function de({attributes:e,statsData:t,isLoading:r,error:n,context:o,postId:i}){const s=ue(e),l={statMode:e.statMode,columns:e.columns,itemGap:e.itemGap,iconSize:e.iconSize,iconSpacing:e.iconSpacing,labelTypography:e.labelTypography,labelColor:e.labelColor,scoreTypography:e.scoreTypography,scoreColor:e.scoreColor,chartBgColor:e.chartBgColor,chartHeight:e.chartHeight,chartRadius:e.chartRadius};if(r)return React.createElement("div",{className:"ts-review-bars",style:s},React.createElement("div",{className:"ts-no-posts"},React.createElement("span",{className:"ts-loader"})));if(n)return React.createElement("div",{className:"ts-review-bars vxfse-error",style:s},React.createElement("div",{className:"vxfse-error-state"},React.createElement("span",null,v("Error loading review stats","voxel-fse"))));if(!t)return e.statMode==="by_category"?React.createElement(React.Fragment,null,React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(l)}}),React.createElement("div",{className:"ts-review-bars",style:s})):React.createElement(React.Fragment,null,React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(l)}}),React.createElement("div",{className:"ts-review-bars",style:s},j.map(a=>React.createElement("div",{key:a.key,className:`ts-percentage-bar ${a.key}`},React.createElement("div",{className:"ts-bar-data"},React.createElement("p",null,a.label,React.createElement("span",null,"0%"))),React.createElement("div",{className:"ts-bar-chart"},React.createElement("div",{style:{width:"0%"}}))))));if(e.statMode==="by_category")return React.createElement(React.Fragment,null,React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(l)}}),React.createElement("div",{className:"ts-review-bars",style:s},t.byCategory.map(a=>{const f=Math.round((a.score+3)*10)/10,d=f/5*100;return React.createElement("div",{key:a.key,className:"ts-percentage-bar",style:a.color?{"--ts-accent-1":a.color}:void 0},React.createElement("div",{className:"ts-bar-data"},a.icon&&React.createElement("span",{className:"ts-category-icon",dangerouslySetInnerHTML:{__html:a.icon}}),React.createElement("p",null,a.label,React.createElement("span",null,f.toFixed(1)," / 5"))),React.createElement("div",{className:"ts-bar-chart"},React.createElement("div",{style:{width:`${d}%`}})))})));const p=[...t.ratingLevels||j].reverse();return React.createElement(React.Fragment,null,React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(l)}}),React.createElement("div",{className:"ts-review-bars",style:s},p.map(a=>{const f=t.overall[a.key]||0;return React.createElement("div",{key:a.key,className:`ts-percentage-bar ${a.key}`,style:a.color?{"--ts-accent-1":a.color}:void 0},React.createElement("div",{className:"ts-bar-data"},React.createElement("p",null,a.label,React.createElement("span",null,Math.round(f),"%"))),React.createElement("div",{className:"ts-bar-chart"},React.createElement("div",{style:{width:`${f}%`}})))})))}function pe(){if(typeof window<"u"&&window.wpApiSettings?.root)return window.wpApiSettings.root;if(typeof document<"u"){const e=document.querySelector('link[rel="https://api.w.org/"]');if(e){const t=e.getAttribute("href");if(t)return t}}if(typeof window<"u"&&window.location?.origin){const e=window.location.pathname.split("/").filter(Boolean),t=["wp-admin","wp-content","wp-includes","wp-json"];return e.length>0&&!t.includes(e[0])?window.location.origin+"/"+e[0]+"/wp-json/":window.location.origin+"/wp-json/"}return"/wp-json/"}function fe(e){const t=(d,h)=>typeof d=="string"?d:typeof d=="number"?String(d):h,r=(d,h)=>{if(typeof d=="number")return d;if(typeof d=="string"){const m=parseFloat(d);if(!isNaN(m))return m}return h},n=(d,h)=>{if(typeof d=="object"&&d!==null){const m=d;return{desktop:m.desktop!==void 0?r(m.desktop,h):h,tablet:m.tablet!==void 0?r(m.tablet,h):void 0,mobile:m.mobile!==void 0?r(m.mobile,h):void 0}}return typeof d=="number"?{desktop:d}:{desktop:h}},o=(d,h)=>{if(typeof d=="object"&&d!==null){const m=d;return{desktop:m.desktop!==void 0?t(m.desktop,h):h,tablet:m.tablet!==void 0?t(m.tablet,h):void 0,mobile:m.mobile!==void 0?t(m.mobile,h):void 0}}return typeof d=="string"?{desktop:d}:{desktop:h}},i=d=>{if(!d)return;const h=parseFloat(d);return isNaN(h)?void 0:h},s=n(e.columns??e.ts_rs_column_no,1),l=o(e.itemGap??e.item_gap??e.ts_rs_col_gap,""),p=o(e.iconSize??e.icon_size??e.ts_review_icon_size,""),a=o(e.chartHeight??e.chart_height??e.ts_chart_height,""),f=o(e.chartRadius??e.chart_radius??e.ts_chart_rad,"");return{statMode:t(e.statMode??e.stat_mode,"overall"),columns:s.desktop,columns_tablet:s.tablet,columns_mobile:s.mobile,itemGap:typeof e.itemGap=="number"?e.itemGap:i(l.desktop)??0,itemGap_tablet:typeof e.itemGap_tablet=="number"?e.itemGap_tablet:i(l.tablet),itemGap_mobile:typeof e.itemGap_mobile=="number"?e.itemGap_mobile:i(l.mobile),iconSize:typeof e.iconSize=="number"?e.iconSize:i(p.desktop)??0,iconSize_tablet:typeof e.iconSize_tablet=="number"?e.iconSize_tablet:i(p.tablet),iconSize_mobile:typeof e.iconSize_mobile=="number"?e.iconSize_mobile:i(p.mobile),iconSpacing:e.iconSpacing!==void 0?r(e.iconSpacing,void 0):e.icon_spacing!==void 0?r(e.icon_spacing,void 0):e.ts_review_icon_spacing!==void 0?r(e.ts_review_icon_spacing,void 0):void 0,labelTypography:e.labelTypography??e.label_typography??e.ts_review_typo??{},labelColor:t(e.labelColor??e.label_color??e.ts_review_typo_color,""),scoreTypography:e.scoreTypography??e.score_typography??e.ts_review_score??{},scoreColor:t(e.scoreColor??e.score_color??e.ts_review_score_color,""),chartBgColor:t(e.chartBgColor??e.chart_bg_color??e.ts_review_chart_bg,""),chartHeight:typeof e.chartHeight=="number"?e.chartHeight:i(a.desktop)??0,chartHeight_tablet:typeof e.chartHeight_tablet=="number"?e.chartHeight_tablet:i(a.tablet),chartHeight_mobile:typeof e.chartHeight_mobile=="number"?e.chartHeight_mobile:i(a.mobile),chartRadius:typeof e.chartRadius=="number"?e.chartRadius:i(f.desktop)??0,chartRadius_tablet:typeof e.chartRadius_tablet=="number"?e.chartRadius_tablet:i(f.tablet),chartRadius_mobile:typeof e.chartRadius_mobile=="number"?e.chartRadius_mobile:i(f.mobile)}}function he(){return pe()}function me(){const e=window.voxelCurrentPost;if(e?.id)return e.id;const t=document.body.className.split(" ");for(const o of t)if(o.startsWith("postid-")||o.startsWith("page-id-")){const i=parseInt(o.replace("postid-","").replace("page-id-",""),10);if(!isNaN(i))return i}const r=window.wp;if(r?.data?.select){const o=r.data.select("core/editor")?.getCurrentPostId?.();if(o)return o}const n=document.querySelector('article[id^="post-"]');if(n){const o=parseInt(n.id.replace("post-",""),10);if(!isNaN(o))return o}return null}function _e(e){const t=e.querySelector("script.vxconfig");if(t?.textContent)try{const r=JSON.parse(t.textContent);return fe(r)}catch(r){console.error("Failed to parse vxconfig:",r)}return null}function ye(e,t){return{blockId:t,statMode:e.statMode||"overall",columns:e.columns||1,columns_tablet:e.columns_tablet,columns_mobile:e.columns_mobile,itemGap:e.itemGap||0,itemGap_tablet:e.itemGap_tablet,itemGap_mobile:e.itemGap_mobile,iconSize:e.iconSize||0,iconSize_tablet:e.iconSize_tablet,iconSize_mobile:e.iconSize_mobile,iconSpacing:e.iconSpacing,labelTypography:e.labelTypography||{},labelColor:e.labelColor||"",scoreTypography:e.scoreTypography||{},scoreColor:e.scoreColor||"",chartBgColor:e.chartBgColor||"",chartHeight:e.chartHeight||0,chartHeight_tablet:e.chartHeight_tablet,chartHeight_mobile:e.chartHeight_mobile,chartRadius:e.chartRadius||0,chartRadius_tablet:e.chartRadius_tablet,chartRadius_mobile:e.chartRadius_mobile,hideDesktop:!1,hideTablet:!1,hideMobile:!1,customClasses:""}}async function be(e){const r=`${he()}voxel-fse/v1/review-stats?post_id=${e}`,n=await fetch(r);if(!n.ok){const o=await n.json().catch(()=>({}));throw new Error(o.message||`HTTP error ${n.status}`)}return n.json()}function ge({attributes:e,postId:t}){const[r,n]=S.useState(null),[o,i]=S.useState(!0),[s,l]=S.useState(null);return S.useEffect(()=>{let p=!1;async function a(){i(!0),l(null);try{const f=await be(t);p||n(f)}catch(f){p||l(f instanceof Error?f.message:"Failed to load review stats")}finally{p||i(!1)}}return a(),()=>{p=!0}},[t]),React.createElement(de,{attributes:e,statsData:r,isLoading:o,error:s,context:"frontend",postId:t})}function F(){document.querySelectorAll(".vxfse-review-stats").forEach(t=>{if(t.dataset.hydrated==="true")return;const r=_e(t);if(!r)return;const n=me();if(!n)return;const o=t.dataset.blockId||"",i=ye(r,o);t.dataset.hydrated="true",t.innerHTML="",B.createRoot(t).render(React.createElement(ge,{attributes:i,postId:n}))})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",F):F(),window.addEventListener("turbo:load",F),window.addEventListener("pjax:complete",F)})(ReactDOM,React);
