(function(x,f){"use strict";function m({text:e,icon:t="î —",className:r="",style:n={}}){return typeof window<"u"&&!window.wp?.blockEditor?null:f.createElement("div",{className:`voxel-empty-placeholder ${r}`,style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:e?"8px":"0",background:"rgb(213 216 220 / 80%)",borderRadius:"0",color:"#666",fontSize:"13px",height:"100%",minHeight:"45px",width:"100%",boxSizing:"border-box",...n}},f.createElement("span",{className:"placeholder-icon",style:{fontFamily:"eicons",fontSize:"24px",opacity:.3,lineHeight:1,fontStyle:"normal"}},t),e&&f.createElement("span",{className:"placeholder-text",style:{opacity:.6}},e))}function v(e){const t={};if(e.priceColor&&(t["--vx-price-color"]=e.priceColor),e.strikethroughTextColor&&(t["--vx-strike-text-color"]=e.strikethroughTextColor),e.strikethroughLineColor&&(t["--vx-strike-line-color"]=e.strikethroughLineColor),e.strikethroughWidth){const r=e.strikethroughWidthUnit||"px";t["--vx-strike-width"]=`${e.strikethroughWidth}${r}`}return e.outOfStockColor&&(t["--vx-nostock-color"]=e.outOfStockColor),e.strikethroughTypography&&(e.strikethroughTypography.fontSize&&(t["--vx-strike-font-size"]=e.strikethroughTypography.fontSize),e.strikethroughTypography.fontWeight&&(t["--vx-strike-font-weight"]=e.strikethroughTypography.fontWeight),e.strikethroughTypography.fontFamily&&(t["--vx-strike-font-family"]=e.strikethroughTypography.fontFamily),e.strikethroughTypography.lineHeight&&(t["--vx-strike-line-height"]=e.strikethroughTypography.lineHeight),e.strikethroughTypography.letterSpacing&&(t["--vx-strike-letter-spacing"]=e.strikethroughTypography.letterSpacing),e.strikethroughTypography.textTransform&&(t["--vx-strike-text-transform"]=e.strikethroughTypography.textTransform)),e.typography&&(e.typography.fontSize&&(t["--vx-price-font-size"]=e.typography.fontSize),e.typography.fontWeight&&(t["--vx-price-font-weight"]=e.typography.fontWeight),e.typography.fontFamily&&(t["--vx-price-font-family"]=e.typography.fontFamily),e.typography.lineHeight&&(t["--vx-price-line-height"]=e.typography.lineHeight),e.typography.letterSpacing&&(t["--vx-price-letter-spacing"]=e.typography.letterSpacing),e.typography.textTransform&&(t["--vx-price-text-transform"]=e.typography.textTransform)),t}function S(e,t){return{priceColor:e.priceColor,strikethroughTextColor:e.strikethroughTextColor,strikethroughLineColor:e.strikethroughLineColor,strikethroughWidth:e.strikethroughWidth,strikethroughWidthUnit:e.strikethroughWidthUnit,outOfStockColor:e.outOfStockColor,typography:e.typography,strikethroughTypography:e.strikethroughTypography,postId:t}}function C({attributes:e,priceData:t,isLoading:r,error:n,context:s,postId:o,ssrPriceHtml:c}){const p=f.useMemo(()=>v(e),[e]),a=f.useMemo(()=>S(e,o),[e,o]),h=[`vxfse-product-price-${e.blockId||"product-price"}`,e.hideDesktop?"vxfse-hide-desktop":"",e.hideTablet?"vxfse-hide-tablet":"",e.hideMobile?"vxfse-hide-mobile":"",e.customClasses||""].filter(Boolean).join(" ");if(s==="frontend")return React.createElement(T,{priceData:t,isLoading:r,error:n,vxconfig:a,ssrPriceHtml:c});if(r)return null;if(n)return React.createElement("div",{className:`vxfse-product-price ${h}`.trim(),style:p},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(a)}}),React.createElement(m,null));if(!t)return React.createElement("div",{className:`vxfse-product-price ${h}`.trim(),style:p},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(a)}}),React.createElement(m,null));if(!t.isAvailable){const y=t.errorMessage==="No product configured";return React.createElement("div",{className:`vxfse-product-price ${h}`.trim(),style:p},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(a)}}),y?React.createElement(m,null):React.createElement("span",{className:"vx-price no-stock"},t.errorMessage||"Unavailable"))}return t.hasDiscount?React.createElement("div",{className:`vxfse-product-price ${h}`.trim(),style:p},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(a)}}),React.createElement("span",{className:"vx-price"},t.formattedDiscountPrice,t.suffix),React.createElement("span",{className:"vx-price"},React.createElement("s",null,t.formattedRegularPrice,t.suffix))):React.createElement("div",{className:`vxfse-product-price ${h}`.trim(),style:p},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(a)}}),React.createElement("span",{className:"vx-price"},t.formattedRegularPrice,t.suffix))}function T({priceData:e,isLoading:t,error:r,vxconfig:n,ssrPriceHtml:s}){const o=React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(n)}});return s?React.createElement(React.Fragment,null,o,React.createElement("span",{className:"vx-ssr-price",style:{display:"contents"},dangerouslySetInnerHTML:{__html:s}})):t||r||!e?o:e.isAvailable?e.hasDiscount?React.createElement(React.Fragment,null,o,React.createElement("span",{className:"vx-price"},e.formattedDiscountPrice,e.suffix),React.createElement("span",{className:"vx-price"},React.createElement("s",null,e.formattedRegularPrice,e.suffix))):React.createElement(React.Fragment,null,o,React.createElement("span",{className:"vx-price"},e.formattedRegularPrice,e.suffix)):e.errorMessage==="No product configured"?o:React.createElement(React.Fragment,null,o,React.createElement("span",{className:"vx-price no-stock"},e.errorMessage||"Unavailable"))}function _(){if(typeof window<"u"&&window.wpApiSettings?.root)return window.wpApiSettings.root;if(typeof document<"u"){const e=document.querySelector('link[rel="https://api.w.org/"]');if(e){const t=e.getAttribute("href");if(t)return t}}if(typeof window<"u"&&window.location?.origin){const e=window.location.pathname.split("/").filter(Boolean),t=["wp-admin","wp-content","wp-includes","wp-json"];return e.length>0&&!t.includes(e[0])?window.location.origin+"/"+e[0]+"/wp-json/":window.location.origin+"/wp-json/"}return"/wp-json/"}function E(e){const t=(l,i)=>typeof l=="string"?l:typeof l=="number"?String(l):i,r=(l,i)=>{if(typeof l=="number"&&!isNaN(l))return l;if(typeof l=="string"){const k=parseFloat(l);if(!isNaN(k))return k}return i},n=l=>{if(!l||typeof l!="object")return;const i=l;return{fontFamily:typeof i.fontFamily=="string"?i.fontFamily:void 0,fontSize:typeof i.fontSize=="string"?i.fontSize:void 0,fontSize_tablet:typeof i.fontSize_tablet=="string"?i.fontSize_tablet:void 0,fontSize_mobile:typeof i.fontSize_mobile=="string"?i.fontSize_mobile:void 0,fontWeight:typeof i.fontWeight=="string"?i.fontWeight:void 0,lineHeight:typeof i.lineHeight=="string"?i.lineHeight:void 0,letterSpacing:typeof i.letterSpacing=="string"?i.letterSpacing:void 0,textTransform:["none","uppercase","lowercase","capitalize"].includes(i.textTransform)?i.textTransform:void 0}},s=t(e.priceColor??e.price_color??e.ts_price_col,""),o=t(e.strikethroughTextColor??e.strikethrough_text_color??e.ts_strike_col_text,""),c=t(e.strikethroughLineColor??e.strikethrough_line_color??e.ts_strike_col,""),p=r(e.strikethroughWidth??e.strikethrough_width??e.ts_strike_width,0),a=t(e.strikethroughWidthUnit??e.strikethrough_width_unit,"px"),d=t(e.outOfStockColor??e.out_of_stock_color??e.ts_price_nostock,""),h=n(e.typography??e.price_typo),y=n(e.strikethroughTypography??e.price_typo_discount),g=r(e.postId??e.post_id,0)||void 0,z=t(e.postType??e.post_type,"")||void 0;return{priceColor:s||void 0,strikethroughTextColor:o||void 0,strikethroughLineColor:c||void 0,strikethroughWidth:p||void 0,strikethroughWidthUnit:a||void 0,outOfStockColor:d||void 0,typography:h,strikethroughTypography:y,postId:g,postType:z}}function N(){return _()}function w(e){if(e){const o=e.closest(".ts-preview[data-post-id]");if(o){const c=parseInt(o.dataset.postId||"",10);if(!isNaN(c)&&c>0)return c}}const t=window.voxelCurrentPost;if(t?.id)return t.id;const r=document.body.className.split(" ");for(const o of r)if(o.startsWith("postid-")){const c=parseInt(o.replace("postid-",""),10);if(!isNaN(c))return c}const n=window.wp;if(n?.data?.select){const o=n.data.select("core/editor")?.getCurrentPostId?.();if(o)return o}const s=document.querySelector('article[id^="post-"]');if(s){const o=parseInt(s.id.replace("post-",""),10);if(!isNaN(o))return o}return null}function R(e){const t=e.querySelector("script.vxconfig");if(t?.textContent)try{const r=JSON.parse(t.textContent);return E(r)}catch(r){console.error("Failed to parse vxconfig:",r)}return null}function P(e,t){return{blockId:t,priceColor:e.priceColor,strikethroughTextColor:e.strikethroughTextColor,strikethroughLineColor:e.strikethroughLineColor,strikethroughWidth:e.strikethroughWidth,strikethroughWidthUnit:e.strikethroughWidthUnit,outOfStockColor:e.outOfStockColor,typography:e.typography,strikethroughTypography:e.strikethroughTypography}}async function W(e){const r=`${N()}voxel-fse/v1/product-price?post_id=${e}`,n={},s=window.wpApiSettings?.nonce;s&&(n["X-WP-Nonce"]=s);const o=await fetch(r,{credentials:"same-origin",headers:n});if(!o.ok){const c=await o.json().catch(()=>({}));throw new Error(c.message||`HTTP error ${o.status}`)}return o.json()}function L({attributes:e,postId:t,hasSsr:r,ssrPriceHtml:n}){const[s,o]=f.useState(null),[c,p]=f.useState(!r),[a,d]=f.useState(null);return f.useEffect(()=>{if(r)return;let h=!1;async function y(){p(!0),d(null);try{const g=await W(t);h||o(g)}catch(g){h||d(g instanceof Error?g.message:"Failed to load price")}finally{h||p(!1)}}return y(),()=>{h=!0}},[t,r]),React.createElement(C,{attributes:e,priceData:s,isLoading:c,error:a,context:"frontend",postId:t,ssrPriceHtml:r&&!s&&!a?n:void 0})}function u(){document.querySelectorAll(".wp-block-voxel-fse-product-price").forEach(t=>{if(t.dataset.hydrated==="true")return;const r=R(t);if(!r){console.warn("Product price block missing vxconfig:",t);return}const n=r.postId||w(t);if(!n){console.warn("Could not determine post ID for product price block");return}const s=t.dataset.blockId||"",o=P(r,s),c=t.dataset.ssr==="true",p=c?Array.from(t.querySelectorAll(".vx-price")).map(d=>d.outerHTML).join(""):"";t.dataset.hydrated="true",t.innerHTML="",x.createRoot(t).render(React.createElement(L,{attributes:o,postId:n,hasSsr:c,ssrPriceHtml:p}))})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",u):u(),window.addEventListener("turbo:load",u),window.addEventListener("pjax:complete",u),document.addEventListener("voxel:markup-update",u)})(ReactDOM,React);
