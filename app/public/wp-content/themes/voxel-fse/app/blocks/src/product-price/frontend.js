(function(m,d){"use strict";function u({text:e,icon:t="î —",className:o="",style:s={}}){return typeof window<"u"&&!window.wp?.blockEditor?null:d.createElement("div",{className:`voxel-empty-placeholder ${o}`,style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:e?"8px":"0",background:"rgb(213 216 220 / 80%)",borderRadius:"0",color:"#666",fontSize:"13px",height:"45px",width:"100%",...s}},d.createElement("span",{className:"placeholder-icon",style:{fontFamily:"eicons",fontSize:"24px",opacity:.3,lineHeight:1,fontStyle:"normal"}},t),e&&d.createElement("span",{className:"placeholder-text",style:{opacity:.6}},e))}function x(e){const t={};if(e.priceColor&&(t["--vx-price-color"]=e.priceColor),e.strikethroughTextColor&&(t["--vx-strike-text-color"]=e.strikethroughTextColor),e.strikethroughLineColor&&(t["--vx-strike-line-color"]=e.strikethroughLineColor),e.strikethroughWidth){const o=e.strikethroughWidthUnit||"px";t["--vx-strike-width"]=`${e.strikethroughWidth}${o}`}return e.outOfStockColor&&(t["--vx-nostock-color"]=e.outOfStockColor),e.typography&&(e.typography.fontSize&&(t["--vx-price-font-size"]=e.typography.fontSize),e.typography.fontWeight&&(t["--vx-price-font-weight"]=e.typography.fontWeight),e.typography.fontFamily&&(t["--vx-price-font-family"]=e.typography.fontFamily),e.typography.lineHeight&&(t["--vx-price-line-height"]=e.typography.lineHeight),e.typography.letterSpacing&&(t["--vx-price-letter-spacing"]=e.typography.letterSpacing),e.typography.textTransform&&(t["--vx-price-text-transform"]=e.typography.textTransform)),t}function k(e,t){return{priceColor:e.priceColor,strikethroughTextColor:e.strikethroughTextColor,strikethroughLineColor:e.strikethroughLineColor,strikethroughWidth:e.strikethroughWidth,strikethroughWidthUnit:e.strikethroughWidthUnit,outOfStockColor:e.outOfStockColor,typography:e.typography,postId:t}}function v({attributes:e,priceData:t,isLoading:o,error:s,context:r,postId:i}){const c=d.useMemo(()=>x(e),[e]),p=d.useMemo(()=>k(e,i),[e,i]),a=[`vxfse-product-price-${e.blockId||"product-price"}`,e.hideDesktop?"vxfse-hide-desktop":"",e.hideTablet?"vxfse-hide-tablet":"",e.hideMobile?"vxfse-hide-mobile":"",e.customClasses||""].filter(Boolean).join(" ");return o?React.createElement("div",{className:`vxfse-product-price ${a}`.trim(),style:c},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(p)}}),r==="editor"&&React.createElement(u,null)):s?React.createElement("div",{className:`vxfse-product-price ${a}`.trim(),style:c},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(p)}}),r==="editor"&&React.createElement(u,null)):t?t.isAvailable?t.hasDiscount?React.createElement("div",{className:`vxfse-product-price ${a}`.trim(),style:c},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(p)}}),React.createElement("span",{className:"vx-price"},t.formattedDiscountPrice,t.suffix),React.createElement("span",{className:"vx-price"},React.createElement("s",null,t.formattedRegularPrice,t.suffix))):React.createElement("div",{className:`vxfse-product-price ${a}`.trim(),style:c},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(p)}}),React.createElement("span",{className:"vx-price"},t.formattedRegularPrice,t.suffix)):t.errorMessage==="No product configured"?r==="frontend"?React.createElement("div",{className:`vxfse-product-price ${a}`.trim(),style:c},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(p)}})):React.createElement("div",{className:`vxfse-product-price ${a}`.trim(),style:c},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(p)}}),React.createElement(u,null)):React.createElement("div",{className:`vxfse-product-price ${a}`.trim(),style:c},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(p)}}),React.createElement("span",{className:"vx-price no-stock"},t.errorMessage||"Unavailable")):React.createElement("div",{className:`vxfse-product-price ${a}`.trim(),style:c},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(p)}}),r==="editor"&&React.createElement(u,null))}function S(){if(typeof window<"u"&&window.wpApiSettings?.root)return window.wpApiSettings.root;if(typeof document<"u"){const e=document.querySelector('link[rel="https://api.w.org/"]');if(e){const t=e.getAttribute("href");if(t)return t}}if(typeof window<"u"&&window.location?.origin){const e=window.location.pathname.split("/").filter(Boolean),t=["wp-admin","wp-content","wp-includes","wp-json"];return e.length>0&&!t.includes(e[0])?window.location.origin+"/"+e[0]+"/wp-json/":window.location.origin+"/wp-json/"}return"/wp-json/"}function C(e){const t=(l,n)=>typeof l=="string"?l:typeof l=="number"?String(l):n,o=(l,n)=>{if(typeof l=="number"&&!isNaN(l))return l;if(typeof l=="string"){const y=parseFloat(l);if(!isNaN(y))return y}return n},s=l=>{if(!l||typeof l!="object")return;const n=l;return{fontFamily:typeof n.fontFamily=="string"?n.fontFamily:void 0,fontSize:typeof n.fontSize=="string"?n.fontSize:void 0,fontSize_tablet:typeof n.fontSize_tablet=="string"?n.fontSize_tablet:void 0,fontSize_mobile:typeof n.fontSize_mobile=="string"?n.fontSize_mobile:void 0,fontWeight:typeof n.fontWeight=="string"?n.fontWeight:void 0,lineHeight:typeof n.lineHeight=="string"?n.lineHeight:void 0,letterSpacing:typeof n.letterSpacing=="string"?n.letterSpacing:void 0,textTransform:["none","uppercase","lowercase","capitalize"].includes(n.textTransform)?n.textTransform:void 0}},r=t(e.priceColor??e.price_color??e.ts_price_col,""),i=t(e.strikethroughTextColor??e.strikethrough_text_color??e.ts_strike_col_text,""),c=t(e.strikethroughLineColor??e.strikethrough_line_color??e.ts_strike_col,""),p=o(e.strikethroughWidth??e.strikethrough_width??e.ts_strike_width,0),f=t(e.strikethroughWidthUnit??e.strikethrough_width_unit,"px"),a=t(e.outOfStockColor??e.out_of_stock_color??e.ts_price_nostock,""),h=s(e.typography??e.price_typo),L=o(e.postId??e.post_id,0)||void 0,P=t(e.postType??e.post_type,"")||void 0;return{priceColor:r||void 0,strikethroughTextColor:i||void 0,strikethroughLineColor:c||void 0,strikethroughWidth:p||void 0,strikethroughWidthUnit:f||void 0,outOfStockColor:a||void 0,typography:h,postId:L,postType:P}}function _(){return S()}function N(){const e=window.voxelCurrentPost;if(e?.id)return e.id;const t=document.body.className.split(" ");for(const r of t)if(r.startsWith("postid-")){const i=parseInt(r.replace("postid-",""),10);if(!isNaN(i))return i}const o=window.wp;if(o?.data?.select){const r=o.data.select("core/editor")?.getCurrentPostId?.();if(r)return r}const s=document.querySelector('article[id^="post-"]');if(s){const r=parseInt(s.id.replace("post-",""),10);if(!isNaN(r))return r}return null}function E(e){const t=e.querySelector("script.vxconfig");if(t?.textContent)try{const o=JSON.parse(t.textContent);return C(o)}catch(o){console.error("Failed to parse vxconfig:",o)}return null}function w(e,t){return{blockId:t,priceColor:e.priceColor,strikethroughTextColor:e.strikethroughTextColor,strikethroughLineColor:e.strikethroughLineColor,strikethroughWidth:e.strikethroughWidth,strikethroughWidthUnit:e.strikethroughWidthUnit,outOfStockColor:e.outOfStockColor,typography:e.typography}}async function T(e){const o=`${_()}voxel-fse/v1/product-price?post_id=${e}`,s={},r=window.wpApiSettings?.nonce;r&&(s["X-WP-Nonce"]=r);const i=await fetch(o,{credentials:"same-origin",headers:s});if(!i.ok){const c=await i.json().catch(()=>({}));throw new Error(c.message||`HTTP error ${i.status}`)}return i.json()}function R({attributes:e,postId:t}){const[o,s]=d.useState(null),[r,i]=d.useState(!0),[c,p]=d.useState(null);return d.useEffect(()=>{let f=!1;async function a(){i(!0),p(null);try{const h=await T(t);f||s(h)}catch(h){f||p(h instanceof Error?h.message:"Failed to load price")}finally{f||i(!1)}}return a(),()=>{f=!0}},[t]),React.createElement(v,{attributes:e,priceData:o,isLoading:r,error:c,context:"frontend",postId:t})}function g(){document.querySelectorAll(".vxfse-product-price").forEach(t=>{if(t.dataset.hydrated==="true")return;const o=E(t);if(!o){console.warn("Product price block missing vxconfig:",t);return}const s=o.postId||N();if(!s){console.warn("Could not determine post ID for product price block");return}const r=t.dataset.blockId||"",i=w(o,r);t.dataset.hydrated="true",t.innerHTML="",m.createRoot(t).render(React.createElement(R,{attributes:i,postId:s}))})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",g):g(),window.addEventListener("turbo:load",g),window.addEventListener("pjax:complete",g)})(ReactDOM,React);
