(function(m,a){"use strict";function u({text:e,icon:t="î —",className:r="",style:n={}}){return typeof window<"u"&&!window.wp?.blockEditor?null:a.createElement("div",{className:`voxel-empty-placeholder ${r}`,style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:e?"8px":"0",background:"rgb(213 216 220 / 80%)",borderRadius:"0",color:"#666",fontSize:"13px",height:"100%",minHeight:"45px",width:"100%",boxSizing:"border-box",...n}},a.createElement("span",{className:"placeholder-icon",style:{fontFamily:"eicons",fontSize:"24px",opacity:.3,lineHeight:1,fontStyle:"normal"}},t),e&&a.createElement("span",{className:"placeholder-text",style:{opacity:.6}},e))}function k(e){const t={};if(e.priceColor&&(t["--vx-price-color"]=e.priceColor),e.strikethroughTextColor&&(t["--vx-strike-text-color"]=e.strikethroughTextColor),e.strikethroughLineColor&&(t["--vx-strike-line-color"]=e.strikethroughLineColor),e.strikethroughWidth){const r=e.strikethroughWidthUnit||"px";t["--vx-strike-width"]=`${e.strikethroughWidth}${r}`}return e.outOfStockColor&&(t["--vx-nostock-color"]=e.outOfStockColor),e.strikethroughTypography&&(e.strikethroughTypography.fontSize&&(t["--vx-strike-font-size"]=e.strikethroughTypography.fontSize),e.strikethroughTypography.fontWeight&&(t["--vx-strike-font-weight"]=e.strikethroughTypography.fontWeight),e.strikethroughTypography.fontFamily&&(t["--vx-strike-font-family"]=e.strikethroughTypography.fontFamily),e.strikethroughTypography.lineHeight&&(t["--vx-strike-line-height"]=e.strikethroughTypography.lineHeight),e.strikethroughTypography.letterSpacing&&(t["--vx-strike-letter-spacing"]=e.strikethroughTypography.letterSpacing),e.strikethroughTypography.textTransform&&(t["--vx-strike-text-transform"]=e.strikethroughTypography.textTransform)),e.typography&&(e.typography.fontSize&&(t["--vx-price-font-size"]=e.typography.fontSize),e.typography.fontWeight&&(t["--vx-price-font-weight"]=e.typography.fontWeight),e.typography.fontFamily&&(t["--vx-price-font-family"]=e.typography.fontFamily),e.typography.lineHeight&&(t["--vx-price-line-height"]=e.typography.lineHeight),e.typography.letterSpacing&&(t["--vx-price-letter-spacing"]=e.typography.letterSpacing),e.typography.textTransform&&(t["--vx-price-text-transform"]=e.typography.textTransform)),t}function x(e,t){return{priceColor:e.priceColor,strikethroughTextColor:e.strikethroughTextColor,strikethroughLineColor:e.strikethroughLineColor,strikethroughWidth:e.strikethroughWidth,strikethroughWidthUnit:e.strikethroughWidthUnit,outOfStockColor:e.outOfStockColor,typography:e.typography,strikethroughTypography:e.strikethroughTypography,postId:t}}function v({attributes:e,priceData:t,isLoading:r,error:n,context:c,postId:o}){const i=a.useMemo(()=>k(e),[e]),p=a.useMemo(()=>x(e,o),[e,o]),h=[`vxfse-product-price-${e.blockId||"product-price"}`,e.hideDesktop?"vxfse-hide-desktop":"",e.hideTablet?"vxfse-hide-tablet":"",e.hideMobile?"vxfse-hide-mobile":"",e.customClasses||""].filter(Boolean).join(" ");if(c==="frontend")return React.createElement(S,{priceData:t,isLoading:r,error:n,vxconfig:p});if(r)return React.createElement("div",{className:`vxfse-product-price ${h}`.trim(),style:i},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(p)}}),React.createElement(u,null));if(n)return React.createElement("div",{className:`vxfse-product-price ${h}`.trim(),style:i},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(p)}}),React.createElement(u,null));if(!t)return React.createElement("div",{className:`vxfse-product-price ${h}`.trim(),style:i},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(p)}}),React.createElement(u,null));if(!t.isAvailable){const f=t.errorMessage==="No product configured";return React.createElement("div",{className:`vxfse-product-price ${h}`.trim(),style:i},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(p)}}),f?React.createElement(u,null):React.createElement("span",{className:"vx-price no-stock"},t.errorMessage||"Unavailable"))}return t.hasDiscount?React.createElement("div",{className:`vxfse-product-price ${h}`.trim(),style:i},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(p)}}),React.createElement("span",{className:"vx-price"},t.formattedDiscountPrice,t.suffix),React.createElement("span",{className:"vx-price"},React.createElement("s",null,t.formattedRegularPrice,t.suffix))):React.createElement("div",{className:`vxfse-product-price ${h}`.trim(),style:i},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(p)}}),React.createElement("span",{className:"vx-price"},t.formattedRegularPrice,t.suffix))}function S({priceData:e,isLoading:t,error:r,vxconfig:n}){const c=React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(n)}});return t||r||!e?c:e.isAvailable?e.hasDiscount?React.createElement(React.Fragment,null,c,React.createElement("span",{className:"vx-price"},e.formattedDiscountPrice,e.suffix),React.createElement("span",{className:"vx-price"},React.createElement("s",null,e.formattedRegularPrice,e.suffix))):React.createElement(React.Fragment,null,c,React.createElement("span",{className:"vx-price"},e.formattedRegularPrice,e.suffix)):e.errorMessage==="No product configured"?c:React.createElement(React.Fragment,null,c,React.createElement("span",{className:"vx-price no-stock"},e.errorMessage||"Unavailable"))}function C(){if(typeof window<"u"&&window.wpApiSettings?.root)return window.wpApiSettings.root;if(typeof document<"u"){const e=document.querySelector('link[rel="https://api.w.org/"]');if(e){const t=e.getAttribute("href");if(t)return t}}if(typeof window<"u"&&window.location?.origin){const e=window.location.pathname.split("/").filter(Boolean),t=["wp-admin","wp-content","wp-includes","wp-json"];return e.length>0&&!t.includes(e[0])?window.location.origin+"/"+e[0]+"/wp-json/":window.location.origin+"/wp-json/"}return"/wp-json/"}function T(e){const t=(l,s)=>typeof l=="string"?l:typeof l=="number"?String(l):s,r=(l,s)=>{if(typeof l=="number"&&!isNaN(l))return l;if(typeof l=="string"){const y=parseFloat(l);if(!isNaN(y))return y}return s},n=l=>{if(!l||typeof l!="object")return;const s=l;return{fontFamily:typeof s.fontFamily=="string"?s.fontFamily:void 0,fontSize:typeof s.fontSize=="string"?s.fontSize:void 0,fontSize_tablet:typeof s.fontSize_tablet=="string"?s.fontSize_tablet:void 0,fontSize_mobile:typeof s.fontSize_mobile=="string"?s.fontSize_mobile:void 0,fontWeight:typeof s.fontWeight=="string"?s.fontWeight:void 0,lineHeight:typeof s.lineHeight=="string"?s.lineHeight:void 0,letterSpacing:typeof s.letterSpacing=="string"?s.letterSpacing:void 0,textTransform:["none","uppercase","lowercase","capitalize"].includes(s.textTransform)?s.textTransform:void 0}},c=t(e.priceColor??e.price_color??e.ts_price_col,""),o=t(e.strikethroughTextColor??e.strikethrough_text_color??e.ts_strike_col_text,""),i=t(e.strikethroughLineColor??e.strikethrough_line_color??e.ts_strike_col,""),p=r(e.strikethroughWidth??e.strikethrough_width??e.ts_strike_width,0),d=t(e.strikethroughWidthUnit??e.strikethrough_width_unit,"px"),h=t(e.outOfStockColor??e.out_of_stock_color??e.ts_price_nostock,""),f=n(e.typography??e.price_typo),W=n(e.strikethroughTypography??e.price_typo_discount),L=r(e.postId??e.post_id,0)||void 0,z=t(e.postType??e.post_type,"")||void 0;return{priceColor:c||void 0,strikethroughTextColor:o||void 0,strikethroughLineColor:i||void 0,strikethroughWidth:p||void 0,strikethroughWidthUnit:d||void 0,outOfStockColor:h||void 0,typography:f,strikethroughTypography:W,postId:L,postType:z}}function N(){return C()}function _(e){if(e){const o=e.closest(".ts-preview[data-post-id]");if(o){const i=parseInt(o.dataset.postId||"",10);if(!isNaN(i)&&i>0)return i}}const t=window.voxelCurrentPost;if(t?.id)return t.id;const r=document.body.className.split(" ");for(const o of r)if(o.startsWith("postid-")){const i=parseInt(o.replace("postid-",""),10);if(!isNaN(i))return i}const n=window.wp;if(n?.data?.select){const o=n.data.select("core/editor")?.getCurrentPostId?.();if(o)return o}const c=document.querySelector('article[id^="post-"]');if(c){const o=parseInt(c.id.replace("post-",""),10);if(!isNaN(o))return o}return null}function E(e){const t=e.querySelector("script.vxconfig");if(t?.textContent)try{const r=JSON.parse(t.textContent);return T(r)}catch(r){console.error("Failed to parse vxconfig:",r)}return null}function w(e,t){return{blockId:t,priceColor:e.priceColor,strikethroughTextColor:e.strikethroughTextColor,strikethroughLineColor:e.strikethroughLineColor,strikethroughWidth:e.strikethroughWidth,strikethroughWidthUnit:e.strikethroughWidthUnit,outOfStockColor:e.outOfStockColor,typography:e.typography,strikethroughTypography:e.strikethroughTypography}}async function R(e){const r=`${N()}voxel-fse/v1/product-price?post_id=${e}`,n={},c=window.wpApiSettings?.nonce;c&&(n["X-WP-Nonce"]=c);const o=await fetch(r,{credentials:"same-origin",headers:n});if(!o.ok){const i=await o.json().catch(()=>({}));throw new Error(i.message||`HTTP error ${o.status}`)}return o.json()}function P({attributes:e,postId:t}){const[r,n]=a.useState(null),[c,o]=a.useState(!0),[i,p]=a.useState(null);return a.useEffect(()=>{let d=!1;async function h(){o(!0),p(null);try{const f=await R(t);d||n(f)}catch(f){d||p(f instanceof Error?f.message:"Failed to load price")}finally{d||o(!1)}}return h(),()=>{d=!0}},[t]),React.createElement(v,{attributes:e,priceData:r,isLoading:c,error:i,context:"frontend",postId:t})}function g(){document.querySelectorAll(".wp-block-voxel-fse-product-price").forEach(t=>{if(t.dataset.hydrated==="true")return;const r=E(t);if(!r){console.warn("Product price block missing vxconfig:",t);return}const n=r.postId||_(t);if(!n){console.warn("Could not determine post ID for product price block");return}const c=t.dataset.blockId||"",o=w(r,c);t.dataset.hydrated="true",t.innerHTML="",m.createRoot(t).render(React.createElement(P,{attributes:o,postId:n}))})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",g):g(),window.addEventListener("turbo:load",g),window.addEventListener("pjax:complete",g),document.addEventListener("voxel:markup-update",g)})(ReactDOM,React);
