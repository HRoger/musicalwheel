(function(m,a){"use strict";function g({text:e,icon:t="î —",className:o="",style:n={}}){return typeof window<"u"&&!window.wp?.blockEditor?null:a.createElement("div",{className:`voxel-empty-placeholder ${o}`,style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:e?"8px":"0",background:"rgb(213 216 220 / 80%)",borderRadius:"0",color:"#666",fontSize:"13px",height:"100%",minHeight:"45px",width:"100%",boxSizing:"border-box",...n}},a.createElement("span",{className:"placeholder-icon",style:{fontFamily:"eicons",fontSize:"24px",opacity:.3,lineHeight:1,fontStyle:"normal"}},t),e&&a.createElement("span",{className:"placeholder-text",style:{opacity:.6}},e))}function k(e){const t={};if(e.priceColor&&(t["--vx-price-color"]=e.priceColor),e.strikethroughTextColor&&(t["--vx-strike-text-color"]=e.strikethroughTextColor),e.strikethroughLineColor&&(t["--vx-strike-line-color"]=e.strikethroughLineColor),e.strikethroughWidth){const o=e.strikethroughWidthUnit||"px";t["--vx-strike-width"]=`${e.strikethroughWidth}${o}`}return e.outOfStockColor&&(t["--vx-nostock-color"]=e.outOfStockColor),e.strikethroughTypography&&(e.strikethroughTypography.fontSize&&(t["--vx-strike-font-size"]=e.strikethroughTypography.fontSize),e.strikethroughTypography.fontWeight&&(t["--vx-strike-font-weight"]=e.strikethroughTypography.fontWeight),e.strikethroughTypography.fontFamily&&(t["--vx-strike-font-family"]=e.strikethroughTypography.fontFamily),e.strikethroughTypography.lineHeight&&(t["--vx-strike-line-height"]=e.strikethroughTypography.lineHeight),e.strikethroughTypography.letterSpacing&&(t["--vx-strike-letter-spacing"]=e.strikethroughTypography.letterSpacing),e.strikethroughTypography.textTransform&&(t["--vx-strike-text-transform"]=e.strikethroughTypography.textTransform)),e.typography&&(e.typography.fontSize&&(t["--vx-price-font-size"]=e.typography.fontSize),e.typography.fontWeight&&(t["--vx-price-font-weight"]=e.typography.fontWeight),e.typography.fontFamily&&(t["--vx-price-font-family"]=e.typography.fontFamily),e.typography.lineHeight&&(t["--vx-price-line-height"]=e.typography.lineHeight),e.typography.letterSpacing&&(t["--vx-price-letter-spacing"]=e.typography.letterSpacing),e.typography.textTransform&&(t["--vx-price-text-transform"]=e.typography.textTransform)),t}function x(e,t){return{priceColor:e.priceColor,strikethroughTextColor:e.strikethroughTextColor,strikethroughLineColor:e.strikethroughLineColor,strikethroughWidth:e.strikethroughWidth,strikethroughWidthUnit:e.strikethroughWidthUnit,outOfStockColor:e.outOfStockColor,typography:e.typography,strikethroughTypography:e.strikethroughTypography,postId:t}}function v({attributes:e,priceData:t,isLoading:o,error:n,context:r,postId:s}){const c=a.useMemo(()=>k(e),[e]),p=a.useMemo(()=>x(e,s),[e,s]),h=[`vxfse-product-price-${e.blockId||"product-price"}`,e.hideDesktop?"vxfse-hide-desktop":"",e.hideTablet?"vxfse-hide-tablet":"",e.hideMobile?"vxfse-hide-mobile":"",e.customClasses||""].filter(Boolean).join(" ");return o?React.createElement("div",{className:`vxfse-product-price ${h}`.trim(),style:c},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(p)}}),r==="editor"&&React.createElement(g,null)):n?React.createElement("div",{className:`vxfse-product-price ${h}`.trim(),style:c},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(p)}}),r==="editor"&&React.createElement(g,null)):t?t.isAvailable?t.hasDiscount?React.createElement("div",{className:`vxfse-product-price ${h}`.trim(),style:c},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(p)}}),React.createElement("span",{className:"vx-price"},t.formattedDiscountPrice,t.suffix),React.createElement("span",{className:"vx-price"},React.createElement("s",null,t.formattedRegularPrice,t.suffix))):React.createElement("div",{className:`vxfse-product-price ${h}`.trim(),style:c},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(p)}}),React.createElement("span",{className:"vx-price"},t.formattedRegularPrice,t.suffix)):t.errorMessage==="No product configured"?r==="frontend"?React.createElement("div",{className:`vxfse-product-price ${h}`.trim(),style:c},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(p)}})):React.createElement("div",{className:`vxfse-product-price ${h}`.trim(),style:c},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(p)}}),React.createElement(g,null)):React.createElement("div",{className:`vxfse-product-price ${h}`.trim(),style:c},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(p)}}),React.createElement("span",{className:"vx-price no-stock"},t.errorMessage||"Unavailable")):React.createElement("div",{className:`vxfse-product-price ${h}`.trim(),style:c},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(p)}}),r==="editor"&&React.createElement(g,null))}function S(){if(typeof window<"u"&&window.wpApiSettings?.root)return window.wpApiSettings.root;if(typeof document<"u"){const e=document.querySelector('link[rel="https://api.w.org/"]');if(e){const t=e.getAttribute("href");if(t)return t}}if(typeof window<"u"&&window.location?.origin){const e=window.location.pathname.split("/").filter(Boolean),t=["wp-admin","wp-content","wp-includes","wp-json"];return e.length>0&&!t.includes(e[0])?window.location.origin+"/"+e[0]+"/wp-json/":window.location.origin+"/wp-json/"}return"/wp-json/"}function C(e){const t=(l,i)=>typeof l=="string"?l:typeof l=="number"?String(l):i,o=(l,i)=>{if(typeof l=="number"&&!isNaN(l))return l;if(typeof l=="string"){const y=parseFloat(l);if(!isNaN(y))return y}return i},n=l=>{if(!l||typeof l!="object")return;const i=l;return{fontFamily:typeof i.fontFamily=="string"?i.fontFamily:void 0,fontSize:typeof i.fontSize=="string"?i.fontSize:void 0,fontSize_tablet:typeof i.fontSize_tablet=="string"?i.fontSize_tablet:void 0,fontSize_mobile:typeof i.fontSize_mobile=="string"?i.fontSize_mobile:void 0,fontWeight:typeof i.fontWeight=="string"?i.fontWeight:void 0,lineHeight:typeof i.lineHeight=="string"?i.lineHeight:void 0,letterSpacing:typeof i.letterSpacing=="string"?i.letterSpacing:void 0,textTransform:["none","uppercase","lowercase","capitalize"].includes(i.textTransform)?i.textTransform:void 0}},r=t(e.priceColor??e.price_color??e.ts_price_col,""),s=t(e.strikethroughTextColor??e.strikethrough_text_color??e.ts_strike_col_text,""),c=t(e.strikethroughLineColor??e.strikethrough_line_color??e.ts_strike_col,""),p=o(e.strikethroughWidth??e.strikethrough_width??e.ts_strike_width,0),f=t(e.strikethroughWidthUnit??e.strikethrough_width_unit,"px"),h=t(e.outOfStockColor??e.out_of_stock_color??e.ts_price_nostock,""),d=n(e.typography??e.price_typo),W=n(e.strikethroughTypography??e.price_typo_discount),L=o(e.postId??e.post_id,0)||void 0,P=t(e.postType??e.post_type,"")||void 0;return{priceColor:r||void 0,strikethroughTextColor:s||void 0,strikethroughLineColor:c||void 0,strikethroughWidth:p||void 0,strikethroughWidthUnit:f||void 0,outOfStockColor:h||void 0,typography:d,strikethroughTypography:W,postId:L,postType:P}}function T(){return S()}function _(){const e=window.voxelCurrentPost;if(e?.id)return e.id;const t=document.body.className.split(" ");for(const r of t)if(r.startsWith("postid-")){const s=parseInt(r.replace("postid-",""),10);if(!isNaN(s))return s}const o=window.wp;if(o?.data?.select){const r=o.data.select("core/editor")?.getCurrentPostId?.();if(r)return r}const n=document.querySelector('article[id^="post-"]');if(n){const r=parseInt(n.id.replace("post-",""),10);if(!isNaN(r))return r}return null}function N(e){const t=e.querySelector("script.vxconfig");if(t?.textContent)try{const o=JSON.parse(t.textContent);return C(o)}catch(o){console.error("Failed to parse vxconfig:",o)}return null}function E(e,t){return{blockId:t,priceColor:e.priceColor,strikethroughTextColor:e.strikethroughTextColor,strikethroughLineColor:e.strikethroughLineColor,strikethroughWidth:e.strikethroughWidth,strikethroughWidthUnit:e.strikethroughWidthUnit,outOfStockColor:e.outOfStockColor,typography:e.typography,strikethroughTypography:e.strikethroughTypography}}async function w(e){const o=`${T()}voxel-fse/v1/product-price?post_id=${e}`,n={},r=window.wpApiSettings?.nonce;r&&(n["X-WP-Nonce"]=r);const s=await fetch(o,{credentials:"same-origin",headers:n});if(!s.ok){const c=await s.json().catch(()=>({}));throw new Error(c.message||`HTTP error ${s.status}`)}return s.json()}function R({attributes:e,postId:t}){const[o,n]=a.useState(null),[r,s]=a.useState(!0),[c,p]=a.useState(null);return a.useEffect(()=>{let f=!1;async function h(){s(!0),p(null);try{const d=await w(t);f||n(d)}catch(d){f||p(d instanceof Error?d.message:"Failed to load price")}finally{f||s(!1)}}return h(),()=>{f=!0}},[t]),React.createElement(v,{attributes:e,priceData:o,isLoading:r,error:c,context:"frontend",postId:t})}function u(){document.querySelectorAll(".vxfse-product-price").forEach(t=>{if(t.dataset.hydrated==="true")return;const o=N(t);if(!o){console.warn("Product price block missing vxconfig:",t);return}const n=o.postId||_();if(!n){console.warn("Could not determine post ID for product price block");return}const r=t.dataset.blockId||"",s=E(o,r);t.dataset.hydrated="true",t.innerHTML="",m.createRoot(t).render(React.createElement(R,{attributes:s,postId:n}))})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",u):u(),window.addEventListener("turbo:load",u),window.addEventListener("pjax:complete",u)})(ReactDOM,React);
