var VoxelFSEMap=(function(b){"use strict";let j=!1;function A(){if(j)return!0;if(!window.Voxel?.mixins?.base)return!1;const t=window.Voxel.mixins.base;return t.mounted&&!t._originalMounted?(t._originalMounted=t.mounted,t.mounted=function(){try{const o=this.$root?.$options?.el||this.$el;if(o){const n=o.closest?.(".elementor-element");if(n)this.widget_id=n.dataset?.id||"";else{const i=o.closest?.("[data-block-id]");this.widget_id=i&&i.dataset?.blockId||""}const e=o.closest?.(".elementor");if(e)this.post_id=e.dataset?.elementorId||"";else{const i=document.body.className.match(/postid-(\d+)/);this.post_id=i?i[1]:""}}t._originalMounted&&t._originalMounted!==t.mounted&&t._originalMounted.call(this)}catch(o){console.warn("[VoxelShim] Error in patched mounted():",o),this.widget_id="",this.post_id=""}},j=!0,console.log("[VoxelShim] Successfully patched Voxel.mixins.base.mounted"),!0):!1}function T(){if(A())return;let t=0;const o=50,e=setInterval(()=>{if(t++,A()){clearInterval(e);return}t>=o&&(clearInterval(e),console.warn("[VoxelShim] Voxel.mixins.base not found after 5 seconds"))},100);typeof document<"u"&&document.addEventListener("voxel:ready",()=>{A(),clearInterval(e)},{once:!0})}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",T,{once:!0}):T());function ee(){if(typeof window>"u")return"desktop";const t=window.innerWidth;return t<768?"mobile":t<1024?"tablet":"desktop"}function h(t,o){if(!t)return o;const n=ee();return n==="mobile"?t.mobile!==void 0?t.mobile:t.tablet!==void 0?t.tablet:t.desktop!==void 0?t.desktop:o:n==="tablet"&&t.tablet!==void 0?t.tablet:t.desktop!==void 0?t.desktop:o}function P(t){if(!t?.enable)return"none";const{horizontal:o=0,vertical:n=0,blur:e=0,spread:i=0,color:r="rgba(0,0,0,0.1)",position:s}=t;return`${s==="inset"?"inset ":""}${o}px ${n}px ${e}px ${i}px ${r}`}function H(t){if(!t)return{};const o={};return t.fontFamily&&(o["font-family"]=t.fontFamily),t.fontSize&&(o["font-size"]=`${t.fontSize}${t.fontSizeUnit||"px"}`),t.fontWeight&&(o["font-weight"]=t.fontWeight),t.fontStyle&&(o["font-style"]=t.fontStyle),t.textTransform&&(o["text-transform"]=t.textTransform),t.textDecoration&&(o["text-decoration"]=t.textDecoration),t.lineHeight&&(o["line-height"]=`${t.lineHeight}${t.lineHeightUnit||""}`),t.letterSpacing&&(o["letter-spacing"]=`${t.letterSpacing}${t.letterSpacingUnit||"px"}`),o}function q(t,o){t.style.width="100%";const n=o.styles;if(!n)return;const e=h(n.height,400),i=n.heightUnit||"px",r=h(n.enableCalcHeight,!1),s=h(n.calcHeight,"");r&&s?t.style.setProperty("--vx-map-height",s):t.style.setProperty("--vx-map-height",`${e}${i}`);const c=h(n.borderRadius,0);if(t.style.setProperty("--vx-map-radius",`${c}px`),n.cluster){const l=h(n.cluster.size,40);t.style.setProperty("--vx-cluster-size",`${l}px`);const a=h(n.cluster.bgColor,"");a&&t.style.setProperty("--vx-cluster-bg",a);const m=h(n.cluster.radius,50);t.style.setProperty("--vx-cluster-radius",`${m}%`);const v=h(n.cluster.textColor,"");if(v&&t.style.setProperty("--vx-cluster-text-color",v),t.style.setProperty("--vx-cluster-shadow",P(n.cluster.shadow)),n.cluster.typography){const g=H(n.cluster.typography);g["font-family"]&&t.style.setProperty("--vx-cluster-font-family",g["font-family"]),g["font-size"]&&t.style.setProperty("--vx-cluster-font-size",g["font-size"]),g["font-weight"]&&t.style.setProperty("--vx-cluster-font-weight",g["font-weight"]),g["font-style"]&&t.style.setProperty("--vx-cluster-font-style",g["font-style"]),g["line-height"]&&t.style.setProperty("--vx-cluster-line-height",g["line-height"]),g["letter-spacing"]&&t.style.setProperty("--vx-cluster-letter-spacing",g["letter-spacing"]),g["text-transform"]&&t.style.setProperty("--vx-cluster-text-transform",g["text-transform"]),g["text-decoration"]&&t.style.setProperty("--vx-cluster-text-decoration",g["text-decoration"])}}if(n.iconMarker){const l=h(n.iconMarker.size,42);t.style.setProperty("--vx-icon-marker-size",`${l}px`);const a=h(n.iconMarker.iconSize,24);t.style.setProperty("--vx-icon-marker-icon-size",`${a}px`);const m=h(n.iconMarker.radius,50);t.style.setProperty("--vx-icon-marker-radius",`${m}%`),t.style.setProperty("--vx-icon-marker-shadow",P(n.iconMarker.shadow));const v=h(n.iconMarker.staticBg,"");v&&t.style.setProperty("--vx-icon-marker-bg",v);const g=h(n.iconMarker.staticBgActive,"");g&&t.style.setProperty("--vx-icon-marker-bg-active",g);const u=h(n.iconMarker.staticIconColor,"");u&&t.style.setProperty("--vx-icon-marker-icon-color",u);const d=h(n.iconMarker.staticIconColorActive,"");d&&t.style.setProperty("--vx-icon-marker-icon-color-active",d)}if(n.textMarker){const l=h(n.textMarker.bgColor,"");l&&t.style.setProperty("--vx-text-marker-bg",l);const a=h(n.textMarker.bgColorActive,"");a&&t.style.setProperty("--vx-text-marker-bg-active",a);const m=h(n.textMarker.textColor,"");m&&t.style.setProperty("--vx-text-marker-text-color",m);const v=h(n.textMarker.textColorActive,"");v&&t.style.setProperty("--vx-text-marker-text-color-active",v);const g=h(n.textMarker.radius,4);if(t.style.setProperty("--vx-text-marker-radius",`${g}px`),t.style.setProperty("--vx-text-marker-shadow",P(n.textMarker.shadow)),n.textMarker.typography){const d=H(n.textMarker.typography);d["font-family"]&&t.style.setProperty("--vx-text-marker-font-family",d["font-family"]),d["font-size"]&&t.style.setProperty("--vx-text-marker-font-size",d["font-size"]),d["font-weight"]&&t.style.setProperty("--vx-text-marker-font-weight",d["font-weight"]),d["font-style"]&&t.style.setProperty("--vx-text-marker-font-style",d["font-style"]),d["line-height"]&&t.style.setProperty("--vx-text-marker-line-height",d["line-height"]),d["letter-spacing"]&&t.style.setProperty("--vx-text-marker-letter-spacing",d["letter-spacing"]),d["text-transform"]&&t.style.setProperty("--vx-text-marker-text-transform",d["text-transform"]),d["text-decoration"]&&t.style.setProperty("--vx-text-marker-text-decoration",d["text-decoration"])}const u=h(n.textMarker.padding,{});if(u){const d=u;d.top&&t.style.setProperty("--vx-text-marker-padding-top",d.top),d.right&&t.style.setProperty("--vx-text-marker-padding-right",d.right),d.bottom&&t.style.setProperty("--vx-text-marker-padding-bottom",d.bottom),d.left&&t.style.setProperty("--vx-text-marker-padding-left",d.left)}}if(n.imageMarker){const l=h(n.imageMarker.size,42);t.style.setProperty("--vx-image-marker-size",`${l}px`);const a=h(n.imageMarker.radius,50);t.style.setProperty("--vx-image-marker-radius",`${a}%`),t.style.setProperty("--vx-image-marker-shadow",P(n.imageMarker.shadow))}if(n.popup){const l=h(n.popup.cardWidth,320);t.style.setProperty("--vx-popup-card-width",`${l}px`),n.popup.loaderColor1&&t.style.setProperty("--vx-popup-loader-color1",n.popup.loaderColor1),n.popup.loaderColor2&&t.style.setProperty("--vx-popup-loader-color2",n.popup.loaderColor2)}if(n.searchBtn){const l=h(n.searchBtn.textColor,"");l&&t.style.setProperty("--vx-search-btn-text-color",l);const a=h(n.searchBtn.bgColor,"");a&&t.style.setProperty("--vx-search-btn-bg",a);const m=h(n.searchBtn.iconColor,"");m&&t.style.setProperty("--vx-search-btn-icon-color",m);const v=h(n.searchBtn.iconColorActive,"");v&&t.style.setProperty("--vx-search-btn-icon-color-active",v);const g=h(n.searchBtn.radius,4);if(t.style.setProperty("--vx-search-btn-radius",`${g}px`),n.searchBtn.typography){const u=H(n.searchBtn.typography);u["font-family"]&&t.style.setProperty("--vx-search-btn-font-family",u["font-family"]),u["font-size"]&&t.style.setProperty("--vx-search-btn-font-size",u["font-size"]),u["font-weight"]&&t.style.setProperty("--vx-search-btn-font-weight",u["font-weight"]),u["font-style"]&&t.style.setProperty("--vx-search-btn-font-style",u["font-style"]),u["line-height"]&&t.style.setProperty("--vx-search-btn-line-height",u["line-height"]),u["letter-spacing"]&&t.style.setProperty("--vx-search-btn-letter-spacing",u["letter-spacing"]),u["text-transform"]&&t.style.setProperty("--vx-search-btn-text-transform",u["text-transform"]),u["text-decoration"]&&t.style.setProperty("--vx-search-btn-text-decoration",u["text-decoration"])}if(n.searchBtn.checkmarkIcon){const u=n.searchBtn.checkmarkIcon;t.dataset.checkmarkIcon=JSON.stringify(u)}}if(n.navBtn){n.navBtn.iconColor&&t.style.setProperty("--vx-nav-btn-icon-color",n.navBtn.iconColor),n.navBtn.iconColorHover&&t.style.setProperty("--vx-nav-btn-icon-color-hover",n.navBtn.iconColorHover);const l=h(n.navBtn.iconSize,20);t.style.setProperty("--vx-nav-btn-icon-size",`${l}px`),n.navBtn.bgColor&&t.style.setProperty("--vx-nav-btn-bg",n.navBtn.bgColor),n.navBtn.bgColorHover&&t.style.setProperty("--vx-nav-btn-bg-hover",n.navBtn.bgColorHover);const a=h(n.navBtn.radius,4);t.style.setProperty("--vx-nav-btn-radius",`${a}px`);const m=h(n.navBtn.size,36);if(t.style.setProperty("--vx-nav-btn-size",`${m}px`),t.style.setProperty("--vx-nav-btn-shadow",P(n.navBtn.shadow)),n.navBtn.borderType&&n.navBtn.borderType!=="none"){t.style.setProperty("--vx-nav-btn-border-style",n.navBtn.borderType);const v=h(n.navBtn.borderWidth,0);t.style.setProperty("--vx-nav-btn-border-width",`${v}px`),n.navBtn.borderColor&&t.style.setProperty("--vx-nav-btn-border-color",n.navBtn.borderColor),n.navBtn.borderColorHover&&t.style.setProperty("--vx-nav-btn-border-color-hover",n.navBtn.borderColorHover)}}}function W(t){const o=t.center||{},n={lat:Number(t.lat||o.lat||o.latitude||51.492),lng:Number(t.lng||o.lng||o.longitude||-.13)},e=t.styles||{},i=(s,c)=>s?{desktop:s.desktop!==void 0?s.desktop:c,tablet:s.tablet!==void 0?s.tablet:s.desktop!==void 0?s.desktop:c,mobile:s.mobile!==void 0?s.mobile:s.tablet!==void 0?s.tablet:s.desktop!==void 0?s.desktop:c}:{desktop:c,tablet:c,mobile:c},r=s=>s?{enable:!!s.enable,horizontal:Number(s.horizontal||s.h||0),vertical:Number(s.vertical||s.v||0),blur:Number(s.blur||0),spread:Number(s.spread||0),color:String(s.color||"rgba(0,0,0,0.1)"),position:s.position||(s.inset?"inset":"outline")}:{enable:!1};return{blockId:String(t.blockId||t.block_id||""),source:t.source||"search-form",center:n,zoom:Number(t.zoom||t.initialZoom||11),minZoom:Number(t.minZoom||t.min_zoom||2),maxZoom:Number(t.maxZoom||t.max_zoom||18),dragSearch:t.dragSearch!==void 0?!!t.dragSearch:t.drag_search!==void 0?!!t.drag_search:!0,dragSearchMode:t.dragSearchMode||t.drag_search_mode||"manual",dragSearchDefault:t.dragSearchDefault||t.drag_search_default||"unchecked",searchFormId:String(t.searchFormId||t.search_form_id||""),styles:{height:i(e.height||e.mapHeight,400),heightUnit:String(e.heightUnit||e.height_unit||"px"),enableCalcHeight:i(e.enableCalcHeight||e.enable_calc_height,!1),calcHeight:i(e.calcHeight||e.calc_height,""),borderRadius:i(e.borderRadius||e.border_radius,0),cluster:e.cluster?{size:i(e.cluster.size,40),bgColor:i(e.cluster.bgColor||e.cluster.bg_color,""),radius:i(e.cluster.radius,50),textColor:i(e.cluster.textColor||e.cluster.text_color,""),shadow:r(e.cluster.shadow),typography:e.cluster.typography||{}}:{size:{desktop:40},bgColor:{desktop:""},radius:{desktop:50},textColor:{desktop:""},shadow:{enable:!1},typography:{}},iconMarker:e.iconMarker||e.icon_marker?{size:i((e.iconMarker||e.icon_marker).size,42),iconSize:i((e.iconMarker||e.icon_marker).iconSize||(e.iconMarker||e.icon_marker).icon_size,24),radius:i((e.iconMarker||e.icon_marker).radius,50),shadow:r((e.iconMarker||e.icon_marker).shadow),staticBg:i((e.iconMarker||e.icon_marker).staticBg||(e.iconMarker||e.icon_marker).static_bg,""),staticBgActive:i((e.iconMarker||e.icon_marker).staticBgActive||(e.iconMarker||e.icon_marker).static_bg_active,""),staticIconColor:i((e.iconMarker||e.icon_marker).staticIconColor||(e.iconMarker||e.icon_marker).static_icon_color,""),staticIconColorActive:i((e.iconMarker||e.icon_marker).staticIconColorActive||(e.iconMarker||e.icon_marker).static_icon_color_active,"")}:{size:{desktop:42},iconSize:{desktop:24},radius:{desktop:50},shadow:{enable:!1},staticBg:{desktop:""},staticBgActive:{desktop:""},staticIconColor:{desktop:""},staticIconColorActive:{desktop:""}},textMarker:e.textMarker||e.text_marker?{bgColor:i((e.textMarker||e.text_marker).bgColor||(e.textMarker||e.text_marker).bg_color,""),bgColorActive:i((e.textMarker||e.text_marker).bgColorActive||(e.textMarker||e.text_marker).bg_color_active,""),textColor:i((e.textMarker||e.text_marker).textColor||(e.textMarker||e.text_marker).text_color,""),textColorActive:i((e.textMarker||e.text_marker).textColorActive||(e.textMarker||e.text_marker).text_color_active,""),radius:i((e.textMarker||e.text_marker).radius,4),shadow:r((e.textMarker||e.text_marker).shadow),typography:(e.textMarker||e.text_marker).typography||{},padding:i((e.textMarker||e.text_marker).padding,{})}:{bgColor:{desktop:""},bgColorActive:{desktop:""},textColor:{desktop:""},textColorActive:{desktop:""},radius:{desktop:4},shadow:{enable:!1},typography:{},padding:{desktop:{}}},imageMarker:e.imageMarker||e.image_marker?{size:i((e.imageMarker||e.image_marker).size,42),radius:i((e.imageMarker||e.image_marker).radius,50),shadow:r((e.imageMarker||e.image_marker).shadow)}:{size:{desktop:42},radius:{desktop:50},shadow:{enable:!1}},popup:e.popup?{cardWidth:i(e.popup.cardWidth||e.popup.card_width,320),loaderColor1:String(e.popup.loaderColor1||e.popup.loader_color_1||""),loaderColor2:String(e.popup.loaderColor2||e.popup.loader_color_2||"")}:{cardWidth:{desktop:320},loaderColor1:"",loaderColor2:""},searchBtn:e.searchBtn||e.search_btn?{textColor:i((e.searchBtn||e.search_btn).textColor||(e.searchBtn||e.search_btn).text_color,""),bgColor:i((e.searchBtn||e.search_btn).bgColor||(e.searchBtn||e.search_btn).bg_color,""),iconColor:i((e.searchBtn||e.search_btn).iconColor||(e.searchBtn||e.search_btn).icon_color,""),iconColorActive:i((e.searchBtn||e.search_btn).iconColorActive||(e.searchBtn||e.search_btn).icon_color_active,""),radius:i((e.searchBtn||e.search_btn).radius||(e.searchBtn||e.search_btn).radius,4),typography:(e.searchBtn||e.search_btn).typography||{},checkmarkIcon:(e.searchBtn||e.search_btn).checkmarkIcon||{},searchIcon:(e.searchBtn||e.search_btn).searchIcon||{}}:{textColor:{desktop:""},bgColor:{desktop:""},iconColor:{desktop:""},iconColorActive:{desktop:""},radius:{desktop:4},typography:{},checkmarkIcon:{},searchIcon:{}},navBtn:e.navBtn||e.nav_btn?{iconColor:String((e.navBtn||e.nav_btn).iconColor||(e.navBtn||e.nav_btn).icon_color||""),iconColorHover:String((e.navBtn||e.nav_btn).iconColorHover||(e.navBtn||e.nav_btn).icon_color_hover||""),iconSize:i((e.navBtn||e.nav_btn).iconSize||(e.navBtn||e.nav_btn).icon_size,20),bgColor:String((e.navBtn||e.nav_btn).bgColor||(e.navBtn||e.nav_btn).bg_color||""),bgColorHover:String((e.navBtn||e.nav_btn).bgColorHover||(e.navBtn||e.nav_btn).bg_color_hover||""),radius:i((e.navBtn||e.nav_btn).radius,4),size:i((e.navBtn||e.nav_btn).size,36),shadow:r((e.navBtn||e.nav_btn).shadow),borderType:String((e.navBtn||e.nav_btn).borderType||(e.navBtn||e.nav_btn).border_type||"none"),borderWidth:i((e.navBtn||e.nav_btn).borderWidth||(e.navBtn||e.nav_btn).border_width,0),borderColor:String((e.navBtn||e.nav_btn).borderColor||(e.navBtn||e.nav_btn).border_color||""),borderColorHover:String((e.navBtn||e.nav_btn).borderColorHover||(e.navBtn||e.nav_btn).border_color_hover||"")}:{iconSize:{desktop:20},radius:{desktop:4},size:{desktop:36},shadow:{enable:!1},borderType:"none",borderWidth:{desktop:0}},geolocationIcon:e.geolocationIcon||e.geolocation_icon||{}}}}const _=()=>window;function te(){return!!_().Voxel?.Maps}function B(){return new Promise((t,o)=>{const n=_().Voxel?.Maps;if(n){n.await(()=>t(n));return}const e=()=>{const i=_().Voxel?.Maps;i&&i.await(()=>t(i))};document.addEventListener("maps:loaded",e,{once:!0}),setTimeout(()=>{document.removeEventListener("maps:loaded",e);const i=_().Voxel?.Maps;i?i.await(()=>t(i)):o(new Error("Voxel.Maps not available after timeout"))},15e3)})}function U(){return{lat:_().Voxel_Config?.maps?.default_lat??40.7128,lng:_().Voxel_Config?.maps?.default_lng??-74.006}}class f{constructor(o,n){this._native=null,this._lat=o,this._lng=n;const e=_().Voxel?.Maps;e&&(this._native=new e.LatLng(o,n))}getLatitude(){return this._native?.getLatitude()??this._lat}getLongitude(){return this._native?.getLongitude()??this._lng}getSourceObject(){return this._native?.getSourceObject()??null}toGeocoderFormat(){return this._native?.toGeocoderFormat()??null}getNative(){return this._native}static fromNative(o){const n=new f(o.getLatitude(),o.getLongitude());return n._native=o,n}}class y{constructor(o,n){this._native=null,this._sw=o??null,this._ne=n??null;const e=_().Voxel?.Maps;e&&(this._native=new e.Bounds(o?.getNative()??void 0,n?.getNative()??void 0))}extend(o){this._native&&o.getNative()&&this._native.extend(o.getNative())}empty(){return this._native?.empty()??!0}getSourceObject(){return this._native?.getSourceObject()??null}getSouthWest(){return this._native?f.fromNative(this._native.getSouthWest()):this._sw}getNorthEast(){return this._native?f.fromNative(this._native.getNorthEast()):this._ne}getNative(){return this._native}static fromNative(o){const n=f.fromNative(o.getSouthWest()),e=f.fromNative(o.getNorthEast()),i=new y(n,e);return i._native=o,i}}class oe{constructor(o){this._native=null,this._listeners=new Map,this._el=o.el,this._options=o}async init(){console.log("[VxMap] init() called");const o=await B();console.log("[VxMap] Got Voxel.Maps:",o),console.log("[VxMap] Maps.Map constructor:",o.Map);const n=window.getComputedStyle(this._el),e=this._el.getBoundingClientRect();console.log("[VxMap] Container dimensions BEFORE map creation:",{width:e.width,height:e.height,display:n.display,visibility:n.visibility,offsetParent:this._el.offsetParent?"exists":"null",styleHeight:this._el.style.height}),e.height===0&&(console.log("[VxMap] WARNING: Container has 0 height! Setting fallback height of 400px"),this._el.style.height="400px");const i=this._options.center?new o.LatLng(this._options.center.getLatitude(),this._options.center.getLongitude()):new o.LatLng(U().lat,U().lng);console.log("[VxMap] centerLatLng created:",i);const r={el:this._el,zoom:this._options.zoom??10,center:i,minZoom:this._options.minZoom??2,maxZoom:this._options.maxZoom??20,draggable:this._options.draggable??!0};console.log("[VxMap] About to call new Maps.Map() with:",r);try{this._native=new o.Map(r),console.log("[VxMap] Maps.Map created successfully:",this._native),console.log("[VxMap] Native map object:",this._native?.map),console.log("[VxMap] Container after init:",this._el.innerHTML.substring(0,200)),this._el.classList.add("ts-map-loaded"),this._el.__vx_map__=this._native;const s=this._native?.getSourceObject(),c=_().Voxel_Config;if(s&&typeof google<"u"){const l=!!c?.google_maps?.mapTypeControl,a=!!c?.google_maps?.streetViewControl;console.log("[VxMap] Voxel_Config control settings:",{configMapTypeControl:l,configStreetViewControl:a}),console.log("[VxMap] Full Voxel_Config.google_maps:",c?.google_maps),console.log("[VxMap] googleMap BEFORE setOptions - mapTypeControl:",s.mapTypeControl),console.log("[VxMap] googleMap BEFORE setOptions - streetViewControl:",s.streetViewControl),s.setOptions({mapTypeControl:!1,streetViewControl:!1}),console.log("[VxMap] setOptions called with mapTypeControl: false, streetViewControl: false"),setTimeout(()=>{console.log("[VxMap] googleMap AFTER setOptions (after 100ms) - mapTypeControl:",s.mapTypeControl),console.log("[VxMap] googleMap AFTER setOptions (after 100ms) - streetViewControl:",s.streetViewControl);const m=this._el,v=m.querySelectorAll(".gm-style-mtc, .gm-style-mtc-bbw");console.log("[VxMap] Found map type control elements in DOM:",v.length),v.length>0&&(console.log("[VxMap] Hiding map type control elements from DOM..."),v.forEach(u=>{u.style.display="none"}));const g=m.querySelectorAll(".gm-svpc");g.length>0&&(console.log("[VxMap] Hiding street view control elements from DOM..."),g.forEach(u=>{u.style.display="none"}))},100)}s&&typeof google<"u"&&google.maps?.event&&(console.log("[VxMap] Triggering resize event sequence..."),this._el.offsetHeight,google.maps.event.trigger(s,"resize"),requestAnimationFrame(()=>{google.maps.event.trigger(s,"resize");const l=s.getCenter();l&&s.setCenter(l),setTimeout(()=>{google.maps.event.trigger(s,"bounds_changed"),google.maps.event.trigger(s,"idle"),console.log("[VxMap] Resize sequence completed");const a=this._el.getBoundingClientRect();console.log("[VxMap] Container dimensions AFTER resize:",{width:a.width,height:a.height})},100)}))}catch(s){throw console.error("[VxMap] Error creating Maps.Map:",s),s}}setZoom(o){this._native?.setZoom(o)}getZoom(){return this._native?.getZoom()??this._options.zoom??10}getMinZoom(){return this._native?.getMinZoom()??this._options.minZoom??2}getMaxZoom(){return this._native?.getMaxZoom()??this._options.maxZoom??20}setCenter(o){this._native&&o.getNative()&&this._native.setCenter(o.getNative())}getCenter(){return this._native?f.fromNative(this._native.getCenter()):this._options.center??null}getBounds(){return this._native?y.fromNative(this._native.getBounds()):null}fitBounds(o){this._native&&o.getNative()&&this._native.fitBounds(o.getNative())}panTo(o){this._native&&o.getNative()&&this._native.panTo(o.getNative())}getClickPosition(o){return this._native?f.fromNative(this._native.getClickPosition(o)):null}addListener(o,n){if(this._native){const e=this._native.addListener(o,n);this._listeners.has(o)||this._listeners.set(o,[]),this._listeners.get(o).push(e)}}addListenerOnce(o,n){this._native&&this._native.addListenerOnce(o,n)}removeListeners(o){const n=this._listeners.get(o);n&&this._native&&(n.forEach(e=>this._native.removeListener(e)),this._listeners.delete(o))}trigger(o){this._native?.trigger(o)}getSourceObject(){return this._native?.getSourceObject()??null}getNative(){return this._native}getElement(){return this._el}}class ne{constructor(o){this._native=null,this._map=null,this._options=o}init(o){const n=_().Voxel?.Maps;if(!n||!o.getNative())return;this._map=o;const e=this._options.position?new n.LatLng(this._options.position.getLatitude(),this._options.position.getLongitude()):void 0;this._native=new n.Marker({map:o.getNative(),position:e,template:this._options.template,onClick:this._options.onClick?(i,r)=>this._options.onClick(i,this):void 0,data:this._options.data})}getPosition(){return this._native?f.fromNative(this._native.getPosition()):this._options.position??null}setPosition(o){this._native&&o.getNative()&&this._native.setPosition(o.getNative())}getMap(){return this._map}setMap(o){this._native&&o.getNative()&&(this._native.setMap(o.getNative()),this._map=o)}remove(){return this._native?.remove(),this._map=null,this}addClass(o){this._native?.addClass(o)}removeClass(o){this._native?.removeClass(o)}getData(){return this._options.data}getNative(){return this._native}}class ie{constructor(o){this._native=null,this._map=null,this._options=o}init(o){const n=_().Voxel?.Maps;if(!n||!o.getNative())return;this._map=o;const e=this._options.position?new n.LatLng(this._options.position.getLatitude(),this._options.position.getLongitude()):void 0;this._native=new n.Popup({map:o.getNative(),position:e,content:this._options.content})}setContent(o){this._native?.setContent(o)}setPosition(o){this._native&&o.getNative()&&this._native.setPosition(o.getNative())}show(){this._native?.show()}hide(){this._native?.hide()}getMap(){return this._map}getNative(){return this._native}}class se{constructor(o){this._native=null,this._map=null,this._options=o}init(o){const n=_().Voxel?.Maps;if(!n||!o.getNative())return;this._map=o;const e=this._options.center?new n.LatLng(this._options.center.getLatitude(),this._options.center.getLongitude()):void 0;this._native=new n.Circle({map:o.getNative(),center:e,radius:this._options.radius,visible:this._options.visible,className:this._options.className??"map-circle"})}hide(){this._native?.hide()}show(){this._native?.show()}setCenter(o){this._native&&o.getNative()&&this._native.setCenter(o.getNative())}setRadius(o){this._native?.setRadius(o)}getBounds(){return this._native?y.fromNative(this._native.getBounds()):null}getMap(){return this._map}getNative(){return this._native}}const M=class M{constructor(){this._native=null;const o=_().Voxel?.Maps;o&&(this._native=o.getGeocoder())}static getInstance(){return M._instance||(M._instance=new M),M._instance}geocode(o,n,e){if(!this._native){const s=typeof n=="function"?n:e;s&&s(!1);return}let i;if(o instanceof f){const s=o.getSourceObject();if(!s){const c=typeof n=="function"?n:e;c&&c(!1);return}i=s}else i=o;const r=s=>c=>{c===!1?s(!1):Array.isArray(c)?s(c.map(l=>({address:l.address,latlng:f.fromNative(l.latlng),viewport:y.fromNative(l.viewport)}))):s({address:c.address,latlng:f.fromNative(c.latlng),viewport:y.fromNative(c.viewport)})};if(typeof n=="function"){const s=n;this._native.geocode(i,r(s))}else e&&this._native.geocode(i,n,r(e))}getUserLocation(o){if(!this._native){o.positionFail?.();return}this._native.getUserLocation({fetchAddress:o.fetchAddress,receivedPosition:o.receivedPosition?n=>o.receivedPosition(f.fromNative(n)):void 0,receivedAddress:o.receivedAddress?n=>o.receivedAddress({address:n.address,latlng:f.fromNative(n.latlng),viewport:y.fromNative(n.viewport)}):void 0,positionFail:o.positionFail,addressFail:o.addressFail})}getNative(){return this._native}};M._instance=null;let F=M;class re{constructor(){this._native=null,this._map=null,this._markers=[]}async init(o){const n=await B();o.getNative()&&(this._map=o,this._native=new n.Clusterer({map:o.getNative()}),this._native&&(this._native._onClusterClick=()=>{this._onClusterClick?.()},this._native._onNonExpandableClusterClick=e=>{if(this._onNonExpandableClusterClick){const i=this._markers.filter(r=>e.some(s=>s===r.getNative()));this._onNonExpandableClusterClick(i)}}))}addMarkers(o){if(this._markers.push(...o),this._native){const n=o.map(e=>e.getNative()).filter(e=>e!==null);this._native.addMarkers(n)}}clearMarkers(){this._markers.forEach(o=>o.remove()),this._markers=[],this._native&&(this._native.markers=[])}render(){this._native?.render()}set onClusterClick(o){this._onClusterClick=o,this._native&&(this._native._onClusterClick=o)}set onNonExpandableClusterClick(o){this._onNonExpandableClusterClick=o}getMarkers(){return this._markers}getMap(){return this._map}getNative(){return this._native}}function ae(t){F.getInstance().getUserLocation(t)}function $(t,o){if(o.length===0)return;if(o.length===1){const e=o[0].getPosition();e&&(t.panTo(e),t.setZoom(15));return}const n=new y;o.forEach(e=>{const i=e.getPosition();i&&n.extend(i)}),n.empty()||t.fitBounds(n)}const C={};function le(){return window.Voxel_Config?.ajax_url?window.Voxel_Config.ajax_url:`${window.location.origin}/?vx=1`}function ce(){return`<div class="ts-map-nav">
		<a href="#" class="ts-map-prev ts-icon-btn"><svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.746 6.00002C10.746 5.69663 10.5632 5.42312 10.2829 5.30707C10.0026 5.19101 9.67996 5.25526 9.4655 5.46986L3.51254 11.4266C3.35184 11.5642 3.25 11.7685 3.25 11.9966V11.9982C3.24959 12.1906 3.32276 12.3831 3.46949 12.53L9.46548 18.5302C9.67994 18.7448 10.0026 18.809 10.2829 18.693C10.5632 18.5769 10.746 18.3034 10.746 18L10.746 12.7466L20.0014 12.7466C20.4156 12.7466 20.7514 12.4108 20.7514 11.9966C20.7514 11.5824 20.4156 11.2466 20.0014 11.2466L10.746 11.2466V6.00002Z" fill="#343C54"/></svg></a>
		<a href="#" class="ts-map-next ts-icon-btn"><svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.5359 5.46986C14.3214 5.25526 13.9988 5.19101 13.7185 5.30707C13.4382 5.42312 13.2554 5.69663 13.2554 6.00002V11.2466L4 11.2466C3.58579 11.2466 3.25 11.5824 3.25 11.9966C3.25 12.4108 3.58579 12.7466 4 12.7466L13.2554 12.7466V18C13.2554 18.3034 13.4382 18.5769 13.7185 18.693C13.9988 18.809 14.3214 18.7448 14.5359 18.5302L20.5319 12.53C20.6786 12.3831 20.7518 12.1905 20.7514 11.9981L20.7514 11.9966C20.7514 11.7685 20.6495 11.5642 20.4888 11.4266L14.5359 5.46986Z" fill="#343C54"/></svg></a>
	</div>`}async function Z(t,o,n,e,i){if(!o||o.length===0)return[];const r=[],s={};for(let c=0;c<o.length;c++){const l=o[c],a=i?.[c]||String(l.postId||""),m=l.uriencoded?decodeURIComponent(l.template):l.template,v={position:new f(l.lat,l.lng),template:m,onClick:(u,d)=>{if(!a){const p=d.getPosition();p&&(n.setPosition(p),n.setContent(m),n.show());return}r.forEach(p=>p.removeClass("marker-active")),d.addClass("marker-active"),t.addListener("click",function(){d.removeClass("marker-active"),n.hide()});const x=p=>{if(r.length>1){p.querySelector(".ts-map-nav")||p.insertAdjacentHTML("beforeend",ce());const Ee=p.querySelector(".ts-map-prev"),Ie=p.querySelector(".ts-map-next"),N=Object.keys(s),L=N.indexOf(a);Ee?.addEventListener("click",V=>{if(V.preventDefault(),V.stopPropagation(),L!==-1){const O=L>0?L-1:N.length-1,z=s[N[O]];if(z){const w=z.getNative();w?.onClick&&w.onClick(new Event("click"),w)}}}),Ie?.addEventListener("click",V=>{if(V.preventDefault(),V.stopPropagation(),L!==-1){const O=N.length>L+1?L+1:0,z=s[N[O]];if(z){const w=z.getNative();w?.onClick&&w.onClick(new Event("click"),w)}}})}const S=d.getPosition();S&&(n.setPosition(S),n.setContent(p),n.show())};if(C[a]){const p=document.createElement("div");p.className="ts-preview-popup",p.innerHTML=C[a],x(p);return}const X=document.querySelector(`.ts-preview[data-post-id="${a}"]`);if(X){const p=X.cloneNode(!0);p.classList.remove("ts-preview"),p.classList.add("ts-preview-popup"),p.removeAttribute("style"),C[a]=p.innerHTML,x(p);return}const D=document.createElement("div");D.className="ts-preview-popup ts-loading-popup",D.innerHTML='<span class="ts-loader"></span>';const Y=d.getPosition();Y&&(n.setPosition(Y),n.setContent(D),n.show());const ze=le();fetch(`${ze}&action=get_preview_card&post_id=${a}`).then(p=>p.text()).then(p=>{const S=document.createElement("div");S.className="ts-preview-popup",S.innerHTML=p,C[a]=p,x(S)}).catch(()=>{const p=document.createElement("div");p.className="ts-preview-popup",C[a]="",x(p)})},data:{lat:l.lat,lng:l.lng,postId:a}},g=new ne(v);g.init(t),r.push(g),a&&(s[a]=g)}return e&&r.length>0&&e.addMarkers(r),r}function de(){Object.keys(C).forEach(t=>delete C[t])}function ge(){if(typeof window<"u"&&window.wpApiSettings?.root)return window.wpApiSettings.root;if(typeof document<"u"){const t=document.querySelector('link[rel="https://api.w.org/"]');if(t){const o=t.getAttribute("href");if(o)return o}}if(typeof window<"u"&&window.location?.origin){const t=window.location.pathname.split("/").filter(Boolean),o=["wp-admin","wp-content","wp-includes","wp-json"];return t.length>0&&!o.includes(t[0])?window.location.origin+"/"+t[0]+"/wp-json/":window.location.origin+"/wp-json/"}return"/wp-json/"}T();function he(){const t="voxel-fse-map-geolocate-css";if(document.getElementById(t))return;const o=document.createElement("style");o.id=t,o.textContent=`
		/* FSE Map Block: Force geolocate button to be visible when map is loaded */
		.voxel-fse-map.elementor-widget-ts-map .vx-geolocate-me:not(.hidden),
		.voxel-fse-map .vx-geolocate-me:not(.hidden) {
			display: flex !important;
		}
		/* Loading state */
		.voxel-fse-map .vx-geolocate-me.loading {
			opacity: 0.5;
			pointer-events: none;
		}
		.voxel-fse-map .vx-geolocate-me.loading svg {
			animation: vx-spin 1s linear infinite;
		}
		@keyframes vx-spin {
			from { transform: rotate(0deg); }
			to { transform: rotate(360deg); }
		}
		/* FSE popup: re-enable pointer-events on block content
		   Voxel parent targets: .ts-preview-popup > .elementor { pointer-events: all }
		   FSE uses wp-block-* wrappers instead of .elementor */
		.ts-preview-popup > * {
			pointer-events: all;
		}
	`,document.head.appendChild(o)}function ue(){return ge()}function G(t){const o=t.querySelector("script.vxconfig");if(o&&o.textContent)try{return JSON.parse(o.textContent)}catch(n){console.error("[Map Block] Failed to parse vxconfig:",n)}return null}function pe(t,o){if(!t)return o;const n=typeof window<"u"?window.innerWidth:1200;let e="desktop";return n<768?e="mobile":n<1024&&(e="tablet"),e==="mobile"?t.mobile!==void 0?t.mobile:t.tablet!==void 0?t.tablet:t.desktop!==void 0?t.desktop:o:e==="tablet"&&t.tablet!==void 0?t.tablet:t.desktop!==void 0?t.desktop:o}const me='<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="ts-checkmark-icon"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>',ve='<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="ts-search-icon"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>',fe='<svg width="24" height="24" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12.4025 9.44141C10.884 9.44141 9.65283 10.6727 9.65283 12.1914C9.65283 13.7101 10.884 14.9414 12.4025 14.9414C13.921 14.9414 15.1522 13.7101 15.1522 12.1914C15.1522 10.6727 13.921 9.44141 12.4025 9.44141Z" fill="currentColor"/><path d="M13.1523 2.19141C13.1523 1.77719 12.8166 1.44141 12.4023 1.44141C11.9881 1.44141 11.6523 1.77719 11.6523 2.19141V3.72405C7.5566 4.0822 4.29367 7.34575 3.93549 11.4414H2.40234C1.98813 11.4414 1.65234 11.7772 1.65234 12.1914C1.65234 12.6056 1.98813 12.9414 2.40234 12.9414H3.93545C4.29344 17.0373 7.55645 20.301 11.6523 20.6592V22.1914C11.6523 22.6056 11.9881 22.9414 12.4023 22.9414C12.8166 22.9414 13.1523 22.6056 13.1523 22.1914V20.6592C17.2482 20.301 20.5113 17.0373 20.8692 12.9414H22.4023C22.8166 12.9414 23.1523 12.6056 23.1523 12.1914C23.1523 11.7772 22.8166 11.4414 22.4023 11.4414H20.8692C20.511 7.34575 17.2481 4.0822 13.1523 3.72405V2.19141ZM12.4025 7.94141C14.7496 7.94141 16.6522 9.84446 16.6522 12.1914C16.6522 14.5383 14.7496 16.4414 12.4025 16.4414C10.0554 16.4414 8.15283 14.5384 8.15283 12.1914C8.15283 9.84446 10.0554 7.94141 12.4025 7.94141ZM12.4025 9.44141C10.884 9.44141 9.65283 10.6727 9.65283 12.1914C9.65283 13.7101 10.884 14.9414 12.4025 14.9414C13.921 14.9414 15.1522 13.7101 15.1522 12.1914C15.1522 10.6727 13.921 9.44141 12.4025 9.44141Z" fill="currentColor"/></svg>';function R(t,o=""){return!t||!t.value?o:t.library==="icon"||!t.library||t.library===""||t.library==="fa-solid"||t.library==="fa-regular"||t.library==="fa-brands"||t.library==="line-awesome"?`<i class="${t.value}"></i>`:t.library==="svg"&&t.value?t.value.startsWith("<svg")||t.value.startsWith("<?xml")?`<span class="ts-icon-svg">${t.value}</span>`:`<img src="${t.value}" alt="" class="ts-icon-svg" />`:t.library==="dynamic"?`<i class="${t.value}"></i>`:o}function xe(t,o){if(!o.dragSearch||o.source!=="search-form")return null;const n=document.createElement("div");if(n.className="ts-map-drag",o.dragSearchMode==="automatic"){const e=o.dragSearchDefault==="checked",i=o.styles?.searchBtn?.checkmarkIcon,r=R(i,me);n.innerHTML=`
			<a href="#" class="ts-map-btn ts-drag-toggle ${e?"active":""}">
				${r}
				Search as I move the map
			</a>
		`}else{const e=o.styles?.searchBtn?.searchIcon,i=R(e,ve);n.innerHTML=`
			<a href="#" class="ts-search-area hidden ts-map-btn">
				${i}
				Search this area
			</a>
		`}return t.insertBefore(n,t.firstChild),n}function _e(t,o){const n=document.createElement("a");n.href="#",n.rel="nofollow",n.role="button",n.className="vx-geolocate-me hidden",n.setAttribute("aria-label","Share your location");const e=o.styles?.geolocationIcon,i=R(e,fe);return n.innerHTML=i,n.addEventListener("click",r=>{r.preventDefault(),n.classList.add("loading"),ae({fetchAddress:!0,receivedPosition:s=>{console.log("[Map Block] Got user position:",s.getLatitude(),s.getLongitude()),n.classList.remove("loading");const c=k.get(t.querySelector(".ts-map"));c&&(c.map.panTo(s),c.map.setZoom(15),c.circle&&(c.circle.setCenter(s),c.circle.show()))},receivedAddress:s=>{console.log("[Map Block] Got user address:",s.address),t.dispatchEvent(new CustomEvent("geolocation:address",{detail:{address:s.address,latlng:{lat:s.latlng.getLatitude(),lng:s.latlng.getLongitude()}},bubbles:!0}))},positionFail:()=>{console.warn("[Map Block] Failed to get user position"),n.classList.remove("loading");const s=window.Voxel_Config?.l10n?.positionFail||"Could not determine your location.";typeof window.Voxel?.alert=="function"&&window.Voxel.alert(s,"error")},addressFail:()=>{console.warn("[Map Block] Failed to get user address")}})}),t.appendChild(n),n}function J(t,o,n){const e=document.createElement("div");return e.className=o.source==="current-post"?"ts-map ts-map-autoload":"ts-map",e.setAttribute("data-config",JSON.stringify(n)),t.appendChild(e),e}async function ye(t,o){const n=Ne();if(!n){console.warn("[Map Block] No post ID found for current-post mode");return}const i=`${ue()}voxel-fse/v1/map/post-location?post_id=${n}`;try{const r=await fetch(i);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const s=await r.json(),c={center:{lat:s.latitude,lng:s.longitude},zoom:o.zoom,minZoom:o.minZoom,maxZoom:o.maxZoom,markers:[{lat:s.latitude,lng:s.longitude,template:encodeURIComponent(s.marker),uriencoded:!0}]};t.innerHTML="",J(t,o,c).dispatchEvent(new CustomEvent("voxel:map-ready",{bubbles:!0}))}catch(r){console.error("[Map Block] Failed to fetch post location:",r)}}function ke(t,o){t.innerHTML="";const n={center:o.center,zoom:o.zoom,minZoom:o.minZoom,maxZoom:o.maxZoom},e=xe(t,o),i=J(t,o,n);_e(t,o);let r=[],s=!1;be(i,n,t,o).then(()=>{if(s=!0,r.length>0){const l=r.flat();console.log("[Map Block] Processing",l.length,"queued markers after map init"),Q(i,l),r=[]}});const c=o.blockId;c&&window.addEventListener("voxel-search-submit",(l=>{l.detail.targetId===c&&Me(t,i,l.detail)})),console.log("[Map Block] Setting up voxel-fse:post-feed-markers listener"),window.addEventListener("voxel-fse:post-feed-markers",(l=>{console.log("[Map Block] Received voxel-fse:post-feed-markers event:",l.detail);const{markers:a}=l.detail;a.length>0?s?(console.log("[Map Block] Received",a.length,"markers from Post Feed - processing now"),Q(i,a)):(console.log("[Map Block] Map not ready, queuing",a.length,"markers"),r.push(a)):console.log("[Map Block] Received empty markers array from Post Feed")})),e&&Pe(e,i)}const k=new Map;async function be(t,o,n,e){console.log("[Map Block] initializeVoxelMap called",{mapContainer:t,dataConfig:o});try{console.log("[Map Block] Waiting for Voxel.Maps..."),await B(),console.log("[Map Block] Voxel.Maps ready!")}catch(i){console.warn("[Map Block] Voxel.Maps not available:",i);return}try{const i=n.style.getPropertyValue("--vx-map-height"),r=window.getComputedStyle(n).getPropertyValue("--vx-map-height"),s=i||r||"400px";t.style.height=s,t.style.minHeight=s,n.style.width=n.style.width||"100%",console.log("[Map Block] Height values:",{inlineHeight:i,computedHeight:r,finalHeight:s,wrapperStyle:n.getAttribute("style")?.substring(0,100)});const c=new f(o.center.lat,o.center.lng);console.log("[Map Block] Center created:",c.getLatitude(),c.getLongitude());const l={el:t,center:c,zoom:o.zoom,minZoom:o.minZoom,maxZoom:o.maxZoom,draggable:!0};console.log("[Map Block] Creating VxMap with options:",{zoom:l.zoom,minZoom:l.minZoom,maxZoom:l.maxZoom});const a=new oe(l);console.log("[Map Block] VxMap instance created, calling init()..."),await a.init(),console.log("[Map Block] VxMap.init() completed, native map:",a.getNative());let m=null;e.source==="search-form"&&(m=new re,await m.init(a),m.onClusterClick=()=>{console.log("[Map Block] Cluster clicked, zooming in")},m.onNonExpandableClusterClick=x=>{console.log("[Map Block] Non-expandable cluster clicked:",x.length,"markers")});const v=new ie({});v.init(a);const g=new se({center:c,radius:5e3,className:"map-circle"});g.init(a),g.hide();const u={map:a,clusterer:m,markers:[],popup:v,circle:g,config:e};if(k.set(t,u),t._voxelMap=a.getNative(),t._vxMapInstance=u,a.addListener("zoom_changed",()=>{m&&m.render()}),a.addListener("idle",()=>{n.querySelector(".ts-drag-toggle.active")&&e.dragSearchMode==="automatic"&&Ce(n,a,e)}),a.addListener("bounds_changed",()=>{const x=n.querySelector(".ts-search-area");x&&e.dragSearchMode==="manual"&&x.classList.remove("hidden")}),a.addListener("click",()=>{v.hide()}),o.markers&&o.markers.length>0){const x=await Z(a,o.markers,v,m);u.markers=x,x.length>1&&m?m.render():x.length>0&&$(a,x)}console.log("[Map Block] Map initialized successfully with all features");const d=n.querySelector(".vx-geolocate-me");d?(d.classList.remove("hidden"),d.style.display="flex",console.log("[Map Block] Geolocate button shown")):console.warn("[Map Block] Geolocate button not found in wrapper")}catch(i){console.error("[Map Block] Failed to initialize map:",i)}}function Ce(t,o,n){const e=o.getBounds();if(!e)return;const i=e.getSouthWest(),r=e.getNorthEast();if(!i||!r)return;const s={bounds:{sw:{lat:i.getLatitude(),lng:i.getLongitude()},ne:{lat:r.getLatitude(),lng:r.getLongitude()}},center:{lat:o.getCenter()?.getLatitude(),lng:o.getCenter()?.getLongitude()},zoom:o.getZoom()};t.dispatchEvent(new CustomEvent("map:bounds-changed",{detail:s,bubbles:!0}))}async function Me(t,o,n,e){console.log("[Map Block] Search submitted:",n);const i=k.get(o);if(!i){console.warn("[Map Block] No map instance found");return}i.clusterer?i.clusterer.clearMarkers():i.markers.forEach(s=>s.remove()),i.markers=[],i.popup?.hide();const r=t.closest(".ts-map-widget");r&&r.dispatchEvent(new CustomEvent("search:updated",{detail:n,bubbles:!0}))}async function we(t,o){const n=t.querySelector(".ts-map");if(!n)return;const e=k.get(n);if(!e)return;e.clusterer?e.clusterer.clearMarkers():e.markers.forEach(s=>s.remove()),e.markers=[];const i=o.map(s=>({lat:s.lat,lng:s.lng,template:s.template,uriencoded:!1})),r=await Z(e.map,i,e.popup,e.clusterer);e.markers=r,e.clusterer&&r.length>0?e.clusterer.render():r.length>0&&$(e.map,r)}async function Q(t,o){const n=k.get(t);if(!n){console.warn("[Map Block] displayMarkersFromFeed: No map instance found");return}if(console.log("[Map Block] Displaying",o.length,"markers from feed"),n.clusterer?n.clusterer.clearMarkers():n.markers.forEach(s=>s.remove()),n.markers=[],n.popup?.hide(),o.length===0){console.log("[Map Block] No markers to display");return}de();const e=o.map(s=>({lat:s.lat,lng:s.lng,template:s.template,uriencoded:!1})),i=o.map(s=>s.postId),r=await Z(n.map,e,n.popup,n.clusterer,i);n.markers=r,n.clusterer&&r.length>0?n.clusterer.render():r.length>0&&$(n.map,r),console.log("[Map Block] Successfully displayed",r.length,"markers from feed")}function Be(t,o,n){const e=t.querySelector(".ts-map");if(!e)return;const i=k.get(e);i?.circle&&(i.circle.setCenter(new f(o.lat,o.lng)),i.circle.setRadius(n),i.circle.show())}function Se(t){const o=t.querySelector(".ts-map");if(!o)return;k.get(o)?.circle?.hide()}function Le(t){const o=t.querySelector(".ts-map");if(o)return k.get(o)}function Pe(t,o,n){const e=t.querySelector(".ts-drag-toggle"),i=t.querySelector(".ts-search-area");e&&e.addEventListener("click",r=>{r.preventDefault(),e.classList.toggle("active")}),i&&i.addEventListener("click",r=>{r.preventDefault();const s=o.closest(".ts-map-widget");s&&s.dispatchEvent(new CustomEvent("search:area",{bubbles:!0}))})}function Ne(){const t=document.body.className.split(" ");for(const n of t){const e=n.match(/^postid-(\d+)$/);if(e)return parseInt(e[1],10)}const o=document.querySelector("[data-post-id]");if(o){const n=o.getAttribute("data-post-id");if(n)return parseInt(n,10)}if(typeof window<"u"){const n=window.wp_post_id;if(n)return n}return null}function Ve(t){const o=document.createElement("div");o.className="ts-map ts-map-loading",o.innerHTML=`
		<div class="ts-no-posts">
			<span class="ts-loader" aria-label="Loading map..."></span>
		</div>
	`,t.appendChild(o)}function E(){he(),document.querySelectorAll(".voxel-fse-map").forEach(o=>{if(o.getAttribute("data-hydrated")==="true")return;const n=G(o);if(!n){console.warn("[Map Block] No vxconfig found for container:",o);return}const e=W(n);o.setAttribute("data-hydrated","true"),q(o,e),o.innerHTML="",Ve(o),e.source==="current-post"?ye(o,e):ke(o,e),requestAnimationFrame(()=>{window.jQuery&&window.jQuery(document).trigger("voxel:markup-update")})})}function I(t){te()?B().then(t).catch(()=>{console.warn("[Map Block] Voxel.Maps not available, initializing anyway"),t()}):(document.addEventListener("maps:loaded",()=>{B().then(t).catch(t)},{once:!0}),setTimeout(()=>{B().then(t).catch(t)},1e4))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{I(E)}):I(E),window.addEventListener("turbo:load",()=>{I(E)}),window.addEventListener("pjax:complete",()=>{I(E)});let K;return window.addEventListener("resize",()=>{clearTimeout(K),K=setTimeout(()=>{document.querySelectorAll('.voxel-fse-map[data-hydrated="true"]').forEach(o=>{if(o.getAttribute("data-hydrated")!=="true")return;const e=G(o);if(e){const i=W(e);q(o,i)}})},250)}),b.getMapInstance=Le,b.getResponsiveValueClient=pe,b.hideRadiusCircle=Se,b.showRadiusCircle=Be,b.updateMapMarkers=we,Object.defineProperty(b,Symbol.toStringTag,{value:"Module"}),b})({});
