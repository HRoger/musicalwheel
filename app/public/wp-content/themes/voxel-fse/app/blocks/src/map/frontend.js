var VoxelFSEMap=(function(C){"use strict";let q=!1;function H(){if(q)return!0;if(!window.Voxel?.mixins?.base)return!1;const e=window.Voxel.mixins.base;return e.mounted&&!e._originalMounted?(e._originalMounted=e.mounted,e.mounted=function(){try{const o=this.$root?.$options?.el||this.$el;if(o){const n=o.closest?.(".elementor-element");if(n)this.widget_id=n.dataset?.id||"";else{const i=o.closest?.("[data-block-id]");this.widget_id=i&&i.dataset?.blockId||""}const t=o.closest?.(".elementor");if(t)this.post_id=t.dataset?.elementorId||"";else{const i=document.body.className.match(/postid-(\d+)/);this.post_id=i?i[1]:""}}e._originalMounted&&e._originalMounted!==e.mounted&&e._originalMounted.call(this)}catch(o){console.warn("[VoxelShim] Error in patched mounted():",o),this.widget_id="",this.post_id=""}},q=!0,console.log("[VoxelShim] Successfully patched Voxel.mixins.base.mounted"),!0):!1}function Z(){if(H())return;let e=0;const o=50,t=setInterval(()=>{if(e++,H()){clearInterval(t);return}e>=o&&(clearInterval(t),console.warn("[VoxelShim] Voxel.mixins.base not found after 5 seconds"))},100);typeof document<"u"&&document.addEventListener("voxel:ready",()=>{H(),clearInterval(t)},{once:!0})}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Z,{once:!0}):Z());function tt(){if(typeof window>"u")return"desktop";const e=window.innerWidth;return e<768?"mobile":e<1024?"tablet":"desktop"}function g(e,o){if(!e)return o;const n=tt();return n==="mobile"?e.mobile!==void 0?e.mobile:e.tablet!==void 0?e.tablet:e.desktop!==void 0?e.desktop:o:n==="tablet"&&e.tablet!==void 0?e.tablet:e.desktop!==void 0?e.desktop:o}function N(e){if(!e?.enable)return"none";const{horizontal:o=0,vertical:n=0,blur:t=0,spread:i=0,color:r="rgba(0,0,0,0.1)",position:s}=e;return`${s==="inset"?"inset ":""}${o}px ${n}px ${t}px ${i}px ${r}`}function T(e){if(!e)return{};const o={};return e.fontFamily&&(o["font-family"]=e.fontFamily),e.fontSize&&(o["font-size"]=`${e.fontSize}${e.fontSizeUnit||"px"}`),e.fontWeight&&(o["font-weight"]=e.fontWeight),e.fontStyle&&(o["font-style"]=e.fontStyle),e.textTransform&&(o["text-transform"]=e.textTransform),e.textDecoration&&(o["text-decoration"]=e.textDecoration),e.lineHeight&&(o["line-height"]=`${e.lineHeight}${e.lineHeightUnit||""}`),e.letterSpacing&&(o["letter-spacing"]=`${e.letterSpacing}${e.letterSpacingUnit||"px"}`),o}function U(e,o){e.style.width="100%";const n=o.styles;if(!n)return;const t=g(n.height,400),i=n.heightUnit||"px",r=g(n.enableCalcHeight,!1),s=g(n.calcHeight,"");r&&s?e.style.setProperty("--vx-map-height",s):e.style.setProperty("--vx-map-height",`${t}${i}`);const a=g(n.borderRadius,0);if(e.style.setProperty("--vx-map-radius",`${a}px`),n.cluster){const l=g(n.cluster.size,40);e.style.setProperty("--vx-cluster-size",`${l}px`);const d=g(n.cluster.bgColor,"");d&&e.style.setProperty("--vx-cluster-bg",d);const c=g(n.cluster.radius,50);e.style.setProperty("--vx-cluster-radius",`${c}%`);const u=g(n.cluster.textColor,"");if(u&&e.style.setProperty("--vx-cluster-text-color",u),e.style.setProperty("--vx-cluster-shadow",N(n.cluster.shadow)),n.cluster.typography){const m=T(n.cluster.typography);m["font-family"]&&e.style.setProperty("--vx-cluster-font-family",m["font-family"]),m["font-size"]&&e.style.setProperty("--vx-cluster-font-size",m["font-size"]),m["font-weight"]&&e.style.setProperty("--vx-cluster-font-weight",m["font-weight"]),m["font-style"]&&e.style.setProperty("--vx-cluster-font-style",m["font-style"]),m["line-height"]&&e.style.setProperty("--vx-cluster-line-height",m["line-height"]),m["letter-spacing"]&&e.style.setProperty("--vx-cluster-letter-spacing",m["letter-spacing"]),m["text-transform"]&&e.style.setProperty("--vx-cluster-text-transform",m["text-transform"]),m["text-decoration"]&&e.style.setProperty("--vx-cluster-text-decoration",m["text-decoration"])}}if(n.iconMarker){const l=g(n.iconMarker.size,42);e.style.setProperty("--vx-icon-marker-size",`${l}px`);const d=g(n.iconMarker.iconSize,24);e.style.setProperty("--vx-icon-marker-icon-size",`${d}px`);const c=g(n.iconMarker.radius,50);e.style.setProperty("--vx-icon-marker-radius",`${c}%`),e.style.setProperty("--vx-icon-marker-shadow",N(n.iconMarker.shadow));const u=g(n.iconMarker.staticBg,"");u&&e.style.setProperty("--vx-icon-marker-bg",u);const m=g(n.iconMarker.staticBgActive,"");m&&e.style.setProperty("--vx-icon-marker-bg-active",m);const v=g(n.iconMarker.staticIconColor,"");v&&e.style.setProperty("--vx-icon-marker-icon-color",v);const h=g(n.iconMarker.staticIconColorActive,"");h&&e.style.setProperty("--vx-icon-marker-icon-color-active",h)}if(n.textMarker){const l=g(n.textMarker.bgColor,"");l&&e.style.setProperty("--vx-text-marker-bg",l);const d=g(n.textMarker.bgColorActive,"");d&&e.style.setProperty("--vx-text-marker-bg-active",d);const c=g(n.textMarker.textColor,"");c&&e.style.setProperty("--vx-text-marker-text-color",c);const u=g(n.textMarker.textColorActive,"");u&&e.style.setProperty("--vx-text-marker-text-color-active",u);const m=g(n.textMarker.radius,4);if(e.style.setProperty("--vx-text-marker-radius",`${m}px`),e.style.setProperty("--vx-text-marker-shadow",N(n.textMarker.shadow)),n.textMarker.typography){const h=T(n.textMarker.typography);h["font-family"]&&e.style.setProperty("--vx-text-marker-font-family",h["font-family"]),h["font-size"]&&e.style.setProperty("--vx-text-marker-font-size",h["font-size"]),h["font-weight"]&&e.style.setProperty("--vx-text-marker-font-weight",h["font-weight"]),h["font-style"]&&e.style.setProperty("--vx-text-marker-font-style",h["font-style"]),h["line-height"]&&e.style.setProperty("--vx-text-marker-line-height",h["line-height"]),h["letter-spacing"]&&e.style.setProperty("--vx-text-marker-letter-spacing",h["letter-spacing"]),h["text-transform"]&&e.style.setProperty("--vx-text-marker-text-transform",h["text-transform"]),h["text-decoration"]&&e.style.setProperty("--vx-text-marker-text-decoration",h["text-decoration"])}const v=g(n.textMarker.padding,{});if(v){const h=v;h.top&&e.style.setProperty("--vx-text-marker-padding-top",h.top),h.right&&e.style.setProperty("--vx-text-marker-padding-right",h.right),h.bottom&&e.style.setProperty("--vx-text-marker-padding-bottom",h.bottom),h.left&&e.style.setProperty("--vx-text-marker-padding-left",h.left)}}if(n.imageMarker){const l=g(n.imageMarker.size,42);e.style.setProperty("--vx-image-marker-size",`${l}px`);const d=g(n.imageMarker.radius,50);e.style.setProperty("--vx-image-marker-radius",`${d}%`),e.style.setProperty("--vx-image-marker-shadow",N(n.imageMarker.shadow))}if(n.popup){const l=g(n.popup.cardWidth,320);e.style.setProperty("--vx-popup-card-width",`${l}px`),n.popup.loaderColor1&&e.style.setProperty("--vx-popup-loader-color1",n.popup.loaderColor1),n.popup.loaderColor2&&e.style.setProperty("--vx-popup-loader-color2",n.popup.loaderColor2)}if(n.searchBtn){const l=g(n.searchBtn.textColor,"");l&&e.style.setProperty("--vx-search-btn-text-color",l);const d=g(n.searchBtn.bgColor,"");d&&e.style.setProperty("--vx-search-btn-bg",d);const c=g(n.searchBtn.iconColor,"");c&&e.style.setProperty("--vx-search-btn-icon-color",c);const u=g(n.searchBtn.iconColorActive,"");u&&e.style.setProperty("--vx-search-btn-icon-color-active",u);const m=g(n.searchBtn.radius,4);if(e.style.setProperty("--vx-search-btn-radius",`${m}px`),n.searchBtn.typography){const v=T(n.searchBtn.typography);v["font-family"]&&e.style.setProperty("--vx-search-btn-font-family",v["font-family"]),v["font-size"]&&e.style.setProperty("--vx-search-btn-font-size",v["font-size"]),v["font-weight"]&&e.style.setProperty("--vx-search-btn-font-weight",v["font-weight"]),v["font-style"]&&e.style.setProperty("--vx-search-btn-font-style",v["font-style"]),v["line-height"]&&e.style.setProperty("--vx-search-btn-line-height",v["line-height"]),v["letter-spacing"]&&e.style.setProperty("--vx-search-btn-letter-spacing",v["letter-spacing"]),v["text-transform"]&&e.style.setProperty("--vx-search-btn-text-transform",v["text-transform"]),v["text-decoration"]&&e.style.setProperty("--vx-search-btn-text-decoration",v["text-decoration"])}if(n.searchBtn.checkmarkIcon){const v=n.searchBtn.checkmarkIcon;e.dataset.checkmarkIcon=JSON.stringify(v)}}if(n.navBtn){n.navBtn.iconColor&&e.style.setProperty("--vx-nav-btn-icon-color",n.navBtn.iconColor),n.navBtn.iconColorHover&&e.style.setProperty("--vx-nav-btn-icon-color-hover",n.navBtn.iconColorHover);const l=g(n.navBtn.iconSize,20);e.style.setProperty("--vx-nav-btn-icon-size",`${l}px`),n.navBtn.bgColor&&e.style.setProperty("--vx-nav-btn-bg",n.navBtn.bgColor),n.navBtn.bgColorHover&&e.style.setProperty("--vx-nav-btn-bg-hover",n.navBtn.bgColorHover);const d=g(n.navBtn.radius,4);e.style.setProperty("--vx-nav-btn-radius",`${d}px`);const c=g(n.navBtn.size,36);if(e.style.setProperty("--vx-nav-btn-size",`${c}px`),e.style.setProperty("--vx-nav-btn-shadow",N(n.navBtn.shadow)),n.navBtn.borderType&&n.navBtn.borderType!=="none"){e.style.setProperty("--vx-nav-btn-border-style",n.navBtn.borderType);const u=g(n.navBtn.borderWidth,0);e.style.setProperty("--vx-nav-btn-border-width",`${u}px`),n.navBtn.borderColor&&e.style.setProperty("--vx-nav-btn-border-color",n.navBtn.borderColor),n.navBtn.borderColorHover&&e.style.setProperty("--vx-nav-btn-border-color-hover",n.navBtn.borderColorHover)}}}function O(e){const o=e.center||{},n={lat:Number(e.lat||o.lat||o.latitude||51.492),lng:Number(e.lng||o.lng||o.longitude||-.13)},t=e.styles||{},i=(s,a)=>s?{desktop:s.desktop!==void 0?s.desktop:a,tablet:s.tablet!==void 0?s.tablet:s.desktop!==void 0?s.desktop:a,mobile:s.mobile!==void 0?s.mobile:s.tablet!==void 0?s.tablet:s.desktop!==void 0?s.desktop:a}:{desktop:a,tablet:a,mobile:a},r=s=>s?{enable:!!s.enable,horizontal:Number(s.horizontal||s.h||0),vertical:Number(s.vertical||s.v||0),blur:Number(s.blur||0),spread:Number(s.spread||0),color:String(s.color||"rgba(0,0,0,0.1)"),position:s.position||(s.inset?"inset":"outline")}:{enable:!1};return{blockId:String(e.blockId||e.block_id||""),source:e.source||"search-form",center:n,zoom:Number(e.zoom||e.initialZoom||11),minZoom:Number(e.minZoom||e.min_zoom||2),maxZoom:Number(e.maxZoom||e.max_zoom||18),dragSearch:e.dragSearch!==void 0?!!e.dragSearch:e.drag_search!==void 0?!!e.drag_search:!0,dragSearchMode:e.dragSearchMode||e.drag_search_mode||"manual",dragSearchDefault:e.dragSearchDefault||e.drag_search_default||"unchecked",searchFormId:String(e.searchFormId||e.search_form_id||""),styles:{height:i(t.height||t.mapHeight,400),heightUnit:String(t.heightUnit||t.height_unit||"px"),enableCalcHeight:i(t.enableCalcHeight||t.enable_calc_height,!1),calcHeight:i(t.calcHeight||t.calc_height,""),borderRadius:i(t.borderRadius||t.border_radius,0),cluster:t.cluster?{size:i(t.cluster.size,40),bgColor:i(t.cluster.bgColor||t.cluster.bg_color,""),radius:i(t.cluster.radius,50),textColor:i(t.cluster.textColor||t.cluster.text_color,""),shadow:r(t.cluster.shadow),typography:t.cluster.typography||{}}:{size:{desktop:40},bgColor:{desktop:""},radius:{desktop:50},textColor:{desktop:""},shadow:{enable:!1},typography:{}},iconMarker:t.iconMarker||t.icon_marker?{size:i((t.iconMarker||t.icon_marker).size,42),iconSize:i((t.iconMarker||t.icon_marker).iconSize||(t.iconMarker||t.icon_marker).icon_size,24),radius:i((t.iconMarker||t.icon_marker).radius,50),shadow:r((t.iconMarker||t.icon_marker).shadow),staticBg:i((t.iconMarker||t.icon_marker).staticBg||(t.iconMarker||t.icon_marker).static_bg,""),staticBgActive:i((t.iconMarker||t.icon_marker).staticBgActive||(t.iconMarker||t.icon_marker).static_bg_active,""),staticIconColor:i((t.iconMarker||t.icon_marker).staticIconColor||(t.iconMarker||t.icon_marker).static_icon_color,""),staticIconColorActive:i((t.iconMarker||t.icon_marker).staticIconColorActive||(t.iconMarker||t.icon_marker).static_icon_color_active,"")}:{size:{desktop:42},iconSize:{desktop:24},radius:{desktop:50},shadow:{enable:!1},staticBg:{desktop:""},staticBgActive:{desktop:""},staticIconColor:{desktop:""},staticIconColorActive:{desktop:""}},textMarker:t.textMarker||t.text_marker?{bgColor:i((t.textMarker||t.text_marker).bgColor||(t.textMarker||t.text_marker).bg_color,""),bgColorActive:i((t.textMarker||t.text_marker).bgColorActive||(t.textMarker||t.text_marker).bg_color_active,""),textColor:i((t.textMarker||t.text_marker).textColor||(t.textMarker||t.text_marker).text_color,""),textColorActive:i((t.textMarker||t.text_marker).textColorActive||(t.textMarker||t.text_marker).text_color_active,""),radius:i((t.textMarker||t.text_marker).radius,4),shadow:r((t.textMarker||t.text_marker).shadow),typography:(t.textMarker||t.text_marker).typography||{},padding:i((t.textMarker||t.text_marker).padding,{})}:{bgColor:{desktop:""},bgColorActive:{desktop:""},textColor:{desktop:""},textColorActive:{desktop:""},radius:{desktop:4},shadow:{enable:!1},typography:{},padding:{desktop:{}}},imageMarker:t.imageMarker||t.image_marker?{size:i((t.imageMarker||t.image_marker).size,42),radius:i((t.imageMarker||t.image_marker).radius,50),shadow:r((t.imageMarker||t.image_marker).shadow)}:{size:{desktop:42},radius:{desktop:50},shadow:{enable:!1}},popup:t.popup?{cardWidth:i(t.popup.cardWidth||t.popup.card_width,320),loaderColor1:String(t.popup.loaderColor1||t.popup.loader_color_1||""),loaderColor2:String(t.popup.loaderColor2||t.popup.loader_color_2||"")}:{cardWidth:{desktop:320},loaderColor1:"",loaderColor2:""},searchBtn:t.searchBtn||t.search_btn?{textColor:i((t.searchBtn||t.search_btn).textColor||(t.searchBtn||t.search_btn).text_color,""),bgColor:i((t.searchBtn||t.search_btn).bgColor||(t.searchBtn||t.search_btn).bg_color,""),iconColor:i((t.searchBtn||t.search_btn).iconColor||(t.searchBtn||t.search_btn).icon_color,""),iconColorActive:i((t.searchBtn||t.search_btn).iconColorActive||(t.searchBtn||t.search_btn).icon_color_active,""),radius:i((t.searchBtn||t.search_btn).radius||(t.searchBtn||t.search_btn).radius,4),typography:(t.searchBtn||t.search_btn).typography||{},checkmarkIcon:(t.searchBtn||t.search_btn).checkmarkIcon||{},searchIcon:(t.searchBtn||t.search_btn).searchIcon||{}}:{textColor:{desktop:""},bgColor:{desktop:""},iconColor:{desktop:""},iconColorActive:{desktop:""},radius:{desktop:4},typography:{},checkmarkIcon:{},searchIcon:{}},navBtn:t.navBtn||t.nav_btn?{iconColor:String((t.navBtn||t.nav_btn).iconColor||(t.navBtn||t.nav_btn).icon_color||""),iconColorHover:String((t.navBtn||t.nav_btn).iconColorHover||(t.navBtn||t.nav_btn).icon_color_hover||""),iconSize:i((t.navBtn||t.nav_btn).iconSize||(t.navBtn||t.nav_btn).icon_size,20),bgColor:String((t.navBtn||t.nav_btn).bgColor||(t.navBtn||t.nav_btn).bg_color||""),bgColorHover:String((t.navBtn||t.nav_btn).bgColorHover||(t.navBtn||t.nav_btn).bg_color_hover||""),radius:i((t.navBtn||t.nav_btn).radius,4),size:i((t.navBtn||t.nav_btn).size,36),shadow:r((t.navBtn||t.nav_btn).shadow),borderType:String((t.navBtn||t.nav_btn).borderType||(t.navBtn||t.nav_btn).border_type||"none"),borderWidth:i((t.navBtn||t.nav_btn).borderWidth||(t.navBtn||t.nav_btn).border_width,0),borderColor:String((t.navBtn||t.nav_btn).borderColor||(t.navBtn||t.nav_btn).border_color||""),borderColorHover:String((t.navBtn||t.nav_btn).borderColorHover||(t.navBtn||t.nav_btn).border_color_hover||"")}:{iconSize:{desktop:20},radius:{desktop:4},size:{desktop:36},shadow:{enable:!1},borderType:"none",borderWidth:{desktop:0}},geolocationIcon:t.geolocationIcon||t.geolocation_icon||{}}}}const x=()=>window;function et(){return!!x().Voxel?.Maps}function S(){return new Promise((e,o)=>{const n=x().Voxel?.Maps;if(n){n.await(()=>e(n));return}const t=()=>{const i=x().Voxel?.Maps;i&&i.await(()=>e(i))};document.addEventListener("maps:loaded",t,{once:!0}),setTimeout(()=>{document.removeEventListener("maps:loaded",t);const i=x().Voxel?.Maps;i?i.await(()=>e(i)):o(new Error("Voxel.Maps not available after timeout"))},15e3)})}function G(){return{lat:x().Voxel_Config?.maps?.default_lat??40.7128,lng:x().Voxel_Config?.maps?.default_lng??-74.006}}class f{constructor(o,n){this._native=null,this._lat=o,this._lng=n;const t=x().Voxel?.Maps;t&&(this._native=new t.LatLng(o,n))}getLatitude(){return this._native?.getLatitude()??this._lat}getLongitude(){return this._native?.getLongitude()??this._lng}getSourceObject(){return this._native?.getSourceObject()??null}toGeocoderFormat(){return this._native?.toGeocoderFormat()??null}getNative(){return this._native}static fromNative(o){const n=new f(o.getLatitude(),o.getLongitude());return n._native=o,n}}class k{constructor(o,n){this._native=null,this._sw=o??null,this._ne=n??null;const t=x().Voxel?.Maps;t&&(this._native=new t.Bounds(o?.getNative()??void 0,n?.getNative()??void 0))}extend(o){this._native&&o.getNative()&&this._native.extend(o.getNative())}empty(){return this._native?.empty()??!0}getSourceObject(){return this._native?.getSourceObject()??null}getSouthWest(){return this._native?f.fromNative(this._native.getSouthWest()):this._sw}getNorthEast(){return this._native?f.fromNative(this._native.getNorthEast()):this._ne}getNative(){return this._native}static fromNative(o){const n=f.fromNative(o.getSouthWest()),t=f.fromNative(o.getNorthEast()),i=new k(n,t);return i._native=o,i}}class ot{constructor(o){this._native=null,this._listeners=new Map,this._el=o.el,this._options=o}async init(){console.log("[VxMap] init() called");const o=await S();console.log("[VxMap] Got Voxel.Maps:",o),console.log("[VxMap] Maps.Map constructor:",o.Map);const n=window.getComputedStyle(this._el),t=this._el.getBoundingClientRect();console.log("[VxMap] Container dimensions BEFORE map creation:",{width:t.width,height:t.height,display:n.display,visibility:n.visibility,offsetParent:this._el.offsetParent?"exists":"null",styleHeight:this._el.style.height}),t.height===0&&(console.log("[VxMap] WARNING: Container has 0 height! Setting fallback height of 400px"),this._el.style.height="400px");const i=this._options.center?new o.LatLng(this._options.center.getLatitude(),this._options.center.getLongitude()):new o.LatLng(G().lat,G().lng);console.log("[VxMap] centerLatLng created:",i);const r=x().Voxel_Config,s={el:this._el,zoom:this._options.zoom??10,center:i,minZoom:this._options.minZoom??2,maxZoom:this._options.maxZoom??20,draggable:this._options.draggable??!0,mapTypeControl:!!r?.google_maps?.mapTypeControl,streetViewControl:!!r?.google_maps?.streetViewControl};try{this._native=new o.Map(s),this._el.classList.add("ts-map-loaded"),this._el.__vx_map__=this._native;const a=this._native?.getSourceObject();a&&typeof google<"u"&&google.maps?.event&&(console.log("[VxMap] Triggering resize event sequence..."),this._el.offsetHeight,google.maps.event.trigger(a,"resize"),requestAnimationFrame(()=>{google.maps.event.trigger(a,"resize");const l=a.getCenter();l&&a.setCenter(l),setTimeout(()=>{google.maps.event.trigger(a,"bounds_changed"),google.maps.event.trigger(a,"idle"),console.log("[VxMap] Resize sequence completed");const d=this._el.getBoundingClientRect();console.log("[VxMap] Container dimensions AFTER resize:",{width:d.width,height:d.height})},100)}))}catch(a){throw console.error("[VxMap] Error creating Maps.Map:",a),a}}setZoom(o){this._native?.setZoom(o)}getZoom(){return this._native?.getZoom()??this._options.zoom??10}getMinZoom(){return this._native?.getMinZoom()??this._options.minZoom??2}getMaxZoom(){return this._native?.getMaxZoom()??this._options.maxZoom??20}setCenter(o){this._native&&o.getNative()&&this._native.setCenter(o.getNative())}getCenter(){return this._native?f.fromNative(this._native.getCenter()):this._options.center??null}getBounds(){return this._native?k.fromNative(this._native.getBounds()):null}fitBounds(o){this._native&&o.getNative()&&this._native.fitBounds(o.getNative())}panTo(o){this._native&&o.getNative()&&this._native.panTo(o.getNative())}getClickPosition(o){return this._native?f.fromNative(this._native.getClickPosition(o)):null}addListener(o,n){if(this._native){const t=this._native.addListener(o,n);this._listeners.has(o)||this._listeners.set(o,[]),this._listeners.get(o).push(t)}}addListenerOnce(o,n){this._native&&this._native.addListenerOnce(o,n)}removeListeners(o){const n=this._listeners.get(o);n&&this._native&&(n.forEach(t=>this._native.removeListener(t)),this._listeners.delete(o))}trigger(o){this._native?.trigger(o)}getSourceObject(){return this._native?.getSourceObject()??null}getNative(){return this._native}getElement(){return this._el}}class nt{constructor(o){this._native=null,this._map=null,this._options=o}init(o){const n=x().Voxel?.Maps;if(!n||!o.getNative())return;this._map=o;const t=this._options.position?new n.LatLng(this._options.position.getLatitude(),this._options.position.getLongitude()):void 0;this._native=new n.Marker({map:o.getNative(),position:t,template:this._options.template,onClick:this._options.onClick?(i,r)=>this._options.onClick(i,this):void 0,data:this._options.data})}getPosition(){return this._native?f.fromNative(this._native.getPosition()):this._options.position??null}setPosition(o){this._native&&o.getNative()&&this._native.setPosition(o.getNative())}getMap(){return this._map}setMap(o){this._native&&o.getNative()&&(this._native.setMap(o.getNative()),this._map=o)}remove(){return this._native?.remove(),this._map=null,this}addClass(o){this._native?.addClass(o)}removeClass(o){this._native?.removeClass(o)}getData(){return this._options.data}getNative(){return this._native}}class it{constructor(o){this._native=null,this._map=null,this._options=o}init(o){const n=x().Voxel?.Maps;if(!n||!o.getNative())return;this._map=o;const t=this._options.position?new n.LatLng(this._options.position.getLatitude(),this._options.position.getLongitude()):void 0;this._native=new n.Popup({map:o.getNative(),position:t,content:this._options.content})}setContent(o){this._native?.setContent(o)}setPosition(o){this._native&&o.getNative()&&this._native.setPosition(o.getNative())}show(){this._native?.show()}hide(){this._native?.hide()}getMap(){return this._map}getNative(){return this._native}}class st{constructor(o){this._native=null,this._map=null,this._options=o}init(o){const n=x().Voxel?.Maps;if(!n||!o.getNative())return;this._map=o;const t=this._options.center?new n.LatLng(this._options.center.getLatitude(),this._options.center.getLongitude()):void 0;this._native=new n.Circle({map:o.getNative(),center:t,radius:this._options.radius,visible:this._options.visible,className:this._options.className??"map-circle"})}hide(){this._native?.hide()}show(){this._native?.show()}setCenter(o){this._native&&o.getNative()&&this._native.setCenter(o.getNative())}setRadius(o){this._native?.setRadius(o)}getBounds(){return this._native?k.fromNative(this._native.getBounds()):null}getMap(){return this._map}getNative(){return this._native}}const w=class w{constructor(){this._native=null;const o=x().Voxel?.Maps;o&&(this._native=o.getGeocoder())}static getInstance(){return w._instance||(w._instance=new w),w._instance}geocode(o,n,t){if(!this._native){const s=typeof n=="function"?n:t;s&&s(!1);return}let i;if(o instanceof f){const s=o.getSourceObject();if(!s){const a=typeof n=="function"?n:t;a&&a(!1);return}i=s}else i=o;const r=s=>a=>{a===!1?s(!1):Array.isArray(a)?s(a.map(l=>({address:l.address,latlng:f.fromNative(l.latlng),viewport:k.fromNative(l.viewport)}))):s({address:a.address,latlng:f.fromNative(a.latlng),viewport:k.fromNative(a.viewport)})};if(typeof n=="function"){const s=n;this._native.geocode(i,r(s))}else t&&this._native.geocode(i,n,r(t))}getUserLocation(o){if(!this._native){o.positionFail?.();return}this._native.getUserLocation({fetchAddress:o.fetchAddress,receivedPosition:o.receivedPosition?n=>o.receivedPosition(f.fromNative(n)):void 0,receivedAddress:o.receivedAddress?n=>o.receivedAddress({address:n.address,latlng:f.fromNative(n.latlng),viewport:k.fromNative(n.viewport)}):void 0,positionFail:o.positionFail,addressFail:o.addressFail})}getNative(){return this._native}};w._instance=null;let $=w;class rt{constructor(){this._native=null,this._map=null,this._markers=[]}async init(o){const n=await S();o.getNative()&&(this._map=o,this._native=new n.Clusterer({map:o.getNative()}),this._native&&(this._native._onClusterClick=()=>{this._onClusterClick?.()},this._native._onNonExpandableClusterClick=t=>{if(this._onNonExpandableClusterClick){const i=this._markers.filter(r=>t.some(s=>s===r.getNative()));this._onNonExpandableClusterClick(i)}}))}addMarkers(o){if(this._markers.push(...o),this._native){const n=o.map(t=>t.getNative()).filter(t=>t!==null);this._native.addMarkers(n)}}clearMarkers(){this._markers.forEach(o=>o.remove()),this._markers=[],this._native&&(this._native.markers=[])}render(){this._native?.render()}set onClusterClick(o){this._onClusterClick=o,this._native&&(this._native._onClusterClick=o)}set onNonExpandableClusterClick(o){this._onNonExpandableClusterClick=o}getMarkers(){return this._markers}getMap(){return this._map}getNative(){return this._native}}function at(e){$.getInstance().getUserLocation(e)}function F(e,o){if(o.length===0)return;if(o.length===1){const t=o[0].getPosition();t&&(e.panTo(t),e.setZoom(15));return}const n=new k;o.forEach(t=>{const i=t.getPosition();i&&n.extend(i)}),n.empty()||(e.fitBounds(n),setTimeout(()=>{const t=e.getZoom(),i=e.getMaxZoom(),r=e.getMinZoom();t>i&&e.setZoom(i),t<r&&e.setZoom(r)}))}const M={};function lt(){return window.Voxel_Config?.ajax_url?window.Voxel_Config.ajax_url:`${window.location.origin}/?vx=1`}function ct(){return`<div class="ts-map-nav">
		<a href="#" class="ts-map-prev ts-icon-btn"><svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.746 6.00002C10.746 5.69663 10.5632 5.42312 10.2829 5.30707C10.0026 5.19101 9.67996 5.25526 9.4655 5.46986L3.51254 11.4266C3.35184 11.5642 3.25 11.7685 3.25 11.9966V11.9982C3.24959 12.1906 3.32276 12.3831 3.46949 12.53L9.46548 18.5302C9.67994 18.7448 10.0026 18.809 10.2829 18.693C10.5632 18.5769 10.746 18.3034 10.746 18L10.746 12.7466L20.0014 12.7466C20.4156 12.7466 20.7514 12.4108 20.7514 11.9966C20.7514 11.5824 20.4156 11.2466 20.0014 11.2466L10.746 11.2466V6.00002Z" fill="#343C54"/></svg></a>
		<a href="#" class="ts-map-next ts-icon-btn"><svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.5359 5.46986C14.3214 5.25526 13.9988 5.19101 13.7185 5.30707C13.4382 5.42312 13.2554 5.69663 13.2554 6.00002V11.2466L4 11.2466C3.58579 11.2466 3.25 11.5824 3.25 11.9966C3.25 12.4108 3.58579 12.7466 4 12.7466L13.2554 12.7466V18C13.2554 18.3034 13.4382 18.5769 13.7185 18.693C13.9988 18.809 14.3214 18.7448 14.5359 18.5302L20.5319 12.53C20.6786 12.3831 20.7518 12.1905 20.7514 11.9981L20.7514 11.9966C20.7514 11.7685 20.6495 11.5642 20.4888 11.4266L14.5359 5.46986Z" fill="#343C54"/></svg></a>
	</div>`}async function R(e,o,n,t,i){if(!o||o.length===0)return[];const r=[],s={};for(let a=0;a<o.length;a++){const l=o[a],d=i?.[a]||String(l.postId||""),c=l.uriencoded?decodeURIComponent(l.template):l.template,u={position:new f(l.lat,l.lng),template:c,onClick:(v,h)=>{if(!d){const p=h.getPosition();p&&(n.setPosition(p),n.setContent(c),n.show());return}r.forEach(p=>p.removeClass("marker-active")),h.addClass("marker-active"),e.addListener("click",function(){h.removeClass("marker-active"),n.hide()});const b=p=>{if(r.length>1){p.querySelector(".ts-map-nav")||p.insertAdjacentHTML("beforeend",ct());const Vt=p.querySelector(".ts-map-prev"),Et=p.querySelector(".ts-map-next"),z=Object.keys(s),P=z.indexOf(d);Vt?.addEventListener("click",I=>{if(I.preventDefault(),I.stopPropagation(),P!==-1){const W=P>0?P-1:z.length-1,V=s[z[W]];if(V){const B=V.getNative();B?.onClick&&B.onClick(new Event("click"),B)}}}),Et?.addEventListener("click",I=>{if(I.preventDefault(),I.stopPropagation(),P!==-1){const W=z.length>P+1?P+1:0,V=s[z[W]];if(V){const B=V.getNative();B?.onClick&&B.onClick(new Event("click"),B)}}})}const L=h.getPosition();L&&(n.setPosition(L),n.setContent(p),n.show())};if(M[d]){const p=document.createElement("div");p.className="ts-preview-popup",p.innerHTML=M[d],b(p);return}const _=document.querySelector(`.ts-preview[data-post-id="${d}"]`);if(_){const p=_.cloneNode(!0);p.classList.remove("ts-preview"),p.classList.add("ts-preview-popup"),p.removeAttribute("style"),M[d]=p.innerHTML,b(p);return}const j=document.createElement("div");j.className="ts-preview-popup ts-loading-popup",j.innerHTML='<span class="ts-loader"></span>';const Y=h.getPosition();Y&&(n.setPosition(Y),n.setContent(j),n.show());const It=lt();fetch(`${It}&action=get_preview_card&post_id=${d}`).then(p=>p.text()).then(p=>{const L=document.createElement("div");L.className="ts-preview-popup",L.innerHTML=p,M[d]=p,b(L)}).catch(()=>{const p=document.createElement("div");p.className="ts-preview-popup",M[d]="",b(p)})},data:{lat:l.lat,lng:l.lng,postId:d}},m=new nt(u);m.init(e),r.push(m),d&&(s[d]=m)}return t&&r.length>0&&t.addMarkers(r),r}function dt(){Object.keys(M).forEach(e=>delete M[e])}function ht(){if(typeof window<"u"&&window.wpApiSettings?.root)return window.wpApiSettings.root;if(typeof document<"u"){const e=document.querySelector('link[rel="https://api.w.org/"]');if(e){const o=e.getAttribute("href");if(o)return o}}if(typeof window<"u"&&window.location?.origin){const e=window.location.pathname.split("/").filter(Boolean),o=["wp-admin","wp-content","wp-includes","wp-json"];return e.length>0&&!o.includes(e[0])?window.location.origin+"/"+e[0]+"/wp-json/":window.location.origin+"/wp-json/"}return"/wp-json/"}const gt='<svg width="80" height="80" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg" transform="rotate(0 0 0)"><path d="M2 12.3906C2 6.86778 6.47715 2.39062 12 2.39062C17.5228 2.39062 22 6.86778 22 12.3906C22 17.9135 17.5228 22.3906 12 22.3906C6.47715 22.3906 2 17.9135 2 12.3906ZM15.5071 9.85447C15.2142 9.56158 14.7393 9.56158 14.4464 9.85447L10.9649 13.336L9.55359 11.9247C9.2607 11.6318 8.78582 11.6318 8.49293 11.9247C8.20004 12.2176 8.20004 12.6925 8.49294 12.9854L10.4346 14.927C10.7275 15.2199 11.2023 15.2199 11.4952 14.927L15.5071 10.9151C15.8 10.6222 15.8 10.1474 15.5071 9.85447Z" fill="#343C54"/></svg>',ut='<svg width="80" height="80" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg" transform="rotate(0 0 0)"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.25 2.75C6.14154 2.75 2 6.89029 2 11.998C2 17.1056 6.14154 21.2459 11.25 21.2459C13.5335 21.2459 15.6238 20.4187 17.2373 19.0475L20.7182 22.5287C21.011 22.8216 21.4859 22.8217 21.7788 22.5288C22.0717 22.2359 22.0718 21.761 21.7789 21.4681L18.2983 17.9872C19.6714 16.3736 20.5 14.2826 20.5 11.998C20.5 6.89029 16.3585 2.75 11.25 2.75ZM3.5 11.998C3.5 7.71905 6.96962 4.25 11.25 4.25C15.5304 4.25 19 7.71905 19 11.998C19 16.2769 15.5304 19.7459 11.25 19.7459C6.96962 19.7459 3.5 16.2769 3.5 11.998Z" fill="#343C54"/></svg>',mt='<svg width="24" height="24" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12.4025 9.44141C10.884 9.44141 9.65283 10.6727 9.65283 12.1914C9.65283 13.7101 10.884 14.9414 12.4025 14.9414C13.921 14.9414 15.1522 13.7101 15.1522 12.1914C15.1522 10.6727 13.921 9.44141 12.4025 9.44141Z" fill="currentColor"/><path d="M13.1523 2.19141C13.1523 1.77719 12.8166 1.44141 12.4023 1.44141C11.9881 1.44141 11.6523 1.77719 11.6523 2.19141V3.72405C7.5566 4.0822 4.29367 7.34575 3.93549 11.4414H2.40234C1.98813 11.4414 1.65234 11.7772 1.65234 12.1914C1.65234 12.6056 1.98813 12.9414 2.40234 12.9414H3.93545C4.29344 17.0373 7.55645 20.301 11.6523 20.6592V22.1914C11.6523 22.6056 11.9881 22.9414 12.4023 22.9414C12.8166 22.9414 13.1523 22.6056 13.1523 22.1914V20.6592C17.2482 20.301 20.5113 17.0373 20.8692 12.9414H22.4023C22.8166 12.9414 23.1523 12.6056 23.1523 12.1914C23.1523 11.7772 22.8166 11.4414 22.4023 11.4414H20.8692C20.511 7.34575 17.2481 4.0822 13.1523 3.72405V2.19141ZM12.4025 7.94141C14.7496 7.94141 16.6522 9.84446 16.6522 12.1914C16.6522 14.5383 14.7496 16.4414 12.4025 16.4414C10.0554 16.4414 8.15283 14.5384 8.15283 12.1914C8.15283 9.84446 10.0554 7.94141 12.4025 7.94141ZM12.4025 9.44141C10.884 9.44141 9.65283 10.6727 9.65283 12.1914C9.65283 13.7101 10.884 14.9414 12.4025 14.9414C13.921 14.9414 15.1522 13.7101 15.1522 12.1914C15.1522 10.6727 13.921 9.44141 12.4025 9.44141Z" fill="currentColor"/></svg>';function D(e,o=""){return!e||!e.value?o:e.library==="icon"||!e.library||e.library===""||e.library==="fa-solid"||e.library==="fa-regular"||e.library==="fa-brands"||e.library==="line-awesome"?`<i class="${e.value}"></i>`:e.library==="svg"&&e.value?e.value.startsWith("<svg")||e.value.startsWith("<?xml")?`<span class="ts-icon-svg">${e.value}</span>`:`<img src="${e.value}" alt="" class="ts-icon-svg" />`:e.library==="dynamic"?`<i class="${e.value}"></i>`:o}Z();function vt(){const e="voxel-fse-map-geolocate-css";if(document.getElementById(e))return;const o=document.createElement("style");o.id=e,o.textContent=`
		/* Hide Google Maps native Map/Satellite toggle button (matches Voxel behavior) */
		.gm-style-mtc-bbw { display: none; }
		/* FSE Map Block: Force geolocate button to be visible when map is loaded */
		.voxel-fse-map.elementor-widget-ts-map .vx-geolocate-me:not(.hidden),
		.voxel-fse-map .vx-geolocate-me:not(.hidden) {
			display: flex !important;
		}
		/* Loading state */
		.voxel-fse-map .vx-geolocate-me.loading {
			opacity: 0.5;
			pointer-events: none;
		}
		.voxel-fse-map .vx-geolocate-me.loading svg {
			animation: vx-spin 1s linear infinite;
		}
		@keyframes vx-spin {
			from { transform: rotate(0deg); }
			to { transform: rotate(360deg); }
		}
		/* FSE popup: re-enable pointer-events on block content
		   Voxel parent targets: .ts-preview-popup > .elementor { pointer-events: all }
		   FSE uses wp-block-* wrappers instead of .elementor */
		.ts-preview-popup > * {
			pointer-events: all;
		}
	`,document.head.appendChild(o)}function pt(){return ht()}function J(e){const o=e.querySelector("script.vxconfig");if(o&&o.textContent)try{return JSON.parse(o.textContent)}catch(n){console.error("[Map Block] Failed to parse vxconfig:",n)}return null}function ft(e,o){if(!e)return o;const n=typeof window<"u"?window.innerWidth:1200;let t="desktop";return n<768?t="mobile":n<1024&&(t="tablet"),t==="mobile"?e.mobile!==void 0?e.mobile:e.tablet!==void 0?e.tablet:e.desktop!==void 0?e.desktop:o:t==="tablet"&&e.tablet!==void 0?e.tablet:e.desktop!==void 0?e.desktop:o}function xt(e,o){if(!o.dragSearch||o.source!=="search-form")return null;const n=document.createElement("div");if(n.className="ts-map-drag",o.dragSearchMode==="automatic"){const t=o.dragSearchDefault==="checked",i=o.styles?.searchBtn?.checkmarkIcon,r=D(i,gt);n.innerHTML=`
			<a href="#" class="ts-map-btn ts-drag-toggle ${t?"active":""}">
				${r}
				Search as I move the map
			</a>
		`}else{const t=o.styles?.searchBtn?.searchIcon,i=D(t,ut);n.innerHTML=`
			<a href="#" class="ts-search-area hidden ts-map-btn">
				${i}
				Search this area
			</a>
		`}return e.insertBefore(n,e.firstChild),n}function _t(e,o){const n=document.createElement("a");n.href="#",n.rel="nofollow",n.role="button",n.className="vx-geolocate-me hidden",n.setAttribute("aria-label","Share your location");const t=o.styles?.geolocationIcon,i=D(t,mt);return n.innerHTML=i,n.addEventListener("click",r=>{r.preventDefault(),n.classList.add("loading"),at({fetchAddress:!0,receivedPosition:s=>{console.log("[Map Block] Got user position:",s.getLatitude(),s.getLongitude()),n.classList.remove("loading");const a=y.get(e.querySelector(".ts-map"));a&&(a.map.panTo(s),a.map.setZoom(15),a.circle&&(a.circle.setCenter(s),a.circle.show()))},receivedAddress:s=>{console.log("[Map Block] Got user address:",s.address),e.dispatchEvent(new CustomEvent("geolocation:address",{detail:{address:s.address,latlng:{lat:s.latlng.getLatitude(),lng:s.latlng.getLongitude()}},bubbles:!0}))},positionFail:()=>{console.warn("[Map Block] Failed to get user position"),n.classList.remove("loading");const s=window.Voxel_Config?.l10n?.positionFail||"Could not determine your location.";typeof window.Voxel?.alert=="function"&&window.Voxel.alert(s,"error")},addressFail:()=>{console.warn("[Map Block] Failed to get user address")}})}),e.appendChild(n),n}function Q(e,o,n){const t=document.createElement("div");return t.className=o.source==="current-post"?"ts-map ts-map-autoload":"ts-map",t.setAttribute("data-config",JSON.stringify(n)),e.appendChild(t),t}async function kt(e,o){const n=Nt();if(!n){console.warn("[Map Block] No post ID found for current-post mode");return}const i=`${pt()}voxel-fse/v1/map/post-location?post_id=${n}`;try{const r={},s=window.wpApiSettings?.nonce;s&&(r["X-WP-Nonce"]=s);const a=await fetch(i,{credentials:"same-origin",headers:r});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const l=await a.json(),d={center:{lat:l.latitude,lng:l.longitude},zoom:o.zoom,minZoom:o.minZoom,maxZoom:o.maxZoom,markers:[{lat:l.latitude,lng:l.longitude,template:encodeURIComponent(l.marker),uriencoded:!0}]};e.innerHTML="",Q(e,o,d).dispatchEvent(new CustomEvent("voxel:map-ready",{bubbles:!0}))}catch(r){console.error("[Map Block] Failed to fetch post location:",r)}}function yt(e,o){e.innerHTML="";let n=!0;const t=document.querySelector(`[data-post-to-map-id="${o.blockId}"]`);if(t){const c=t.getAttribute("data-enable-clusters");n=c!=="no",console.log("[Map Block] Read enableClusters from linked search-form:",n,"(attr:",c,")")}else console.log("[Map Block] No linked search-form found for blockId:",o.blockId,"- defaulting enableClusters=true");const i={center:o.center,zoom:o.zoom,minZoom:o.minZoom,maxZoom:o.maxZoom},r=xt(e,o),s=Q(e,o,i);_t(e,o);let a=[],l=!1;bt(s,i,e,o,n).then(()=>{if(l=!0,a.length>0){const c=a.flat();console.log("[Map Block] Processing",c.length,"queued markers after map init"),K(s,c),a=[]}});const d=o.blockId;d&&window.addEventListener("voxel-search-submit",(c=>{c.detail.targetId===d&&Mt(e,s,c.detail)})),console.log("[Map Block] Setting up voxel-fse:post-feed-markers listener"),window.addEventListener("voxel-fse:post-feed-markers",(c=>{console.log("[Map Block] Received voxel-fse:post-feed-markers event:",c.detail);const{markers:u}=c.detail;u.length>0?l?(console.log("[Map Block] Received",u.length,"markers from Post Feed - processing now"),K(s,u)):(console.log("[Map Block] Map not ready, queuing",u.length,"markers"),a.push(u)):console.log("[Map Block] Received empty markers array from Post Feed")})),r&&Pt(r,s)}const y=new Map;async function bt(e,o,n,t,i=!0){console.log("[Map Block] initializeVoxelMap called",{mapContainer:e,dataConfig:o});try{console.log("[Map Block] Waiting for Voxel.Maps..."),await S(),console.log("[Map Block] Voxel.Maps ready!")}catch(r){console.warn("[Map Block] Voxel.Maps not available:",r);return}try{const r=n.style.getPropertyValue("--vx-map-height"),s=window.getComputedStyle(n).getPropertyValue("--vx-map-height"),a=r||s||"400px";e.style.height=a,e.style.minHeight=a,n.style.width=n.style.width||"100%",console.log("[Map Block] Height values:",{inlineHeight:r,computedHeight:s,finalHeight:a,wrapperStyle:n.getAttribute("style")?.substring(0,100)});const l=new f(o.center.lat,o.center.lng);console.log("[Map Block] Center created:",l.getLatitude(),l.getLongitude());const d={el:e,center:l,zoom:o.zoom,minZoom:o.minZoom,maxZoom:o.maxZoom,draggable:!0};console.log("[Map Block] Creating VxMap with options:",{zoom:d.zoom,minZoom:d.minZoom,maxZoom:d.maxZoom});const c=new ot(d);console.log("[Map Block] VxMap instance created, calling init()..."),await c.init(),console.log("[Map Block] VxMap.init() completed, native map:",c.getNative()),e.style.height=a,e.style.minHeight=a,console.log("[Map Block] Height re-applied after map init:",a);let u=null;t.source==="search-form"&&i&&(u=new rt,await u.init(c),u.onClusterClick=()=>{console.log("[Map Block] Cluster clicked, zooming in")},u.onNonExpandableClusterClick=_=>{console.log("[Map Block] Non-expandable cluster clicked:",_.length,"markers")});const m=new it({});m.init(c);const v=new st({center:l,radius:5e3,className:"map-circle"});v.init(c),v.hide();const h={map:c,clusterer:u,markers:[],popup:m,circle:v,config:t};if(y.set(e,h),e._voxelMap=c.getNative(),e._vxMapInstance=h,c.addListener("zoom_changed",()=>{u&&u.render()}),c.addListener("idle",()=>{n.querySelector(".ts-drag-toggle.active")&&t.dragSearchMode==="automatic"&&Ct(n,c,t)}),c.addListener("bounds_changed",()=>{const _=n.querySelector(".ts-search-area");_&&t.dragSearchMode==="manual"&&_.classList.remove("hidden")}),c.addListener("click",()=>{m.hide()}),o.markers&&o.markers.length>0){const _=await R(c,o.markers,m,u);h.markers=_,u&&_.length>0&&u.render(),_.length>0&&F(c,_)}console.log("[Map Block] Map initialized successfully with all features");const b=n.querySelector(".vx-geolocate-me");b?(b.classList.remove("hidden"),b.style.display="flex",console.log("[Map Block] Geolocate button shown")):console.warn("[Map Block] Geolocate button not found in wrapper")}catch(r){console.error("[Map Block] Failed to initialize map:",r)}}function Ct(e,o,n){const t=o.getBounds();if(!t)return;const i=t.getSouthWest(),r=t.getNorthEast();if(!i||!r)return;const s={bounds:{sw:{lat:i.getLatitude(),lng:i.getLongitude()},ne:{lat:r.getLatitude(),lng:r.getLongitude()}},center:{lat:o.getCenter()?.getLatitude(),lng:o.getCenter()?.getLongitude()},zoom:o.getZoom()};e.dispatchEvent(new CustomEvent("map:bounds-changed",{detail:s,bubbles:!0}))}async function Mt(e,o,n,t){console.log("[Map Block] Search submitted:",n);const i=y.get(o);if(!i){console.warn("[Map Block] No map instance found");return}i.clusterer?i.clusterer.clearMarkers():i.markers.forEach(s=>s.remove()),i.markers=[],i.popup?.hide();const r=e.closest(".ts-map-widget");r&&r.dispatchEvent(new CustomEvent("search:updated",{detail:n,bubbles:!0}))}async function wt(e,o){const n=e.querySelector(".ts-map");if(!n)return;const t=y.get(n);if(!t)return;t.clusterer?t.clusterer.clearMarkers():t.markers.forEach(s=>s.remove()),t.markers=[];const i=o.map(s=>({lat:s.lat,lng:s.lng,template:s.template,uriencoded:!1})),r=await R(t.map,i,t.popup,t.clusterer);t.markers=r,t.clusterer&&r.length>0&&t.clusterer.render(),r.length>0&&F(t.map,r)}async function K(e,o){const n=y.get(e);if(!n){console.warn("[Map Block] displayMarkersFromFeed: No map instance found");return}if(console.log("[Map Block] Displaying",o.length,"markers from feed"),n.clusterer?n.clusterer.clearMarkers():n.markers.forEach(s=>s.remove()),n.markers=[],n.popup?.hide(),o.length===0){console.log("[Map Block] No markers to display");return}dt();const t=o.map(s=>({lat:s.lat,lng:s.lng,template:s.template,uriencoded:!1})),i=o.map(s=>s.postId),r=await R(n.map,t,n.popup,n.clusterer,i);n.markers=r,n.clusterer&&r.length>0&&n.clusterer.render(),r.length>0&&F(n.map,r),console.log("[Map Block] Successfully displayed",r.length,"markers from feed")}function Bt(e,o,n){const t=e.querySelector(".ts-map");if(!t)return;const i=y.get(t);i?.circle&&(i.circle.setCenter(new f(o.lat,o.lng)),i.circle.setRadius(n),i.circle.show())}function St(e){const o=e.querySelector(".ts-map");if(!o)return;y.get(o)?.circle?.hide()}function Lt(e){const o=e.querySelector(".ts-map");if(o)return y.get(o)}function Pt(e,o,n){const t=e.querySelector(".ts-drag-toggle"),i=e.querySelector(".ts-search-area");t&&t.addEventListener("click",r=>{r.preventDefault(),t.classList.toggle("active")}),i&&i.addEventListener("click",r=>{r.preventDefault();const s=o.closest(".ts-map-widget");s&&s.dispatchEvent(new CustomEvent("search:area",{bubbles:!0}))})}function Nt(){const e=document.body.className.split(" ");for(const n of e){const t=n.match(/^postid-(\d+)$/);if(t)return parseInt(t[1],10)}const o=document.querySelector("[data-post-id]");if(o){const n=o.getAttribute("data-post-id");if(n)return parseInt(n,10)}if(typeof window<"u"){const n=window.wp_post_id;if(n)return n}return null}function zt(e){const o=document.createElement("div");o.className="ts-map ts-map-loading",o.innerHTML=`
		<div class="ts-no-posts">
			<span class="ts-loader" aria-label="Loading map..."></span>
		</div>
	`,e.appendChild(o)}function E(){vt(),document.querySelectorAll(".voxel-fse-map").forEach(o=>{if(o.getAttribute("data-hydrated")==="true")return;const n=J(o);if(!n){console.warn("[Map Block] No vxconfig found for container:",o);return}const t=O(n);o.setAttribute("data-hydrated","true"),U(o,t),o.innerHTML="",zt(o),t.source==="current-post"?kt(o,t):yt(o,t),requestAnimationFrame(()=>{window.jQuery&&window.jQuery(document).trigger("voxel:markup-update")})})}function A(e){et()?S().then(e).catch(()=>{console.warn("[Map Block] Voxel.Maps not available, initializing anyway"),e()}):(document.addEventListener("maps:loaded",()=>{S().then(e).catch(e)},{once:!0}),setTimeout(()=>{S().then(e).catch(e)},1e4))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{A(E)}):A(E),window.addEventListener("turbo:load",()=>{A(E)}),window.addEventListener("pjax:complete",()=>{A(E)});let X;return window.addEventListener("resize",()=>{clearTimeout(X),X=setTimeout(()=>{document.querySelectorAll('.voxel-fse-map[data-hydrated="true"]').forEach(o=>{if(o.getAttribute("data-hydrated")!=="true")return;const t=J(o);if(t){const i=O(t);U(o,i)}})},250)}),C.getMapInstance=Lt,C.getResponsiveValueClient=ft,C.hideRadiusCircle=St,C.showRadiusCircle=Bt,C.updateMapMarkers=wt,Object.defineProperty(C,Symbol.toStringTag,{value:"Module"}),C})({});
