(function(){"use strict";function M(){if(typeof window<"u"&&window.wpApiSettings?.root)return window.wpApiSettings.root.replace(/\/wp-json\/?$/,"")+"?vx=1";if(typeof document<"u"){const e=document.querySelector('link[rel="https://api.w.org/"]');if(e){const o=e.getAttribute("href");if(o)return o.replace(/\/wp-json\/?$/,"")+"?vx=1"}}return typeof window<"u"?window.location.origin+"?vx=1":"/?vx=1"}function C(){const e=M();try{return new URL(e).pathname.replace(/\/$/,"")}catch{return""}}function P(){if(typeof window<"u"&&window.wpApiSettings?.root)return window.wpApiSettings.root;if(typeof document<"u"){const o=document.querySelector('link[rel="https://api.w.org/"]');if(o){const t=o.getAttribute("href");if(t)return t}}const e=C();return typeof window<"u"?window.location.origin+e+"/wp-json/":"/wp-json/"}function B(){return P()}function h(e){const o=e.querySelector("script.vxconfig");if(o&&o.textContent)try{return JSON.parse(o.textContent)}catch(t){console.error("[Map Block] Failed to parse vxconfig:",t)}return null}function S(){const e=window.innerWidth;return e<768?"mobile":e<1024?"tablet":"desktop"}function r(e,o){if(!e)return o;const t=S();return t==="mobile"?e.mobile??e.tablet??e.desktop??o:t==="tablet"?e.tablet??e.desktop??o:e.desktop??o}function p(e){if(!e?.enable)return"none";const{horizontal:o=0,vertical:t=0,blur:n=0,spread:c=0,color:s="rgba(0,0,0,0.1)",position:i}=e;return`${i==="inset"?"inset ":""}${o}px ${t}px ${n}px ${c}px ${s}`}function y(e,o){e.style.width="100%";const t=o.styles;if(!t)return;const n=r(t.height,400),c=t.heightUnit||"px",s=r(t.enableCalcHeight,!1),i=r(t.calcHeight,"");s&&i?e.style.setProperty("--vx-map-height",i):e.style.setProperty("--vx-map-height",`${n}${c}`);const f=r(t.borderRadius,0);if(e.style.setProperty("--vx-map-radius",`${f}px`),t.cluster){const a=r(t.cluster.size,40);e.style.setProperty("--vx-cluster-size",`${a}px`);const l=r(t.cluster.bgColor,"");l&&e.style.setProperty("--vx-cluster-bg",l);const d=r(t.cluster.radius,50);e.style.setProperty("--vx-cluster-radius",`${d}%`);const u=r(t.cluster.textColor,"");u&&e.style.setProperty("--vx-cluster-text-color",u),e.style.setProperty("--vx-cluster-shadow",p(t.cluster.shadow))}if(t.iconMarker){const a=r(t.iconMarker.size,42);e.style.setProperty("--vx-icon-marker-size",`${a}px`);const l=r(t.iconMarker.iconSize,24);e.style.setProperty("--vx-icon-marker-icon-size",`${l}px`);const d=r(t.iconMarker.radius,50);e.style.setProperty("--vx-icon-marker-radius",`${d}%`),e.style.setProperty("--vx-icon-marker-shadow",p(t.iconMarker.shadow));const u=r(t.iconMarker.staticBg,"");u&&e.style.setProperty("--vx-icon-marker-bg",u);const v=r(t.iconMarker.staticBgActive,"");v&&e.style.setProperty("--vx-icon-marker-bg-active",v);const w=r(t.iconMarker.staticIconColor,"");w&&e.style.setProperty("--vx-icon-marker-icon-color",w);const k=r(t.iconMarker.staticIconColorActive,"");k&&e.style.setProperty("--vx-icon-marker-icon-color-active",k)}if(t.textMarker){const a=r(t.textMarker.bgColor,"");a&&e.style.setProperty("--vx-text-marker-bg",a);const l=r(t.textMarker.bgColorActive,"");l&&e.style.setProperty("--vx-text-marker-bg-active",l);const d=r(t.textMarker.textColor,"");d&&e.style.setProperty("--vx-text-marker-text-color",d);const u=r(t.textMarker.textColorActive,"");u&&e.style.setProperty("--vx-text-marker-text-color-active",u);const v=r(t.textMarker.radius,4);e.style.setProperty("--vx-text-marker-radius",`${v}px`),e.style.setProperty("--vx-text-marker-shadow",p(t.textMarker.shadow))}if(t.imageMarker){const a=r(t.imageMarker.size,42);e.style.setProperty("--vx-image-marker-size",`${a}px`);const l=r(t.imageMarker.radius,50);e.style.setProperty("--vx-image-marker-radius",`${l}%`),e.style.setProperty("--vx-image-marker-shadow",p(t.imageMarker.shadow))}if(t.popup){const a=r(t.popup.cardWidth,320);e.style.setProperty("--vx-popup-card-width",`${a}px`),t.popup.loaderColor1&&e.style.setProperty("--vx-popup-loader-color1",t.popup.loaderColor1),t.popup.loaderColor2&&e.style.setProperty("--vx-popup-loader-color2",t.popup.loaderColor2)}if(t.searchBtn){const a=r(t.searchBtn.textColor,"");a&&e.style.setProperty("--vx-search-btn-text-color",a);const l=r(t.searchBtn.bgColor,"");l&&e.style.setProperty("--vx-search-btn-bg",l);const d=r(t.searchBtn.iconColor,"");d&&e.style.setProperty("--vx-search-btn-icon-color",d);const u=r(t.searchBtn.iconColorActive,"");u&&e.style.setProperty("--vx-search-btn-icon-color-active",u);const v=r(t.searchBtn.radius,4);e.style.setProperty("--vx-search-btn-radius",`${v}px`)}if(t.navBtn){t.navBtn.iconColor&&e.style.setProperty("--vx-nav-btn-icon-color",t.navBtn.iconColor),t.navBtn.iconColorHover&&e.style.setProperty("--vx-nav-btn-icon-color-hover",t.navBtn.iconColorHover);const a=r(t.navBtn.iconSize,20);e.style.setProperty("--vx-nav-btn-icon-size",`${a}px`),t.navBtn.bgColor&&e.style.setProperty("--vx-nav-btn-bg",t.navBtn.bgColor),t.navBtn.bgColorHover&&e.style.setProperty("--vx-nav-btn-bg-hover",t.navBtn.bgColorHover);const l=r(t.navBtn.radius,4);e.style.setProperty("--vx-nav-btn-radius",`${l}px`);const d=r(t.navBtn.size,36);e.style.setProperty("--vx-nav-btn-size",`${d}px`),e.style.setProperty("--vx-nav-btn-shadow",p(t.navBtn.shadow))}}function z(e,o){if(!o.dragSearch||o.source!=="search-form")return null;const t=document.createElement("div");if(t.className="ts-map-drag",o.dragSearchMode==="automatic"){const n=o.dragSearchDefault==="checked";t.innerHTML=`
			<a href="#" class="ts-map-btn ts-drag-toggle ${n?"active":""}">
				<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="ts-checkmark-icon">
					<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
				</svg>
				Search as I move the map
			</a>
		`}else t.innerHTML=`
			<a href="#" class="ts-search-area hidden ts-map-btn">
				<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="ts-search-icon">
					<path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
				</svg>
				Search this area
			</a>
		`;return e.insertBefore(t,e.firstChild),t}function $(e){const o=document.createElement("a");return o.href="#",o.rel="nofollow",o.role="button",o.className="vx-geolocate-me hidden",o.setAttribute("aria-label","Share your location"),o.innerHTML=`
		<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
			<path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>
		</svg>
	`,e.appendChild(o),o}function g(e,o,t){const n=document.createElement("div");return n.className=o.source==="current-post"?"ts-map ts-map-autoload":"ts-map",n.setAttribute("data-config",JSON.stringify(t)),e.appendChild(n),n}async function L(e,o){const t=V();if(!t){console.warn("[Map Block] No post ID found for current-post mode");return}const c=`${B()}voxel-fse/v1/map/post-location?post_id=${t}`;try{const s=await fetch(c);if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const i=await s.json(),f={center:{lat:i.latitude,lng:i.longitude},zoom:o.zoom,minZoom:o.minZoom,maxZoom:o.maxZoom,markers:[{lat:i.latitude,lng:i.longitude,template:encodeURIComponent(i.marker),uriencoded:!0}]};e.innerHTML="",g(e,o,f).dispatchEvent(new CustomEvent("voxel:map-ready",{bubbles:!0}))}catch(s){console.error("[Map Block] Failed to fetch post location:",s)}}function I(e,o){e.innerHTML="";const t={center:o.center,zoom:o.zoom,minZoom:o.minZoom,maxZoom:o.maxZoom},n=z(e,o),c=g(e,o,t);$(e),A(c,t,e);const s=o.searchFormId;s&&window.addEventListener("voxel-search-submit",(i=>{i.detail.targetId===s&&E(e,c,i.detail)})),n&&H(n,c)}function A(e,o,t){if(!window.Voxel?.Maps){console.warn("[Map Block] Voxel.Maps not available");return}window.Voxel.Maps.await(()=>{try{const c=t.style.getPropertyValue("--vx-map-height")||"400px";e.style.height=c;const s=new window.Voxel.Maps.LatLng(o.center.lat,o.center.lng),i=new window.Voxel.Maps.Map({el:e,center:s,zoom:o.zoom,minZoom:o.minZoom,maxZoom:o.maxZoom});e._voxelMap=i,console.log("[Map Block] Map initialized successfully")}catch(n){console.error("[Map Block] Failed to initialize map:",n)}})}function E(e,o,t,n){console.log("[Map Block] Search submitted:",t);const c=e.closest(".ts-map-widget");c&&c.dispatchEvent(new CustomEvent("search:updated",{detail:t,bubbles:!0}))}function H(e,o,t){const n=e.querySelector(".ts-drag-toggle"),c=e.querySelector(".ts-search-area");n&&n.addEventListener("click",s=>{s.preventDefault(),n.classList.toggle("active")}),c&&c.addEventListener("click",s=>{s.preventDefault();const i=o.closest(".ts-map-widget");i&&i.dispatchEvent(new CustomEvent("search:area",{bubbles:!0}))})}function V(){const e=document.body.className.split(" ");for(const t of e){const n=t.match(/^postid-(\d+)$/);if(n)return parseInt(n[1],10)}const o=document.querySelector("[data-post-id]");if(o){const t=o.getAttribute("data-post-id");if(t)return parseInt(t,10)}if(typeof window<"u"){const t=window.wp_post_id;if(t)return t}return null}function m(){document.querySelectorAll(".voxel-fse-map").forEach(o=>{if(o.dataset.hydrated==="true")return;const t=h(o);if(!t){console.warn("[Map Block] No vxconfig found for container:",o);return}o.dataset.hydrated="true",y(o,t),t.source==="current-post"?L(o,t):I(o,t),requestAnimationFrame(()=>{window.jQuery&&window.jQuery(document).trigger("voxel:markup-update")})})}function x(e){if(window.Voxel?.Maps)window.Voxel.Maps.await(e);else{document.addEventListener("maps:loaded",e,{once:!0});const o=setInterval(()=>{window.Voxel?.Maps&&(clearInterval(o),window.Voxel.Maps.await(e))},100);setTimeout(()=>{clearInterval(o),e()},1e4)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{x(m)}):x(m),window.addEventListener("turbo:load",()=>{x(m)}),window.addEventListener("pjax:complete",()=>{x(m)});let b;window.addEventListener("resize",()=>{clearTimeout(b),b=setTimeout(()=>{document.querySelectorAll('.voxel-fse-map[data-hydrated="true"]').forEach(o=>{const t=h(o);t&&y(o,t)})},250)})})();
