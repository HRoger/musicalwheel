var VoxelFSEMap=(function(x){"use strict";let N=!1;function w(){if(N)return!0;if(!window.Voxel?.mixins?.base)return!1;const o=window.Voxel.mixins.base;return o.mounted&&!o._originalMounted?(o._originalMounted=o.mounted,o.mounted=function(){try{const e=this.$root?.$options?.el||this.$el;if(e){const i=e.closest?.(".elementor-element");if(i)this.widget_id=i.dataset?.id||"";else{const n=e.closest?.("[data-block-id]");this.widget_id=n&&n.dataset?.blockId||""}const t=e.closest?.(".elementor");if(t)this.post_id=t.dataset?.elementorId||"";else{const n=document.body.className.match(/postid-(\d+)/);this.post_id=n?n[1]:""}}o._originalMounted&&o._originalMounted!==o.mounted&&o._originalMounted.call(this)}catch(e){console.warn("[VoxelShim] Error in patched mounted():",e),this.widget_id="",this.post_id=""}},N=!0,console.log("[VoxelShim] Successfully patched Voxel.mixins.base.mounted"),!0):!1}function S(){if(w())return;let o=0;const e=50,t=setInterval(()=>{if(o++,w()){clearInterval(t);return}o>=e&&(clearInterval(t),console.warn("[VoxelShim] Voxel.mixins.base not found after 5 seconds"))},100);typeof document<"u"&&document.addEventListener("voxel:ready",()=>{w(),clearInterval(t)},{once:!0})}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",S,{once:!0}):S());function $(){if(typeof window>"u")return"desktop";const o=window.innerWidth;return o<768?"mobile":o<1024?"tablet":"desktop"}function c(o,e){if(!o)return e;const i=$();return i==="mobile"?o.mobile!==void 0?o.mobile:o.tablet!==void 0?o.tablet:o.desktop!==void 0?o.desktop:e:i==="tablet"&&o.tablet!==void 0?o.tablet:o.desktop!==void 0?o.desktop:e}function M(o){if(!o?.enable)return"none";const{horizontal:e=0,vertical:i=0,blur:t=0,spread:n=0,color:r="rgba(0,0,0,0.1)",position:s}=o;return`${s==="inset"?"inset ":""}${e}px ${i}px ${t}px ${n}px ${r}`}function P(o){if(!o)return{};const e={};return o.fontFamily&&(e["font-family"]=o.fontFamily),o.fontSize&&(e["font-size"]=`${o.fontSize}${o.fontSizeUnit||"px"}`),o.fontWeight&&(e["font-weight"]=o.fontWeight),o.fontStyle&&(e["font-style"]=o.fontStyle),o.textTransform&&(e["text-transform"]=o.textTransform),o.textDecoration&&(e["text-decoration"]=o.textDecoration),o.lineHeight&&(e["line-height"]=`${o.lineHeight}${o.lineHeightUnit||""}`),o.letterSpacing&&(e["letter-spacing"]=`${o.letterSpacing}${o.letterSpacingUnit||"px"}`),e}function L(o,e){o.style.width="100%";const i=e.styles;if(!i)return;const t=c(i.height,400),n=i.heightUnit||"px",r=c(i.enableCalcHeight,!1),s=c(i.calcHeight,"");r&&s?o.style.setProperty("--vx-map-height",s):o.style.setProperty("--vx-map-height",`${t}${n}`);const l=c(i.borderRadius,0);if(o.style.setProperty("--vx-map-radius",`${l}px`),i.cluster){const d=c(i.cluster.size,40);o.style.setProperty("--vx-cluster-size",`${d}px`);const h=c(i.cluster.bgColor,"");h&&o.style.setProperty("--vx-cluster-bg",h);const v=c(i.cluster.radius,50);o.style.setProperty("--vx-cluster-radius",`${v}%`);const m=c(i.cluster.textColor,"");if(m&&o.style.setProperty("--vx-cluster-text-color",m),o.style.setProperty("--vx-cluster-shadow",M(i.cluster.shadow)),i.cluster.typography){const g=P(i.cluster.typography);g["font-family"]&&o.style.setProperty("--vx-cluster-font-family",g["font-family"]),g["font-size"]&&o.style.setProperty("--vx-cluster-font-size",g["font-size"]),g["font-weight"]&&o.style.setProperty("--vx-cluster-font-weight",g["font-weight"]),g["font-style"]&&o.style.setProperty("--vx-cluster-font-style",g["font-style"]),g["line-height"]&&o.style.setProperty("--vx-cluster-line-height",g["line-height"]),g["letter-spacing"]&&o.style.setProperty("--vx-cluster-letter-spacing",g["letter-spacing"]),g["text-transform"]&&o.style.setProperty("--vx-cluster-text-transform",g["text-transform"]),g["text-decoration"]&&o.style.setProperty("--vx-cluster-text-decoration",g["text-decoration"])}}if(i.iconMarker){const d=c(i.iconMarker.size,42);o.style.setProperty("--vx-icon-marker-size",`${d}px`);const h=c(i.iconMarker.iconSize,24);o.style.setProperty("--vx-icon-marker-icon-size",`${h}px`);const v=c(i.iconMarker.radius,50);o.style.setProperty("--vx-icon-marker-radius",`${v}%`),o.style.setProperty("--vx-icon-marker-shadow",M(i.iconMarker.shadow));const m=c(i.iconMarker.staticBg,"");m&&o.style.setProperty("--vx-icon-marker-bg",m);const g=c(i.iconMarker.staticBgActive,"");g&&o.style.setProperty("--vx-icon-marker-bg-active",g);const u=c(i.iconMarker.staticIconColor,"");u&&o.style.setProperty("--vx-icon-marker-icon-color",u);const a=c(i.iconMarker.staticIconColorActive,"");a&&o.style.setProperty("--vx-icon-marker-icon-color-active",a)}if(i.textMarker){const d=c(i.textMarker.bgColor,"");d&&o.style.setProperty("--vx-text-marker-bg",d);const h=c(i.textMarker.bgColorActive,"");h&&o.style.setProperty("--vx-text-marker-bg-active",h);const v=c(i.textMarker.textColor,"");v&&o.style.setProperty("--vx-text-marker-text-color",v);const m=c(i.textMarker.textColorActive,"");m&&o.style.setProperty("--vx-text-marker-text-color-active",m);const g=c(i.textMarker.radius,4);if(o.style.setProperty("--vx-text-marker-radius",`${g}px`),o.style.setProperty("--vx-text-marker-shadow",M(i.textMarker.shadow)),i.textMarker.typography){const a=P(i.textMarker.typography);a["font-family"]&&o.style.setProperty("--vx-text-marker-font-family",a["font-family"]),a["font-size"]&&o.style.setProperty("--vx-text-marker-font-size",a["font-size"]),a["font-weight"]&&o.style.setProperty("--vx-text-marker-font-weight",a["font-weight"]),a["font-style"]&&o.style.setProperty("--vx-text-marker-font-style",a["font-style"]),a["line-height"]&&o.style.setProperty("--vx-text-marker-line-height",a["line-height"]),a["letter-spacing"]&&o.style.setProperty("--vx-text-marker-letter-spacing",a["letter-spacing"]),a["text-transform"]&&o.style.setProperty("--vx-text-marker-text-transform",a["text-transform"]),a["text-decoration"]&&o.style.setProperty("--vx-text-marker-text-decoration",a["text-decoration"])}const u=c(i.textMarker.padding,{});if(u){const a=u;a.top&&o.style.setProperty("--vx-text-marker-padding-top",a.top),a.right&&o.style.setProperty("--vx-text-marker-padding-right",a.right),a.bottom&&o.style.setProperty("--vx-text-marker-padding-bottom",a.bottom),a.left&&o.style.setProperty("--vx-text-marker-padding-left",a.left)}}if(i.imageMarker){const d=c(i.imageMarker.size,42);o.style.setProperty("--vx-image-marker-size",`${d}px`);const h=c(i.imageMarker.radius,50);o.style.setProperty("--vx-image-marker-radius",`${h}%`),o.style.setProperty("--vx-image-marker-shadow",M(i.imageMarker.shadow))}if(i.popup){const d=c(i.popup.cardWidth,320);o.style.setProperty("--vx-popup-card-width",`${d}px`),i.popup.loaderColor1&&o.style.setProperty("--vx-popup-loader-color1",i.popup.loaderColor1),i.popup.loaderColor2&&o.style.setProperty("--vx-popup-loader-color2",i.popup.loaderColor2)}if(i.searchBtn){const d=c(i.searchBtn.textColor,"");d&&o.style.setProperty("--vx-search-btn-text-color",d);const h=c(i.searchBtn.bgColor,"");h&&o.style.setProperty("--vx-search-btn-bg",h);const v=c(i.searchBtn.iconColor,"");v&&o.style.setProperty("--vx-search-btn-icon-color",v);const m=c(i.searchBtn.iconColorActive,"");m&&o.style.setProperty("--vx-search-btn-icon-color-active",m);const g=c(i.searchBtn.radius,4);if(o.style.setProperty("--vx-search-btn-radius",`${g}px`),i.searchBtn.typography){const u=P(i.searchBtn.typography);u["font-family"]&&o.style.setProperty("--vx-search-btn-font-family",u["font-family"]),u["font-size"]&&o.style.setProperty("--vx-search-btn-font-size",u["font-size"]),u["font-weight"]&&o.style.setProperty("--vx-search-btn-font-weight",u["font-weight"]),u["font-style"]&&o.style.setProperty("--vx-search-btn-font-style",u["font-style"]),u["line-height"]&&o.style.setProperty("--vx-search-btn-line-height",u["line-height"]),u["letter-spacing"]&&o.style.setProperty("--vx-search-btn-letter-spacing",u["letter-spacing"]),u["text-transform"]&&o.style.setProperty("--vx-search-btn-text-transform",u["text-transform"]),u["text-decoration"]&&o.style.setProperty("--vx-search-btn-text-decoration",u["text-decoration"])}if(i.searchBtn.checkmarkIcon){const u=i.searchBtn.checkmarkIcon;o.dataset.checkmarkIcon=JSON.stringify(u)}}if(i.navBtn){i.navBtn.iconColor&&o.style.setProperty("--vx-nav-btn-icon-color",i.navBtn.iconColor),i.navBtn.iconColorHover&&o.style.setProperty("--vx-nav-btn-icon-color-hover",i.navBtn.iconColorHover);const d=c(i.navBtn.iconSize,20);o.style.setProperty("--vx-nav-btn-icon-size",`${d}px`),i.navBtn.bgColor&&o.style.setProperty("--vx-nav-btn-bg",i.navBtn.bgColor),i.navBtn.bgColorHover&&o.style.setProperty("--vx-nav-btn-bg-hover",i.navBtn.bgColorHover);const h=c(i.navBtn.radius,4);o.style.setProperty("--vx-nav-btn-radius",`${h}px`);const v=c(i.navBtn.size,36);if(o.style.setProperty("--vx-nav-btn-size",`${v}px`),o.style.setProperty("--vx-nav-btn-shadow",M(i.navBtn.shadow)),i.navBtn.borderType&&i.navBtn.borderType!=="none"){o.style.setProperty("--vx-nav-btn-border-style",i.navBtn.borderType);const m=c(i.navBtn.borderWidth,0);o.style.setProperty("--vx-nav-btn-border-width",`${m}px`),i.navBtn.borderColor&&o.style.setProperty("--vx-nav-btn-border-color",i.navBtn.borderColor),i.navBtn.borderColorHover&&o.style.setProperty("--vx-nav-btn-border-color-hover",i.navBtn.borderColorHover)}}}function V(o){const e=o.center||{},i={lat:Number(o.lat||e.lat||e.latitude||51.492),lng:Number(o.lng||e.lng||e.longitude||-.13)},t=o.styles||{},n=(s,l)=>s?{desktop:s.desktop!==void 0?s.desktop:l,tablet:s.tablet!==void 0?s.tablet:s.desktop!==void 0?s.desktop:l,mobile:s.mobile!==void 0?s.mobile:s.tablet!==void 0?s.tablet:s.desktop!==void 0?s.desktop:l}:{desktop:l,tablet:l,mobile:l},r=s=>s?{enable:!!s.enable,horizontal:Number(s.horizontal||s.h||0),vertical:Number(s.vertical||s.v||0),blur:Number(s.blur||0),spread:Number(s.spread||0),color:String(s.color||"rgba(0,0,0,0.1)"),position:s.position||(s.inset?"inset":"outline")}:{enable:!1};return{blockId:String(o.blockId||o.block_id||""),source:o.source||"search-form",center:i,zoom:Number(o.zoom||o.initialZoom||11),minZoom:Number(o.minZoom||o.min_zoom||2),maxZoom:Number(o.maxZoom||o.max_zoom||18),dragSearch:o.dragSearch!==void 0?!!o.dragSearch:o.drag_search!==void 0?!!o.drag_search:!0,dragSearchMode:o.dragSearchMode||o.drag_search_mode||"manual",dragSearchDefault:o.dragSearchDefault||o.drag_search_default||"unchecked",searchFormId:String(o.searchFormId||o.search_form_id||""),styles:{height:n(t.height||t.mapHeight,400),heightUnit:String(t.heightUnit||t.height_unit||"px"),enableCalcHeight:n(t.enableCalcHeight||t.enable_calc_height,!1),calcHeight:n(t.calcHeight||t.calc_height,""),borderRadius:n(t.borderRadius||t.border_radius,0),cluster:t.cluster?{size:n(t.cluster.size,40),bgColor:n(t.cluster.bgColor||t.cluster.bg_color,""),radius:n(t.cluster.radius,50),textColor:n(t.cluster.textColor||t.cluster.text_color,""),shadow:r(t.cluster.shadow),typography:t.cluster.typography||{}}:{size:{desktop:40},bgColor:{desktop:""},radius:{desktop:50},textColor:{desktop:""},shadow:{enable:!1},typography:{}},iconMarker:t.iconMarker||t.icon_marker?{size:n((t.iconMarker||t.icon_marker).size,42),iconSize:n((t.iconMarker||t.icon_marker).iconSize||(t.iconMarker||t.icon_marker).icon_size,24),radius:n((t.iconMarker||t.icon_marker).radius,50),shadow:r((t.iconMarker||t.icon_marker).shadow),staticBg:n((t.iconMarker||t.icon_marker).staticBg||(t.iconMarker||t.icon_marker).static_bg,""),staticBgActive:n((t.iconMarker||t.icon_marker).staticBgActive||(t.iconMarker||t.icon_marker).static_bg_active,""),staticIconColor:n((t.iconMarker||t.icon_marker).staticIconColor||(t.iconMarker||t.icon_marker).static_icon_color,""),staticIconColorActive:n((t.iconMarker||t.icon_marker).staticIconColorActive||(t.iconMarker||t.icon_marker).static_icon_color_active,"")}:{size:{desktop:42},iconSize:{desktop:24},radius:{desktop:50},shadow:{enable:!1},staticBg:{desktop:""},staticBgActive:{desktop:""},staticIconColor:{desktop:""},staticIconColorActive:{desktop:""}},textMarker:t.textMarker||t.text_marker?{bgColor:n((t.textMarker||t.text_marker).bgColor||(t.textMarker||t.text_marker).bg_color,""),bgColorActive:n((t.textMarker||t.text_marker).bgColorActive||(t.textMarker||t.text_marker).bg_color_active,""),textColor:n((t.textMarker||t.text_marker).textColor||(t.textMarker||t.text_marker).text_color,""),textColorActive:n((t.textMarker||t.text_marker).textColorActive||(t.textMarker||t.text_marker).text_color_active,""),radius:n((t.textMarker||t.text_marker).radius,4),shadow:r((t.textMarker||t.text_marker).shadow),typography:(t.textMarker||t.text_marker).typography||{},padding:n((t.textMarker||t.text_marker).padding,{})}:{bgColor:{desktop:""},bgColorActive:{desktop:""},textColor:{desktop:""},textColorActive:{desktop:""},radius:{desktop:4},shadow:{enable:!1},typography:{},padding:{desktop:{}}},imageMarker:t.imageMarker||t.image_marker?{size:n((t.imageMarker||t.image_marker).size,42),radius:n((t.imageMarker||t.image_marker).radius,50),shadow:r((t.imageMarker||t.image_marker).shadow)}:{size:{desktop:42},radius:{desktop:50},shadow:{enable:!1}},popup:t.popup?{cardWidth:n(t.popup.cardWidth||t.popup.card_width,320),loaderColor1:String(t.popup.loaderColor1||t.popup.loader_color_1||""),loaderColor2:String(t.popup.loaderColor2||t.popup.loader_color_2||"")}:{cardWidth:{desktop:320},loaderColor1:"",loaderColor2:""},searchBtn:t.searchBtn||t.search_btn?{textColor:n((t.searchBtn||t.search_btn).textColor||(t.searchBtn||t.search_btn).text_color,""),bgColor:n((t.searchBtn||t.search_btn).bgColor||(t.searchBtn||t.search_btn).bg_color,""),iconColor:n((t.searchBtn||t.search_btn).iconColor||(t.searchBtn||t.search_btn).icon_color,""),iconColorActive:n((t.searchBtn||t.search_btn).iconColorActive||(t.searchBtn||t.search_btn).icon_color_active,""),radius:n((t.searchBtn||t.search_btn).radius||(t.searchBtn||t.search_btn).radius,4),typography:(t.searchBtn||t.search_btn).typography||{},checkmarkIcon:(t.searchBtn||t.search_btn).checkmarkIcon||{}}:{textColor:{desktop:""},bgColor:{desktop:""},iconColor:{desktop:""},iconColorActive:{desktop:""},radius:{desktop:4},typography:{},checkmarkIcon:{}},navBtn:t.navBtn||t.nav_btn?{iconColor:String((t.navBtn||t.nav_btn).iconColor||(t.navBtn||t.nav_btn).icon_color||""),iconColorHover:String((t.navBtn||t.nav_btn).iconColorHover||(t.navBtn||t.nav_btn).icon_color_hover||""),iconSize:n((t.navBtn||t.nav_btn).iconSize||(t.navBtn||t.nav_btn).icon_size,20),bgColor:String((t.navBtn||t.nav_btn).bgColor||(t.navBtn||t.nav_btn).bg_color||""),bgColorHover:String((t.navBtn||t.nav_btn).bgColorHover||(t.navBtn||t.nav_btn).bg_color_hover||""),radius:n((t.navBtn||t.nav_btn).radius,4),size:n((t.navBtn||t.nav_btn).size,36),shadow:r((t.navBtn||t.nav_btn).shadow),borderType:String((t.navBtn||t.nav_btn).borderType||(t.navBtn||t.nav_btn).border_type||"none"),borderWidth:n((t.navBtn||t.nav_btn).borderWidth||(t.navBtn||t.nav_btn).border_width,0),borderColor:String((t.navBtn||t.nav_btn).borderColor||(t.navBtn||t.nav_btn).border_color||""),borderColorHover:String((t.navBtn||t.nav_btn).borderColorHover||(t.navBtn||t.nav_btn).border_color_hover||"")}:{iconSize:{desktop:20},radius:{desktop:4},size:{desktop:36},shadow:{enable:!1},borderType:"none",borderWidth:{desktop:0}}}}}const p=()=>window;function R(){return!!p().Voxel?.Maps}function b(){return new Promise((o,e)=>{const i=p().Voxel?.Maps;if(i){i.await(()=>o(i));return}const t=()=>{const n=p().Voxel?.Maps;n&&n.await(()=>o(n))};document.addEventListener("maps:loaded",t,{once:!0}),setTimeout(()=>{document.removeEventListener("maps:loaded",t);const n=p().Voxel?.Maps;n?n.await(()=>o(n)):e(new Error("Voxel.Maps not available after timeout"))},15e3)})}function A(){return{lat:p().Voxel_Config?.maps?.default_lat??40.7128,lng:p().Voxel_Config?.maps?.default_lng??-74.006}}class f{constructor(e,i){this._native=null,this._lat=e,this._lng=i;const t=p().Voxel?.Maps;t&&(this._native=new t.LatLng(e,i))}getLatitude(){return this._native?.getLatitude()??this._lat}getLongitude(){return this._native?.getLongitude()??this._lng}getSourceObject(){return this._native?.getSourceObject()??null}toGeocoderFormat(){return this._native?.toGeocoderFormat()??null}getNative(){return this._native}static fromNative(e){const i=new f(e.getLatitude(),e.getLongitude());return i._native=e,i}}class _{constructor(e,i){this._native=null,this._sw=e??null,this._ne=i??null;const t=p().Voxel?.Maps;t&&(this._native=new t.Bounds(e?.getNative()??void 0,i?.getNative()??void 0))}extend(e){this._native&&e.getNative()&&this._native.extend(e.getNative())}empty(){return this._native?.empty()??!0}getSourceObject(){return this._native?.getSourceObject()??null}getSouthWest(){return this._native?f.fromNative(this._native.getSouthWest()):this._sw}getNorthEast(){return this._native?f.fromNative(this._native.getNorthEast()):this._ne}getNative(){return this._native}static fromNative(e){const i=f.fromNative(e.getSouthWest()),t=f.fromNative(e.getNorthEast()),n=new _(i,t);return n._native=e,n}}class D{constructor(e){this._native=null,this._listeners=new Map,this._el=e.el,this._options=e}async init(){console.log("[VxMap] init() called");const e=await b();console.log("[VxMap] Got Voxel.Maps:",e),console.log("[VxMap] Maps.Map constructor:",e.Map);const i=window.getComputedStyle(this._el),t=this._el.getBoundingClientRect();console.log("[VxMap] Container dimensions BEFORE map creation:",{width:t.width,height:t.height,display:i.display,visibility:i.visibility,offsetParent:this._el.offsetParent?"exists":"null",styleHeight:this._el.style.height}),t.height===0&&(console.log("[VxMap] WARNING: Container has 0 height! Setting fallback height of 400px"),this._el.style.height="400px");const n=this._options.center?new e.LatLng(this._options.center.getLatitude(),this._options.center.getLongitude()):new e.LatLng(A().lat,A().lng);console.log("[VxMap] centerLatLng created:",n);const r={el:this._el,zoom:this._options.zoom??10,center:n,minZoom:this._options.minZoom??2,maxZoom:this._options.maxZoom??20,draggable:this._options.draggable??!0};console.log("[VxMap] About to call new Maps.Map() with:",r);try{this._native=new e.Map(r),console.log("[VxMap] Maps.Map created successfully:",this._native),console.log("[VxMap] Native map object:",this._native?.map),console.log("[VxMap] Container after init:",this._el.innerHTML.substring(0,200)),this._el.classList.add("ts-map-loaded"),this._el.__vx_map__=this._native;const s=this._native?.map;s&&typeof google<"u"&&google.maps?.event&&(console.log("[VxMap] Triggering resize event sequence..."),this._el.offsetHeight,google.maps.event.trigger(s,"resize"),requestAnimationFrame(()=>{google.maps.event.trigger(s,"resize");const l=s.getCenter();l&&s.setCenter(l),setTimeout(()=>{google.maps.event.trigger(s,"bounds_changed"),google.maps.event.trigger(s,"idle"),console.log("[VxMap] Resize sequence completed");const d=this._el.getBoundingClientRect();console.log("[VxMap] Container dimensions AFTER resize:",{width:d.width,height:d.height})},100)}))}catch(s){throw console.error("[VxMap] Error creating Maps.Map:",s),s}}setZoom(e){this._native?.setZoom(e)}getZoom(){return this._native?.getZoom()??this._options.zoom??10}getMinZoom(){return this._native?.getMinZoom()??this._options.minZoom??2}getMaxZoom(){return this._native?.getMaxZoom()??this._options.maxZoom??20}setCenter(e){this._native&&e.getNative()&&this._native.setCenter(e.getNative())}getCenter(){return this._native?f.fromNative(this._native.getCenter()):this._options.center??null}getBounds(){return this._native?_.fromNative(this._native.getBounds()):null}fitBounds(e){this._native&&e.getNative()&&this._native.fitBounds(e.getNative())}panTo(e){this._native&&e.getNative()&&this._native.panTo(e.getNative())}getClickPosition(e){return this._native?f.fromNative(this._native.getClickPosition(e)):null}addListener(e,i){if(this._native){const t=this._native.addListener(e,i);this._listeners.has(e)||this._listeners.set(e,[]),this._listeners.get(e).push(t)}}addListenerOnce(e,i){this._native&&this._native.addListenerOnce(e,i)}removeListeners(e){const i=this._listeners.get(e);i&&this._native&&(i.forEach(t=>this._native.removeListener(t)),this._listeners.delete(e))}trigger(e){this._native?.trigger(e)}getSourceObject(){return this._native?.getSourceObject()??null}getNative(){return this._native}getElement(){return this._el}}class F{constructor(e){this._native=null,this._map=null,this._options=e}init(e){const i=p().Voxel?.Maps;if(!i||!e.getNative())return;this._map=e;const t=this._options.position?new i.LatLng(this._options.position.getLatitude(),this._options.position.getLongitude()):void 0;this._native=new i.Marker({map:e.getNative(),position:t,template:this._options.template,onClick:this._options.onClick?(n,r)=>this._options.onClick(n,this):void 0,data:this._options.data})}getPosition(){return this._native?f.fromNative(this._native.getPosition()):this._options.position??null}setPosition(e){this._native&&e.getNative()&&this._native.setPosition(e.getNative())}getMap(){return this._map}setMap(e){this._native&&e.getNative()&&(this._native.setMap(e.getNative()),this._map=e)}remove(){return this._native?.remove(),this._map=null,this}addClass(e){this._native?.addClass(e)}removeClass(e){this._native?.removeClass(e)}getData(){return this._options.data}getNative(){return this._native}}class W{constructor(e){this._native=null,this._map=null,this._options=e}init(e){const i=p().Voxel?.Maps;if(!i||!e.getNative())return;this._map=e;const t=this._options.position?new i.LatLng(this._options.position.getLatitude(),this._options.position.getLongitude()):void 0;this._native=new i.Popup({map:e.getNative(),position:t,content:this._options.content})}setContent(e){this._native?.setContent(e)}setPosition(e){this._native&&e.getNative()&&this._native.setPosition(e.getNative())}show(){this._native?.show()}hide(){this._native?.hide()}getMap(){return this._map}getNative(){return this._native}}class j{constructor(e){this._native=null,this._map=null,this._options=e}init(e){const i=p().Voxel?.Maps;if(!i||!e.getNative())return;this._map=e;const t=this._options.center?new i.LatLng(this._options.center.getLatitude(),this._options.center.getLongitude()):void 0;this._native=new i.Circle({map:e.getNative(),center:t,radius:this._options.radius,visible:this._options.visible,className:this._options.className??"map-circle"})}hide(){this._native?.hide()}show(){this._native?.show()}setCenter(e){this._native&&e.getNative()&&this._native.setCenter(e.getNative())}setRadius(e){this._native?.setRadius(e)}getBounds(){return this._native?_.fromNative(this._native.getBounds()):null}getMap(){return this._map}getNative(){return this._native}}const k=class k{constructor(){this._native=null;const e=p().Voxel?.Maps;e&&(this._native=e.getGeocoder())}static getInstance(){return k._instance||(k._instance=new k),k._instance}geocode(e,i,t){if(!this._native){const s=typeof i=="function"?i:t;s&&s(!1);return}let n;if(e instanceof f){const s=e.getSourceObject();if(!s){const l=typeof i=="function"?i:t;l&&l(!1);return}n=s}else n=e;const r=s=>l=>{l===!1?s(!1):Array.isArray(l)?s(l.map(d=>({address:d.address,latlng:f.fromNative(d.latlng),viewport:_.fromNative(d.viewport)}))):s({address:l.address,latlng:f.fromNative(l.latlng),viewport:_.fromNative(l.viewport)})};if(typeof i=="function"){const s=i;this._native.geocode(n,r(s))}else t&&this._native.geocode(n,i,r(t))}getUserLocation(e){if(!this._native){e.positionFail?.();return}this._native.getUserLocation({fetchAddress:e.fetchAddress,receivedPosition:e.receivedPosition?i=>e.receivedPosition(f.fromNative(i)):void 0,receivedAddress:e.receivedAddress?i=>e.receivedAddress({address:i.address,latlng:f.fromNative(i.latlng),viewport:_.fromNative(i.viewport)}):void 0,positionFail:e.positionFail,addressFail:e.addressFail})}getNative(){return this._native}};k._instance=null;let z=k;class U{constructor(){this._native=null,this._map=null,this._markers=[]}async init(e){const i=await b();e.getNative()&&(this._map=e,this._native=new i.Clusterer({map:e.getNative()}),this._native&&(this._native._onClusterClick=()=>{this._onClusterClick?.()},this._native._onNonExpandableClusterClick=t=>{if(this._onNonExpandableClusterClick){const n=this._markers.filter(r=>t.some(s=>s===r.getNative()));this._onNonExpandableClusterClick(n)}}))}addMarkers(e){if(this._markers.push(...e),this._native){const i=e.map(t=>t.getNative()).filter(t=>t!==null);this._native.addMarkers(i)}}clearMarkers(){this._markers.forEach(e=>e.remove()),this._markers=[],this._native&&(this._native.markers=[])}render(){this._native?.render()}set onClusterClick(e){this._onClusterClick=e,this._native&&(this._native._onClusterClick=e)}set onNonExpandableClusterClick(e){this._onNonExpandableClusterClick=e}getMarkers(){return this._markers}getMap(){return this._map}getNative(){return this._native}}function q(o){z.getInstance().getUserLocation(o)}function E(o,e){if(e.length===0)return;if(e.length===1){const t=e[0].getPosition();t&&(o.panTo(t),o.setZoom(15));return}const i=new _;e.forEach(t=>{const n=t.getPosition();n&&i.extend(n)}),i.empty()||o.fitBounds(i)}function O(){if(typeof window<"u"&&window.wpApiSettings?.root)return window.wpApiSettings.root;if(typeof document<"u"){const o=document.querySelector('link[rel="https://api.w.org/"]');if(o){const e=o.getAttribute("href");if(e)return e}}if(typeof window<"u"&&window.location?.origin){const o=window.location.pathname.split("/").filter(Boolean),e=["wp-admin","wp-content","wp-includes","wp-json"];return o.length>0&&!e.includes(o[0])?window.location.origin+"/"+o[0]+"/wp-json/":window.location.origin+"/wp-json/"}return"/wp-json/"}S();function G(){return O()}function I(o){const e=o.querySelector("script.vxconfig");if(e&&e.textContent)try{return JSON.parse(e.textContent)}catch(i){console.error("[Map Block] Failed to parse vxconfig:",i)}return null}function J(o,e){if(!o)return e;const i=typeof window<"u"?window.innerWidth:1200;let t="desktop";return i<768?t="mobile":i<1024&&(t="tablet"),t==="mobile"?o.mobile!==void 0?o.mobile:o.tablet!==void 0?o.tablet:o.desktop!==void 0?o.desktop:e:t==="tablet"&&o.tablet!==void 0?o.tablet:o.desktop!==void 0?o.desktop:e}function Q(o,e){if(!e.dragSearch||e.source!=="search-form")return null;const i=document.createElement("div");if(i.className="ts-map-drag",e.dragSearchMode==="automatic"){const t=e.dragSearchDefault==="checked";i.innerHTML=`
			<a href="#" class="ts-map-btn ts-drag-toggle ${t?"active":""}">
				<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="ts-checkmark-icon">
					<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
				</svg>
				Search as I move the map
			</a>
		`}else i.innerHTML=`
			<a href="#" class="ts-search-area hidden ts-map-btn">
				<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="ts-search-icon">
					<path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
				</svg>
				Search this area
			</a>
		`;return o.insertBefore(i,o.firstChild),i}function K(o){const e=document.createElement("a");return e.href="#",e.rel="nofollow",e.role="button",e.className="vx-geolocate-me hidden",e.setAttribute("aria-label","Share your location"),e.innerHTML=`
		<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
			<path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>
		</svg>
	`,e.addEventListener("click",i=>{i.preventDefault(),e.classList.add("loading"),q({fetchAddress:!0,receivedPosition:t=>{console.log("[Map Block] Got user position:",t.getLatitude(),t.getLongitude()),e.classList.remove("loading");const n=y.get(o.querySelector(".ts-map"));n&&(n.map.panTo(t),n.map.setZoom(15),n.circle&&(n.circle.setCenter(t),n.circle.show()))},receivedAddress:t=>{console.log("[Map Block] Got user address:",t.address),o.dispatchEvent(new CustomEvent("geolocation:address",{detail:{address:t.address,latlng:{lat:t.latlng.getLatitude(),lng:t.latlng.getLongitude()}},bubbles:!0}))},positionFail:()=>{console.warn("[Map Block] Failed to get user position"),e.classList.remove("loading")},addressFail:()=>{console.warn("[Map Block] Failed to get user address")}})}),o.appendChild(e),e}function H(o,e,i){const t=document.createElement("div");return t.className=e.source==="current-post"?"ts-map ts-map-autoload":"ts-map",t.setAttribute("data-config",JSON.stringify(i)),o.appendChild(t),t}async function X(o,e){const i=ct();if(!i){console.warn("[Map Block] No post ID found for current-post mode");return}const n=`${G()}voxel-fse/v1/map/post-location?post_id=${i}`;try{const r=await fetch(n);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const s=await r.json(),l={center:{lat:s.latitude,lng:s.longitude},zoom:e.zoom,minZoom:e.minZoom,maxZoom:e.maxZoom,markers:[{lat:s.latitude,lng:s.longitude,template:encodeURIComponent(s.marker),uriencoded:!0}]};o.innerHTML="",H(o,e,l).dispatchEvent(new CustomEvent("voxel:map-ready",{bubbles:!0}))}catch(r){console.error("[Map Block] Failed to fetch post location:",r)}}function Y(o,e){o.innerHTML="";const i={center:e.center,zoom:e.zoom,minZoom:e.minZoom,maxZoom:e.maxZoom},t=Q(o,e),n=H(o,e,i);K(o),tt(n,i,o,e);const r=e.blockId;r&&window.addEventListener("voxel-search-submit",(s=>{s.detail.targetId===r&&ot(o,n,s.detail)})),t&&at(t,n)}const y=new Map;async function tt(o,e,i,t){console.log("[Map Block] initializeVoxelMap called",{mapContainer:o,dataConfig:e});try{console.log("[Map Block] Waiting for Voxel.Maps..."),await b(),console.log("[Map Block] Voxel.Maps ready!")}catch(n){console.warn("[Map Block] Voxel.Maps not available:",n);return}try{const n=i.style.getPropertyValue("--vx-map-height"),r=window.getComputedStyle(i).getPropertyValue("--vx-map-height"),s=n||r||"400px";o.style.height=s,o.style.minHeight=s,i.style.width=i.style.width||"100%",console.log("[Map Block] Height values:",{inlineHeight:n,computedHeight:r,finalHeight:s,wrapperStyle:i.getAttribute("style")?.substring(0,100)});const l=new f(e.center.lat,e.center.lng);console.log("[Map Block] Center created:",l.getLatitude(),l.getLongitude());const d={el:o,center:l,zoom:e.zoom,minZoom:e.minZoom,maxZoom:e.maxZoom,draggable:!0};console.log("[Map Block] Creating VxMap with options:",{zoom:d.zoom,minZoom:d.minZoom,maxZoom:d.maxZoom});const h=new D(d);console.log("[Map Block] VxMap instance created, calling init()..."),await h.init(),console.log("[Map Block] VxMap.init() completed, native map:",h.getNative());let v=null;t.source==="search-form"&&(v=new U,await v.init(h),v.onClusterClick=()=>{console.log("[Map Block] Cluster clicked, zooming in")},v.onNonExpandableClusterClick=a=>{console.log("[Map Block] Non-expandable cluster clicked:",a.length,"markers")});const m=new W({});m.init(h);const g=new j({center:l,radius:5e3,className:"map-circle"});g.init(h),g.hide();const u={map:h,clusterer:v,markers:[],popup:m,circle:g,config:t};if(y.set(o,u),o._voxelMap=h.getNative(),o._vxMapInstance=u,h.addListener("zoom_changed",()=>{v&&v.render()}),h.addListener("idle",()=>{i.querySelector(".ts-drag-toggle.active")&&t.dragSearchMode==="automatic"&&et(i,h,t)}),h.addListener("bounds_changed",()=>{const a=i.querySelector(".ts-search-area");a&&t.dragSearchMode==="manual"&&a.classList.remove("hidden")}),h.addListener("click",()=>{m.hide()}),e.markers&&e.markers.length>0){const a=await Z(h,e.markers,m,v);u.markers=a,a.length>1&&v?v.render():a.length>0&&E(h,a)}console.log("[Map Block] Map initialized successfully with all features")}catch(n){console.error("[Map Block] Failed to initialize map:",n)}}async function Z(o,e,i,t){if(!e)return[];const n=[];for(const r of e){const s=r.uriencoded?decodeURIComponent(r.template):r.template,l={position:new f(r.lat,r.lng),template:s,onClick:(h,v)=>{const m=v.getPosition();m&&(i.setPosition(m),i.setContent(s),i.show())},data:{lat:r.lat,lng:r.lng}},d=new F(l);d.init(o),n.push(d)}return t&&n.length>0&&t.addMarkers(n),n}function et(o,e,i){const t=e.getBounds();if(!t)return;const n=t.getSouthWest(),r=t.getNorthEast();if(!n||!r)return;const s={bounds:{sw:{lat:n.getLatitude(),lng:n.getLongitude()},ne:{lat:r.getLatitude(),lng:r.getLongitude()}},center:{lat:e.getCenter()?.getLatitude(),lng:e.getCenter()?.getLongitude()},zoom:e.getZoom()};o.dispatchEvent(new CustomEvent("map:bounds-changed",{detail:s,bubbles:!0}))}async function ot(o,e,i,t){console.log("[Map Block] Search submitted:",i);const n=y.get(e);if(!n){console.warn("[Map Block] No map instance found");return}n.clusterer?n.clusterer.clearMarkers():n.markers.forEach(s=>s.remove()),n.markers=[],n.popup?.hide();const r=o.closest(".ts-map-widget");r&&r.dispatchEvent(new CustomEvent("search:updated",{detail:i,bubbles:!0}))}async function it(o,e){const i=o.querySelector(".ts-map");if(!i)return;const t=y.get(i);if(!t)return;t.clusterer?t.clusterer.clearMarkers():t.markers.forEach(s=>s.remove()),t.markers=[];const n=e.map(s=>({lat:s.lat,lng:s.lng,template:s.template,uriencoded:!1})),r=await Z(t.map,n,t.popup,t.clusterer);t.markers=r,t.clusterer&&r.length>0?t.clusterer.render():r.length>0&&E(t.map,r)}function nt(o,e,i){const t=o.querySelector(".ts-map");if(!t)return;const n=y.get(t);n?.circle&&(n.circle.setCenter(new f(e.lat,e.lng)),n.circle.setRadius(i),n.circle.show())}function st(o){const e=o.querySelector(".ts-map");if(!e)return;y.get(e)?.circle?.hide()}function rt(o){const e=o.querySelector(".ts-map");if(e)return y.get(e)}function at(o,e,i){const t=o.querySelector(".ts-drag-toggle"),n=o.querySelector(".ts-search-area");t&&t.addEventListener("click",r=>{r.preventDefault(),t.classList.toggle("active")}),n&&n.addEventListener("click",r=>{r.preventDefault();const s=e.closest(".ts-map-widget");s&&s.dispatchEvent(new CustomEvent("search:area",{bubbles:!0}))})}function ct(){const o=document.body.className.split(" ");for(const i of o){const t=i.match(/^postid-(\d+)$/);if(t)return parseInt(t[1],10)}const e=document.querySelector("[data-post-id]");if(e){const i=e.getAttribute("data-post-id");if(i)return parseInt(i,10)}if(typeof window<"u"){const i=window.wp_post_id;if(i)return i}return null}function C(){document.querySelectorAll(".voxel-fse-map").forEach(e=>{if(e.getAttribute("data-hydrated")==="true")return;const i=I(e);if(!i){console.warn("[Map Block] No vxconfig found for container:",e);return}const t=V(i);e.setAttribute("data-hydrated","true"),L(e,t),t.source==="current-post"?X(e,t):Y(e,t),requestAnimationFrame(()=>{window.jQuery&&window.jQuery(document).trigger("voxel:markup-update")})})}function B(o){R()?b().then(o).catch(()=>{console.warn("[Map Block] Voxel.Maps not available, initializing anyway"),o()}):(document.addEventListener("maps:loaded",()=>{b().then(o).catch(o)},{once:!0}),setTimeout(()=>{b().then(o).catch(o)},1e4))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{B(C)}):B(C),window.addEventListener("turbo:load",()=>{B(C)}),window.addEventListener("pjax:complete",()=>{B(C)});let T;return window.addEventListener("resize",()=>{clearTimeout(T),T=setTimeout(()=>{document.querySelectorAll('.voxel-fse-map[data-hydrated="true"]').forEach(e=>{if(e.getAttribute("data-hydrated")!=="true")return;const t=I(e);if(t){const n=V(t);L(e,n)}})},250)}),x.getMapInstance=rt,x.getResponsiveValueClient=J,x.hideRadiusCircle=st,x.showRadiusCircle=nt,x.updateMapMarkers=it,Object.defineProperty(x,Symbol.toStringTag,{value:"Module"}),x})({});
