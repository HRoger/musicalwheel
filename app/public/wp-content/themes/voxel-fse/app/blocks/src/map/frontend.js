var VoxelFSEMap=(function(y){"use strict";let E=!1;function S(){if(E)return!0;if(!window.Voxel?.mixins?.base)return!1;const o=window.Voxel.mixins.base;return o.mounted&&!o._originalMounted?(o._originalMounted=o.mounted,o.mounted=function(){try{const e=this.$root?.$options?.el||this.$el;if(e){const n=e.closest?.(".elementor-element");if(n)this.widget_id=n.dataset?.id||"";else{const i=e.closest?.("[data-block-id]");this.widget_id=i&&i.dataset?.blockId||""}const t=e.closest?.(".elementor");if(t)this.post_id=t.dataset?.elementorId||"";else{const i=document.body.className.match(/postid-(\d+)/);this.post_id=i?i[1]:""}}o._originalMounted&&o._originalMounted!==o.mounted&&o._originalMounted.call(this)}catch(e){console.warn("[VoxelShim] Error in patched mounted():",e),this.widget_id="",this.post_id=""}},E=!0,console.log("[VoxelShim] Successfully patched Voxel.mixins.base.mounted"),!0):!1}function P(){if(S())return;let o=0;const e=50,t=setInterval(()=>{if(o++,S()){clearInterval(t);return}o>=e&&(clearInterval(t),console.warn("[VoxelShim] Voxel.mixins.base not found after 5 seconds"))},100);typeof document<"u"&&document.addEventListener("voxel:ready",()=>{S(),clearInterval(t)},{once:!0})}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",P,{once:!0}):P());function R(){if(typeof window>"u")return"desktop";const o=window.innerWidth;return o<768?"mobile":o<1024?"tablet":"desktop"}function c(o,e){if(!o)return e;const n=R();return n==="mobile"?o.mobile!==void 0?o.mobile:o.tablet!==void 0?o.tablet:o.desktop!==void 0?o.desktop:e:n==="tablet"&&o.tablet!==void 0?o.tablet:o.desktop!==void 0?o.desktop:e}function C(o){if(!o?.enable)return"none";const{horizontal:e=0,vertical:n=0,blur:t=0,spread:i=0,color:r="rgba(0,0,0,0.1)",position:s}=o;return`${s==="inset"?"inset ":""}${e}px ${n}px ${t}px ${i}px ${r}`}function N(o){if(!o)return{};const e={};return o.fontFamily&&(e["font-family"]=o.fontFamily),o.fontSize&&(e["font-size"]=`${o.fontSize}${o.fontSizeUnit||"px"}`),o.fontWeight&&(e["font-weight"]=o.fontWeight),o.fontStyle&&(e["font-style"]=o.fontStyle),o.textTransform&&(e["text-transform"]=o.textTransform),o.textDecoration&&(e["text-decoration"]=o.textDecoration),o.lineHeight&&(e["line-height"]=`${o.lineHeight}${o.lineHeightUnit||""}`),o.letterSpacing&&(e["letter-spacing"]=`${o.letterSpacing}${o.letterSpacingUnit||"px"}`),e}function A(o,e){o.style.width="100%";const n=e.styles;if(!n)return;const t=c(n.height,400),i=n.heightUnit||"px",r=c(n.enableCalcHeight,!1),s=c(n.calcHeight,"");r&&s?o.style.setProperty("--vx-map-height",s):o.style.setProperty("--vx-map-height",`${t}${i}`);const a=c(n.borderRadius,0);if(o.style.setProperty("--vx-map-radius",`${a}px`),n.cluster){const l=c(n.cluster.size,40);o.style.setProperty("--vx-cluster-size",`${l}px`);const h=c(n.cluster.bgColor,"");h&&o.style.setProperty("--vx-cluster-bg",h);const m=c(n.cluster.radius,50);o.style.setProperty("--vx-cluster-radius",`${m}%`);const v=c(n.cluster.textColor,"");if(v&&o.style.setProperty("--vx-cluster-text-color",v),o.style.setProperty("--vx-cluster-shadow",C(n.cluster.shadow)),n.cluster.typography){const g=N(n.cluster.typography);g["font-family"]&&o.style.setProperty("--vx-cluster-font-family",g["font-family"]),g["font-size"]&&o.style.setProperty("--vx-cluster-font-size",g["font-size"]),g["font-weight"]&&o.style.setProperty("--vx-cluster-font-weight",g["font-weight"]),g["font-style"]&&o.style.setProperty("--vx-cluster-font-style",g["font-style"]),g["line-height"]&&o.style.setProperty("--vx-cluster-line-height",g["line-height"]),g["letter-spacing"]&&o.style.setProperty("--vx-cluster-letter-spacing",g["letter-spacing"]),g["text-transform"]&&o.style.setProperty("--vx-cluster-text-transform",g["text-transform"]),g["text-decoration"]&&o.style.setProperty("--vx-cluster-text-decoration",g["text-decoration"])}}if(n.iconMarker){const l=c(n.iconMarker.size,42);o.style.setProperty("--vx-icon-marker-size",`${l}px`);const h=c(n.iconMarker.iconSize,24);o.style.setProperty("--vx-icon-marker-icon-size",`${h}px`);const m=c(n.iconMarker.radius,50);o.style.setProperty("--vx-icon-marker-radius",`${m}%`),o.style.setProperty("--vx-icon-marker-shadow",C(n.iconMarker.shadow));const v=c(n.iconMarker.staticBg,"");v&&o.style.setProperty("--vx-icon-marker-bg",v);const g=c(n.iconMarker.staticBgActive,"");g&&o.style.setProperty("--vx-icon-marker-bg-active",g);const u=c(n.iconMarker.staticIconColor,"");u&&o.style.setProperty("--vx-icon-marker-icon-color",u);const d=c(n.iconMarker.staticIconColorActive,"");d&&o.style.setProperty("--vx-icon-marker-icon-color-active",d)}if(n.textMarker){const l=c(n.textMarker.bgColor,"");l&&o.style.setProperty("--vx-text-marker-bg",l);const h=c(n.textMarker.bgColorActive,"");h&&o.style.setProperty("--vx-text-marker-bg-active",h);const m=c(n.textMarker.textColor,"");m&&o.style.setProperty("--vx-text-marker-text-color",m);const v=c(n.textMarker.textColorActive,"");v&&o.style.setProperty("--vx-text-marker-text-color-active",v);const g=c(n.textMarker.radius,4);if(o.style.setProperty("--vx-text-marker-radius",`${g}px`),o.style.setProperty("--vx-text-marker-shadow",C(n.textMarker.shadow)),n.textMarker.typography){const d=N(n.textMarker.typography);d["font-family"]&&o.style.setProperty("--vx-text-marker-font-family",d["font-family"]),d["font-size"]&&o.style.setProperty("--vx-text-marker-font-size",d["font-size"]),d["font-weight"]&&o.style.setProperty("--vx-text-marker-font-weight",d["font-weight"]),d["font-style"]&&o.style.setProperty("--vx-text-marker-font-style",d["font-style"]),d["line-height"]&&o.style.setProperty("--vx-text-marker-line-height",d["line-height"]),d["letter-spacing"]&&o.style.setProperty("--vx-text-marker-letter-spacing",d["letter-spacing"]),d["text-transform"]&&o.style.setProperty("--vx-text-marker-text-transform",d["text-transform"]),d["text-decoration"]&&o.style.setProperty("--vx-text-marker-text-decoration",d["text-decoration"])}const u=c(n.textMarker.padding,{});if(u){const d=u;d.top&&o.style.setProperty("--vx-text-marker-padding-top",d.top),d.right&&o.style.setProperty("--vx-text-marker-padding-right",d.right),d.bottom&&o.style.setProperty("--vx-text-marker-padding-bottom",d.bottom),d.left&&o.style.setProperty("--vx-text-marker-padding-left",d.left)}}if(n.imageMarker){const l=c(n.imageMarker.size,42);o.style.setProperty("--vx-image-marker-size",`${l}px`);const h=c(n.imageMarker.radius,50);o.style.setProperty("--vx-image-marker-radius",`${h}%`),o.style.setProperty("--vx-image-marker-shadow",C(n.imageMarker.shadow))}if(n.popup){const l=c(n.popup.cardWidth,320);o.style.setProperty("--vx-popup-card-width",`${l}px`),n.popup.loaderColor1&&o.style.setProperty("--vx-popup-loader-color1",n.popup.loaderColor1),n.popup.loaderColor2&&o.style.setProperty("--vx-popup-loader-color2",n.popup.loaderColor2)}if(n.searchBtn){const l=c(n.searchBtn.textColor,"");l&&o.style.setProperty("--vx-search-btn-text-color",l);const h=c(n.searchBtn.bgColor,"");h&&o.style.setProperty("--vx-search-btn-bg",h);const m=c(n.searchBtn.iconColor,"");m&&o.style.setProperty("--vx-search-btn-icon-color",m);const v=c(n.searchBtn.iconColorActive,"");v&&o.style.setProperty("--vx-search-btn-icon-color-active",v);const g=c(n.searchBtn.radius,4);if(o.style.setProperty("--vx-search-btn-radius",`${g}px`),n.searchBtn.typography){const u=N(n.searchBtn.typography);u["font-family"]&&o.style.setProperty("--vx-search-btn-font-family",u["font-family"]),u["font-size"]&&o.style.setProperty("--vx-search-btn-font-size",u["font-size"]),u["font-weight"]&&o.style.setProperty("--vx-search-btn-font-weight",u["font-weight"]),u["font-style"]&&o.style.setProperty("--vx-search-btn-font-style",u["font-style"]),u["line-height"]&&o.style.setProperty("--vx-search-btn-line-height",u["line-height"]),u["letter-spacing"]&&o.style.setProperty("--vx-search-btn-letter-spacing",u["letter-spacing"]),u["text-transform"]&&o.style.setProperty("--vx-search-btn-text-transform",u["text-transform"]),u["text-decoration"]&&o.style.setProperty("--vx-search-btn-text-decoration",u["text-decoration"])}if(n.searchBtn.checkmarkIcon){const u=n.searchBtn.checkmarkIcon;o.dataset.checkmarkIcon=JSON.stringify(u)}}if(n.navBtn){n.navBtn.iconColor&&o.style.setProperty("--vx-nav-btn-icon-color",n.navBtn.iconColor),n.navBtn.iconColorHover&&o.style.setProperty("--vx-nav-btn-icon-color-hover",n.navBtn.iconColorHover);const l=c(n.navBtn.iconSize,20);o.style.setProperty("--vx-nav-btn-icon-size",`${l}px`),n.navBtn.bgColor&&o.style.setProperty("--vx-nav-btn-bg",n.navBtn.bgColor),n.navBtn.bgColorHover&&o.style.setProperty("--vx-nav-btn-bg-hover",n.navBtn.bgColorHover);const h=c(n.navBtn.radius,4);o.style.setProperty("--vx-nav-btn-radius",`${h}px`);const m=c(n.navBtn.size,36);if(o.style.setProperty("--vx-nav-btn-size",`${m}px`),o.style.setProperty("--vx-nav-btn-shadow",C(n.navBtn.shadow)),n.navBtn.borderType&&n.navBtn.borderType!=="none"){o.style.setProperty("--vx-nav-btn-border-style",n.navBtn.borderType);const v=c(n.navBtn.borderWidth,0);o.style.setProperty("--vx-nav-btn-border-width",`${v}px`),n.navBtn.borderColor&&o.style.setProperty("--vx-nav-btn-border-color",n.navBtn.borderColor),n.navBtn.borderColorHover&&o.style.setProperty("--vx-nav-btn-border-color-hover",n.navBtn.borderColorHover)}}}function I(o){const e=o.center||{},n={lat:Number(o.lat||e.lat||e.latitude||51.492),lng:Number(o.lng||e.lng||e.longitude||-.13)},t=o.styles||{},i=(s,a)=>s?{desktop:s.desktop!==void 0?s.desktop:a,tablet:s.tablet!==void 0?s.tablet:s.desktop!==void 0?s.desktop:a,mobile:s.mobile!==void 0?s.mobile:s.tablet!==void 0?s.tablet:s.desktop!==void 0?s.desktop:a}:{desktop:a,tablet:a,mobile:a},r=s=>s?{enable:!!s.enable,horizontal:Number(s.horizontal||s.h||0),vertical:Number(s.vertical||s.v||0),blur:Number(s.blur||0),spread:Number(s.spread||0),color:String(s.color||"rgba(0,0,0,0.1)"),position:s.position||(s.inset?"inset":"outline")}:{enable:!1};return{blockId:String(o.blockId||o.block_id||""),source:o.source||"search-form",center:n,zoom:Number(o.zoom||o.initialZoom||11),minZoom:Number(o.minZoom||o.min_zoom||2),maxZoom:Number(o.maxZoom||o.max_zoom||18),dragSearch:o.dragSearch!==void 0?!!o.dragSearch:o.drag_search!==void 0?!!o.drag_search:!0,dragSearchMode:o.dragSearchMode||o.drag_search_mode||"manual",dragSearchDefault:o.dragSearchDefault||o.drag_search_default||"unchecked",searchFormId:String(o.searchFormId||o.search_form_id||""),styles:{height:i(t.height||t.mapHeight,400),heightUnit:String(t.heightUnit||t.height_unit||"px"),enableCalcHeight:i(t.enableCalcHeight||t.enable_calc_height,!1),calcHeight:i(t.calcHeight||t.calc_height,""),borderRadius:i(t.borderRadius||t.border_radius,0),cluster:t.cluster?{size:i(t.cluster.size,40),bgColor:i(t.cluster.bgColor||t.cluster.bg_color,""),radius:i(t.cluster.radius,50),textColor:i(t.cluster.textColor||t.cluster.text_color,""),shadow:r(t.cluster.shadow),typography:t.cluster.typography||{}}:{size:{desktop:40},bgColor:{desktop:""},radius:{desktop:50},textColor:{desktop:""},shadow:{enable:!1},typography:{}},iconMarker:t.iconMarker||t.icon_marker?{size:i((t.iconMarker||t.icon_marker).size,42),iconSize:i((t.iconMarker||t.icon_marker).iconSize||(t.iconMarker||t.icon_marker).icon_size,24),radius:i((t.iconMarker||t.icon_marker).radius,50),shadow:r((t.iconMarker||t.icon_marker).shadow),staticBg:i((t.iconMarker||t.icon_marker).staticBg||(t.iconMarker||t.icon_marker).static_bg,""),staticBgActive:i((t.iconMarker||t.icon_marker).staticBgActive||(t.iconMarker||t.icon_marker).static_bg_active,""),staticIconColor:i((t.iconMarker||t.icon_marker).staticIconColor||(t.iconMarker||t.icon_marker).static_icon_color,""),staticIconColorActive:i((t.iconMarker||t.icon_marker).staticIconColorActive||(t.iconMarker||t.icon_marker).static_icon_color_active,"")}:{size:{desktop:42},iconSize:{desktop:24},radius:{desktop:50},shadow:{enable:!1},staticBg:{desktop:""},staticBgActive:{desktop:""},staticIconColor:{desktop:""},staticIconColorActive:{desktop:""}},textMarker:t.textMarker||t.text_marker?{bgColor:i((t.textMarker||t.text_marker).bgColor||(t.textMarker||t.text_marker).bg_color,""),bgColorActive:i((t.textMarker||t.text_marker).bgColorActive||(t.textMarker||t.text_marker).bg_color_active,""),textColor:i((t.textMarker||t.text_marker).textColor||(t.textMarker||t.text_marker).text_color,""),textColorActive:i((t.textMarker||t.text_marker).textColorActive||(t.textMarker||t.text_marker).text_color_active,""),radius:i((t.textMarker||t.text_marker).radius,4),shadow:r((t.textMarker||t.text_marker).shadow),typography:(t.textMarker||t.text_marker).typography||{},padding:i((t.textMarker||t.text_marker).padding,{})}:{bgColor:{desktop:""},bgColorActive:{desktop:""},textColor:{desktop:""},textColorActive:{desktop:""},radius:{desktop:4},shadow:{enable:!1},typography:{},padding:{desktop:{}}},imageMarker:t.imageMarker||t.image_marker?{size:i((t.imageMarker||t.image_marker).size,42),radius:i((t.imageMarker||t.image_marker).radius,50),shadow:r((t.imageMarker||t.image_marker).shadow)}:{size:{desktop:42},radius:{desktop:50},shadow:{enable:!1}},popup:t.popup?{cardWidth:i(t.popup.cardWidth||t.popup.card_width,320),loaderColor1:String(t.popup.loaderColor1||t.popup.loader_color_1||""),loaderColor2:String(t.popup.loaderColor2||t.popup.loader_color_2||"")}:{cardWidth:{desktop:320},loaderColor1:"",loaderColor2:""},searchBtn:t.searchBtn||t.search_btn?{textColor:i((t.searchBtn||t.search_btn).textColor||(t.searchBtn||t.search_btn).text_color,""),bgColor:i((t.searchBtn||t.search_btn).bgColor||(t.searchBtn||t.search_btn).bg_color,""),iconColor:i((t.searchBtn||t.search_btn).iconColor||(t.searchBtn||t.search_btn).icon_color,""),iconColorActive:i((t.searchBtn||t.search_btn).iconColorActive||(t.searchBtn||t.search_btn).icon_color_active,""),radius:i((t.searchBtn||t.search_btn).radius||(t.searchBtn||t.search_btn).radius,4),typography:(t.searchBtn||t.search_btn).typography||{},checkmarkIcon:(t.searchBtn||t.search_btn).checkmarkIcon||{}}:{textColor:{desktop:""},bgColor:{desktop:""},iconColor:{desktop:""},iconColorActive:{desktop:""},radius:{desktop:4},typography:{},checkmarkIcon:{}},navBtn:t.navBtn||t.nav_btn?{iconColor:String((t.navBtn||t.nav_btn).iconColor||(t.navBtn||t.nav_btn).icon_color||""),iconColorHover:String((t.navBtn||t.nav_btn).iconColorHover||(t.navBtn||t.nav_btn).icon_color_hover||""),iconSize:i((t.navBtn||t.nav_btn).iconSize||(t.navBtn||t.nav_btn).icon_size,20),bgColor:String((t.navBtn||t.nav_btn).bgColor||(t.navBtn||t.nav_btn).bg_color||""),bgColorHover:String((t.navBtn||t.nav_btn).bgColorHover||(t.navBtn||t.nav_btn).bg_color_hover||""),radius:i((t.navBtn||t.nav_btn).radius,4),size:i((t.navBtn||t.nav_btn).size,36),shadow:r((t.navBtn||t.nav_btn).shadow),borderType:String((t.navBtn||t.nav_btn).borderType||(t.navBtn||t.nav_btn).border_type||"none"),borderWidth:i((t.navBtn||t.nav_btn).borderWidth||(t.navBtn||t.nav_btn).border_width,0),borderColor:String((t.navBtn||t.nav_btn).borderColor||(t.navBtn||t.nav_btn).border_color||""),borderColorHover:String((t.navBtn||t.nav_btn).borderColorHover||(t.navBtn||t.nav_btn).border_color_hover||"")}:{iconSize:{desktop:20},radius:{desktop:4},size:{desktop:36},shadow:{enable:!1},borderType:"none",borderWidth:{desktop:0}}}}}const f=()=>window;function F(){return!!f().Voxel?.Maps}function M(){return new Promise((o,e)=>{const n=f().Voxel?.Maps;if(n){n.await(()=>o(n));return}const t=()=>{const i=f().Voxel?.Maps;i&&i.await(()=>o(i))};document.addEventListener("maps:loaded",t,{once:!0}),setTimeout(()=>{document.removeEventListener("maps:loaded",t);const i=f().Voxel?.Maps;i?i.await(()=>o(i)):e(new Error("Voxel.Maps not available after timeout"))},15e3)})}function H(){return{lat:f().Voxel_Config?.maps?.default_lat??40.7128,lng:f().Voxel_Config?.maps?.default_lng??-74.006}}class p{constructor(e,n){this._native=null,this._lat=e,this._lng=n;const t=f().Voxel?.Maps;t&&(this._native=new t.LatLng(e,n))}getLatitude(){return this._native?.getLatitude()??this._lat}getLongitude(){return this._native?.getLongitude()??this._lng}getSourceObject(){return this._native?.getSourceObject()??null}toGeocoderFormat(){return this._native?.toGeocoderFormat()??null}getNative(){return this._native}static fromNative(e){const n=new p(e.getLatitude(),e.getLongitude());return n._native=e,n}}class x{constructor(e,n){this._native=null,this._sw=e??null,this._ne=n??null;const t=f().Voxel?.Maps;t&&(this._native=new t.Bounds(e?.getNative()??void 0,n?.getNative()??void 0))}extend(e){this._native&&e.getNative()&&this._native.extend(e.getNative())}empty(){return this._native?.empty()??!0}getSourceObject(){return this._native?.getSourceObject()??null}getSouthWest(){return this._native?p.fromNative(this._native.getSouthWest()):this._sw}getNorthEast(){return this._native?p.fromNative(this._native.getNorthEast()):this._ne}getNative(){return this._native}static fromNative(e){const n=p.fromNative(e.getSouthWest()),t=p.fromNative(e.getNorthEast()),i=new x(n,t);return i._native=e,i}}class D{constructor(e){this._native=null,this._listeners=new Map,this._el=e.el,this._options=e}async init(){console.log("[VxMap] init() called");const e=await M();console.log("[VxMap] Got Voxel.Maps:",e),console.log("[VxMap] Maps.Map constructor:",e.Map);const n=window.getComputedStyle(this._el),t=this._el.getBoundingClientRect();console.log("[VxMap] Container dimensions BEFORE map creation:",{width:t.width,height:t.height,display:n.display,visibility:n.visibility,offsetParent:this._el.offsetParent?"exists":"null",styleHeight:this._el.style.height}),t.height===0&&(console.log("[VxMap] WARNING: Container has 0 height! Setting fallback height of 400px"),this._el.style.height="400px");const i=this._options.center?new e.LatLng(this._options.center.getLatitude(),this._options.center.getLongitude()):new e.LatLng(H().lat,H().lng);console.log("[VxMap] centerLatLng created:",i);const r={el:this._el,zoom:this._options.zoom??10,center:i,minZoom:this._options.minZoom??2,maxZoom:this._options.maxZoom??20,draggable:this._options.draggable??!0};console.log("[VxMap] About to call new Maps.Map() with:",r);try{this._native=new e.Map(r),console.log("[VxMap] Maps.Map created successfully:",this._native),console.log("[VxMap] Native map object:",this._native?.map),console.log("[VxMap] Container after init:",this._el.innerHTML.substring(0,200)),this._el.classList.add("ts-map-loaded"),this._el.__vx_map__=this._native;const s=this._native?.map;s&&typeof google<"u"&&google.maps?.event&&(console.log("[VxMap] Triggering resize event sequence..."),this._el.offsetHeight,google.maps.event.trigger(s,"resize"),requestAnimationFrame(()=>{google.maps.event.trigger(s,"resize");const a=s.getCenter();a&&s.setCenter(a),setTimeout(()=>{google.maps.event.trigger(s,"bounds_changed"),google.maps.event.trigger(s,"idle"),console.log("[VxMap] Resize sequence completed");const l=this._el.getBoundingClientRect();console.log("[VxMap] Container dimensions AFTER resize:",{width:l.width,height:l.height})},100)}))}catch(s){throw console.error("[VxMap] Error creating Maps.Map:",s),s}}setZoom(e){this._native?.setZoom(e)}getZoom(){return this._native?.getZoom()??this._options.zoom??10}getMinZoom(){return this._native?.getMinZoom()??this._options.minZoom??2}getMaxZoom(){return this._native?.getMaxZoom()??this._options.maxZoom??20}setCenter(e){this._native&&e.getNative()&&this._native.setCenter(e.getNative())}getCenter(){return this._native?p.fromNative(this._native.getCenter()):this._options.center??null}getBounds(){return this._native?x.fromNative(this._native.getBounds()):null}fitBounds(e){this._native&&e.getNative()&&this._native.fitBounds(e.getNative())}panTo(e){this._native&&e.getNative()&&this._native.panTo(e.getNative())}getClickPosition(e){return this._native?p.fromNative(this._native.getClickPosition(e)):null}addListener(e,n){if(this._native){const t=this._native.addListener(e,n);this._listeners.has(e)||this._listeners.set(e,[]),this._listeners.get(e).push(t)}}addListenerOnce(e,n){this._native&&this._native.addListenerOnce(e,n)}removeListeners(e){const n=this._listeners.get(e);n&&this._native&&(n.forEach(t=>this._native.removeListener(t)),this._listeners.delete(e))}trigger(e){this._native?.trigger(e)}getSourceObject(){return this._native?.getSourceObject()??null}getNative(){return this._native}getElement(){return this._el}}class W{constructor(e){this._native=null,this._map=null,this._options=e}init(e){const n=f().Voxel?.Maps;if(!n||!e.getNative())return;this._map=e;const t=this._options.position?new n.LatLng(this._options.position.getLatitude(),this._options.position.getLongitude()):void 0;this._native=new n.Marker({map:e.getNative(),position:t,template:this._options.template,onClick:this._options.onClick?(i,r)=>this._options.onClick(i,this):void 0,data:this._options.data})}getPosition(){return this._native?p.fromNative(this._native.getPosition()):this._options.position??null}setPosition(e){this._native&&e.getNative()&&this._native.setPosition(e.getNative())}getMap(){return this._map}setMap(e){this._native&&e.getNative()&&(this._native.setMap(e.getNative()),this._map=e)}remove(){return this._native?.remove(),this._map=null,this}addClass(e){this._native?.addClass(e)}removeClass(e){this._native?.removeClass(e)}getData(){return this._options.data}getNative(){return this._native}}class j{constructor(e){this._native=null,this._map=null,this._options=e}init(e){const n=f().Voxel?.Maps;if(!n||!e.getNative())return;this._map=e;const t=this._options.position?new n.LatLng(this._options.position.getLatitude(),this._options.position.getLongitude()):void 0;this._native=new n.Popup({map:e.getNative(),position:t,content:this._options.content})}setContent(e){this._native?.setContent(e)}setPosition(e){this._native&&e.getNative()&&this._native.setPosition(e.getNative())}show(){this._native?.show()}hide(){this._native?.hide()}getMap(){return this._map}getNative(){return this._native}}class U{constructor(e){this._native=null,this._map=null,this._options=e}init(e){const n=f().Voxel?.Maps;if(!n||!e.getNative())return;this._map=e;const t=this._options.center?new n.LatLng(this._options.center.getLatitude(),this._options.center.getLongitude()):void 0;this._native=new n.Circle({map:e.getNative(),center:t,radius:this._options.radius,visible:this._options.visible,className:this._options.className??"map-circle"})}hide(){this._native?.hide()}show(){this._native?.show()}setCenter(e){this._native&&e.getNative()&&this._native.setCenter(e.getNative())}setRadius(e){this._native?.setRadius(e)}getBounds(){return this._native?x.fromNative(this._native.getBounds()):null}getMap(){return this._map}getNative(){return this._native}}const b=class b{constructor(){this._native=null;const e=f().Voxel?.Maps;e&&(this._native=e.getGeocoder())}static getInstance(){return b._instance||(b._instance=new b),b._instance}geocode(e,n,t){if(!this._native){const s=typeof n=="function"?n:t;s&&s(!1);return}let i;if(e instanceof p){const s=e.getSourceObject();if(!s){const a=typeof n=="function"?n:t;a&&a(!1);return}i=s}else i=e;const r=s=>a=>{a===!1?s(!1):Array.isArray(a)?s(a.map(l=>({address:l.address,latlng:p.fromNative(l.latlng),viewport:x.fromNative(l.viewport)}))):s({address:a.address,latlng:p.fromNative(a.latlng),viewport:x.fromNative(a.viewport)})};if(typeof n=="function"){const s=n;this._native.geocode(i,r(s))}else t&&this._native.geocode(i,n,r(t))}getUserLocation(e){if(!this._native){e.positionFail?.();return}this._native.getUserLocation({fetchAddress:e.fetchAddress,receivedPosition:e.receivedPosition?n=>e.receivedPosition(p.fromNative(n)):void 0,receivedAddress:e.receivedAddress?n=>e.receivedAddress({address:n.address,latlng:p.fromNative(n.latlng),viewport:x.fromNative(n.viewport)}):void 0,positionFail:e.positionFail,addressFail:e.addressFail})}getNative(){return this._native}};b._instance=null;let z=b;class q{constructor(){this._native=null,this._map=null,this._markers=[]}async init(e){const n=await M();e.getNative()&&(this._map=e,this._native=new n.Clusterer({map:e.getNative()}),this._native&&(this._native._onClusterClick=()=>{this._onClusterClick?.()},this._native._onNonExpandableClusterClick=t=>{if(this._onNonExpandableClusterClick){const i=this._markers.filter(r=>t.some(s=>s===r.getNative()));this._onNonExpandableClusterClick(i)}}))}addMarkers(e){if(this._markers.push(...e),this._native){const n=e.map(t=>t.getNative()).filter(t=>t!==null);this._native.addMarkers(n)}}clearMarkers(){this._markers.forEach(e=>e.remove()),this._markers=[],this._native&&(this._native.markers=[])}render(){this._native?.render()}set onClusterClick(e){this._onClusterClick=e,this._native&&(this._native._onClusterClick=e)}set onNonExpandableClusterClick(e){this._onNonExpandableClusterClick=e}getMarkers(){return this._markers}getMap(){return this._map}getNative(){return this._native}}function O(o){z.getInstance().getUserLocation(o)}function L(o,e){if(e.length===0)return;if(e.length===1){const t=e[0].getPosition();t&&(o.panTo(t),o.setZoom(15));return}const n=new x;e.forEach(t=>{const i=t.getPosition();i&&n.extend(i)}),n.empty()||o.fitBounds(n)}function G(){if(typeof window<"u"&&window.wpApiSettings?.root)return window.wpApiSettings.root;if(typeof document<"u"){const o=document.querySelector('link[rel="https://api.w.org/"]');if(o){const e=o.getAttribute("href");if(e)return e}}if(typeof window<"u"&&window.location?.origin){const o=window.location.pathname.split("/").filter(Boolean),e=["wp-admin","wp-content","wp-includes","wp-json"];return o.length>0&&!e.includes(o[0])?window.location.origin+"/"+o[0]+"/wp-json/":window.location.origin+"/wp-json/"}return"/wp-json/"}P();function J(){return G()}function T(o){const e=o.querySelector("script.vxconfig");if(e&&e.textContent)try{return JSON.parse(e.textContent)}catch(n){console.error("[Map Block] Failed to parse vxconfig:",n)}return null}function Q(o,e){if(!o)return e;const n=typeof window<"u"?window.innerWidth:1200;let t="desktop";return n<768?t="mobile":n<1024&&(t="tablet"),t==="mobile"?o.mobile!==void 0?o.mobile:o.tablet!==void 0?o.tablet:o.desktop!==void 0?o.desktop:e:t==="tablet"&&o.tablet!==void 0?o.tablet:o.desktop!==void 0?o.desktop:e}function K(o,e){if(!e.dragSearch||e.source!=="search-form")return null;const n=document.createElement("div");if(n.className="ts-map-drag",e.dragSearchMode==="automatic"){const t=e.dragSearchDefault==="checked";n.innerHTML=`
			<a href="#" class="ts-map-btn ts-drag-toggle ${t?"active":""}">
				<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="ts-checkmark-icon">
					<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
				</svg>
				Search as I move the map
			</a>
		`}else n.innerHTML=`
			<a href="#" class="ts-search-area hidden ts-map-btn">
				<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="ts-search-icon">
					<path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
				</svg>
				Search this area
			</a>
		`;return o.insertBefore(n,o.firstChild),n}function X(o){const e=document.createElement("a");return e.href="#",e.rel="nofollow",e.role="button",e.className="vx-geolocate-me hidden",e.setAttribute("aria-label","Share your location"),e.innerHTML=`
		<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
			<path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>
		</svg>
	`,e.addEventListener("click",n=>{n.preventDefault(),e.classList.add("loading"),O({fetchAddress:!0,receivedPosition:t=>{console.log("[Map Block] Got user position:",t.getLatitude(),t.getLongitude()),e.classList.remove("loading");const i=k.get(o.querySelector(".ts-map"));i&&(i.map.panTo(t),i.map.setZoom(15),i.circle&&(i.circle.setCenter(t),i.circle.show()))},receivedAddress:t=>{console.log("[Map Block] Got user address:",t.address),o.dispatchEvent(new CustomEvent("geolocation:address",{detail:{address:t.address,latlng:{lat:t.latlng.getLatitude(),lng:t.latlng.getLongitude()}},bubbles:!0}))},positionFail:()=>{console.warn("[Map Block] Failed to get user position"),e.classList.remove("loading")},addressFail:()=>{console.warn("[Map Block] Failed to get user address")}})}),o.appendChild(e),e}function Z(o,e,n){const t=document.createElement("div");return t.className=e.source==="current-post"?"ts-map ts-map-autoload":"ts-map",t.setAttribute("data-config",JSON.stringify(n)),o.appendChild(t),t}async function Y(o,e){const n=dt();if(!n){console.warn("[Map Block] No post ID found for current-post mode");return}const i=`${J()}voxel-fse/v1/map/post-location?post_id=${n}`;try{const r=await fetch(i);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const s=await r.json(),a={center:{lat:s.latitude,lng:s.longitude},zoom:e.zoom,minZoom:e.minZoom,maxZoom:e.maxZoom,markers:[{lat:s.latitude,lng:s.longitude,template:encodeURIComponent(s.marker),uriencoded:!0}]};o.innerHTML="",Z(o,e,a).dispatchEvent(new CustomEvent("voxel:map-ready",{bubbles:!0}))}catch(r){console.error("[Map Block] Failed to fetch post location:",r)}}function tt(o,e){o.innerHTML="";const n={center:e.center,zoom:e.zoom,minZoom:e.minZoom,maxZoom:e.maxZoom},t=K(o,e),i=Z(o,e,n);X(o),et(i,n,o,e);const r=e.blockId;r&&window.addEventListener("voxel-search-submit",(s=>{s.detail.targetId===r&&nt(o,i,s.detail)})),window.addEventListener("voxel-fse:post-feed-markers",(s=>{const{markers:a}=s.detail;a.length>0&&(console.log("[Map Block] Received",a.length,"markers from Post Feed"),st(i,a))})),t&&lt(t,i)}const k=new Map;async function et(o,e,n,t){console.log("[Map Block] initializeVoxelMap called",{mapContainer:o,dataConfig:e});try{console.log("[Map Block] Waiting for Voxel.Maps..."),await M(),console.log("[Map Block] Voxel.Maps ready!")}catch(i){console.warn("[Map Block] Voxel.Maps not available:",i);return}try{const i=n.style.getPropertyValue("--vx-map-height"),r=window.getComputedStyle(n).getPropertyValue("--vx-map-height"),s=i||r||"400px";o.style.height=s,o.style.minHeight=s,n.style.width=n.style.width||"100%",console.log("[Map Block] Height values:",{inlineHeight:i,computedHeight:r,finalHeight:s,wrapperStyle:n.getAttribute("style")?.substring(0,100)});const a=new p(e.center.lat,e.center.lng);console.log("[Map Block] Center created:",a.getLatitude(),a.getLongitude());const l={el:o,center:a,zoom:e.zoom,minZoom:e.minZoom,maxZoom:e.maxZoom,draggable:!0};console.log("[Map Block] Creating VxMap with options:",{zoom:l.zoom,minZoom:l.minZoom,maxZoom:l.maxZoom});const h=new D(l);console.log("[Map Block] VxMap instance created, calling init()..."),await h.init(),console.log("[Map Block] VxMap.init() completed, native map:",h.getNative());let m=null;t.source==="search-form"&&(m=new q,await m.init(h),m.onClusterClick=()=>{console.log("[Map Block] Cluster clicked, zooming in")},m.onNonExpandableClusterClick=_=>{console.log("[Map Block] Non-expandable cluster clicked:",_.length,"markers")});const v=new j({});v.init(h);const g=new U({center:a,radius:5e3,className:"map-circle"});g.init(h),g.hide();const u={map:h,clusterer:m,markers:[],popup:v,circle:g,config:t};if(k.set(o,u),o._voxelMap=h.getNative(),o._vxMapInstance=u,h.addListener("zoom_changed",()=>{m&&m.render()}),h.addListener("idle",()=>{n.querySelector(".ts-drag-toggle.active")&&t.dragSearchMode==="automatic"&&ot(n,h,t)}),h.addListener("bounds_changed",()=>{const _=n.querySelector(".ts-search-area");_&&t.dragSearchMode==="manual"&&_.classList.remove("hidden")}),h.addListener("click",()=>{v.hide()}),e.markers&&e.markers.length>0){const _=await V(h,e.markers,v,m);u.markers=_,_.length>1&&m?m.render():_.length>0&&L(h,_)}console.log("[Map Block] Map initialized successfully with all features");const d=n.querySelector(".vx-geolocate-me");d?(d.classList.remove("hidden"),console.log("[Map Block] Geolocate button shown")):console.warn("[Map Block] Geolocate button not found in wrapper")}catch(i){console.error("[Map Block] Failed to initialize map:",i)}}async function V(o,e,n,t){if(!e)return[];const i=[];for(const r of e){const s=r.uriencoded?decodeURIComponent(r.template):r.template,a={position:new p(r.lat,r.lng),template:s,onClick:(h,m)=>{const v=m.getPosition();v&&(n.setPosition(v),n.setContent(s),n.show())},data:{lat:r.lat,lng:r.lng}},l=new W(a);l.init(o),i.push(l)}return t&&i.length>0&&t.addMarkers(i),i}function ot(o,e,n){const t=e.getBounds();if(!t)return;const i=t.getSouthWest(),r=t.getNorthEast();if(!i||!r)return;const s={bounds:{sw:{lat:i.getLatitude(),lng:i.getLongitude()},ne:{lat:r.getLatitude(),lng:r.getLongitude()}},center:{lat:e.getCenter()?.getLatitude(),lng:e.getCenter()?.getLongitude()},zoom:e.getZoom()};o.dispatchEvent(new CustomEvent("map:bounds-changed",{detail:s,bubbles:!0}))}async function nt(o,e,n,t){console.log("[Map Block] Search submitted:",n);const i=k.get(e);if(!i){console.warn("[Map Block] No map instance found");return}i.clusterer?i.clusterer.clearMarkers():i.markers.forEach(s=>s.remove()),i.markers=[],i.popup?.hide();const r=o.closest(".ts-map-widget");r&&r.dispatchEvent(new CustomEvent("search:updated",{detail:n,bubbles:!0}))}async function it(o,e){const n=o.querySelector(".ts-map");if(!n)return;const t=k.get(n);if(!t)return;t.clusterer?t.clusterer.clearMarkers():t.markers.forEach(s=>s.remove()),t.markers=[];const i=e.map(s=>({lat:s.lat,lng:s.lng,template:s.template,uriencoded:!1})),r=await V(t.map,i,t.popup,t.clusterer);t.markers=r,t.clusterer&&r.length>0?t.clusterer.render():r.length>0&&L(t.map,r)}async function st(o,e){const n=k.get(o);if(!n){console.warn("[Map Block] displayMarkersFromFeed: No map instance found");return}if(console.log("[Map Block] Displaying",e.length,"markers from feed"),n.clusterer?n.clusterer.clearMarkers():n.markers.forEach(r=>r.remove()),n.markers=[],n.popup?.hide(),e.length===0){console.log("[Map Block] No markers to display");return}const t=e.map(r=>({lat:r.lat,lng:r.lng,template:r.template,uriencoded:!1})),i=await V(n.map,t,n.popup,n.clusterer);n.markers=i,n.clusterer&&i.length>0?n.clusterer.render():i.length>0&&L(n.map,i),console.log("[Map Block] Successfully displayed",i.length,"markers from feed")}function rt(o,e,n){const t=o.querySelector(".ts-map");if(!t)return;const i=k.get(t);i?.circle&&(i.circle.setCenter(new p(e.lat,e.lng)),i.circle.setRadius(n),i.circle.show())}function at(o){const e=o.querySelector(".ts-map");if(!e)return;k.get(e)?.circle?.hide()}function ct(o){const e=o.querySelector(".ts-map");if(e)return k.get(e)}function lt(o,e,n){const t=o.querySelector(".ts-drag-toggle"),i=o.querySelector(".ts-search-area");t&&t.addEventListener("click",r=>{r.preventDefault(),t.classList.toggle("active")}),i&&i.addEventListener("click",r=>{r.preventDefault();const s=e.closest(".ts-map-widget");s&&s.dispatchEvent(new CustomEvent("search:area",{bubbles:!0}))})}function dt(){const o=document.body.className.split(" ");for(const n of o){const t=n.match(/^postid-(\d+)$/);if(t)return parseInt(t[1],10)}const e=document.querySelector("[data-post-id]");if(e){const n=e.getAttribute("data-post-id");if(n)return parseInt(n,10)}if(typeof window<"u"){const n=window.wp_post_id;if(n)return n}return null}function ht(o){const e=document.createElement("div");e.className="ts-map ts-map-loading",e.innerHTML=`
		<div class="ts-no-posts">
			<span class="ts-loader" aria-label="Loading map..."></span>
		</div>
	`,o.appendChild(e)}function B(){document.querySelectorAll(".voxel-fse-map").forEach(e=>{if(e.getAttribute("data-hydrated")==="true")return;const n=T(e);if(!n){console.warn("[Map Block] No vxconfig found for container:",e);return}const t=I(n);e.setAttribute("data-hydrated","true"),A(e,t),e.innerHTML="",ht(e),t.source==="current-post"?Y(e,t):tt(e,t),requestAnimationFrame(()=>{window.jQuery&&window.jQuery(document).trigger("voxel:markup-update")})})}function w(o){F()?M().then(o).catch(()=>{console.warn("[Map Block] Voxel.Maps not available, initializing anyway"),o()}):(document.addEventListener("maps:loaded",()=>{M().then(o).catch(o)},{once:!0}),setTimeout(()=>{M().then(o).catch(o)},1e4))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{w(B)}):w(B),window.addEventListener("turbo:load",()=>{w(B)}),window.addEventListener("pjax:complete",()=>{w(B)});let $;return window.addEventListener("resize",()=>{clearTimeout($),$=setTimeout(()=>{document.querySelectorAll('.voxel-fse-map[data-hydrated="true"]').forEach(e=>{if(e.getAttribute("data-hydrated")!=="true")return;const t=T(e);if(t){const i=I(t);A(e,i)}})},250)}),y.getMapInstance=ct,y.getResponsiveValueClient=Q,y.hideRadiusCircle=at,y.showRadiusCircle=rt,y.updateMapMarkers=it,Object.defineProperty(y,Symbol.toStringTag,{value:"Module"}),y})({});
