import{registerBlockType as F}from"@wordpress/blocks";import{useBlockProps as H,InspectorControls as j}from"@wordpress/block-editor";import{k as A,o as Y,e as V,A as W,a as L,R as M,C as k,T as $,p as G}from"../TypographyPopup-BXz72zyZ.js";import{I as J,V as q}from"../InspectorTabs-DmdaThza.js";import{f as X}from"../RepeaterControl-BJok1GGr.js";import{useState as U,useRef as u,useEffect as E}from"react";import{PanelBody as K,ToggleControl as b}from"@wordpress/components";import{__ as o}from"@wordpress/i18n";import"@wordpress/api-fetch";/* empty css                            */import"@wordpress/data";import"../voxelShim-DB_Ue-9R.js";import{g as z}from"../useAdvancedTabProps-BnJDQbKr.js";import{r as Q}from"../backgroundElements-Ui-iCrLV.js";import{V as Z}from"../VoxelGridIcon-D5dF5acW.js";import"react-dom";import"../generateAdvancedStyles-CRpLcHXt.js";import"../generateVoxelStyles-oZeaeuKH.js";function ee({label:e,value:t,onChange:n,placeholder:l="YYYY-MM-DD HH:mm:ss",help:d,context:x="post"}){const[f,y]=U(!1),h=u(null),r=u(null),m=()=>typeof t=="string"&&t.startsWith("@tags()")&&t.includes("@endtags()"),v=()=>{if(!m())return t||"";const i=t.match(/@tags\(\)(.*?)@endtags\(\)/s);return i?i[1]:t},S=i=>i?`@tags()${i}@endtags()`:"",T=()=>{y(!0)},R=()=>{y(!0)},C=()=>{window.confirm(o("Are you sure?","voxel-fse"))&&n("")},_=i=>{i&&n(S(i)),y(!1)},a=i=>{if(!i||m())return i;try{const s=new Date(i);if(isNaN(s.getTime()))return i;const D=s.getFullYear(),N=String(s.getMonth()+1).padStart(2,"0"),O=String(s.getDate()).padStart(2,"0"),w=String(s.getHours()).padStart(2,"0"),B=String(s.getMinutes()).padStart(2,"0"),P=String(s.getSeconds()).padStart(2,"0");return`${D}-${N}-${O} ${w}:${B}:${P}`}catch{return i}},p=m(),c=m()?t:a(t);return E(()=>{if(!h.current||p){r.current&&(r.current.destroy(),r.current=null);return}return r.current=X(h.current,{enableTime:!0,enableSeconds:!0,dateFormat:"Y-m-d H:i:S",time_24hr:!0,defaultDate:t||void 0,onChange:(i,s)=>{n(s)}}),()=>{r.current&&(r.current.destroy(),r.current=null)}},[p,t,n]),React.createElement("div",{className:"voxel-dynamic-tag-datetime-control",style:{marginBottom:"16px"}},React.createElement("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"}},React.createElement(A,{onClick:T}),React.createElement("label",{style:{fontSize:"11px",fontWeight:500,textTransform:"uppercase",color:"#1e1e1e",margin:0}},e)),React.createElement("style",null,`
				.voxel-dynamic-tag-datetime-control .datetime-text-input {
					width: 100%;
					padding: 8px;
					border: 1px solid #949494;
					border-radius: 2px;
					font-size: 13px;
					line-height: 1.4;
					background: #fff;
					color: #1e1e1e;
				}
				.voxel-dynamic-tag-datetime-control .datetime-text-input:focus {
					border-color: #007cba;
					box-shadow: 0 0 0 1px #007cba;
					outline: none;
				}
				.voxel-dynamic-tag-datetime-control .datetime-text-input::placeholder {
					color: #757575;
				}
			`),React.createElement("div",null,p?React.createElement("div",{className:"edit-voxel-tags",style:{backgroundColor:"rgb(47, 47, 49)",borderRadius:"10px",overflow:"hidden",padding:"12px"}},React.createElement("div",{style:{marginBottom:"12px"}},React.createElement("span",{style:{color:"#fff",fontSize:"13px",fontFamily:"inherit",wordBreak:"break-all"}},v())),React.createElement("div",{style:{height:"1px",backgroundColor:"rgba(255, 255, 255, 0.15)",marginBottom:"8px"}}),React.createElement("div",{style:{display:"flex"}},React.createElement("button",{type:"button",className:"edit-tags",onClick:R,style:{flex:1,background:"transparent",border:"none",color:"rgba(255, 255, 255, 0.8)",fontSize:"10px",fontWeight:600,letterSpacing:"0.5px",cursor:"pointer",padding:"6px 0",textAlign:"left"}},o("EDIT TAGS","voxel-fse")),React.createElement("button",{type:"button",className:"disable-tags",onClick:C,style:{flex:1,background:"transparent",border:"none",color:"rgba(255, 255, 255, 0.5)",fontSize:"10px",fontWeight:600,letterSpacing:"0.5px",cursor:"pointer",padding:"6px 0",textAlign:"right"}},o("DISABLE TAGS","voxel-fse")))):React.createElement(React.Fragment,null,React.createElement("input",{ref:h,type:"text",className:"datetime-text-input",defaultValue:c||"",placeholder:l,autoComplete:"off"}),d&&React.createElement("p",{className:"components-base-control__help",style:{marginTop:"8px",fontSize:"12px",color:"#757575"}},d))),f&&React.createElement(Y,{value:v(),onChange:_,label:e,context:x,onClose:()=>y(!1),autoOpen:!0}))}function g(e){if(!e||typeof e!="object")return{};const t={};return e.fontFamily&&(t.fontFamily=e.fontFamily),typeof e.fontSize=="number"&&(t.fontSize=`${e.fontSize}${e.fontSizeUnit||"px"}`),e.fontWeight&&(t.fontWeight=e.fontWeight),e.fontStyle&&e.fontStyle!=="default"&&(t.fontStyle=e.fontStyle),e.textTransform&&e.textTransform!=="none"&&(t.textTransform=e.textTransform),e.textDecoration&&e.textDecoration!=="none"&&(t.textDecoration=e.textDecoration),typeof e.lineHeight=="number"&&(t.lineHeight=`${e.lineHeight}${e.lineHeightUnit||"px"}`),typeof e.letterSpacing=="number"&&(t.letterSpacing=`${e.letterSpacing}${e.letterSpacingUnit||"px"}`),typeof e.wordSpacing=="number"&&(t.wordSpacing=`${e.wordSpacing}${e.wordSpacingUnit||"px"}`),t}function ne(e){return{dueDate:e.dueDate??e.due_date??e.target_date??"",countdownEndedText:e.countdownEndedText??e.countdown_ended_text??e.ended_text??"Countdown ended",hideSeconds:e.hideSeconds??e.hide_seconds??!1,hideMinutes:e.hideMinutes??e.hide_minutes??!1,hideHours:e.hideHours??e.hide_hours??!1,hideDays:e.hideDays??e.hide_days??!1,disableAnimation:e.disableAnimation??e.disable_animation??!1,horizontalOrientation:e.horizontalOrientation??e.horizontal_orientation??!1,itemSpacing:e.itemSpacing??e.item_spacing??15,itemSpacing_tablet:e.itemSpacing_tablet??e.item_spacing_tablet??10,itemSpacing_mobile:e.itemSpacing_mobile??e.item_spacing_mobile??5,itemSpacingUnit:e.itemSpacingUnit??e.item_spacing_unit??"px",contentSpacing:e.contentSpacing??e.content_spacing??10,contentSpacing_tablet:e.contentSpacing_tablet??e.content_spacing_tablet??8,contentSpacing_mobile:e.contentSpacing_mobile??e.content_spacing_mobile??5,contentSpacingUnit:e.contentSpacingUnit??e.content_spacing_unit??"px",textColor:e.textColor??e.text_color??"",numberColor:e.numberColor??e.number_color??"",endedColor:e.endedColor??e.ended_color??"",textTypography:e.textTypography??e.text_typography??{},numberTypography:e.numberTypography??e.number_typography??{},endedTypography:e.endedTypography??e.ended_typography??{}}}function te({config:e,isEditor:t=!1}){const n=ne(e),[l,d]=U({days:0,hours:0,minutes:0,seconds:0,isExpired:!1}),x=u(null),f=u(null),y=u(null),h=u(null),r=u(l);r.current=l;const m=u(Math.floor(Date.now()/1e3)),v=a=>{if(!n.dueDate)return{days:0,hours:0,minutes:0,seconds:0,isExpired:!0};const c=Math.floor(new Date(n.dueDate).getTime()/1e3)-a;if(c<0)return{days:0,hours:0,minutes:0,seconds:0,isExpired:!0};const i=Math.floor(c/86400),s=Math.floor(c%86400/3600),D=Math.floor(c%3600/60),N=Math.floor(c%60);return{days:i,hours:s,minutes:D,seconds:N,isExpired:!1}},S=(a,p)=>{if(!a.current||n.disableAnimation){a.current&&(a.current.innerText=p.toString());return}a.current.style.animationName="vx-fade-out-up",setTimeout(()=>{a.current&&(a.current.innerText=p.toString(),a.current.style.animationName="vx-fade-in-up")},500)};E(()=>{m.current=Math.floor(Date.now()/1e3);const a=v(m.current);d(a),r.current=a;const p=setInterval(()=>{m.current++;const c=v(m.current),i=r.current;c.days!==i.days&&S(x,c.days),c.hours!==i.hours&&S(f,c.hours),c.minutes!==i.minutes&&S(y,c.minutes),c.seconds!==i.seconds&&S(h,c.seconds),d(c),r.current=c},1e3);return()=>clearInterval(p)},[e.dueDate,e.disableAnimation]);const T=()=>{const a={};return n.itemSpacing>=0&&(a["--item-spacing-desktop"]=`${n.itemSpacing}${n.itemSpacingUnit}`),n.itemSpacing_tablet>=0&&(a["--item-spacing-tablet"]=`${n.itemSpacing_tablet}${n.itemSpacingUnit}`),n.itemSpacing_mobile>=0&&(a["--item-spacing-mobile"]=`${n.itemSpacing_mobile}${n.itemSpacingUnit}`),n.contentSpacing>=0&&(a["--content-spacing-desktop"]=`${n.contentSpacing}${n.contentSpacingUnit}`),n.contentSpacing_tablet>=0&&(a["--content-spacing-tablet"]=`${n.contentSpacing_tablet}${n.contentSpacingUnit}`),n.contentSpacing_mobile>=0&&(a["--content-spacing-mobile"]=`${n.contentSpacing_mobile}${n.contentSpacingUnit}`),a},R=()=>{const a={};return n.textColor&&(a["--text-color"]=n.textColor),n.numberColor&&(a["--number-color"]=n.numberColor),n.endedColor&&(a["--ended-color"]=n.endedColor),a},C={...T(),...R()},_=React.createElement("script",{type:"application/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(n)}});return React.createElement(React.Fragment,null,_,React.createElement("div",{className:"ts-countdown-widget flexify",style:C,"data-config":JSON.stringify({days:l.days,hours:l.hours,minutes:l.minutes,seconds:l.seconds,due:new Date(n.dueDate).getTime()/1e3,now:Date.now()/1e3})},!l.isExpired&&React.createElement("ul",{className:`countdown-timer flexify simplify-ul${n.horizontalOrientation?" ts-ct-inline":""}${n.disableAnimation?" ts-disable-animation":""}`,style:{gap:`${n.itemSpacing}${n.itemSpacingUnit}`}},!n.hideDays&&React.createElement("li",{style:{display:"flex",flexDirection:n.horizontalOrientation?"row":"column",alignItems:"center",justifyContent:"center",gap:`${n.contentSpacing}${n.contentSpacingUnit}`}},React.createElement("span",{ref:x,className:"timer-days",style:{color:n.numberColor||void 0,animation:n.disableAnimation?"none":void 0,...g(n.numberTypography)}},l.days),React.createElement("p",{style:{color:n.textColor||void 0,...g(n.textTypography)}},o("Days","voxel-fse"))),!n.hideHours&&React.createElement("li",{style:{display:"flex",flexDirection:n.horizontalOrientation?"row":"column",alignItems:"center",justifyContent:"center",gap:`${n.contentSpacing}${n.contentSpacingUnit}`}},React.createElement("span",{ref:f,className:"timer-hours",style:{color:n.numberColor||void 0,animation:n.disableAnimation?"none":void 0,...g(n.numberTypography)}},l.hours),React.createElement("p",{style:{color:n.textColor||void 0,...g(n.textTypography)}},o("Hours","voxel-fse"))),!n.hideMinutes&&React.createElement("li",{style:{display:"flex",flexDirection:n.horizontalOrientation?"row":"column",alignItems:"center",justifyContent:"center",gap:`${n.contentSpacing}${n.contentSpacingUnit}`}},React.createElement("span",{ref:y,className:"timer-minutes",style:{color:n.numberColor||void 0,animation:n.disableAnimation?"none":void 0,...g(n.numberTypography)}},l.minutes),React.createElement("p",{style:{color:n.textColor||void 0,...g(n.textTypography)}},o("Minutes","voxel-fse"))),!n.hideSeconds&&React.createElement("li",{style:{display:"flex",flexDirection:n.horizontalOrientation?"row":"column",alignItems:"center",justifyContent:"center",gap:`${n.contentSpacing}${n.contentSpacingUnit}`}},React.createElement("span",{ref:h,className:"timer-seconds",style:{color:n.numberColor||void 0,animation:n.disableAnimation?"none":void 0,...g(n.numberTypography)}},l.seconds),React.createElement("p",{style:{color:n.textColor||void 0,...g(n.textTypography)}},o("Seconds","voxel-fse")))),React.createElement("div",{className:"countdown-ended",style:{display:l.isExpired?"flex":"none",color:n.endedColor||void 0,...g(n.endedTypography)}},n.countdownEndedText)))}function oe({attributes:e,setAttributes:t}){return React.createElement(K,{title:o("Content","voxel-fse"),initialOpen:!0},React.createElement(ee,{label:o("Due Date","voxel-fse"),value:e.dueDate,onChange:n=>t({dueDate:n}),placeholder:"YYYY-MM-DD HH:mm:ss",context:"post"}),React.createElement(V,{label:o("Countdown Ended Text","voxel-fse"),value:e.countdownEndedText,onChange:n=>t({countdownEndedText:n}),help:o("Message displayed when countdown reaches zero","voxel-fse"),context:"post"}),React.createElement(b,{label:o("Hide seconds","voxel-fse"),checked:e.hideSeconds,onChange:n=>t({hideSeconds:n})}),React.createElement(b,{label:o("Hide minutes","voxel-fse"),checked:e.hideMinutes,onChange:n=>t({hideMinutes:n})}),React.createElement(b,{label:o("Hide hours","voxel-fse"),checked:e.hideHours,onChange:n=>t({hideHours:n})}),React.createElement(b,{label:o("Hide days","voxel-fse"),checked:e.hideDays,onChange:n=>t({hideDays:n})}))}function ae({attributes:e,setAttributes:t}){return React.createElement(W,{defaultPanel:"style",attributes:e,setAttributes:t,stateAttribute:"styleTabOpenPanel"},React.createElement(L,{id:"style",title:o("Style","voxel-fse")},React.createElement(b,{label:o("Disable reveal animation","voxel-fse"),checked:e.disableAnimation,onChange:n=>t({disableAnimation:n}),help:o("Disable the fade animation when numbers change","voxel-fse")}),React.createElement(b,{label:o("Horizontal orientation","voxel-fse"),checked:e.horizontalOrientation,onChange:n=>t({horizontalOrientation:n}),help:o("Display number and label side by side","voxel-fse")}),React.createElement(M,{label:o("Item spacing","voxel-fse"),attributes:e,setAttributes:t,attributeBaseName:"itemSpacing",min:0,max:200,step:1}),React.createElement(M,{label:o("Content spacing","voxel-fse"),attributes:e,setAttributes:t,attributeBaseName:"contentSpacing",min:0,max:200,step:1}),React.createElement(k,{label:o("Text Color","voxel-fse"),value:e.textColor,onChange:n=>t({textColor:n})}),React.createElement(k,{label:o("Number Color","voxel-fse"),value:e.numberColor,onChange:n=>t({numberColor:n})}),React.createElement(k,{label:o("Ended Color","voxel-fse"),value:e.endedColor,onChange:n=>t({endedColor:n})}),React.createElement($,{label:o("Text Typography","voxel-fse"),attributes:e,setAttributes:t,typographyAttributeName:"textTypography"}),React.createElement($,{label:o("Number Typography","voxel-fse"),attributes:e,setAttributes:t,typographyAttributeName:"numberTypography"}),React.createElement($,{label:o("Ended Typography","voxel-fse"),attributes:e,setAttributes:t,typographyAttributeName:"endedTypography"})))}function ie(){return`countdown-${Math.random().toString(36).substring(2,11)}`}function le({attributes:e,setAttributes:t}){const n=e.blockId||"countdown",l=z(e,{blockId:n,baseClass:"voxel-fse-countdown-block-editor",selectorPrefix:"voxel-fse-countdown"}),d=H({className:l.className,style:l.styles});E(()=>{e.blockId||t({blockId:ie()})},[e.blockId,t]);const x={dueDate:e.dueDate,countdownEndedText:e.countdownEndedText,hideSeconds:e.hideSeconds,hideMinutes:e.hideMinutes,hideHours:e.hideHours,hideDays:e.hideDays,disableAnimation:e.disableAnimation,horizontalOrientation:e.horizontalOrientation,itemSpacing:e.itemSpacing,itemSpacing_tablet:e.itemSpacing_tablet,itemSpacing_mobile:e.itemSpacing_mobile,itemSpacingUnit:e.itemSpacingUnit,contentSpacing:e.contentSpacing,contentSpacing_tablet:e.contentSpacing_tablet,contentSpacing_mobile:e.contentSpacing_mobile,contentSpacingUnit:e.contentSpacingUnit,textColor:e.textColor,numberColor:e.numberColor,endedColor:e.endedColor,textTypography:e.textTypography,numberTypography:e.numberTypography,endedTypography:e.endedTypography};return E(()=>{if(!e.dueDate){const f=new Date;f.setDate(f.getDate()+1),t({dueDate:f.toISOString()})}},[]),React.createElement(React.Fragment,null,React.createElement(j,null,React.createElement(J,{tabs:[{id:"content",label:o("Content","voxel-fse"),icon:"",render:()=>React.createElement(oe,{attributes:e,setAttributes:t})},{id:"style",label:o("Style","voxel-fse"),icon:"",render:()=>React.createElement(ae,{attributes:e,setAttributes:t})},{id:"advanced",label:o("Advanced","voxel-fse"),icon:"",render:()=>React.createElement(G,{attributes:e,setAttributes:t})},{id:"voxel",label:o("Voxel","voxel-fse"),icon:"/wp-content/themes/voxel/assets/images/post-types/logo.svg",render:()=>React.createElement(q,{attributes:e,setAttributes:t})}]})),React.createElement("div",{...d},React.createElement(te,{config:x,isEditor:!0})))}function ce({attributes:e}){const t=e.blockId||"countdown",n=z(e,{blockId:t,baseClass:"voxel-fse-countdown",selectorPrefix:"voxel-fse-countdown"}),l=H.save({id:n.elementId,className:n.className,style:n.styles,...n.customAttrs,"data-visibility-behavior":e.visibilityBehavior||void 0,"data-visibility-rules":e.visibilityRules?.length?JSON.stringify(e.visibilityRules):void 0,"data-loop-source":e.loopSource||void 0,"data-loop-limit":e.loopLimit||void 0,"data-loop-offset":e.loopOffset||void 0}),d={dueDate:e.dueDate,countdownEndedText:e.countdownEndedText,hideSeconds:e.hideSeconds,hideMinutes:e.hideMinutes,hideHours:e.hideHours,hideDays:e.hideDays,disableAnimation:e.disableAnimation,horizontalOrientation:e.horizontalOrientation,itemSpacing:e.itemSpacing,itemSpacing_tablet:e.itemSpacing_tablet,itemSpacing_mobile:e.itemSpacing_mobile,itemSpacingUnit:e.itemSpacingUnit,contentSpacing:e.contentSpacing,contentSpacing_tablet:e.contentSpacing_tablet,contentSpacing_mobile:e.contentSpacing_mobile,contentSpacingUnit:e.contentSpacingUnit,textColor:e.textColor,numberColor:e.numberColor,endedColor:e.endedColor,textTypography:e.textTypography,numberTypography:e.numberTypography,endedTypography:e.endedTypography};return React.createElement("div",{...l},n.responsiveCSS&&React.createElement("style",{dangerouslySetInnerHTML:{__html:n.responsiveCSS}}),Q(e,!1,void 0,void 0,n.uniqueSelector),React.createElement("script",{type:"application/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(d)}}),React.createElement("div",{className:"ts-countdown-widget flexify","data-config":'{"days":0,"hours":0,"minutes":0,"seconds":0,"due":0,"now":0}'},React.createElement("ul",{className:"countdown-timer flexify simplify-ul",style:{display:"none"}},React.createElement("li",null,React.createElement("span",{className:"timer-days"},"0"),React.createElement("p",null,"Days")),React.createElement("li",null,React.createElement("span",{className:"timer-hours"},"0"),React.createElement("p",null,"Hours")),React.createElement("li",null,React.createElement("span",{className:"timer-minutes"},"0"),React.createElement("p",null,"Minutes")),React.createElement("li",null,React.createElement("span",{className:"timer-seconds"},"0"),React.createElement("p",null,"Seconds"))),React.createElement("div",{className:"countdown-ended",style:{display:"none"}},e.countdownEndedText)))}const re="https://schemas.wp.org/trunk/block.json",se=2,de="voxel-fse/countdown",me="Countdown (VX)",pe="voxel-fse",ge="Display a countdown timer to a specific date and time",fe=["countdown","timer","clock","voxel"],ue="voxel-fse",ye={html:!1,anchor:!0,align:["wide","full"]},xe={blockId:{type:"string",default:""},dueDate:{type:"string",default:""},countdownEndedText:{type:"string",default:"The countdown has ended."},hideSeconds:{type:"boolean",default:!1},hideMinutes:{type:"boolean",default:!1},hideHours:{type:"boolean",default:!1},hideDays:{type:"boolean",default:!1},disableAnimation:{type:"boolean",default:!1},horizontalOrientation:{type:"boolean",default:!1},itemSpacing:{type:"number",default:15},itemSpacing_tablet:{type:"number",default:10},itemSpacing_mobile:{type:"number",default:5},itemSpacingUnit:{type:"string",default:"px"},contentSpacing:{type:"number",default:10},contentSpacing_tablet:{type:"number",default:8},contentSpacing_mobile:{type:"number",default:5},contentSpacingUnit:{type:"string",default:"px"},textColor:{type:"string",default:""},numberColor:{type:"string",default:""},endedColor:{type:"string",default:""},textTypography:{type:"object",default:{}},textTypographyFontFamily:{type:"string",default:""},numberTypography:{type:"object",default:{}},numberTypographyFontFamily:{type:"string",default:""},endedTypography:{type:"object",default:{}},endedTypographyFontFamily:{type:"string",default:""},styleTabOpenPanel:{type:"string",default:"style"},_comment_voxel_tab:"VoxelTab attributes for visibility and loop features",visibilityBehavior:{type:"string",default:"show",enum:["show","hide"]},visibilityRules:{type:"array",default:[],items:{type:"object"}},loopEnabled:{type:"boolean",default:!1},loopSource:{type:"string",default:""},loopProperty:{type:"string",default:""},loopLimit:{type:"number"},loopOffset:{type:"number"}},he="file:./index.tsx",Se="file:./editor.css",be="file:./frontend.js",ve="file:./render.php",I={$schema:re,apiVersion:se,name:de,title:me,category:pe,description:ge,keywords:fe,textdomain:ue,supports:ye,attributes:xe,editorScript:he,editorStyle:Se,viewScript:be,render:ve};F(I.name,{...I,icon:Z,edit:le,save:ce});
