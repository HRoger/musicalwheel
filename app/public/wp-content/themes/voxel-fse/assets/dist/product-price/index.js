import{registerBlockType as $}from"@wordpress/blocks";import{useBlockProps as _,InspectorControls as P}from"@wordpress/block-editor";import{useSelect as I}from"@wordpress/data";import{useMemo as v,useState as x,useEffect as E}from"react";import{__ as a}from"@wordpress/i18n";import{E as u}from"../EmptyPlaceholder-CnO9R1NI.js";import{A as L,a as O,T as W,R as j}from"../TypographyPopup-CkDwan7Z.js";import{I as M}from"../InspectorTabs-C-Yyx0JZ.js";import"@wordpress/components";import"@wordpress/api-fetch";/* empty css                            */import{R as y}from"../RepeaterControl-DaYyJwAm.js";import"../voxelShim-DB_Ue-9R.js";import{g as H}from"../useAdvancedTabProps-BnJDQbKr.js";import{r as B}from"../backgroundElements-BCKss4qj.js";import{V as U}from"../VoxelGridIcon-D5dF5acW.js";import"react-dom";import"../generateAdvancedStyles-CRpLcHXt.js";import"../generateVoxelStyles-oZeaeuKH.js";function J(e){const t={};if(e.priceColor&&(t["--vx-price-color"]=e.priceColor),e.strikethroughTextColor&&(t["--vx-strike-text-color"]=e.strikethroughTextColor),e.strikethroughLineColor&&(t["--vx-strike-line-color"]=e.strikethroughLineColor),e.strikethroughWidth){const o=e.strikethroughWidthUnit||"px";t["--vx-strike-width"]=`${e.strikethroughWidth}${o}`}return e.outOfStockColor&&(t["--vx-nostock-color"]=e.outOfStockColor),e.typography&&(e.typography.fontSize&&(t["--vx-price-font-size"]=e.typography.fontSize),e.typography.fontWeight&&(t["--vx-price-font-weight"]=e.typography.fontWeight),e.typography.fontFamily&&(t["--vx-price-font-family"]=e.typography.fontFamily),e.typography.lineHeight&&(t["--vx-price-line-height"]=e.typography.lineHeight),e.typography.letterSpacing&&(t["--vx-price-letter-spacing"]=e.typography.letterSpacing),e.typography.textTransform&&(t["--vx-price-text-transform"]=e.typography.textTransform)),t}function V(e,t){return{priceColor:e.priceColor,strikethroughTextColor:e.strikethroughTextColor,strikethroughLineColor:e.strikethroughLineColor,strikethroughWidth:e.strikethroughWidth,strikethroughWidthUnit:e.strikethroughWidthUnit,outOfStockColor:e.outOfStockColor,typography:e.typography,postId:t}}function z({attributes:e,priceData:t,isLoading:o,error:r,context:i,postId:s}){const n=v(()=>J(e),[e]),c=v(()=>V(e,s),[e,s]),l=[`vxfse-product-price-${e.blockId||"product-price"}`,e.hideDesktop?"vxfse-hide-desktop":"",e.hideTablet?"vxfse-hide-tablet":"",e.hideMobile?"vxfse-hide-mobile":"",e.customClasses||""].filter(Boolean).join(" ");return o?React.createElement("div",{className:`vxfse-product-price ${l}`.trim(),style:n},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(c)}}),i==="editor"&&React.createElement(u,null)):r?React.createElement("div",{className:`vxfse-product-price ${l}`.trim(),style:n},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(c)}}),i==="editor"&&React.createElement(u,null)):t?t.isAvailable?t.hasDiscount?React.createElement("div",{className:`vxfse-product-price ${l}`.trim(),style:n},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(c)}}),React.createElement("span",{className:"vx-price"},t.formattedDiscountPrice,t.suffix),React.createElement("span",{className:"vx-price"},React.createElement("s",null,t.formattedRegularPrice,t.suffix))):React.createElement("div",{className:`vxfse-product-price ${l}`.trim(),style:n},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(c)}}),React.createElement("span",{className:"vx-price"},t.formattedRegularPrice,t.suffix)):t.errorMessage==="No product configured"?i==="frontend"?React.createElement("div",{className:`vxfse-product-price ${l}`.trim(),style:n},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(c)}})):React.createElement("div",{className:`vxfse-product-price ${l}`.trim(),style:n},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(c)}}),React.createElement(u,null)):React.createElement("div",{className:`vxfse-product-price ${l}`.trim(),style:n},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(c)}}),React.createElement("span",{className:"vx-price no-stock"},t.errorMessage||"Unavailable")):React.createElement("div",{className:`vxfse-product-price ${l}`.trim(),style:n},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(c)}}),i==="editor"&&React.createElement(u,null))}function F({attributes:e,setAttributes:t}){return React.createElement(L,{defaultPanel:"chart",attributes:e,setAttributes:t,stateAttribute:"contentTabOpenPanel"},React.createElement(O,{id:"chart",title:a("Chart","voxel-fse")},React.createElement(W,{label:a("Typography","voxel-fse"),attributes:e,setAttributes:t,typographyAttributeName:"typography"}),React.createElement(y,{label:a("Color","voxel-fse"),attributes:e,setAttributes:t,attributeBaseName:"priceColor"}),React.createElement(y,{label:a("Linethrough text color","voxel-fse"),attributes:e,setAttributes:t,attributeBaseName:"strikethroughTextColor"}),React.createElement(y,{label:a("Linethrough line color","voxel-fse"),attributes:e,setAttributes:t,attributeBaseName:"strikethroughLineColor"}),React.createElement(j,{label:a("Linethrough line width","voxel-fse"),attributes:e,setAttributes:t,attributeBaseName:"strikethroughWidth",min:1,max:10,step:.5,unitAttributeName:"strikethroughWidthUnit"}),React.createElement(y,{label:a("Out of stock color","voxel-fse"),attributes:e,setAttributes:t,attributeBaseName:"outOfStockColor"})))}function N(e,t){const o=[],r=[],i=[],s=`.vxfse-product-price-${t}`;if(e.priceColor_tablet&&r.push(`${s} { --vx-price-color: ${e.priceColor_tablet}; }`),e.strikethroughTextColor_tablet&&r.push(`${s} { --vx-strike-text-color: ${e.strikethroughTextColor_tablet}; }`),e.strikethroughLineColor_tablet&&r.push(`${s} { --vx-strike-line-color: ${e.strikethroughLineColor_tablet}; }`),e.strikethroughWidth_tablet!==void 0){const c=e.strikethroughWidthUnit||"px";r.push(`${s} { --vx-strike-width: ${e.strikethroughWidth_tablet}${c}; }`)}if(e.outOfStockColor_tablet&&r.push(`${s} { --vx-nostock-color: ${e.outOfStockColor_tablet}; }`),e.priceColor_mobile&&i.push(`${s} { --vx-price-color: ${e.priceColor_mobile}; }`),e.strikethroughTextColor_mobile&&i.push(`${s} { --vx-strike-text-color: ${e.strikethroughTextColor_mobile}; }`),e.strikethroughLineColor_mobile&&i.push(`${s} { --vx-strike-line-color: ${e.strikethroughLineColor_mobile}; }`),e.strikethroughWidth_mobile!==void 0){const c=e.strikethroughWidthUnit||"px";i.push(`${s} { --vx-strike-width: ${e.strikethroughWidth_mobile}${c}; }`)}e.outOfStockColor_mobile&&i.push(`${s} { --vx-nostock-color: ${e.outOfStockColor_mobile}; }`);let n="";return o.length>0&&(n+=o.join(`
`)),r.length>0&&(n+=`
@media (max-width: 1024px) {
${r.join(`
`)}
}`),i.length>0&&(n+=`
@media (max-width: 767px) {
${i.join(`
`)}
}`),n}function A(){return typeof window<"u"&&window.wpApiSettings?.root?window.wpApiSettings.root:"/wp-json/"}async function b(e){const o=`${A()}voxel-fse/v1/product-price?post_id=${e}`,r=await fetch(o);if(!r.ok){const i=await r.json().catch(()=>({}));throw new Error(i.message||`HTTP error ${r.status}`)}return r.json()}function G(){return Math.random().toString(36).substring(2,9)}function q({attributes:e,setAttributes:t,context:o,clientId:r}){const i=e.blockId||r,s=_({className:`vxfse-product-price-editor vxfse-product-price-${i}`}),[n,c]=x(null),[d,l]=x(!1),[f,m]=x(null),T=I(p=>p("core/editor")?.getCurrentPostId?.()??null,[]),h=o.postId||T;E(()=>{e.blockId||t({blockId:G()})},[e.blockId,t]),E(()=>{let p=!1;async function R(){if(!h){c(null);return}l(!0),m(null);try{const g=await b(h);p||c(g)}catch(g){if(!p){const S=g instanceof Error?g.message:"Failed to load";S.includes("product field")||m(S),c(null)}}finally{p||l(!1)}}return R(),()=>{p=!0}},[h]);const C=v(()=>N(e,i),[e,i]);return React.createElement(React.Fragment,null,React.createElement(P,null,React.createElement(M,{tabs:[{id:"content",label:a("Content","voxel-fse"),icon:"î¤¬",render:()=>React.createElement(F,{attributes:e,setAttributes:t})}],includeAdvancedTab:!0,includeVoxelTab:!0,attributes:e,setAttributes:t})),React.createElement("div",{...s},C&&React.createElement("style",{dangerouslySetInnerHTML:{__html:C}}),h?React.createElement(z,{attributes:e,priceData:n,isLoading:d,error:f,context:"editor",postId:h}):React.createElement("div",{className:"vxfse-product-price-placeholder"},React.createElement("span",{className:"vx-price"},a("Product Price - Select a post with product data","voxel-fse")))))}function w(e){return function({attributes:o}){const r=H(o,{blockId:o.blockId||"product-price",baseClass:"vxfse-product-price"}),i=o.blockId||"product-price",s=N(o,i),n=[r.responsiveCSS,s].filter(Boolean).join(`
`),c=_.save({id:r.elementId,className:r.className}),d={priceColor:o.priceColor,strikethroughTextColor:o.strikethroughTextColor,strikethroughLineColor:o.strikethroughLineColor,strikethroughWidth:o.strikethroughWidth,strikethroughWidthUnit:o.strikethroughWidthUnit,outOfStockColor:o.outOfStockColor,typography:o.typography},l={};if(o.priceColor&&(l["--vx-price-color"]=o.priceColor),o.strikethroughTextColor&&(l["--vx-strike-text-color"]=o.strikethroughTextColor),o.strikethroughLineColor&&(l["--vx-strike-line-color"]=o.strikethroughLineColor),o.strikethroughWidth){const m=o.strikethroughWidthUnit||"px";l["--vx-strike-width"]=`${o.strikethroughWidth}${m}`}o.outOfStockColor&&(l["--vx-nostock-color"]=o.outOfStockColor),o.typography?.fontSize&&(l["--vx-price-font-size"]=o.typography.fontSize),o.typography?.fontWeight&&(l["--vx-price-font-weight"]=o.typography.fontWeight);const f={...l,...r.styles||{}};return React.createElement("div",{...c,"data-block-id":o.blockId,style:f,"data-visibility-behavior":o.visibilityBehavior||void 0,"data-visibility-rules":o.visibilityRules?.length?JSON.stringify(o.visibilityRules):void 0,"data-loop-source":o.loopSource||void 0,"data-loop-limit":o.loopLimit||void 0,"data-loop-offset":o.loopOffset||void 0,...r.customAttrs},n&&React.createElement("style",{dangerouslySetInnerHTML:{__html:n}}),B(o,!1,void 0,void 0,r.uniqueSelector),React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(d)}}),e&&React.createElement("div",{className:"voxel-fse-block-placeholder",style:{display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f3f4f6",padding:"8px 16px",minHeight:"32px",borderRadius:"4px"}},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"20",height:"20",fill:"currentColor",style:{opacity:.4,marginRight:"8px"}},React.createElement("rect",{x:"4",y:"4",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"10",y:"4",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"16",y:"4",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"4",y:"10",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"10",y:"10",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"16",y:"10",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"4",y:"16",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"10",y:"16",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"16",y:"16",width:"4",height:"4",rx:"0.5"})),React.createElement("span",{style:{opacity:.5,fontSize:"14px"}},"Product Price")))}}const X=w(!1),K=w(!0),Q="https://schemas.wp.org/trunk/block.json",Y=3,Z="voxel-fse/product-price",D="1.0.0",ee="Product Price (VX)",oe="voxel-fse",te="Display product pricing with discount support - converted from Voxel Elementor widget following Plan C+ architecture",re=["product","price","ecommerce","voxel"],ie="voxel-fse",le={html:!1,align:["left","center","right"],anchor:!0,className:!0,customClassName:!0},ne=["postId","postType"],ce={blockId:{type:"string",default:""},priceColor:{type:"string",default:""},priceColor_tablet:{type:"string",default:""},priceColor_mobile:{type:"string",default:""},strikethroughTextColor:{type:"string",default:""},strikethroughTextColor_tablet:{type:"string",default:""},strikethroughTextColor_mobile:{type:"string",default:""},strikethroughLineColor:{type:"string",default:""},strikethroughLineColor_tablet:{type:"string",default:""},strikethroughLineColor_mobile:{type:"string",default:""},strikethroughWidth:{type:"number",default:1},strikethroughWidth_tablet:{type:"number"},strikethroughWidth_mobile:{type:"number"},strikethroughWidthUnit:{type:"string",default:"px"},outOfStockColor:{type:"string",default:""},outOfStockColor_tablet:{type:"string",default:""},outOfStockColor_mobile:{type:"string",default:""},typography:{type:"object",default:{}},hideDesktop:{type:"boolean",default:!1},hideTablet:{type:"boolean",default:!1},hideMobile:{type:"boolean",default:!1},customClasses:{type:"string",default:""},contentTabOpenPanel:{type:"string",default:"chart"},_comment_voxel_tab:"VoxelTab attributes for visibility and loop features",visibilityBehavior:{type:"string",default:"show",enum:["show","hide"]},visibilityRules:{type:"array",default:[],items:{type:"object"}},loopEnabled:{type:"boolean",default:!1},loopSource:{type:"string",default:""},loopProperty:{type:"string",default:""},loopLimit:{type:"string",default:""},loopOffset:{type:"string",default:""}},se="file:./index.js",ae="file:./frontend.js",pe="file:./render.php",k={$schema:Q,apiVersion:Y,name:Z,version:D,title:ee,category:oe,description:te,keywords:re,textdomain:ie,supports:le,usesContext:ne,attributes:ce,editorScript:se,viewScript:ae,render:pe},he=[{attributes:k.attributes,save:K}];$(k.name,{...k,icon:U,edit:q,save:X,deprecated:he});
