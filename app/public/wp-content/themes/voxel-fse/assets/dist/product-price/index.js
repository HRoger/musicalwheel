import{registerBlockType as T}from"@wordpress/blocks";import{useBlockProps as _,InspectorControls as $}from"@wordpress/block-editor";import{useSelect as I}from"@wordpress/data";import{useMemo as y,useState as u,useEffect as S}from"react";import{__ as a}from"@wordpress/i18n";import{E as m}from"../EmptyPlaceholder-BsL18qxN.js";import{A as P,a as L,T as O,R as W}from"../TypographyPopup-CAcEJ5NA.js";import{I as j}from"../InspectorTabs-Bq2wAh4W.js";import"@wordpress/components";import"@wordpress/api-fetch";/* empty css                            */import{R as g}from"../RepeaterControl-BnF4Wtgt.js";import"../voxelShim-DB_Ue-9R.js";import{g as M}from"../useAdvancedTabProps-BnJDQbKr.js";import{r as H}from"../backgroundElements-Ui-iCrLV.js";import{V as B}from"../VoxelGridIcon-D5dF5acW.js";import"react-dom";import"../generateAdvancedStyles-CRpLcHXt.js";import"../generateVoxelStyles-oZeaeuKH.js";function U(e){const o={};if(e.priceColor&&(o["--vx-price-color"]=e.priceColor),e.strikethroughTextColor&&(o["--vx-strike-text-color"]=e.strikethroughTextColor),e.strikethroughLineColor&&(o["--vx-strike-line-color"]=e.strikethroughLineColor),e.strikethroughWidth){const s=e.strikethroughWidthUnit||"px";o["--vx-strike-width"]=`${e.strikethroughWidth}${s}`}return e.outOfStockColor&&(o["--vx-nostock-color"]=e.outOfStockColor),e.typography&&(e.typography.fontSize&&(o["--vx-price-font-size"]=e.typography.fontSize),e.typography.fontWeight&&(o["--vx-price-font-weight"]=e.typography.fontWeight),e.typography.fontFamily&&(o["--vx-price-font-family"]=e.typography.fontFamily),e.typography.lineHeight&&(o["--vx-price-line-height"]=e.typography.lineHeight),e.typography.letterSpacing&&(o["--vx-price-letter-spacing"]=e.typography.letterSpacing),e.typography.textTransform&&(o["--vx-price-text-transform"]=e.typography.textTransform)),o}function J(e,o){return{priceColor:e.priceColor,strikethroughTextColor:e.strikethroughTextColor,strikethroughLineColor:e.strikethroughLineColor,strikethroughWidth:e.strikethroughWidth,strikethroughWidthUnit:e.strikethroughWidthUnit,outOfStockColor:e.outOfStockColor,typography:e.typography,postId:o}}function V({attributes:e,priceData:o,isLoading:s,error:r,context:i,postId:l}){const n=y(()=>U(e),[e]),t=y(()=>J(e,l),[e,l]),c=[`vxfse-product-price-${e.blockId||"product-price"}`,e.hideDesktop?"vxfse-hide-desktop":"",e.hideTablet?"vxfse-hide-tablet":"",e.hideMobile?"vxfse-hide-mobile":"",e.customClasses||""].filter(Boolean).join(" ");return s?React.createElement("div",{className:`vxfse-product-price ${c}`.trim(),style:n},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(t)}}),React.createElement(m,null)):r?React.createElement("div",{className:`vxfse-product-price ${c}`.trim(),style:n},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(t)}}),React.createElement(m,null)):o?o.isAvailable?o.hasDiscount?React.createElement("div",{className:`vxfse-product-price ${c}`.trim(),style:n},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(t)}}),React.createElement("span",{className:"vx-price"},o.formattedDiscountPrice,o.suffix),React.createElement("span",{className:"vx-price"},React.createElement("s",null,o.formattedRegularPrice,o.suffix))):React.createElement("div",{className:`vxfse-product-price ${c}`.trim(),style:n},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(t)}}),React.createElement("span",{className:"vx-price"},o.formattedRegularPrice,o.suffix)):o.errorMessage==="No product configured"?i==="frontend"?React.createElement("div",{className:`vxfse-product-price ${c}`.trim(),style:n},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(t)}})):React.createElement("div",{className:`vxfse-product-price ${c}`.trim(),style:n},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(t)}}),React.createElement(m,null)):React.createElement("div",{className:`vxfse-product-price ${c}`.trim(),style:n},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(t)}}),React.createElement("span",{className:"vx-price no-stock"},o.errorMessage||"Unavailable")):React.createElement("div",{className:`vxfse-product-price ${c}`.trim(),style:n},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(t)}}),React.createElement(m,null))}function z({attributes:e,setAttributes:o}){return React.createElement(P,{defaultPanel:"chart",attributes:e,setAttributes:o,stateAttribute:"contentTabOpenPanel"},React.createElement(L,{id:"chart",title:a("Chart","voxel-fse")},React.createElement(O,{label:a("Typography","voxel-fse"),attributes:e,setAttributes:o,typographyAttributeName:"typography"}),React.createElement(g,{label:a("Color","voxel-fse"),attributes:e,setAttributes:o,attributeBaseName:"priceColor"}),React.createElement(g,{label:a("Linethrough text color","voxel-fse"),attributes:e,setAttributes:o,attributeBaseName:"strikethroughTextColor"}),React.createElement(g,{label:a("Linethrough line color","voxel-fse"),attributes:e,setAttributes:o,attributeBaseName:"strikethroughLineColor"}),React.createElement(W,{label:a("Linethrough line width","voxel-fse"),attributes:e,setAttributes:o,attributeBaseName:"strikethroughWidth",min:1,max:10,step:.5,unitAttributeName:"strikethroughWidthUnit"}),React.createElement(g,{label:a("Out of stock color","voxel-fse"),attributes:e,setAttributes:o,attributeBaseName:"outOfStockColor"})))}function N(e,o){const s=[],r=[],i=[],l=`.vxfse-product-price-${o}`;if(e.priceColor_tablet&&r.push(`${l} { --vx-price-color: ${e.priceColor_tablet}; }`),e.strikethroughTextColor_tablet&&r.push(`${l} { --vx-strike-text-color: ${e.strikethroughTextColor_tablet}; }`),e.strikethroughLineColor_tablet&&r.push(`${l} { --vx-strike-line-color: ${e.strikethroughLineColor_tablet}; }`),e.strikethroughWidth_tablet!==void 0){const t=e.strikethroughWidthUnit||"px";r.push(`${l} { --vx-strike-width: ${e.strikethroughWidth_tablet}${t}; }`)}if(e.outOfStockColor_tablet&&r.push(`${l} { --vx-nostock-color: ${e.outOfStockColor_tablet}; }`),e.priceColor_mobile&&i.push(`${l} { --vx-price-color: ${e.priceColor_mobile}; }`),e.strikethroughTextColor_mobile&&i.push(`${l} { --vx-strike-text-color: ${e.strikethroughTextColor_mobile}; }`),e.strikethroughLineColor_mobile&&i.push(`${l} { --vx-strike-line-color: ${e.strikethroughLineColor_mobile}; }`),e.strikethroughWidth_mobile!==void 0){const t=e.strikethroughWidthUnit||"px";i.push(`${l} { --vx-strike-width: ${e.strikethroughWidth_mobile}${t}; }`)}e.outOfStockColor_mobile&&i.push(`${l} { --vx-nostock-color: ${e.outOfStockColor_mobile}; }`);let n="";return s.length>0&&(n+=s.join(`
`)),r.length>0&&(n+=`
@media (max-width: 1024px) {
${r.join(`
`)}
}`),i.length>0&&(n+=`
@media (max-width: 767px) {
${i.join(`
`)}
}`),n}function F(){return typeof window<"u"&&window.wpApiSettings?.root?window.wpApiSettings.root:"/wp-json/"}async function A(e){const s=`${F()}voxel-fse/v1/product-price?post_id=${e}`,r=await fetch(s);if(!r.ok){const i=await r.json().catch(()=>({}));throw new Error(i.message||`HTTP error ${r.status}`)}return r.json()}function G(){return Math.random().toString(36).substring(2,9)}function q({attributes:e,setAttributes:o,context:s,clientId:r}){const i=e.blockId||r,l=_({className:`vxfse-product-price-editor vxfse-product-price-${i}`}),[n,t]=u(null),[d,c]=u(!1),[x,v]=u(null),w=I(p=>p("core/editor")?.getCurrentPostId?.()??null,[]),h=s.postId||w;S(()=>{e.blockId||o({blockId:G()})},[e.blockId,o]),S(()=>{let p=!1;async function C(){if(!h){t(null);return}c(!0),v(null);try{const f=await A(h);p||t(f)}catch(f){if(!p){const R=f instanceof Error?f.message:"Failed to load";R.includes("product field")||v(R),t(null)}}finally{p||c(!1)}}return C(),()=>{p=!0}},[h]);const k=y(()=>N(e,i),[e,i]);return React.createElement(React.Fragment,null,React.createElement($,null,React.createElement(j,{tabs:[{id:"content",label:a("Content","voxel-fse"),icon:"î¤¬",render:()=>React.createElement(z,{attributes:e,setAttributes:o})}],includeAdvancedTab:!0,includeVoxelTab:!0,attributes:e,setAttributes:o})),React.createElement("div",{...l},k&&React.createElement("style",{dangerouslySetInnerHTML:{__html:k}}),h?React.createElement(V,{attributes:e,priceData:n,isLoading:d,error:x,context:"editor",postId:h}):React.createElement("div",{className:"vxfse-product-price-placeholder"},React.createElement("span",{className:"vx-price"},a("Product Price - Select a post with product data","voxel-fse")))))}function X({attributes:e}){const o=M(e,{blockId:e.blockId||"product-price",baseClass:"vxfse-product-price"}),s=e.blockId||"product-price",r=N(e,s),i=[o.responsiveCSS,r].filter(Boolean).join(`
`),l=_.save({id:o.elementId,className:o.className}),n={priceColor:e.priceColor,strikethroughTextColor:e.strikethroughTextColor,strikethroughLineColor:e.strikethroughLineColor,strikethroughWidth:e.strikethroughWidth,strikethroughWidthUnit:e.strikethroughWidthUnit,outOfStockColor:e.outOfStockColor,typography:e.typography},t={};if(e.priceColor&&(t["--vx-price-color"]=e.priceColor),e.strikethroughTextColor&&(t["--vx-strike-text-color"]=e.strikethroughTextColor),e.strikethroughLineColor&&(t["--vx-strike-line-color"]=e.strikethroughLineColor),e.strikethroughWidth){const c=e.strikethroughWidthUnit||"px";t["--vx-strike-width"]=`${e.strikethroughWidth}${c}`}e.outOfStockColor&&(t["--vx-nostock-color"]=e.outOfStockColor),e.typography?.fontSize&&(t["--vx-price-font-size"]=e.typography.fontSize),e.typography?.fontWeight&&(t["--vx-price-font-weight"]=e.typography.fontWeight);const d={...t,...o.styles||{}};return React.createElement("div",{...l,"data-block-id":e.blockId,style:d,"data-visibility-behavior":e.visibilityBehavior||void 0,"data-visibility-rules":e.visibilityRules?.length?JSON.stringify(e.visibilityRules):void 0,"data-loop-source":e.loopSource||void 0,"data-loop-limit":e.loopLimit||void 0,"data-loop-offset":e.loopOffset||void 0,...o.customAttrs},i&&React.createElement("style",{dangerouslySetInnerHTML:{__html:i}}),H(e,!1,void 0,void 0,o.uniqueSelector),React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(n)}}),React.createElement("div",{className:"voxel-fse-block-placeholder",style:{display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f3f4f6",padding:"8px 16px",minHeight:"32px",borderRadius:"4px"}},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"20",height:"20",fill:"currentColor",style:{opacity:.4,marginRight:"8px"}},React.createElement("rect",{x:"4",y:"4",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"10",y:"4",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"16",y:"4",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"4",y:"10",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"10",y:"10",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"16",y:"10",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"4",y:"16",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"10",y:"16",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"16",y:"16",width:"4",height:"4",rx:"0.5"})),React.createElement("span",{style:{opacity:.5,fontSize:"14px"}},"Product Price")))}const b="https://schemas.wp.org/trunk/block.json",K=3,Q="voxel-fse/product-price",Y="1.0.0",Z="Product Price (VX)",D="voxel-fse",ee="Display product pricing with discount support - converted from Voxel Elementor widget following Plan C+ architecture",oe=["product","price","ecommerce","voxel"],te="voxel-fse",re={html:!1,align:["left","center","right"],anchor:!0,className:!0,customClassName:!0},ie=["postId","postType"],le={blockId:{type:"string",default:""},priceColor:{type:"string",default:""},priceColor_tablet:{type:"string",default:""},priceColor_mobile:{type:"string",default:""},strikethroughTextColor:{type:"string",default:""},strikethroughTextColor_tablet:{type:"string",default:""},strikethroughTextColor_mobile:{type:"string",default:""},strikethroughLineColor:{type:"string",default:""},strikethroughLineColor_tablet:{type:"string",default:""},strikethroughLineColor_mobile:{type:"string",default:""},strikethroughWidth:{type:"number",default:1},strikethroughWidth_tablet:{type:"number"},strikethroughWidth_mobile:{type:"number"},strikethroughWidthUnit:{type:"string",default:"px"},outOfStockColor:{type:"string",default:""},outOfStockColor_tablet:{type:"string",default:""},outOfStockColor_mobile:{type:"string",default:""},typography:{type:"object",default:{}},hideDesktop:{type:"boolean",default:!1},hideTablet:{type:"boolean",default:!1},hideMobile:{type:"boolean",default:!1},customClasses:{type:"string",default:""},contentTabOpenPanel:{type:"string",default:"chart"},_comment_voxel_tab:"VoxelTab attributes for visibility and loop features",visibilityBehavior:{type:"string",default:"show",enum:["show","hide"]},visibilityRules:{type:"array",default:[],items:{type:"object"}},loopEnabled:{type:"boolean",default:!1},loopSource:{type:"string",default:""},loopProperty:{type:"string",default:""},loopLimit:{type:"string",default:""},loopOffset:{type:"string",default:""}},ne="file:./index.js",ce="file:./frontend.js",se="file:./render.php",E={$schema:b,apiVersion:K,name:Q,version:Y,title:Z,category:D,description:ee,keywords:oe,textdomain:te,supports:re,usesContext:ie,attributes:le,editorScript:ne,viewScript:ce,render:se};T(E.name,{...E,icon:B,edit:q,save:X});
