import{useState as j,useRef as G,useMemo as oe,useEffect as Q,useCallback as v}from"react";import{createPortal as Te}from"react-dom";import{useSelect as Ue}from"@wordpress/data";import{a as We}from"./siteUrl-7x5eJEvc.js";import He from"@wordpress/api-fetch";import{V as ie,r as Ne}from"./voxelIcons-B76o57vm.js";import"./voxelShim-DB_Ue-9R.js";import"./backgroundElements-Ui-iCrLV.js";import"./MediaPopup-CXePoOCG.js";import{F as ue,D as $e}from"./DatePicker-pD2Z7qly.js";function je(e,t){const n={},s=[t];return e.width&&e.width>0&&(n.width=`${e.width}%`,n.flexGrow=0,n.flexShrink=0),e.hideFilter&&s.push("vx-hidden"),e.alignContent&&(n.justifyContent=e.alignContent),e.hideLabel&&s.push("hide-label"),{style:n,className:s.join(" ")}}function Z(e,t){return je(e,t)}function pe(e){const t={},n=["ts-field-popup","triggers-blur"];return e.customPopupEnabled&&(e.popupMinWidth&&e.popupMinWidth>0&&(t.minWidth=`${e.popupMinWidth}px`),e.popupMaxWidth&&e.popupMaxWidth>0&&(t.maxWidth=`${e.popupMaxWidth}px`),e.popupMaxHeight&&e.popupMaxHeight>0&&(t.maxHeight=`${e.popupMaxHeight}px`),e.popupCenterPosition&&n.push("ts-popup-centered")),{style:t,className:n.join(" ")}}function qe({attributes:e,postTypes:t,context:n,onSubmit:s,onPostTypeChange:d,onFilterChange:y}){const[r,a]=j(()=>({currentPostType:e.postTypes[0]||"",filterValues:{},activeFilterCount:0,portalActive:!1,loading:!1,resetting:!1,narrowedValues:null,narrowingFilters:!1,lastModifiedFilter:null})),g=G(!1),f=G(!1),m=G(null),$=oe(()=>t.find(N=>N.key===r.currentPostType),[t,r.currentPostType]),u=oe(()=>e.filterLists[r.currentPostType]||[],[e.filterLists,r.currentPostType]);Q(()=>{e.postTypes.length>0&&!e.postTypes.includes(r.currentPostType)&&a(N=>({...N,currentPostType:e.postTypes[0],filterValues:{}}))},[e.postTypes,r.currentPostType]),Q(()=>{if(!$?.filters)return;const N={};let c=!1;$.filters.forEach(h=>{h.key in r.filterValues||h.value!==null&&h.value!==void 0&&(N[h.key]=h.value,c=!0)}),c&&a(h=>({...h,filterValues:{...h.filterValues,...N}}))},[$?.filters,r.currentPostType]),Q(()=>{if(n!=="editor"||r.resetting||!$?.filters)return;(e.filterLists?.[r.currentPostType]||[]).forEach(c=>{const h=r.filterValues[c.filterKey];c.defaultValueEnabled&&c.defaultValue!==void 0&&c.defaultValue!==""&&c.defaultValue!==null?h!==c.defaultValue&&h!==null&&a(R=>({...R,filterValues:{...R.filterValues,[c.filterKey]:c.defaultValue}})):h!=null&&a(R=>({...R,filterValues:{...R.filterValues,[c.filterKey]:void 0}}))})},[n,r.currentPostType,e.filterLists,r.resetting,$?.filters]),Q(()=>{const N=Object.values(r.filterValues).filter(c=>c!=null&&c!==""&&c!==!1).length;a(c=>({...c,activeFilterCount:N}))},[r.filterValues]);const x=v(N=>{a(c=>c.currentPostType===N?c:{...c,currentPostType:N,filterValues:{}}),n==="editor"&&d&&d(N),n==="editor"&&y&&y({}),n==="frontend"&&s&&(f.current&&e.updateUrl!==!1&&_e({},N),f.current=!0,setTimeout(()=>{s({postType:N})},50))},[n,s,d,y,e.updateUrl]),_=v((N,c)=>{f.current=!0,a(h=>{const R={...h.filterValues,[N]:c};return n==="editor"&&y&&setTimeout(()=>y(R),0),{...h,filterValues:R,lastModifiedFilter:N}})},[n,y]),O=v((N=!1)=>{const c={};$?.filters?.forEach(R=>{R.resets_to!==null&&R.resets_to!==void 0?c[R.key]=R.resets_to:c[R.key]=null});const h=Object.values(c).filter(R=>R!=null&&R!=="").length;if(a(R=>({...R,filterValues:c,activeFilterCount:h,resetting:!0,portalActive:N?!1:R.portalActive,narrowedValues:null,lastModifiedFilter:null})),setTimeout(()=>{a(R=>({...R,resetting:!1}))},100),n==="editor"&&y&&y(c),n==="frontend"){e.updateUrl!==!1&&Ke(r.currentPostType);const R=new CustomEvent("voxel-search-clear",{detail:{postType:r.currentPostType}});window.dispatchEvent(R)}},[n,r.currentPostType,y,e.updateUrl,$?.filters]),P=v(()=>{a(N=>({...N,portalActive:!N.portalActive}))},[]),C=v(async()=>{if(!e.adaptiveFiltering||n!=="frontend")return;if(g.current){g.current=!1;return}const N=u.filter(R=>R.type==="range"||R.type==="terms");if(N.length===0)return;const c=new URLSearchParams;c.set("type",r.currentPostType),r.lastModifiedFilter&&c.set("_last_modified",r.lastModifiedFilter),Object.entries(r.filterValues).forEach(([R,b])=>{b!=null&&b!==""&&(Array.isArray(b)?c.set(R,b.join(",")):typeof b=="object"?c.set(R,JSON.stringify(b)):c.set(R,String(b)))});const h=[];N.forEach(R=>{if(R.type==="terms"){const b=$?.filters?.find(o=>o.key===R.filterKey);if(b?.props?.terms){const o=T=>{T.forEach(J=>{J.term_taxonomy_id&&h.push(J.term_taxonomy_id),J.children&&Array.isArray(J.children)&&o(J.children)})};o(b.props.terms)}}}),a(R=>({...R,narrowingFilters:!0}));try{const R=We(),b=await fetch(`${R}voxel-fse/v1/search-form/narrow-filters?${c.toString()}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({term_taxonomy_ids:h})});if(!b.ok)throw new Error(`HTTP ${b.status}`);const o=await b.json();o.success&&o.data?(a(T=>({...T,narrowedValues:{ranges:o.data.ranges||{},terms:o.data.terms||{}},narrowingFilters:!1})),g.current=!0):a(T=>({...T,narrowingFilters:!1}))}catch(R){console.error("[useSearchForm] Adaptive filtering error:",R),a(b=>({...b,narrowingFilters:!1}))}},[e.adaptiveFiltering,n,u,r.currentPostType,r.filterValues,$]);Q(()=>{if(!(!e.adaptiveFiltering||n!=="frontend"))return m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{C()},300),()=>{m.current&&clearTimeout(m.current)}},[r.filterValues,e.adaptiveFiltering,n,C]);const E=v((N,c)=>{a(h=>({...h,loading:!0})),s&&s({postType:c,...N}),n==="frontend"&&e.updateUrl!==!1&&f.current&&_e(N,c),a(h=>({...h,loading:!1}))},[n,s,e.updateUrl]),B=G(null);Q(()=>{if(e.searchOn==="change"&&n==="frontend"){const N=JSON.stringify({type:r.currentPostType,filters:r.filterValues});if(B.current===N)return;if(B.current===null){B.current=N;return}B.current=N;const c=setTimeout(()=>{E(r.filterValues,r.currentPostType)},300);return()=>{clearTimeout(c)}}},[r.filterValues,r.currentPostType,e.searchOn,n,E]);const V=v(()=>{f.current=!0,E(r.filterValues,r.currentPostType)},[E,r.filterValues,r.currentPostType]);return{state:r,setCurrentPostType:x,setFilterValue:_,clearAll:O,togglePortal:P,submit:V,currentPostTypeConfig:$,filterConfigs:u,narrowedValues:r.narrowedValues,narrowingFilters:r.narrowingFilters}}function Ke(e){const t=new URL(window.location.href),n=[];t.searchParams.forEach((s,d)=>{(d.startsWith("filter_")||d==="post_type")&&n.push(d),d==="type"&&!e&&n.push(d),d!=="type"&&d!=="page"&&d!=="pg"&&n.push(d)}),n.forEach(s=>t.searchParams.delete(s)),e&&t.searchParams.set("type",e),window.history.replaceState({},"",t.toString())}function ze(e,t){return Object.hasOwn(t,e)}function _e(e,t){const n=new URL(window.location.href),s=[];n.searchParams.forEach((d,y)=>{(y.startsWith("filter_")||y==="post_type")&&s.push(y),(y==="type"||ze(y,e))&&s.push(y)}),s.forEach(d=>n.searchParams.delete(d)),t&&n.searchParams.set("type",t),Object.entries(e).forEach(([d,y])=>{if(!(y==null||y==="")&&!(typeof y=="string"&&y==="..")&&!(typeof y=="object"&&!Array.isArray(y)&&!Object.values(y).some(g=>g!=null&&g!=="")))if(Array.isArray(y)){const r=y.join(",");r&&n.searchParams.set(d,r)}else typeof y=="object"?n.searchParams.set(d,JSON.stringify(y)):n.searchParams.set(d,String(y))}),window.history.replaceState({},"",n.toString())}function Le(e){return typeof e=="string"&&e.includes("@tags()")}function Pe(e){if(!Le(e))return e;const t=e.match(/@tags\(\)(.*?)@endtags\(\)/s);return t?t[1]:e}async function Ie(e,t={}){try{return(await He({path:"/voxel-fse/v1/dynamic-data/render",method:"POST",data:{expression:e,context:t}})).rendered}catch(n){return console.error("Failed to render dynamic tag:",n),e}}function we(){return typeof document>"u"?!1:document.body.classList.contains("logged-in")}function Ge(){return typeof document>"u"?[]:Array.from(document.body.classList).filter(n=>n.startsWith("role-")||["administrator","editor","author","contributor","subscriber"].includes(n)).map(n=>n.replace("role-",""))}function Je(e){const t=e.filterKey;switch(t){case"user:logged_in":return we();case"user:logged_out":return!we();case"user:role":{if(!we())return!1;const n=Ge(),s=e.value||"";switch(e.operator){case"equals":return n.includes(s);case"not_equals":return!n.includes(s);default:return n.includes(s)}}default:return console.warn(`Unknown visibility rule type: ${t}`),!0}}function Qe(e){return!e||e.length===0?!0:e.every(t=>Je(t))}function Ye(e){const{rowVisibility:t="show",visibilityRules:n=[]}=e;if(!n||n.length===0)return!0;const s=Qe(n);return t==="hide"?!s:s}function Xe({config:e,filterData:t,value:n,onChange:s,blockId:d}){const y=d?`voxel-popup-${d}`:"",r=G(null),a=G(null),[g,f]=j(!1),[m,$]=j(""),[u,x]=j(""),_=typeof n=="string"?n:"",O=t.props?.placeholder||t.label||"Type keywords...",P=e.displayAs||t.props?.display_as||"popup",C=t.icon||"";Q(()=>{x(_)},[_]),Q(()=>{g&&($(_),setTimeout(()=>{a.current?.focus()},50))},[g,_]);const E=U=>{x(U.target.value)},B=v(()=>{const U=u.trim();s(U.length>0?U:"")},[u,s]),V=v(U=>{U.key==="Enter"&&(U.preventDefault(),B())},[B]),N=U=>{$(U.target.value)},c=v(()=>{f(!0)},[]),h=v(()=>{const U=m.trim();s(U.length>0?U:""),f(!1)},[m,s]),R=v(()=>{$(""),s("")},[s]),b=v(U=>{U.key==="Enter"&&(U.preventDefault(),h())},[h]);if(P==="inline"){const{style:U,className:I}=Z(e,"ts-form-group ts-inline-filter");return React.createElement("div",{className:I,style:U},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:"ts-input-icon flexify"},C&&React.createElement("span",{dangerouslySetInnerHTML:{__html:C}}),React.createElement("input",{type:"text",value:u,onChange:E,onBlur:B,onKeyDown:V,placeholder:O,className:"inline-input"})))}const o=_.trim().length>0,{style:T,className:J}=Z(e,"ts-form-group"),L=pe(e);return React.createElement("div",{className:J,style:T},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:r,className:`ts-filter ts-popup-target ${o?"ts-filled":""}`,onClick:c,onMouseDown:U=>U.preventDefault(),role:"button",tabIndex:0},C&&React.createElement("span",{dangerouslySetInnerHTML:{__html:C}}),React.createElement("div",{className:"ts-filter-text"},o?_:O)),React.createElement(ue,{isOpen:g,target:r,title:"",icon:C,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:h,onClear:R,onClose:()=>f(!1),className:`${y}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:L.style},React.createElement("div",{className:"ts-input-icon ts-sticky-top flexify"},React.createElement("span",null,ie.search),React.createElement("input",{ref:a,type:"text",value:m,onChange:N,onKeyDown:b,placeholder:O,className:"autofocus border-none"}))))}const Ze=()=>window.noUiSlider;function Fe(e){if(e==null||e==="")return[];if(Array.isArray(e))return e.map(Number).filter(s=>!isNaN(s));if(typeof e=="string"&&e.includes("..")){const n=e.split(".."),s=[];if(n[0]!==""){const d=Number(n[0]);isNaN(d)||s.push(d)}if(n[1]!==""){const d=Number(n[1]);isNaN(d)||s.push(d)}return s}const t=Number(e);return isNaN(t)?[]:[t]}function et({config:e,filterData:t,value:n,onChange:s,blockId:d,narrowedValues:y,isNarrowing:r}){const a=[d?`voxel-popup-${d}`:"",e.id?`elementor-repeater-item-${e.id}`:""].filter(Boolean).join(" "),g=G(null),f=G(null),m=G(null),[$,u]=j(!1),x=t.props||{},_=x.range_start??x.min??0,O=x.range_end??x.max??100,P=x.step_size??x.step??1,C=x.placeholder||t.label||"Range",E=e.displayAs||t.props?.display_as||"popup",B=x.handles||"single",V=x.compare||"in_range",N=e.filterKey,c=y?.ranges?.[N],h=c?.min??_,R=c?.max??O,b=typeof x.format=="object"?x.format:{numeric:!1,prefix:"",suffix:""},o=b.prefix||"",T=b.suffix||"",J=t.icon||"",L=B==="single"?[V==="in_range"?R:h]:V==="in_range"?[h,R]:[h,h],U=Fe(n),I=U.length>0?U:L,[q,te]=j(I),Y=v(S=>{const K=b.numeric?S.toLocaleString():String(S);return`${o}${K}${T}`},[b.numeric,o,T]),le=v(S=>S.map(K=>Y(K)).join(" — "),[Y]),se=n!=null&&n!=="",H=se?le(U.length>0?U:q):C,i=le(q),M=v(()=>{if(!f.current||m.current)return;let S,K;B==="single"?(K=V==="in_range"?[1,0]:[0,1],S=[...q]):(K=V==="in_range"?[0,1,0]:[1,0,1],S=[...q]);const F=Ze();if(!F){console.error("noUiSlider not loaded - window.noUiSlider is undefined");return}F.create(f.current,{start:S,connect:K,range:{min:h,max:R},step:P,behaviour:"tap-drag"}),m.current=f.current.noUiSlider,m.current.on("update",ne=>{te(ne.map(A=>Number(A)))}),requestAnimationFrame(()=>{m.current&&m.current.set(S,!1)})},[B,V,q,h,R,P]),W=v(()=>{m.current&&(m.current.destroy(),m.current=null)},[]);Q(()=>{const S=Fe(n),K=S.length>0?S:L;te(K),m.current&&(m.current.set(K,!1),requestAnimationFrame(()=>{m.current&&m.current.set(K,!1)}))},[n,h,R,B,V]),Q(()=>{if($&&E==="popup"){const S=setTimeout(()=>{M()},100);return()=>clearTimeout(S)}return()=>{E==="popup"&&W()}},[$,E,M,W]),Q(()=>{if(E==="inline")return M(),()=>W()},[E,M,W]),Q(()=>{if(!m.current||!c)return;const S=q.map(K=>K<h?h:K>R?R:K);m.current.updateOptions({range:{min:h,max:R},start:S}),te(S)},[c,h,R,B]);const ee=v(()=>{u(!0)},[]),ce=v(S=>!S.length||S.some(K=>typeof K!="number")?!1:S.join("..")!==L.join(".."),[L]),D=v(S=>ce(S)?S.join(".."):null,[ce]),re=S=>{const F=[S.target.value===""?h:Number(S.target.value),q[1]??R];te(F),m.current&&m.current.set(F),E==="minmax"&&s(D(F))},ae=S=>{const K=S.target.value===""?R:Number(S.target.value),F=[q[0]??h,K];te(F),m.current&&m.current.set(F),E==="minmax"&&s(D(F))},fe=v(()=>{s(D(q)),u(!1)},[q,D,s]),l=v(()=>{te(L),m.current&&m.current.set(L),s(null)},[L,s]),w=()=>React.createElement("div",{className:"ts-minmax"},React.createElement("input",{type:"number",className:"inline-input input-no-icon",placeholder:String(h),value:q[0]??h,onChange:re,min:h,max:typeof q[1]=="number"?q[1]:R,step:P}),React.createElement("input",{type:"number",className:"inline-input input-no-icon",placeholder:String(R),value:q[1]??R,onChange:ae,min:typeof q[0]=="number"?q[0]:h,max:R,step:P})),p=()=>React.createElement("div",{className:`range-slider-wrapper${r?" ts-loading":""}`},React.createElement("div",{className:"range-value"},i),React.createElement("div",{ref:f,className:"range-slider"}),c&&(c.min!==_||c.max!==O)&&React.createElement("div",{className:"range-narrowed-indicator"},React.createElement("small",null,"Showing ",Y(h)," — ",Y(R)," based on current results")));if(E==="minmax"&&B==="double"){const{style:S,className:K}=Z(e,"ts-form-group");return React.createElement("div",{className:K,style:S},!e.hideLabel&&React.createElement("label",null,t.label),w())}if(E==="inline"){const{style:S,className:K}=Z(e,"ts-form-group ts-inline-filter");return React.createElement("div",{className:K,style:S},!e.hideLabel&&React.createElement("label",null,t.label),p())}const{style:k,className:z}=Z(e,"ts-form-group"),X=pe(e);return React.createElement("div",{className:z,style:k},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:g,className:`ts-filter ts-popup-target ${se?"ts-filled":""}`,onClick:ee,onMouseDown:S=>S.preventDefault(),role:"button",tabIndex:0},J&&React.createElement("span",{dangerouslySetInnerHTML:{__html:J}}),React.createElement("div",{className:"ts-filter-text"},H),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ue,{isOpen:$,target:g,title:"",icon:J,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:fe,onClear:l,onClose:()=>u(!1),className:`${a}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:X.style},React.createElement("div",{className:"ts-form-group"},React.createElement("label",null,t.label,t.description&&React.createElement("small",null,t.description)),p())))}function tt(e,t){let n=null;return function(...s){n&&clearTimeout(n),n=setTimeout(()=>e.apply(this,s),t)}}function nt({config:e,filterData:t,value:n,onChange:s,blockId:d}){const y=d?`voxel-popup-${d}`:"",r=t.props||{},a=typeof r.range_start=="number"?r.range_start:0,g=typeof r.range_end=="number"?r.range_end:1e3,f=typeof r.step_size=="number"?r.step_size:1,m=typeof r.precision=="number"?r.precision:0,$=r.placeholder||t.label||"Any",u=e.displayAs||r.display_as||"popup",x=t.icon||"",_=G(null),O=G(null),[P,C]=j(!1),[E,B]=j(typeof n=="number"?n:""),V=v(H=>{if(H===""||typeof H!="number"||isNaN(H))return"";let i=H;return i<a&&(i=a),i>g&&(i=g),Number(i.toFixed(m))},[a,g,m]),N=v(H=>typeof H=="number",[]),c=v(H=>{const i=V(H);N(i)?s(i):s("")},[V,N,s]),h=oe(()=>tt(H=>c(H),300),[c]);Q(()=>{B(typeof n=="number"?n:"")},[n]),Q(()=>{P&&B(typeof n=="number"?n:"")},[P,n]);const R=H=>{H.preventDefault();let i;typeof E!="number"?i=a:(i=V(E+f),typeof i!="number"&&(i=a)),B(i),u==="inline"&&h(i)},b=H=>{H.preventDefault();let i;typeof E!="number"?i=a:(i=V(E-f),typeof i!="number"&&(i=a)),B(i),u==="inline"&&h(i)},o=H=>{const i=H.target.value;if(i===""){B(""),u==="inline"&&h("");return}const M=parseFloat(i);if(!isNaN(M)){const W=V(M);B(W),u==="inline"&&h(W)}},T=v(()=>{c(E)},[E,c]),J=v(()=>{C(!0)},[]),L=v(()=>{c(E),C(!1)},[E,c]),U=v(()=>{B(""),s(""),O.current?.focus()},[s]),I=typeof n=="number"?n:null,q=H=>React.createElement("div",{className:"ts-stepper-input flexify"},React.createElement("button",{type:"button",className:`ts-stepper-left ts-icon-btn${H?" inline-btn-ts":""}`,onClick:b},React.createElement("i",{className:"las la-minus"})),React.createElement("input",{ref:O,type:"number",className:"ts-input-box",min:a,max:g,step:f,value:E,onChange:o,onBlur:H?T:void 0,placeholder:$}),React.createElement("button",{type:"button",className:`ts-stepper-right ts-icon-btn${H?" inline-btn-ts":""}`,onClick:R},React.createElement("i",{className:"las la-plus"})));if(u==="inline"){const{style:H,className:i}=Z(e,"ts-form-group ts-inline-filter");return React.createElement("div",{className:i,style:H},!e.hideLabel&&React.createElement("label",null,t.label),q(!0))}const te=typeof n=="number",{style:Y,className:le}=Z(e,"ts-form-group"),se=pe(e);return React.createElement("div",{className:le,style:Y},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:_,className:`ts-filter ts-popup-target ${te?"ts-filled":""}`,onClick:J,onMouseDown:H=>H.preventDefault(),role:"button",tabIndex:0},x&&React.createElement("span",{dangerouslySetInnerHTML:{__html:x}}),React.createElement("div",{className:"ts-filter-text"},I!==null?I:$),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ue,{isOpen:P,target:_,title:"",icon:x,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:L,onClear:U,onClose:()=>C(!1),className:`${y}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:se.style},React.createElement("div",{className:"ts-form-group"},React.createElement("label",null,t.label,t.description&&React.createElement("small",null,t.description)),q(!1))))}function st(e){return e==null||e===""?[]:typeof e=="string"?e.split(",").map(t=>t.trim()).filter(t=>t!==""):Array.isArray(e)?e.length>0&&typeof e[0]=="string"?e:e.length>0&&typeof e[0]=="number"?e.map(String):[]:[]}function Se(e){return e.length===0?null:e.join(",")}function lt({config:e,filterData:t,value:n,onChange:s,blockId:d,narrowedValues:y,isNarrowing:r}){const a=d?`voxel-popup-${d}`:"",g=G(null),f=G(null),[m,$]=j(!1),[u,x]=j(""),_=t.props||{},O=_.multiple??!0,P=_.taxonomy_label??"",C=_.placeholder||t.label||P||"Select",E=e.displayAs||_.display_as||"popup",B=e.hideEmptyTerms??_.hide_empty_terms??!1,V=_.per_page??20,[N,c]=j(1),h=t.icon||"",R=_.taxonomy||e.filterKey,b=y?.terms?.[R],o=v(l=>{const w=(p,k,z)=>{const X={...p,parentRef:k||void 0,hasSelection:!1,depth:z};return p.children&&p.children.length>0&&(X.children=p.children.map(S=>w(S,X,z+1))),X};return l.map(p=>w(p,null,0))},[]),T=oe(()=>{const l=_.terms||[];return o(l)},[_,o]),J=oe(()=>{const l=new Map,w=p=>{l.set(p.slug,p),p.children&&p.children.forEach(k=>w(k))};return T.forEach(p=>w(p)),l},[T]),L=oe(()=>{const l=[],w=p=>{p.forEach(k=>{B&&b&&k.term_taxonomy_id&&b[k.term_taxonomy_id]===0||(l.push(k),k.children&&k.children.length>0&&w(k.children))})};return w(T),l},[T,B,b]),U=v(l=>!b||!l.term_taxonomy_id?null:b[l.term_taxonomy_id]??null,[b]),I=oe(()=>st(n),[n]),q=v(l=>l.slug?I.includes(l.slug):!1,[I]),te=oe(()=>L.filter(l=>l.slug&&I.includes(l.slug)),[L,I]),Y=oe(()=>{const l=V*N;return L.slice(0,l)},[L,V,N]),le=L.length>V*N,se=oe(()=>{if(!u)return Y;const l=u.toLowerCase();return L.filter(w=>w.label.toLowerCase().includes(l))},[L,Y,u]);Q(()=>{m&&(x(""),L.length>=15&&setTimeout(()=>f.current?.focus(),50))},[m,L.length]);const H=v(()=>{$(!0)},[]),i=v(l=>{const w=l.slug;if(w)if(O){let p=[...I];if(p.includes(w)){p=p.filter(z=>z!==w);let k=l.parentRef;for(;k;)k.children?.some(X=>p.includes(X.slug)||X.hasSelection)||(k.hasSelection=!1),k=k.parentRef;s(Se(p))}else{p.push(w);let k=l.parentRef;for(;k;)p=p.filter(X=>X!==k.slug),k.hasSelection=!0,k=k.parentRef;const z=new Set;p.forEach(X=>{const S=J.get(X);if(!S)return;let K=S.parentRef;const F=[];let ne=!1;for(;K;){if(K.slug===w){ne=!0;break}F.push(K),K=K.parentRef}ne&&(z.add(S.slug),F.forEach(A=>{A.hasSelection=!1}))}),p=p.filter(X=>!z.has(X)),s(Se(p))}}else s(Se([w])),E!=="inline"&&$(!1)},[O,I,s,J,E]),M=v(()=>{$(!1)},[]),W=v(()=>{s(null)},[s]),ee=I.length>0,ce=ee&&te[0]?.label||C,D=te.length>1?te.length-1:0;if(E==="inline"){const{style:l,className:w}=Z(e,"ts-form-group inline-terms-wrapper ts-inline-filter min-scroll");return React.createElement("div",{className:`${w}${r?" ts-loading":""}`,style:l},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:"ts-term-dropdown ts-multilevel-dropdown inline-multilevel"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},Y.map(p=>{const k=q(p),z=U(p),X=z===0;return React.createElement("li",{key:p.slug,className:`${k?"ts-selected":""}${X?" ts-disabled":""}`},React.createElement("a",{href:"#",className:"flexify",onClick:S=>{S.preventDefault(),X||i(p)}},React.createElement("div",{className:"ts-checkbox-container"},React.createElement("label",{className:`container-${O?"checkbox":"radio"}`},React.createElement("input",{type:O?"checkbox":"radio",checked:k,readOnly:!0,disabled:!0,hidden:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,p.depth>0?"— ".repeat(p.depth):"",p.label),z!==null&&React.createElement("span",{className:"ts-term-count"},"(",z,")"),p.icon&&React.createElement("div",{className:"ts-term-icon",dangerouslySetInnerHTML:{__html:p.icon}})))}),le&&React.createElement("li",{className:"ts-term-centered"},React.createElement("a",{href:"#",onClick:p=>{p.preventDefault(),c(k=>k+1)},className:"flexify"},React.createElement("div",{className:"ts-term-icon"},ie.reload||React.createElement("span",null,"↻")),React.createElement("span",null,"Load more"))))))}if(E==="buttons"){const{style:l,className:w}=Z(e,"ts-form-group");return React.createElement("div",{className:w,style:l},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("ul",{className:"simplify-ul addon-buttons flexify"},L.map(p=>{const k=q(p);return React.createElement("li",{key:p.slug,className:`flexify ${k?"adb-selected":""}`,onClick:()=>i(p)},p.label)})))}const{style:re,className:ae}=Z(e,"ts-form-group"),fe=pe(e);return React.createElement("div",{className:ae,style:re},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:g,className:`ts-filter ts-popup-target ${ee?"ts-filled":""}`,onClick:H,onMouseDown:l=>l.preventDefault(),role:"button",tabIndex:0},h&&React.createElement("span",{dangerouslySetInnerHTML:{__html:h}}),React.createElement("div",{className:"ts-filter-text"},ce,D>0&&React.createElement("span",{className:"term-count"},"+",D)),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ue,{isOpen:m,target:g,title:"",icon:h,saveLabel:"Save",clearLabel:"Clear",showClear:!0,showSave:O,onSave:M,onClear:W,onClose:()=>$(!1),className:`${a}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:fe.style},L.length>=15&&React.createElement("div",{className:"ts-sticky-top uib b-bottom"},React.createElement("div",{className:"ts-input-icon flexify"},React.createElement("span",null,ie.search),React.createElement("input",{ref:f,type:"text",value:u,onChange:l=>x(l.target.value),placeholder:"Search",className:"autofocus"}))),React.createElement("div",{className:`ts-term-dropdown ts-multilevel-dropdown ts-md-group${r?" ts-loading":""}`},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},se.map(l=>{const w=q(l),p=U(l),k=p===0;return React.createElement("li",{key:l.slug,className:`${w?"ts-selected":""}${k?" ts-disabled":""}`},React.createElement("a",{href:"#",className:"flexify",onClick:z=>{z.preventDefault(),k||i(l)}},React.createElement("div",{className:"ts-checkbox-container"},React.createElement("label",{className:`container-${O?"checkbox":"radio"}`},React.createElement("input",{type:O?"checkbox":"radio",checked:w,readOnly:!0,disabled:!0,hidden:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,l.depth>0?"— ".repeat(l.depth):"",l.label),p!==null&&React.createElement("span",{className:"ts-term-count"},"(",p,")"),l.icon&&React.createElement("div",{className:"ts-term-icon",dangerouslySetInnerHTML:{__html:l.icon}})))}),!u&&le&&React.createElement("li",{className:"ts-term-centered"},React.createElement("a",{href:"#",onClick:l=>{l.preventDefault(),c(w=>w+1)},className:"flexify"},React.createElement("div",{className:"ts-term-icon"},ie.reload||React.createElement("span",null,"↻")),React.createElement("span",null,"Load more")))),se.length===0&&React.createElement("div",{className:"ts-empty-user-tab"},h&&React.createElement("span",{dangerouslySetInnerHTML:{__html:h}}),React.createElement("p",null,"No results found")))))}const rt=()=>window.noUiSlider;function ye(e){return!e||!e.address?null:e.method==="radius"&&e.lat!==void 0&&e.lng!==void 0?`${e.address};${e.lat},${e.lng},${e.radius||10}`:e.swlat!==void 0&&e.swlng!==void 0&&e.nelat!==void 0&&e.nelng!==void 0?`${e.address};${e.swlat},${e.swlng}..${e.nelat},${e.nelng}`:e.lat!==void 0&&e.lng!==void 0?`${e.address};${e.lat},${e.lng},${e.radius||10}`:e.address}function at(e,t){if(e==null||e==="")return null;if(typeof e=="string"){const n=e.indexOf(";");if(n===-1)return{address:e};const s=e.substring(0,n),d=e.substring(n+1);if(d.includes("..")){const r=d.split(".."),a=r[0].split(","),g=r[1].split(",");return{address:s,method:"area",swlat:Number(a[0]),swlng:Number(a[1]),nelat:Number(g[0]),nelng:Number(g[1])}}const y=d.split(",");return{address:s,method:"radius",lat:Number(y[0]),lng:Number(y[1]),radius:y[2]?Number(y[2]):t}}return typeof e=="object"?e:null}function ct({config:e,filterData:t,value:n,onChange:s,blockId:d}){const y=d?`voxel-popup-${d}`:"",r=G(null),a=G(null),g=G(null),f=G(null),m=G(null),[$,u]=j(!1),[x,_]=j(!1),O=G(null),P=t.props||{},C=P.radius||{},E=C.default??10,B=C.min??0,V=C.max??100,N=C.step??1,c=C.units||"km",h=P.display_proximity_as||"popup",R=P.placeholder||t.label||"Location",b=P.default_search_method||"area";(P.l10n||{}).visibleArea;const T=e.displayAs||t.props?.display_as||"popup",J=t.icon||"",L=at(n,E)||{},[U,I]=j(L.address||""),[q,te]=j(L.radius||E),Y=v(A=>Math.round(A*1e6)/1e6,[]),le=v(A=>`${A}${c==="mi"?"mi":"km"}`,[c]),se=v(()=>{if(!f.current||m.current)return;const A=rt();if(!A){console.error("noUiSlider not loaded - window.noUiSlider is undefined");return}A.create(f.current,{start:q,connect:[!0,!1],step:N,range:{min:B,max:V},behaviour:"tap-drag"}),m.current=f.current.noUiSlider,m.current.on("update",de=>{te(Math.round(Number(de[0])))}),m.current.on("change",de=>{const me=Math.round(Number(de[0]));h==="inline"&&L.lat&&s(ye({...L,radius:me}))})},[q,N,B,V,h,L,s]),H=v(()=>{m.current&&(m.current.destroy(),m.current=null)},[]);Q(()=>{if(h==="inline"&&L.lat){const A=setTimeout(()=>se(),50);return()=>{clearTimeout(A),H()}}},[h,L.lat,se,H]),Q(()=>{if(x){const A=setTimeout(()=>se(),50);return()=>clearTimeout(A)}return()=>H()},[x,se,H]),Q(()=>{const A=L.radius||E;te(A),m.current&&m.current.set([A])},[L.radius,E]);const i=v(()=>{if(g.current||!a.current||typeof window>"u")return;const A=window.Voxel?.Maps;if(!A){console.warn("Voxel.Maps not available for autocomplete");return}A.await(()=>{if(g.current)return;const de=e.autocomplete||{};g.current=new A.Autocomplete(a.current,me=>{if(me){const Ce=me.viewport.getSouthWest(),Ve=me.viewport.getNorthEast(),Ae={address:me.address,method:b,swlat:Y(Ce.getLatitude()),swlng:Y(Ce.getLongitude()),nelat:Y(Ve.getLatitude()),nelng:Y(Ve.getLongitude()),lat:Y(me.latlng.getLatitude()),lng:Y(me.latlng.getLongitude()),radius:L.radius||E};I(me.address),s(ye(Ae)),T==="popup"&&u(!1)}else I(""),s(null)},de)})},[e.autocomplete,s,T,E,b,L.radius,Y]);Q(()=>{($||T==="inline")&&(I(L.address||""),$&&setTimeout(()=>a.current?.focus(),50))},[$,T,L.address]);const M=v(()=>{u(!0)},[]),W=v(()=>{i()},[i]),ee=A=>{I(A.target.value),T==="inline"&&(A.target.value?s(ye({...L,address:A.target.value})):s(null))},ce=A=>{A.preventDefault(),A.stopPropagation(),"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(de=>{const me={address:"Current Location",method:"radius",lat:de.coords.latitude,lng:de.coords.longitude,radius:E};I("Current Location"),s(ye(me)),T==="popup"&&u(!1)},de=>{console.error("Geolocation error:",de)})},D=v(()=>{s(U?ye({...L,address:U}):null),u(!1)},[U,L,s]),re=v(()=>{I(""),s(null)},[s]),ae=v(A=>{A.key==="Enter"&&(A.preventDefault(),D())},[D]),fe=v(()=>{L.lat&&s(ye({...L,radius:q})),_(!1)},[L,q,s]),l=v(()=>{te(E),m.current&&m.current.set([E]),L.lat&&s(ye({...L,radius:E}))},[E,L,s]),w=!!L.address||!!L.lat,p=w?L.address||"Location set":R,k=()=>React.createElement("div",{className:"ts-input-icon flexify",style:{position:"relative"}},J&&React.createElement("span",{dangerouslySetInnerHTML:{__html:J}}),React.createElement("input",{ref:a,type:"text",className:"inline-input",placeholder:R,value:U,onChange:ee,onKeyDown:ae,onFocus:W}),React.createElement("a",{href:"#",className:"inline-user-location ts-icon-btn",onClick:ce,title:"Use my location","aria-label":"Use my location"},ie.crosshairs)),z=()=>React.createElement("div",{className:"range-slider-wrapper"},React.createElement("div",{className:"range-value"},le(q)),React.createElement("div",{ref:f,className:"range-slider"})),X=()=>!L.lat||h==="inline"?null:React.createElement("div",{className:"ts-form-group ts-proximity-filter"},React.createElement("label",null,P.proximity_label||"Radius"),React.createElement("div",{ref:O,className:`ts-filter ts-popup-target ${L.radius?"ts-filled":""}`,onClick:()=>_(!0),onMouseDown:A=>A.preventDefault(),role:"button",tabIndex:0},React.createElement("div",{className:"ts-filter-text"},le(L.radius||E)),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ue,{isOpen:x,target:O,title:"",saveLabel:"Save",clearLabel:"Reset",showClear:!0,onSave:fe,onClear:l,onClose:()=>_(!1),className:`${y}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:ne.style},React.createElement("div",{className:"ts-form-group"},React.createElement("label",null,P.proximity_label||"Search radius"),z()))),S=()=>h!=="inline"||!L.lat?null:React.createElement("div",{className:"ts-form-group ts-inline-proximity"},React.createElement("label",null,P.proximity_label||"Radius",": ",le(q)),React.createElement("div",{ref:f,className:"range-slider"}));if(T==="inline"){const{style:A,className:de}=Z(e,"ts-form-group ts-inline-filter");return React.createElement(React.Fragment,null,React.createElement("div",{className:de,style:A},!e.hideLabel&&React.createElement("label",null,t.label),k()),S(),X())}const{style:K,className:F}=Z(e,"ts-form-group"),ne=pe(e);return React.createElement(React.Fragment,null,React.createElement("div",{className:F,style:K},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:r,className:`ts-filter ts-popup-target ${w?"ts-filled":""}`,onClick:M,onMouseDown:A=>A.preventDefault(),role:"button",tabIndex:0},J&&React.createElement("span",{dangerouslySetInnerHTML:{__html:J}}),React.createElement("div",{className:"ts-filter-text"},p),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ue,{isOpen:$,target:r,title:"",icon:J,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:D,onClear:re,onClose:()=>u(!1),className:`${y}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:ne.style},React.createElement("div",{className:"ts-form-group"},k()))),S(),X())}function ot(e){if(e==null||e==="")return{date:"",slots:1};if(typeof e=="string")return{date:e,slots:1};if(typeof e=="object"){const t=e;return{date:t.date||"",slots:t.slots||1}}return{date:"",slots:1}}const ve=e=>{if(!e)return null;try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t:null}catch{return null}},Re=e=>{if(!e)return null;const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${s}`},Ee=e=>{if(!e)return"";try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):""}catch{return e}};function it({config:e,filterData:t,value:n,onChange:s,blockId:d}){const y=[d?`voxel-popup-${d}`:"",e.id?`elementor-repeater-item-${e.id}`:""].filter(Boolean).join(" "),r=G(null),a=G(null),[g,f]=j(!1),m=t.props||{},u=(m.inputMode||"date-range")==="date-range",x=m.l10n||{},_=x.pickDate||t.label||"Choose date",O=m.presets||[],P=t.icon||"",C=ot(n),E=C.date,B=C.slots;let V="",N="";u&&E&&E.includes("..")?[V,N]=E.split(".."):!u&&E&&(V=E);const[c,h]=j(()=>ve(V)),[R,b]=j(()=>ve(N)),[o,T]=j("start"),[J,L]=j(B);Q(()=>{if(g){if(u&&E&&E.includes("..")){const[D,re]=E.split("..");h(ve(D)),b(ve(re))}else!u&&E&&h(ve(E));L(B),T("start")}},[g,u,E,B]);const U=v(()=>{f(!0)},[]),I=v(D=>{if(u&&D&&a.current)if(o==="start")h(D),T("end"),a.current.setStartRange(D),a.current.setEndRange(null),a.current.draw();else if(c&&D<c)h(D),b(null),a.current.setStartRange(D),a.current.setEndRange(null),a.current.draw();else{b(D),T("start"),a.current.setEndRange(D),a.current.draw();const re=Re(c),ae=Re(D);re&&ae&&(s(`${re}..${ae}`),f(!1))}else h(D)},[u,o,c,s]);v(D=>{L(Number(D.target.value)||1)},[]);const q=v(D=>{if(u){const re=Re(c),ae=Re(R);re&&ae&&s(`${re}..${ae}`)}else{const ae=Re(D!==void 0?D:c);ae&&s(ae)}f(!1)},[u,c,R,s]),te=v(()=>{h(null),b(null),L(1),s(null),a.current&&(a.current.setStartRange(null),a.current.setEndRange(null))},[s]),Y=v(D=>{s(D)},[s]),le=v(()=>typeof n=="string"&&n.includes(".."),[n]),se=u?!!(V&&N):!!E,H=u?le():!!n,i=v(D=>n===D,[n]),M=oe(()=>{if(u&&O.length>0){if(le()){const D=Ee(V),re=Ee(N);return`${D} - ${re}`}return _}if(!se)return _;if(u){const D=Ee(V),re=Ee(N),ae=`${D} — ${re}`;return B>1?`${ae} (${B})`:ae}else{const D=Ee(E);return B>1?`${D} (${B})`:D}},[u,O.length,le,se,V,N,E,B,_]),{style:W,className:ee}=Z(e,"ts-form-group"),ce=pe(e);return React.createElement(React.Fragment,null,u&&O.map(D=>React.createElement("div",{key:D.key,className:ee,style:W},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter ${i(D.key)?"ts-filled":""}`,onClick:()=>Y(D.key),role:"button",tabIndex:0},React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,D.label))))),React.createElement("div",{className:ee,style:W},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:r,className:`ts-filter ts-popup-target ${H?"ts-filled":""}`,onClick:U,onMouseDown:D=>D.preventDefault(),role:"button",tabIndex:0},P&&React.createElement("span",{dangerouslySetInnerHTML:{__html:P}}),React.createElement("div",{className:"ts-filter-text"},M),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ue,{isOpen:g,target:r,title:"",icon:P,saveLabel:x.save||"Save",clearLabel:x.clear||"Clear",showSave:u,onSave:q,onClear:te,onClose:()=>f(!1),className:`${y}${u?" ts-availability-wrapper xl-height xl-width":" md-width xl-height"}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:ce.style},u&&React.createElement("div",{className:"ts-popup-head flexify"},React.createElement("div",{className:"ts-popup-name flexify"},P&&React.createElement("span",{dangerouslySetInnerHTML:{__html:P}}),React.createElement("span",null,React.createElement("span",{className:o==="start"?"chosen":"",onClick:()=>T("start"),style:{cursor:"pointer"}},c?Ee(Re(c)):x.checkIn||"Check-in"),React.createElement("span",null," — "),React.createElement("span",{className:o==="end"?"chosen":"",onClick:()=>T("end"),style:{cursor:"pointer"}},R?Ee(Re(R)):x.checkOut||"Check-out")))),React.createElement($e,{value:c,onChange:I,...!u&&{onSelect:q},pickerConfig:{minDate:new Date,...u?{numberOfMonths:2,theme:"pika-range"}:{}},onPickerReady:D=>{a.current=D,u&&c&&(D.setStartRange(c),R&&D.setEndRange(R))}}))))}function ut(e,t){if(e==null||e==="")return{from:"",to:""};if(typeof e=="string"){if(t&&e.includes("..")){const n=e.split("..");return{from:n[0]||"",to:n[1]||""}}return{from:e,to:""}}return{from:"",to:""}}function xe(e,t,n){return!e&&!t?null:n?e&&t?`${e}..${t}`:e?`${e}..`:t?`..${t}`:null:e||null}const he=e=>{if(!e)return null;try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t:null}catch{return null}},be=e=>{if(!e)return null;const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${s}`},ge=e=>{if(!e)return"";try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}):""}catch{return e}},Me=e=>e?e.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}):"";function dt(e){return typeof e=="string"&&e.includes("..")}function De({config:e,filterData:t,value:n,onChange:s,blockId:d}){const y=d?`voxel-popup-${d}`:"",r=G(null),a=t.props||{},g=a.inputMode==="date-range"||a.inputMode===void 0,f=a.l10n||{},m=f.from||"From",$=f.to||"To",u=f.pickDate||"Choose date",x=g?a.presets||[]:[],_=a.displayValue||{start:null,end:null},O=t.icon||"",P=ut(n,g),C=P.from,E=P.to,[B,V]=j(!1),[N,c]=j(!1),[h,R]=j(()=>he(C)),[b,o]=j("start"),[T,J]=j(()=>he(C)),[L,U]=j(()=>he(E)),I=G(null),q=v(()=>{R(he(C)),c(!0)},[C]),te=v((F="start")=>{const ne=he(C),A=he(E);J(ne),U(A),o(F==="end"&&!A?"start":F),c(!0)},[C,E]),Y=v(F=>{R(F)},[]),le=v(F=>{V(!0);const A=be(F!==void 0?F:h)||"";s(xe(A,"",!1)),c(!1)},[h,s]),se=v(()=>{V(!0),R(null),s(null)},[s]),H=G(b);H.current=b;const i=G(T);i.current=T;const M=G(L);M.current=L;const W=v(F=>{J(F),i.current=F,I.current&&(I.current.setStartRange(F),M.current&&F&&F>M.current&&(U(null),M.current=null,I.current.setEndRange(null)))},[]),ee=v(F=>{U(F),M.current=F,I.current&&I.current.setEndRange(F)},[]),ce=v(()=>{V(!0);let F=be(i.current)||"",ne=be(M.current)||"";F&&!ne&&(ne=F),s(xe(F,ne,!0)),c(!1)},[s]),D=v(()=>{V(!0),W(null),ee(null),o("start"),I.current&&I.current.draw(!0),s(null)},[s,W,ee]),re=v(F=>{H.current==="start"?(W(F),o("end")):(ee(F),o("start"),setTimeout(()=>{V(!0);const ne=be(i.current)||"";let A=be(F)||"";ne&&!A&&(A=ne),s(xe(ne,A,!0)),c(!1)},0)),I.current&&I.current.draw(!0)},[W,ee,s]),ae=v(F=>{I.current=F;const ne=he(C),A=he(E);ne&&F.setStartRange(ne),A&&F.setEndRange(A),F.draw(!0)},[C,E]),fe=oe(()=>({numberOfMonths:2,theme:"pika-range",disableDayFn:F=>!!(H.current==="end"&&i.current&&F<i.current),selectDayFn:F=>i.current&&F.toDateString()===i.current.toDateString()||M.current&&F.toDateString()===M.current.toDateString()||void 0}),[]),l=v(F=>{V(!0),s(n===F?null:F)},[n,s]),w=g?dt(n):n!=null&&n!=="",p=oe(()=>{if(!w)return u;if(g){const ne=B?ge(C):_.start||ge(C),A=B?ge(E):_.end||ge(E);return ne&&A?`${ne} - ${A}`:ne||u}return(B?ge(C):_.start||ge(C))||u},[w,g,C,E,u,B,_]),k=T?Me(T):m,z=L?Me(L):$,{style:X,className:S}=Z(e,"ts-form-group"),K=pe(e);return React.createElement(React.Fragment,null,x.map(F=>React.createElement("div",{key:F.key,className:S,style:X},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter${n===F.key?" ts-filled":""}`,onClick:()=>l(F.key),role:"button",tabIndex:0},React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,F.label))))),React.createElement("div",{className:S,style:X},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:r,className:`ts-filter ts-popup-target${w?" ts-filled":""}`,onClick:g?()=>te("start"):q,onMouseDown:F=>F.preventDefault(),role:"button",tabIndex:0},O&&React.createElement("span",{dangerouslySetInnerHTML:{__html:O}}),React.createElement("div",{className:"ts-filter-text"},p),React.createElement("div",{className:"ts-down-icon"})),!g&&React.createElement(ue,{isOpen:N,target:r,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:le,onClear:se,onClose:()=>c(!1),className:`${y} md-width xl-height${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:K.style},React.createElement($e,{value:h,onChange:Y,onSelect:le})),g&&React.createElement(ue,{isOpen:N,target:r,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:ce,onClear:D,onClose:()=>c(!1),className:`${y} ts-availability-wrapper xl-width xl-height${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:K.style},React.createElement("div",{className:"ts-popup-head flexify"},React.createElement("div",{className:"ts-popup-name flexify"},O&&React.createElement("span",{dangerouslySetInnerHTML:{__html:O}}),React.createElement("span",null,React.createElement("span",{className:b==="start"?"chosen":"",onClick:()=>o("start"),style:{cursor:"pointer"}},k),T&&React.createElement(React.Fragment,null,React.createElement("span",null," — "),React.createElement("span",{className:b==="end"?"chosen":"",onClick:()=>o("end"),style:{cursor:"pointer"}},z))))),React.createElement($e,{value:null,onChange:()=>{},onSelect:re,pickerConfig:fe,onPickerReady:ae}))))}function pt({config:e,filterData:t,value:n,onChange:s}){const d=n!=null&&n!==!1&&n!==""&&n!==0,y=m=>{m.preventDefault(),s(d?null:1)},r=t.props?.placeholder||t.label||"Open now";if(e.openInPopup||t.props?.openInPopup||!1){const{style:m,className:$}=Z(e,"ts-form-group"),u=t.icon||"";return React.createElement("div",{className:$,style:m},React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter ts-popup-target${d?" ts-filled":""}`,onClick:y,role:"button",tabIndex:0},u&&React.createElement("span",{dangerouslySetInnerHTML:{__html:u}}),React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,r))))}const{style:g,className:f}=Z(e,"ts-form-group switcher-label ts-inline-filter");return React.createElement("div",{className:f,style:g},React.createElement("label",{className:"ts-keep-visible"},React.createElement("div",{className:"switch-slider"},React.createElement("div",{className:"onoffswitch"},React.createElement("input",{type:"checkbox",className:"onoffswitch-checkbox",checked:d,onChange:y,tabIndex:0}),React.createElement("label",{className:"onoffswitch-label",onClick:y}))),r))}function Oe(e){return typeof e!="string"||!e?null:e.split("(")[0]}function Be(e){return Math.round(e*1e5)/1e5}function mt({config:e,filterData:t,value:n,onChange:s,blockId:d,allFilterValues:y,allFiltersData:r,postFeedId:a}){const g=d?`voxel-popup-${d}`:"",f=G(null),[m,$]=j(!1),[u,x]=j(!1),_=t.props||{},O=e.displayAs||t.props?.display_as||"popup",P=_.placeholder||t.label||"Order By",C=oe(()=>{const i=_.choices||{};return Array.isArray(i)?i:Object.entries(i).map(([M,W])=>({key:M,label:W.label||W,placeholder:W.placeholder||W.label||W,icon:W.icon||"",requires_location:W.requires_location||!1,has_location:W.has_location||!1}))},[_.choices]),E=t.icon||"",B=oe(()=>r&&r.find(i=>i.type==="location")||null,[r]),V=oe(()=>{if(!B||!y)return null;const i=y[B.key];return!i||typeof i!="object"?null:i},[B,y]),N=v(i=>{if(V){const{lat:M,lng:W,method:ee,address:ce}=V;if(M&&W){if(ee==="radius"){i(M,W),x(!1);return}i(M,W),x(!1);return}if(ce&&window.Voxel?.Maps?.getGeocoder){window.Voxel.Maps.getGeocoder().geocode(ce,D=>{D?i(D.latlng?.getLatitude?.()||D.lat,D.latlng?.getLongitude?.()||D.lng):c(i),x(!1)});return}}c(i)},[V]),c=v(i=>{if(!navigator.geolocation){x(!1);return}navigator.geolocation.getCurrentPosition(M=>{const W=Be(M.coords.latitude),ee=Be(M.coords.longitude);i(W,ee),x(!1)},()=>{const M=window.Voxel_Config;window.Voxel?.alert&&M?.l10n?.positionFail&&window.Voxel.alert(M.l10n.positionFail,"error"),x(!1)})},[]),h=Oe(n),R=C.find(i=>i.key===h)?.requires_location;Q(()=>{if(!R||!V)return;const{lat:i,lng:M,method:W}=V;W==="radius"&&i&&M&&h&&s(`${h}(${i},${M})`)},[V?.lat,V?.lng]);const b=v(()=>{$(!0)},[]),o=v(i=>{i.requires_location?(x(i.key),N((M,W)=>{s(i.key+`(${M},${W})`),$(!1)})):(s(i.key),$(!1))},[s,N]),T=v(i=>{i.requires_location?(x(i.key),N((M,W)=>{s(i.key+`(${M},${W})`)})):s(i.key)},[s,N]),J=v(()=>{s(null)},[s]),L=typeof n=="string"?n:"",U=!!L,I=Oe(L),q=C.find(i=>i.key===I),te=q?.label||P;Q(()=>{q?.requires_location&&!q?.has_location&&I&&(O==="buttons"?o(q):T(q))},[]);const Y=i=>React.createElement("div",{className:"ts-term-dropdown ts-md-group"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list min-scroll"},C.map(M=>{const W=I===M.key,ee=u===M.key;return React.createElement("li",{key:M.key,className:W?"ts-selected":""},React.createElement("a",{href:"#",className:`flexify${ee?" vx-pending":""}`,onClick:ce=>{ce.preventDefault(),i(M)}},React.createElement("div",{className:"ts-radio-container"},React.createElement("label",{className:"container-radio"},React.createElement("input",{type:"radio",value:M.key,checked:W,readOnly:!0,disabled:!0,hidden:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,M.label),M.icon&&React.createElement("div",{className:"ts-term-icon"},React.createElement("span",{dangerouslySetInnerHTML:{__html:M.icon}}))))})));if(O==="buttons"){const{style:i,className:M}=Z(e,"ts-form-group");return React.createElement("div",{className:M,style:i},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("ul",{className:"simplify-ul addon-buttons flexify"},C.map(W=>{const ee=I===W.key,ce=u===W.key;return React.createElement("li",{key:W.key,className:`flexify${ee?" adb-selected":""}${ce?" vx-pending":""}`,onClick:()=>T(W)},W.placeholder||W.label)})))}if(O==="alt-btn")return React.createElement(React.Fragment,null,C.map(i=>{const M=I===i.key,W=u===i.key,{style:ee,className:ce}=Z(e,"ts-form-group");return React.createElement("div",{key:i.key,className:ce,style:ee},!e.hideLabel&&React.createElement("label",null,i.label),React.createElement("div",{className:`ts-filter${M?" ts-filled":""}${W?" vx-pending":""}`,onClick:()=>T(i)},i.icon&&React.createElement("span",{dangerouslySetInnerHTML:{__html:i.icon}}),React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,i.placeholder||i.label))))}));if(O==="post-feed"&&a){const i=`[data-block-id="${a}"] .post-feed-header, .elementor-element-${a} .post-feed-header`,M=document.querySelector(i);if(M&&!M.querySelector(".vxf-sort"))return Te(React.createElement(ft,{filterData:t,filterIcon:E,placeholder:P,options:C,currentKey:I,hasValue:U,displayValue:te,loading:u,selectDropdownChoice:o,handleClear:J,renderRadioList:Y,popupClassName:g,config:e}),M)}const{style:le,className:se}=Z(e,"ts-form-group"),H=pe(e);return React.createElement("div",{className:se,style:le},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:f,className:`ts-filter ts-popup-target${U?" ts-filled":""}`,onClick:b,onMouseDown:i=>i.preventDefault(),role:"button",tabIndex:0},E&&React.createElement("span",{dangerouslySetInnerHTML:{__html:E}}),React.createElement("div",{className:"ts-filter-text"},te),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ue,{isOpen:m,target:f,title:"",icon:E,saveLabel:"Save",clearLabel:"Clear",showClear:U,showSave:!1,onSave:()=>$(!1),onClear:J,onClose:()=>$(!1),className:`hide-head ${g}${e.popupCenterPosition?" ts-popup-centered":""}`.trim(),popupStyle:H.style},Y(o)))}function ft({filterData:e,filterIcon:t,placeholder:n,options:s,currentKey:d,hasValue:y,displayValue:r,loading:a,selectDropdownChoice:g,handleClear:f,renderRadioList:m,popupClassName:$,config:u}){const x=G(null),[_,O]=j(!1),P=pe(u);return React.createElement("div",{className:`vxf-sort ts-popup-target${y?" ts-filled":""}`,ref:x},React.createElement("a",{href:"#",onClick:C=>{C.preventDefault(),O(!_)}},y?r:n,React.createElement("div",{className:"ts-down-icon"})),React.createElement(ue,{isOpen:_,target:x,title:"",icon:t,saveLabel:"Save",clearLabel:"Clear",showClear:y,showSave:!1,onSave:()=>O(!1),onClear:()=>{f(),O(!1)},onClose:()=>O(!1),className:`hide-d ${$}${u.popupCenterPosition?" ts-popup-centered":""}`.trim(),popupStyle:P.style},m(C=>{g(C),O(!1)})))}function ht({config:e,filterData:t,value:n,onChange:s,blockId:d}){const y=d?`voxel-popup-${d}`:"",[r,a]=j(!1),g=G(null),f=t.props||{},m=e.displayAs||t.props?.display_as||"popup",$=f.placeholder||t.label||"Status",u=oe(()=>{const b=f.choices||{};return Array.isArray(b)?b:Object.entries(b).map(([o,T])=>({key:o,label:T.label||T}))},[f.choices]),x=t.icon||"",_=v(b=>{s(b),a(!1)},[s]),O=v(()=>{s(""),a(!1)},[s]),P=v(()=>{a(!0)},[]),C=typeof n=="string"?n:"",E=!!C,B=u.find(b=>b.key===C),V=E&&B?.label||$,N=()=>React.createElement("div",{className:"ts-term-dropdown ts-md-group"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list min-scroll"},u.map(b=>{const o=C===b.key;return React.createElement("li",{key:b.key},React.createElement("a",{href:"#",className:"flexify",onClick:T=>{T.preventDefault(),_(b.key)}},React.createElement("div",{className:"ts-radio-container"},React.createElement("label",{className:"container-radio"},React.createElement("input",{type:"radio",value:b.key,checked:o,readOnly:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,b.label),x&&React.createElement("div",{className:"ts-term-icon"},React.createElement("span",{dangerouslySetInnerHTML:{__html:x}}))))})));if(m==="buttons")return React.createElement(React.Fragment,null,u.map(b=>{const o=C===b.key,{style:T,className:J}=Z(e,"ts-form-group");return React.createElement("div",{key:b.key,className:J,style:T},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter${o?" ts-filled":""}`,onClick:()=>s(b.key)},x&&React.createElement("span",{dangerouslySetInnerHTML:{__html:x}}),React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,b.label))))}));const{style:c,className:h}=Z(e,"ts-form-group"),R=pe(e);return React.createElement("div",{className:h,style:c},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:g,className:`ts-filter ts-popup-target ${E?"ts-filled":""}`,onClick:P,onMouseDown:b=>b.preventDefault(),role:"button",tabIndex:0},x&&React.createElement("span",{dangerouslySetInnerHTML:{__html:x}}),React.createElement("div",{className:"ts-filter-text"},V),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ue,{isOpen:r,target:g,title:"",icon:x,saveLabel:"Save",showSave:!1,showClear:E,onClear:O,onSave:()=>a(!1),onClose:()=>a(!1),className:`hide-head ${y}${e.popupCenterPosition?" ts-popup-centered":""}`.trim(),popupStyle:R.style},N()))}function yt(e){const{userId:t,skip:n=!1}=e,[s,d]=j(null),[y,r]=j(!1),[a,g]=j(null),f=v(async()=>{if(!t||n){d(null);return}r(!0),g(null);try{const m=We(),$=await fetch(`${m}voxel-fse/v1/search-form/user-data?user_id=${t}`);if($.ok){const u=await $.json();d({id:u.id,name:u.name,avatar:u.avatar||""})}else d({id:t,name:"Unknown",avatar:""}),g("User not found")}catch(m){console.error("useUserData: Error fetching user data:",m),d({id:t,name:"Unknown",avatar:""}),g(m instanceof Error?m.message:"Failed to fetch user data")}finally{r(!1)}},[t,n]);return Q(()=>{f()},[f]),{userData:s,isLoading:y,error:a,refetch:f}}function Rt({config:e,filterData:t,value:n}){const s=G(null),d=t.props||{},y=t.icon||"",r=d.user;let a;n!==void 0?a=n:t.value!==null&&t.value!==void 0?a=t.value:a=null;const g=a?Number(a):null,f=g!==null&&!isNaN(g)&&g>0,m=!!r?.name,{userData:$,isLoading:u}=yt({userId:f?g:null,skip:m}),x=m?{name:r.name,avatar:r.avatar||""}:$;if(!f)return null;const _=x?.name||(u?"Loading...":"Unknown"),{style:O,className:P}=Z(e,"ts-form-group");return React.createElement("div",{className:P,style:O},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:s,className:`ts-filter ts-popup-target ts-filled${u?" ts-loading":""}`},React.createElement("span",{dangerouslySetInnerHTML:{__html:y}}),React.createElement("div",{className:"ts-filter-text"},_)))}function Et({config:e,filterData:t,value:n,onChange:s,blockId:d}){const y=G(null),r=d?`voxel-popup-${d}`:"",g=(t.props||{}).post,f=t.icon||"";let m=null;n!==void 0?n===null?m=null:typeof n=="number"?m=n:typeof n=="string"&&n!==""&&(m=Number(n)):t.value!==null&&t.value!==void 0&&(m=typeof t.value=="number"?t.value:Number(t.value));const $=m!==null&&!isNaN(m)&&m>0,u=v(()=>{s(null)},[s]);if(!$)return null;const x=g?.title||"Unknown",{style:_,className:O}=Z(e,"ts-form-group"),P=pe(e);return React.createElement("div",{className:O,style:_},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:y,className:"ts-filter ts-popup-target ts-filled",role:"button",tabIndex:0},f&&React.createElement("span",{dangerouslySetInnerHTML:{__html:f}}),React.createElement("div",{className:"ts-filter-text"},x),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ue,{isOpen:!1,target:y,showClear:!0,showSave:!1,onSave:()=>{},onClear:u,onClose:()=>{},className:`${r}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:P.style}))}function ke({config:e,filterData:t,value:n,onChange:s}){const[d,y]=j(!1),[r,a]=j(""),[g,f]=j([]),[m,$]=j(!1),u=G(null),x=t.props||{},_=x.placeholder||t.label||"Following",O=x.user,P=t.icon||"",C=o=>{const T=o.target.value;a(T),T.length>=2?($(!0),setTimeout(()=>{f([]),$(!1)},300)):f([])},E=(o,T)=>{s({id:o,name:T}),y(!1),a("")},B=o=>{o.preventDefault(),y(!d)};Q(()=>{const o=T=>{u.current&&!u.current.contains(T.target)&&y(!1)};return d&&document.addEventListener("mousedown",o),()=>{document.removeEventListener("mousedown",o)}},[d]);let V=null;if(n!==void 0){const o=n;o===null?V=null:typeof o=="number"?V=o:typeof o=="object"&&o?.id&&(V=o.id)}else t.value!==null&&t.value!==void 0&&(V=typeof t.value=="number"?t.value:Number(t.value));const N=V!==null&&!isNaN(V)&&V>0;let c=_;if(N){const o=n;o&&typeof o=="object"&&o.name?c=o.name:O?.name&&(c=O.name)}const{style:h,className:R}=Z(e,"ts-form-group"),b=pe(e);return React.createElement("div",{className:R,style:h,ref:u},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter ts-popup-target ${N?"ts-filled":""}`,onClick:B,onMouseDown:o=>o.preventDefault(),role:"button",tabIndex:0},P&&React.createElement("span",{dangerouslySetInnerHTML:{__html:P}}),React.createElement("div",{className:"ts-filter-text"},c),React.createElement("div",{className:"ts-down-icon"})),d&&React.createElement("div",{className:"ts-field-popup-container"},React.createElement("div",{className:b.className,style:b.style},React.createElement("div",{className:"ts-popup-content-wrapper min-scroll"},React.createElement("div",{className:"ts-form-group"},React.createElement("div",{className:"flexify ts-input-icon"},React.createElement("span",null,ie.search),React.createElement("input",{type:"text",className:"inline-input",value:r,onChange:C,placeholder:"Search..."}))),m?React.createElement("div",{className:"ts-loading"},React.createElement("span",{className:"ts-loader"})):g.length>0?React.createElement("div",{className:"ts-term-dropdown"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},g.map(o=>React.createElement("li",{key:o.id},React.createElement("a",{href:"#",className:"flexify",onClick:T=>{T.preventDefault(),E(o.id,o.name)}},React.createElement("span",null,o.name)))))):r.length>=2?React.createElement("div",{className:"ts-empty-user-list"},React.createElement("span",null,"No results found")):null))))}function gt({config:e,filterData:t,value:n,onChange:s}){const[d,y]=j(!1),[r,a]=j(""),[g,f]=j([]),[m,$]=j(!1),u=G(null),x=t.props||{},_=x.placeholder||t.label||"Following Post",O=x.post,P=t.icon||"",C=o=>{const T=o.target.value;a(T),T.length>=2?($(!0),setTimeout(()=>{f([]),$(!1)},300)):f([])},E=(o,T)=>{s({id:o,title:T}),y(!1),a("")},B=o=>{o.preventDefault(),y(!d)};Q(()=>{const o=T=>{u.current&&!u.current.contains(T.target)&&y(!1)};return d&&document.addEventListener("mousedown",o),()=>{document.removeEventListener("mousedown",o)}},[d]);let V=null;if(n!==void 0){const o=n;o===null?V=null:typeof o=="number"?V=o:typeof o=="object"&&o?.id&&(V=o.id)}else t.value!==null&&t.value!==void 0&&(V=typeof t.value=="number"?t.value:Number(t.value));const N=V!==null&&!isNaN(V)&&V>0;let c=_;if(N){const o=n;o&&typeof o=="object"&&o.title?c=o.title:O?.title&&(c=O.title)}const{style:h,className:R}=Z(e,"ts-form-group"),b=pe(e);return React.createElement("div",{className:R,style:h,ref:u},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter ts-popup-target ${N?"ts-filled":""}`,onClick:B,onMouseDown:o=>o.preventDefault(),role:"button",tabIndex:0},P&&React.createElement("span",{dangerouslySetInnerHTML:{__html:P}}),React.createElement("div",{className:"ts-filter-text"},c),React.createElement("div",{className:"ts-down-icon"})),d&&React.createElement("div",{className:"ts-field-popup-container"},React.createElement("div",{className:b.className,style:b.style},React.createElement("div",{className:"ts-popup-content-wrapper min-scroll"},React.createElement("div",{className:"ts-form-group"},React.createElement("div",{className:"flexify ts-input-icon"},React.createElement("span",null,ie.search),React.createElement("input",{type:"text",className:"inline-input",value:r,onChange:C,placeholder:"Search posts..."}))),m?React.createElement("div",{className:"ts-loading"},React.createElement("span",{className:"ts-loader"})):g.length>0?React.createElement("div",{className:"ts-term-dropdown"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},g.map(o=>React.createElement("li",{key:o.id},React.createElement("a",{href:"#",className:"flexify",onClick:T=>{T.preventDefault(),E(o.id,o.title)}},React.createElement("span",null,o.title)))))):r.length>=2?React.createElement("div",{className:"ts-empty-user-list"},React.createElement("span",null,"No posts found")):null))))}function vt({config:e,filterData:t,value:n,onChange:s}){const d=t.props||{},y=d.openInPopup===!0,r=d.placeholder||t.label||"",a=t.icon||"",g=n!=null&&n!==""&&n!==!1,f=u=>{u.preventDefault(),s(g?"":1)};if(y){const{style:u,className:x}=Z(e,"ts-form-group");return React.createElement("div",{className:x,style:u},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter${g?" ts-filled":""}`,onClick:f,onMouseDown:_=>_.preventDefault(),role:"button",tabIndex:0},a&&React.createElement("span",{dangerouslySetInnerHTML:{__html:a}}),React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,r))))}const{style:m,className:$}=Z(e,"ts-form-group switcher-label ts-inline-filter");return React.createElement("div",{className:$,style:m},React.createElement("label",{className:"ts-keep-visible"},React.createElement("div",{className:"switch-slider"},React.createElement("div",{className:"onoffswitch"},React.createElement("input",{type:"checkbox",className:"onoffswitch-checkbox",checked:g,onChange:f,tabIndex:0}),React.createElement("label",{className:"onoffswitch-label",onClick:f}))),r))}function bt({config:e,filterData:t}){const n=t.description||"",{style:s,className:d}=Z(e,"ts-form-group ui-heading");return React.createElement("div",{className:d,style:s},React.createElement("label",null,e.label||t.label,n&&React.createElement("small",null,n)))}function Nt({postTypes:e,currentPostType:t,onChange:n,blockId:s,style:d}){const y=s?`voxel-popup-${s}`:"",[r,a]=j(!1),g=G(null),f=v(P=>{n(P),a(!1)},[n]),m=v(()=>{a(!0)},[]),$=e.find(P=>P.key===t),u=$?.label||"Select type",x=!!t,_=$?.icon||"",O=()=>React.createElement("div",{className:"ts-term-dropdown ts-md-group"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list min-scroll"},e.map(P=>{const C=t===P.key;return React.createElement("li",{key:P.key},React.createElement("a",{href:"#",className:"flexify",onClick:E=>{E.preventDefault(),f(P.key)}},React.createElement("div",{className:"ts-radio-container"},React.createElement("label",{className:"container-radio"},React.createElement("input",{type:"radio",checked:C,disabled:!0,hidden:!0,readOnly:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,P.label),React.createElement("div",{className:"ts-term-icon ts-pull-right"},P.icon&&React.createElement("span",{dangerouslySetInnerHTML:{__html:P.icon}}))))})));return React.createElement("div",{className:"ts-form-group choose-cpt-filter",style:d},React.createElement("label",null,"Post type"),React.createElement("div",{ref:g,className:`ts-filter ts-popup-target ${x?"ts-filled":""}`,onClick:m,onMouseDown:P=>P.preventDefault(),role:"button",tabIndex:0},_&&React.createElement("span",{dangerouslySetInnerHTML:{__html:_}}),React.createElement("div",{className:"ts-filter-text"},u),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ue,{isOpen:r,target:g,title:"",icon:_,saveLabel:"Save",showSave:!1,showClear:!1,onSave:()=>a(!1),onClose:()=>a(!1),className:`hide-head ${y}`.trim()},O()))}const wt={"common:is_empty":(e,t)=>t==null||t==="","common:is_not_empty":(e,t)=>t!=null&&t!=="","text:equals":(e,t)=>t===e.value,"text:not_equals":(e,t)=>t!==e.value,"text:contains":(e,t)=>typeof t!="string"||!e.value?!1:new RegExp(e.value,"i").test(t),"taxonomy:contains":(e,t)=>typeof t!="string"||!e.value?!1:t.split(",").includes(e.value),"taxonomy:not_contains":(e,t)=>typeof t!="string"||!e.value?!0:!t.split(",").includes(e.value),"number:equals":(e,t)=>{const n=parseFloat(String(t)),s=parseFloat(e.value||"0");return n===s},"number:not_equals":(e,t)=>{const n=parseFloat(String(t)),s=parseFloat(e.value||"0");return n!==s},"number:gt":(e,t)=>{const n=parseFloat(String(t)),s=parseFloat(e.value||"0");return n>s},"number:gte":(e,t)=>{const n=parseFloat(String(t)),s=parseFloat(e.value||"0");return n>=s},"number:lt":(e,t)=>{const n=parseFloat(String(t)),s=parseFloat(e.value||"0");return n<s},"number:lte":(e,t)=>{const n=parseFloat(String(t)),s=parseFloat(e.value||"0");return n<=s}};function St(e,t,n){const s=wt[e.type];if(!s)return console.warn(`[filterConditions] Unknown condition type: ${e.type}`),!1;let d=t;return n==="order-by"&&typeof t=="string"&&t.length>0&&(d=t.split("(")[0]),s(e,d)}function xt(e,t="show",n,s){if(!e||e.length===0)return!0;let d=!1;return e.forEach(y=>{if(!y.length)return;let r=!0;y.forEach(a=>{const g=n[a.source],m=s[a.source]?.type;St(a,g,m)||(r=!1)}),r&&(d=!0)}),t==="hide"?!d:d}function kt(e,t,n){return xt(e.conditions,e.conditions_behavior||"show",t,n)}function Tt(){const e=()=>{if(typeof window>"u")return"desktop";const s=window.innerWidth;return s<=767?"mobile":s<=1024?"tablet":"desktop"},[t,n]=j(e);return Q(()=>{const s=()=>{n(e())};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),t}function Ot({attributes:e,postTypes:t,context:n,editorDeviceType:s,onSubmit:d,onPostTypeChange:y,onFilterChange:r}){const a=G(null),g=G(null),{state:f,setCurrentPostType:m,setFilterValue:$,togglePortal:u,submit:x,clearAll:_,narrowedValues:O,narrowingFilters:P}=qe({attributes:e,postTypes:t,context:n,onSubmit:d,onPostTypeChange:y,onFilterChange:r}),C=Ue(l=>{if(n!=="editor")return null;const{isListViewOpened:w,isEditorSidebarOpened:p}=l("core/edit-post");return{leftVisible:w?.()??!1,rightVisible:p?.()??!1}}),E=oe(()=>{if(n!=="editor"||!C||s&&s!=="desktop")return{width:"100%",left:"0",right:"0",zIndex:9999};const l=C.leftVisible?350:0,w=C.rightVisible?280:0;return l===0&&w===0?{}:{width:`calc(100% - ${l+w}px)`,left:`${l}px`,right:`${w}px`,zIndex:9999}},[n,C,s]),[B,V]=j(""),[N,c]=j("");Q(()=>{const l=async()=>{const p=e.searchButtonText??"";if(Le(p)){const k=Pe(p),z=await Ie(k);V(z)}else V(p)},w=async()=>{const p=e.resetButtonText??"Reset";if(Le(p)){const k=Pe(p),z=await Ie(k);c(z)}else c(p)};l(),w()},[e.searchButtonText,e.resetButtonText]),Q(()=>{if(!f.portalActive)return;const l=w=>{w.key==="Escape"&&u()};return document.addEventListener("keydown",l),()=>document.removeEventListener("keydown",l)},[f.portalActive,u]),Q(()=>{if(!f.portalActive)return;const l=p=>{const k=p.target;a.current?.contains(k)||n==="editor"&&(k.closest(".interface-interface-skeleton__sidebar")||k.closest(".edit-post-sidebar")||k.closest(".block-editor-block-inspector")||k.closest(".components-popover")||k.closest(".components-modal"))||u()},w=requestAnimationFrame(()=>{document.addEventListener("mousedown",l)});return()=>{cancelAnimationFrame(w),document.removeEventListener("mousedown",l)}},[f.portalActive,u,n]),Q(()=>{if(n!=="frontend")return;const l=w=>{const p=w;p.detail?.searchFormId&&p.detail.searchFormId!==e.blockId||_()};return window.addEventListener("voxel-search-clear",l),()=>window.removeEventListener("voxel-search-clear",l)},[n,e.blockId,_]);const h=t.find(l=>l.key===f.currentPostType),R=e.filterLists?.[f.currentPostType]||[],b=l=>{x()},o=(l=!1)=>{_(l)},T={};h?.filters?.forEach(l=>{T[l.key]=l});const J=l=>{if(!(n==="frontend"?Ye(l):!0))return null;const p=l;if(n==="frontend"&&p.conditions&&!kt(p,f.filterValues,T))return null;const k=h?.filters?.find(K=>K.key===l.filterKey);if(!k)return null;const z=l.defaultValueEnabled&&l.defaultValue!==void 0&&l.defaultValue!==""&&!(k.type==="range"&&l.defaultValue===".."),X={...k,value:z?l.defaultValue:k.value},S={config:l,filterData:X,value:f.filterValues[l.filterKey],onChange:K=>$(l.filterKey,K),narrowedValues:O,isNarrowing:P,blockId:e.blockId,context:n};switch(k.type){case"keywords":return React.createElement(Xe,{key:l.id,...S});case"range":return React.createElement(et,{key:l.id,...S});case"stepper":return React.createElement(nt,{key:l.id,...S});case"terms":return React.createElement(lt,{key:l.id,...S});case"location":return React.createElement(ct,{key:l.id,...S});case"availability":return React.createElement(it,{key:l.id,...S});case"date":return React.createElement(De,{key:l.id,...S});case"recurring-date":return React.createElement(De,{key:l.id,...S});case"open-now":return React.createElement(pt,{key:l.id,...S});case"order-by":return React.createElement(mt,{key:l.id,...S,allFilterValues:f.filterValues,allFiltersData:h?.filters,postFeedId:e.postToFeedId});case"post-status":return React.createElement(ht,{key:l.id,...S});case"user":return React.createElement(Rt,{key:l.id,...S});case"relations":return React.createElement(Et,{key:l.id,...S});case"following":return React.createElement(ke,{key:l.id,...S});case"followed-by":return React.createElement(ke,{key:l.id,...S});case"following-user":return React.createElement(ke,{key:l.id,...S});case"following-post":return React.createElement(gt,{key:l.id,...S});case"switcher":return React.createElement(vt,{key:l.id,...S});case"ui-heading":return React.createElement(bt,{key:l.id,...S});default:return null}},L=(l=!0)=>React.createElement("div",{className:"ts-filter-wrapper flexify"},e.showPostTypeFilter&&t.length>1&&React.createElement(Nt,{postTypes:t,currentPostType:f.currentPostType,onChange:m,style:fe()}),R.map(w=>J(w)),l&&e.showSearchButton&&React.createElement("div",{className:"ts-form-group flexify ts-form-submit",id:"sf_submit",style:ae("search")},React.createElement("button",{type:"button",onClick:()=>b(),className:`ts-btn ts-btn-2 ts-btn-large ts-search-btn ${f.loading&&!f.resetting?"ts-loading-btn":""}`},f.loading&&!f.resetting&&React.createElement("div",{className:"ts-loader-wrapper"},React.createElement("span",{className:"ts-loader"})),Ne(e.searchButtonIcon,ie.search),B&&B)),l&&e.showResetButton&&React.createElement("div",{className:"ts-form-group flexify ts-form-reset",style:ae("reset")},React.createElement("a",{href:"#",onClick:w=>{w.preventDefault(),o(!1)},className:"ts-filter",role:"button"},Ne(e.resetButtonIcon,ie.reload),N&&React.createElement("div",{className:"ts-filter-text"},N)))),U=Tt(),I=n==="editor"&&s?s:U,q=I==="desktop"&&(e.mfSwitcherDesktop??!1)||I==="tablet"&&(e.mfSwitcherTablet??!1)||I==="mobile"&&(e.mfSwitcherMobile??!1),te=()=>I==="desktop"?e.mfSwitcherDesktopDefault??"feed":I==="tablet"?e.mfSwitcherTabletDefault??"feed":e.mfSwitcherMobileDefault??"feed",[Y,le]=j(te),se=G(null);Q(()=>{le(te())},[I,e.mfSwitcherDesktopDefault,e.mfSwitcherTabletDefault,e.mfSwitcherMobileDefault]);const H=(l,w)=>{if(!l)return null;const p=g.current?.ownerDocument||document,k=p.getElementById(l);if(k)return k;const z=w==="map"?"voxel-fse-map-":"voxel-fse-post-feed-",X=l.replace(/^#/,""),S=`.${z}${X}`,K=p.querySelector(S);return K||null},i=()=>{le("feed");const l=I,w=H(e.postToMapId||"","map"),p=H(e.postToFeedId||"","feed");if(w){w.classList.add(`vx-hidden-${l}`);const k=w.closest(".voxel-fse-flex-container");k&&k.classList.add(`vx-hidden-${l}`);const z=w.querySelector(".ts-map");z&&se.current&&(z.style.height=se.current.height,z.style.minHeight=se.current.minHeight)}if(p){p.classList.remove(`vx-hidden-${l}`);const k=p.closest(".voxel-fse-flex-container");k&&k.classList.remove(`vx-hidden-${l}`)}},M=()=>{le("map");const l=I,w=H(e.postToMapId||"","map"),p=H(e.postToFeedId||"","feed");if(p){p.classList.add(`vx-hidden-${l}`);const k=p.closest(".voxel-fse-flex-container");k&&k.classList.add(`vx-hidden-${l}`)}if(w){w.classList.remove(`vx-hidden-${l}`);const k=w.closest(".voxel-fse-flex-container");k&&k.classList.remove(`vx-hidden-${l}`);const z=w.querySelector(".ts-map");z&&(se.current||(se.current={height:z.style.height||"",minHeight:z.style.minHeight||""}),requestAnimationFrame(()=>{const X=w.getBoundingClientRect().top;z.style.height=`calc(100vh - ${Math.round(X)}px)`,z.style.minHeight=`calc(100vh - ${Math.round(X)}px)`}))}};Q(()=>{q&&(Y==="feed"?i():M())},[I,Y,q,e.postToMapId,e.postToFeedId]);const W=()=>{if(!q)return null;const l=[e.mfSwitcherDesktop?"":"vx-hidden-desktop",e.mfSwitcherTablet?"":"vx-hidden-tablet",e.mfSwitcherMobile?"":"vx-hidden-mobile"].filter(Boolean).join(" "),w=React.createElement("div",{className:`ts-switcher-btn ${l}`,style:n==="editor"?E:{}},React.createElement("a",{href:"#",className:`ts-btn ts-btn-1 ${Y==="feed"?`vx-hidden-${I}`:""}`,onClick:p=>{p.preventDefault(),i()},role:"button"},ie.grid,"List view"),React.createElement("a",{href:"#",className:`ts-btn ts-btn-1 ${Y==="map"?`vx-hidden-${I}`:""}`,onClick:p=>{p.preventDefault(),M()},role:"button"},ie.marker,"Map view"));return n==="editor"?w:Te(React.createElement("div",{className:`voxel-fse-search-form-${e.blockId}`,"data-voxel-id":e.blockId},w),document.body)},ee=I==="desktop"&&(e.formToggleDesktop??!1)||I==="tablet"&&(e.formToggleTablet??!0)||I==="mobile"&&(e.formToggleMobile??!0),ce=ee,D=!ee,re={postTypes:t.map(l=>({key:l.key,label:l.label,filters:l.filters})),currentPostType:f.currentPostType,filterLists:e.filterLists||{},portalMode:e.portalMode||{desktop:!1,tablet:!1,mobile:!1},showPostTypeFilter:e.showPostTypeFilter??!0,showSearchButton:e.showSearchButton??!0,showResetButton:e.showResetButton??!1,searchButtonText:e.searchButtonText||"",resetButtonText:e.resetButtonText||"",formToggleDesktop:e.formToggleDesktop??!1,formToggleTablet:e.formToggleTablet??!0,formToggleMobile:e.formToggleMobile??!0,searchButtonWidth:e.searchButtonWidth,searchButtonWidth_tablet:e.searchButtonWidth_tablet,searchButtonWidth_mobile:e.searchButtonWidth_mobile,searchButtonWidthUnit:e.searchButtonWidthUnit||"%",resetButtonWidth:e.resetButtonWidth,resetButtonWidth_tablet:e.resetButtonWidth_tablet,resetButtonWidth_mobile:e.resetButtonWidth_mobile,resetButtonWidthUnit:e.resetButtonWidthUnit||"%"},ae=l=>{const w=l==="search"?e.searchButtonWidthUnit||"%":e.resetButtonWidthUnit||"%";let p;return l==="search"?I==="mobile"?p=e.searchButtonWidth_mobile??e.searchButtonWidth_tablet??e.searchButtonWidth:I==="tablet"?p=e.searchButtonWidth_tablet??e.searchButtonWidth:p=e.searchButtonWidth:I==="mobile"?p=e.resetButtonWidth_mobile??e.resetButtonWidth_tablet??e.resetButtonWidth:I==="tablet"?p=e.resetButtonWidth_tablet??e.resetButtonWidth:p=e.resetButtonWidth,p!==void 0?{width:`${p}${w}`,flexGrow:0,flexShrink:0}:{}},fe=()=>{let l;return I==="mobile"?l=e.postTypeFilterWidth_mobile??e.postTypeFilterWidth_tablet??e.postTypeFilterWidth:I==="tablet"?l=e.postTypeFilterWidth_tablet??e.postTypeFilterWidth:l=e.postTypeFilterWidth,l!==void 0?{width:`${l}%`,flexGrow:0,flexShrink:0}:{}};return React.createElement(React.Fragment,null,React.createElement("div",{className:"ts-form ts-search-widget","data-v-app":"",ref:g},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(re)}}),ce&&React.createElement("div",{className:"ts-filter-wrapper flexify"},React.createElement("a",{href:"#",onClick:l=>{l.preventDefault(),u()},onMouseDown:l=>l.preventDefault(),className:`ts-filter-toggle ts-btn ts-btn-1 ${f.activeFilterCount>0?"ts-filled":""}`,role:"button","aria-expanded":f.portalActive},ie.filterslider,React.createElement("div",{className:"ts-toggle-text"},"Filter results"),f.activeFilterCount>0&&React.createElement("span",{className:"ts-filter-count"},f.activeFilterCount))),React.createElement("form",{method:"GET",onSubmit:l=>(l.preventDefault(),!1)},D&&React.createElement("div",{className:"ts-inline-filters"},L())),React.createElement("div",{className:"hidden"},React.createElement("div",{className:"ts-search-portal"}))),f.portalActive&&Te(React.createElement("div",{className:`ts-search-portal vx-popup elementor voxel-fse-search-form-${e.blockId}`,"data-voxel-id":e.blockId},React.createElement("div",{className:"ts-popup-root elementor-element"},React.createElement("div",{className:"ts-form ts-search-widget no-render elementor-element"},React.createElement("div",{className:"ts-field-popup-container"},React.createElement("div",{className:"ts-field-popup triggers-blur",ref:a},React.createElement("div",{className:"ts-popup-content-wrapper min-scroll"},React.createElement("div",{className:"ts-form-group"},L())),React.createElement("div",{className:"ts-popup-controller"},React.createElement("ul",{className:"flexify simplify-ul"},React.createElement("li",{className:"flexify ts-popup-close"},React.createElement("a",{href:"#",onClick:l=>{l.preventDefault(),u()},className:"ts-icon-btn",role:"button","aria-label":"Close"},Ne(e.closeIcon,ie.close))),React.createElement("li",{className:"flexify hide-d"},React.createElement("a",{href:"#",onClick:l=>{l.preventDefault(),o(!0)},className:"ts-icon-btn",role:"button"},ie.reload)),React.createElement("li",{className:"flexify hide-m"},React.createElement("a",{href:"#",onClick:l=>{l.preventDefault(),o(!0)},className:"ts-btn ts-btn-1",role:"button"},"Clear")),React.createElement("li",{className:"flexify"},React.createElement("a",{href:"#",onClick:l=>{l.preventDefault(),b(),u()},className:"ts-btn ts-btn-2",role:"button"},"Search"))))))))),document.body),W())}export{Ot as S};
