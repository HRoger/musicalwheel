import{useState as H,useRef as G,useMemo as ie,useEffect as Y,useCallback as v}from"react";import{createPortal as Te}from"react-dom";import{useSelect as Ue}from"@wordpress/data";import{a as Ae}from"./siteUrl-7x5eJEvc.js";import je from"@wordpress/api-fetch";import{V as ue,r as Ne}from"./voxelIcons-B76o57vm.js";import"./voxelShim-DB_Ue-9R.js";import"./backgroundElements-Ui-iCrLV.js";import"./MediaPopup-CXePoOCG.js";import{F as de,D as $e}from"./DatePicker-pD2Z7qly.js";function He(e,t){const n={},s=[t];return e.width&&e.width>0&&(n.width=`${e.width}%`,n.flexGrow=0,n.flexShrink=0),e.hideFilter&&s.push("vx-hidden"),e.alignContent&&(n.justifyContent=e.alignContent),e.hideLabel&&s.push("hide-label"),{style:n,className:s.join(" ")}}function Z(e,t){return He(e,t)}function me(e){const t={},n=["ts-field-popup","triggers-blur"];return e.customPopupEnabled&&(e.popupMinWidth&&e.popupMinWidth>0&&(t.minWidth=`${e.popupMinWidth}px`),e.popupMaxWidth&&e.popupMaxWidth>0&&(t.maxWidth=`${e.popupMaxWidth}px`),e.popupMaxHeight&&e.popupMaxHeight>0&&(t.maxHeight=`${e.popupMaxHeight}px`),e.popupCenterPosition&&n.push("ts-popup-centered")),{style:t,className:n.join(" ")}}function qe({attributes:e,postTypes:t,context:n,onSubmit:s,onPostTypeChange:d,onFilterChange:h}){const[l,a]=H(()=>({currentPostType:e.postTypes[0]||"",filterValues:{},activeFilterCount:0,portalActive:!1,loading:!1,resetting:!1,narrowedValues:null,narrowingFilters:!1,lastModifiedFilter:null})),g=G(!1),m=G(!1),p=G(null),T=ie(()=>t.find(S=>S.key===l.currentPostType),[t,l.currentPostType]),u=ie(()=>e.filterLists[l.currentPostType]||[],[e.filterLists,l.currentPostType]);Y(()=>{e.postTypes.length>0&&!e.postTypes.includes(l.currentPostType)&&a(S=>({...S,currentPostType:e.postTypes[0],filterValues:{}}))},[e.postTypes,l.currentPostType]),Y(()=>{if(!T?.filters)return;const S={};let c=!1;T.filters.forEach(f=>{f.key in l.filterValues||f.value!==null&&f.value!==void 0&&(S[f.key]=f.value,c=!0)}),c&&a(f=>({...f,filterValues:{...f.filterValues,...S}}))},[T?.filters,l.currentPostType]),Y(()=>{if(n!=="editor"||l.resetting||!T?.filters)return;(e.filterLists?.[l.currentPostType]||[]).forEach(c=>{const f=l.filterValues[c.filterKey];c.defaultValueEnabled&&c.defaultValue!==void 0&&c.defaultValue!==""&&c.defaultValue!==null?f!==c.defaultValue&&f!==null&&a(y=>({...y,filterValues:{...y.filterValues,[c.filterKey]:c.defaultValue}})):f!=null&&a(y=>({...y,filterValues:{...y.filterValues,[c.filterKey]:void 0}}))})},[n,l.currentPostType,e.filterLists,l.resetting,T?.filters]),Y(()=>{const S=Object.values(l.filterValues).filter(c=>c!=null&&c!==""&&c!==!1).length;a(c=>({...c,activeFilterCount:S}))},[l.filterValues]);const x=v(S=>{a(c=>c.currentPostType===S?c:{...c,currentPostType:S,filterValues:{}}),n==="editor"&&d&&d(S),n==="editor"&&h&&h({}),n==="frontend"&&s&&(m.current&&e.updateUrl!==!1&&_e({},S),m.current=!0,setTimeout(()=>{s({postType:S})},50))},[n,s,d,h,e.updateUrl]),L=v((S,c)=>{m.current=!0,a(f=>{const y={...f.filterValues,[S]:c};return n==="editor"&&h&&setTimeout(()=>h(y),0),{...f,filterValues:y,lastModifiedFilter:S}})},[n,h]),D=v((S=!1)=>{const c={};T?.filters?.forEach(y=>{y.resets_to!==null&&y.resets_to!==void 0?c[y.key]=y.resets_to:c[y.key]=null});const f=Object.values(c).filter(y=>y!=null&&y!=="").length;if(a(y=>({...y,filterValues:c,activeFilterCount:f,resetting:!0,portalActive:S?!1:y.portalActive,narrowedValues:null,lastModifiedFilter:null})),setTimeout(()=>{a(y=>({...y,resetting:!1}))},100),n==="editor"&&h&&h(c),n==="frontend"){e.updateUrl!==!1&&Ke(l.currentPostType);const y=new CustomEvent("voxel-search-clear",{detail:{postType:l.currentPostType}});window.dispatchEvent(y)}},[n,l.currentPostType,h,e.updateUrl,T?.filters]),_=v(()=>{a(S=>({...S,portalActive:!S.portalActive}))},[]),C=v(async()=>{if(!e.adaptiveFiltering||n!=="frontend")return;if(g.current){g.current=!1;return}const S=u.filter(y=>y.type==="range"||y.type==="terms");if(S.length===0)return;const c=new URLSearchParams;c.set("type",l.currentPostType),l.lastModifiedFilter&&c.set("_last_modified",l.lastModifiedFilter),Object.entries(l.filterValues).forEach(([y,b])=>{b!=null&&b!==""&&(Array.isArray(b)?c.set(y,b.join(",")):typeof b=="object"?c.set(y,JSON.stringify(b)):c.set(y,String(b)))});const f=[];S.forEach(y=>{if(y.type==="terms"){const b=T?.filters?.find(o=>o.key===y.filterKey);if(b?.props?.terms){const o=k=>{k.forEach(Q=>{Q.term_taxonomy_id&&f.push(Q.term_taxonomy_id),Q.children&&Array.isArray(Q.children)&&o(Q.children)})};o(b.props.terms)}}}),a(y=>({...y,narrowingFilters:!0}));try{const y=Ae(),b=await fetch(`${y}voxel-fse/v1/search-form/narrow-filters?${c.toString()}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({term_taxonomy_ids:f})});if(!b.ok)throw new Error(`HTTP ${b.status}`);const o=await b.json();o.success&&o.data?(a(k=>({...k,narrowedValues:{ranges:o.data.ranges||{},terms:o.data.terms||{}},narrowingFilters:!1})),g.current=!0):a(k=>({...k,narrowingFilters:!1}))}catch(y){console.error("[useSearchForm] Adaptive filtering error:",y),a(b=>({...b,narrowingFilters:!1}))}},[e.adaptiveFiltering,n,u,l.currentPostType,l.filterValues,T]);Y(()=>{if(!(!e.adaptiveFiltering||n!=="frontend"))return p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{C()},300),()=>{p.current&&clearTimeout(p.current)}},[l.filterValues,e.adaptiveFiltering,n,C]);const R=v((S,c)=>{a(f=>({...f,loading:!0})),s&&s({postType:c,...S}),n==="frontend"&&e.updateUrl!==!1&&m.current&&_e(S,c),a(f=>({...f,loading:!1}))},[n,s,e.updateUrl]),B=G(null);Y(()=>{if(e.searchOn==="change"&&n==="frontend"){const S=JSON.stringify({type:l.currentPostType,filters:l.filterValues});if(B.current===S)return;if(B.current===null){B.current=S;return}B.current=S;const c=setTimeout(()=>{R(l.filterValues,l.currentPostType)},300);return()=>{clearTimeout(c)}}},[l.filterValues,l.currentPostType,e.searchOn,n,R]);const V=v(()=>{m.current=!0,R(l.filterValues,l.currentPostType)},[R,l.filterValues,l.currentPostType]);return{state:l,setCurrentPostType:x,setFilterValue:L,clearAll:D,togglePortal:_,submit:V,currentPostTypeConfig:T,filterConfigs:u,narrowedValues:l.narrowedValues,narrowingFilters:l.narrowingFilters}}function Ke(e){const t=new URL(window.location.href),n=[];t.searchParams.forEach((s,d)=>{(d.startsWith("filter_")||d==="post_type")&&n.push(d),d==="type"&&!e&&n.push(d),d!=="type"&&d!=="page"&&d!=="pg"&&n.push(d)}),n.forEach(s=>t.searchParams.delete(s)),e&&t.searchParams.set("type",e),window.history.replaceState({},"",t.toString())}function ze(e,t){return Object.hasOwn(t,e)}function _e(e,t){const n=new URL(window.location.href),s=[];n.searchParams.forEach((d,h)=>{(h.startsWith("filter_")||h==="post_type")&&s.push(h),(h==="type"||ze(h,e))&&s.push(h)}),s.forEach(d=>n.searchParams.delete(d)),t&&n.searchParams.set("type",t),Object.entries(e).forEach(([d,h])=>{if(!(h==null||h==="")&&!(typeof h=="string"&&h==="..")&&!(typeof h=="object"&&!Array.isArray(h)&&!Object.values(h).some(g=>g!=null&&g!=="")))if(Array.isArray(h)){const l=h.join(",");l&&n.searchParams.set(d,l)}else typeof h=="object"?n.searchParams.set(d,JSON.stringify(h)):n.searchParams.set(d,String(h))}),window.history.replaceState({},"",n.toString())}function Ce(e){return typeof e=="string"&&e.includes("@tags()")}function Pe(e){if(!Ce(e))return e;const t=e.match(/@tags\(\)(.*?)@endtags\(\)/s);return t?t[1]:e}async function Ie(e,t={}){try{return(await je({path:"/voxel-fse/v1/dynamic-data/render",method:"POST",data:{expression:e,context:t}})).rendered}catch(n){return console.error("Failed to render dynamic tag:",n),e}}function we(){return typeof document>"u"?!1:document.body.classList.contains("logged-in")}function Ge(){return typeof document>"u"?[]:Array.from(document.body.classList).filter(n=>n.startsWith("role-")||["administrator","editor","author","contributor","subscriber"].includes(n)).map(n=>n.replace("role-",""))}function Je(e){const t=e.filterKey;switch(t){case"user:logged_in":return we();case"user:logged_out":return!we();case"user:role":{if(!we())return!1;const n=Ge(),s=e.value||"";switch(e.operator){case"equals":return n.includes(s);case"not_equals":return!n.includes(s);default:return n.includes(s)}}default:return console.warn(`Unknown visibility rule type: ${t}`),!0}}function Qe(e){return!e||e.length===0?!0:e.every(t=>Je(t))}function Ye(e){const{rowVisibility:t="show",visibilityRules:n=[]}=e;if(!n||n.length===0)return!0;const s=Qe(n);return t==="hide"?!s:s}function Xe({config:e,filterData:t,value:n,onChange:s,blockId:d}){const h=d?`voxel-popup-${d}`:"",l=G(null),a=G(null),[g,m]=H(!1),[p,T]=H(""),[u,x]=H(""),L=typeof n=="string"?n:"",D=t.props?.placeholder||t.label||"Type keywords...",_=e.displayAs||t.props?.display_as||"popup",C=t.icon||"";Y(()=>{x(L)},[L]),Y(()=>{g&&(T(L),setTimeout(()=>{a.current?.focus()},50))},[g,L]);const R=j=>{x(j.target.value)},B=v(()=>{const j=u.trim();s(j.length>0?j:"")},[u,s]),V=v(j=>{j.key==="Enter"&&(j.preventDefault(),B())},[B]),S=j=>{T(j.target.value)},c=v(()=>{m(!0)},[]),f=v(()=>{const j=p.trim();s(j.length>0?j:""),m(!1)},[p,s]),y=v(()=>{T(""),s("")},[s]),b=v(j=>{j.key==="Enter"&&(j.preventDefault(),f())},[f]);if(_==="inline"){const{style:j,className:P}=Z(e,"ts-form-group ts-inline-filter");return React.createElement("div",{className:P,style:j},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:"ts-input-icon flexify"},C&&React.createElement("span",{dangerouslySetInnerHTML:{__html:C}}),React.createElement("input",{type:"text",value:u,onChange:R,onBlur:B,onKeyDown:V,placeholder:D,className:"inline-input"})))}const o=L.trim().length>0,{style:k,className:Q}=Z(e,"ts-form-group"),$=me(e);return React.createElement("div",{className:Q,style:k},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:l,className:`ts-filter ts-popup-target ${o?"ts-filled":""}`,onClick:c,onMouseDown:j=>j.preventDefault(),role:"button",tabIndex:0},C&&React.createElement("span",{dangerouslySetInnerHTML:{__html:C}}),React.createElement("div",{className:"ts-filter-text"},o?L:D)),React.createElement(de,{isOpen:g,target:l,title:"",icon:C,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:f,onClear:y,onClose:()=>m(!1),className:`${h}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:$.style},React.createElement("div",{className:"ts-input-icon ts-sticky-top flexify"},React.createElement("span",null,ue.search),React.createElement("input",{ref:a,type:"text",value:p,onChange:S,onKeyDown:b,placeholder:D,className:"autofocus border-none"}))))}const Ze=()=>window.noUiSlider;function Fe(e){if(e==null||e==="")return[];if(Array.isArray(e))return e.map(Number).filter(s=>!isNaN(s));if(typeof e=="string"&&e.includes("..")){const n=e.split(".."),s=[];if(n[0]!==""){const d=Number(n[0]);isNaN(d)||s.push(d)}if(n[1]!==""){const d=Number(n[1]);isNaN(d)||s.push(d)}return s}const t=Number(e);return isNaN(t)?[]:[t]}function et({config:e,filterData:t,value:n,onChange:s,blockId:d,narrowedValues:h,isNarrowing:l}){const a=[d?`voxel-popup-${d}`:"",e.id?`elementor-repeater-item-${e.id}`:""].filter(Boolean).join(" "),g=G(null),m=G(null),p=G(null),[T,u]=H(!1),x=t.props||{},L=x.range_start??x.min??0,D=x.range_end??x.max??100,_=x.step_size??x.step??1,C=x.placeholder||t.label||"Range",R=e.displayAs||t.props?.display_as||"popup",B=x.handles||"single",V=x.compare||"in_range",S=e.filterKey,c=h?.ranges?.[S],f=c?.min??L,y=c?.max??D,b=typeof x.format=="object"?x.format:{numeric:!1,prefix:"",suffix:""},o=b.prefix||"",k=b.suffix||"",Q=t.icon||"",$=B==="single"?[V==="in_range"?y:f]:V==="in_range"?[f,y]:[f,f],j=Fe(n),P=j.length>0?j:$,[q,ee]=H(P),X=v(O=>{const J=b.numeric?O.toLocaleString():String(O);return`${o}${J}${k}`},[b.numeric,o,k]),le=v(O=>O.map(J=>X(J)).join(" — "),[X]),re=n!=null&&n!=="",z=re?le(j.length>0?j:q):C,i=le(q),M=v(()=>{if(!m.current||p.current)return;let O,J;B==="single"?(J=V==="in_range"?[1,0]:[0,1],O=[...q]):(J=V==="in_range"?[0,1,0]:[1,0,1],O=[...q]);const I=Ze();if(!I){console.error("noUiSlider not loaded - window.noUiSlider is undefined");return}I.create(m.current,{start:O,connect:J,range:{min:f,max:y},step:_,behaviour:"tap-drag"}),p.current=m.current.noUiSlider,p.current.on("update",ne=>{ee(ne.map(W=>Number(W)))}),requestAnimationFrame(()=>{p.current&&p.current.set(O,!1)})},[B,V,q,f,y,_]),A=v(()=>{p.current&&(p.current.destroy(),p.current=null)},[]);Y(()=>{const O=Fe(n),J=O.length>0?O:$;ee(J),p.current&&(p.current.set(J,!1),requestAnimationFrame(()=>{p.current&&p.current.set(J,!1)}))},[n,f,y,B,V]),Y(()=>{if(T&&R==="popup"){const O=setTimeout(()=>{M()},100);return()=>clearTimeout(O)}return()=>{R==="popup"&&A()}},[T,R,M,A]),Y(()=>{if(R==="inline")return M(),()=>A()},[R,M,A]),Y(()=>{if(!p.current||!c)return;const O=q.map(J=>J<f?f:J>y?y:J);p.current.updateOptions({range:{min:f,max:y},start:O}),ee(O)},[c,f,y,B]);const te=v(()=>{u(!0)},[]),ce=v(O=>!O.length||O.some(J=>typeof J!="number")?!1:O.join("..")!==$.join(".."),[$]),F=v(O=>ce(O)?O.join(".."):null,[ce]),ae=O=>{const I=[O.target.value===""?f:Number(O.target.value),q[1]??y];ee(I),p.current&&p.current.set(I),R==="minmax"&&s(F(I))},oe=O=>{const J=O.target.value===""?y:Number(O.target.value),I=[q[0]??f,J];ee(I),p.current&&p.current.set(I),R==="minmax"&&s(F(I))},r=v(()=>{s(F(q)),u(!1)},[q,F,s]),E=v(()=>{ee($),p.current&&p.current.set($),s(null)},[$,s]),w=()=>React.createElement("div",{className:"ts-minmax"},React.createElement("input",{type:"number",className:"inline-input input-no-icon",placeholder:String(f),value:q[0]??f,onChange:ae,min:f,max:typeof q[1]=="number"?q[1]:y,step:_}),React.createElement("input",{type:"number",className:"inline-input input-no-icon",placeholder:String(y),value:q[1]??y,onChange:oe,min:typeof q[0]=="number"?q[0]:f,max:y,step:_})),N=()=>React.createElement("div",{className:`range-slider-wrapper${l?" ts-loading":""}`},React.createElement("div",{className:"range-value"},i),React.createElement("div",{ref:m,className:"range-slider"}),c&&(c.min!==L||c.max!==D)&&React.createElement("div",{className:"range-narrowed-indicator"},React.createElement("small",null,"Showing ",X(f)," — ",X(y)," based on current results")));if(R==="minmax"&&B==="double"){const{style:O,className:J}=Z(e,"ts-form-group");return React.createElement("div",{className:J,style:O},!e.hideLabel&&React.createElement("label",null,t.label),w())}if(R==="inline"){const{style:O,className:J}=Z(e,"ts-form-group ts-inline-filter");return React.createElement("div",{className:J,style:O},!e.hideLabel&&React.createElement("label",null,t.label),N())}const{style:U,className:se}=Z(e,"ts-form-group"),K=me(e);return React.createElement("div",{className:se,style:U},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:g,className:`ts-filter ts-popup-target ${re?"ts-filled":""}`,onClick:te,onMouseDown:O=>O.preventDefault(),role:"button",tabIndex:0},Q&&React.createElement("span",{dangerouslySetInnerHTML:{__html:Q}}),React.createElement("div",{className:"ts-filter-text"},z),React.createElement("div",{className:"ts-down-icon"})),React.createElement(de,{isOpen:T,target:g,title:"",icon:Q,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:r,onClear:E,onClose:()=>u(!1),className:`${a}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:K.style},React.createElement("div",{className:"ts-form-group"},React.createElement("label",null,t.label,t.description&&React.createElement("small",null,t.description)),N())))}function tt(e,t){let n=null;return function(...s){n&&clearTimeout(n),n=setTimeout(()=>e.apply(this,s),t)}}function nt({config:e,filterData:t,value:n,onChange:s,blockId:d}){const h=d?`voxel-popup-${d}`:"",l=t.props||{},a=typeof l.range_start=="number"?l.range_start:0,g=typeof l.range_end=="number"?l.range_end:1e3,m=typeof l.step_size=="number"?l.step_size:1,p=typeof l.precision=="number"?l.precision:0,T=l.placeholder||t.label||"Any",u=e.displayAs||l.display_as||"popup",x=t.icon||"",L=G(null),D=G(null),[_,C]=H(!1),[R,B]=H(typeof n=="number"?n:""),V=v(z=>{if(z===""||typeof z!="number"||isNaN(z))return"";let i=z;return i<a&&(i=a),i>g&&(i=g),Number(i.toFixed(p))},[a,g,p]),S=v(z=>typeof z=="number",[]),c=v(z=>{const i=V(z);S(i)?s(i):s("")},[V,S,s]),f=ie(()=>tt(z=>c(z),300),[c]);Y(()=>{B(typeof n=="number"?n:"")},[n]),Y(()=>{_&&B(typeof n=="number"?n:"")},[_,n]);const y=z=>{z.preventDefault();let i;typeof R!="number"?i=a:(i=V(R+m),typeof i!="number"&&(i=a)),B(i),u==="inline"&&f(i)},b=z=>{z.preventDefault();let i;typeof R!="number"?i=a:(i=V(R-m),typeof i!="number"&&(i=a)),B(i),u==="inline"&&f(i)},o=z=>{const i=z.target.value;if(i===""){B(""),u==="inline"&&f("");return}const M=parseFloat(i);if(!isNaN(M)){const A=V(M);B(A),u==="inline"&&f(A)}},k=v(()=>{c(R)},[R,c]),Q=v(()=>{C(!0)},[]),$=v(()=>{c(R),C(!1)},[R,c]),j=v(()=>{B(""),s(""),D.current?.focus()},[s]),P=typeof n=="number"?n:null,q=z=>React.createElement("div",{className:"ts-stepper-input flexify"},React.createElement("button",{type:"button",className:`ts-stepper-left ts-icon-btn${z?" inline-btn-ts":""}`,onClick:b},React.createElement("i",{className:"las la-minus"})),React.createElement("input",{ref:D,type:"number",className:"ts-input-box",min:a,max:g,step:m,value:R,onChange:o,onBlur:z?k:void 0,placeholder:T}),React.createElement("button",{type:"button",className:`ts-stepper-right ts-icon-btn${z?" inline-btn-ts":""}`,onClick:y},React.createElement("i",{className:"las la-plus"})));if(u==="inline"){const{style:z,className:i}=Z(e,"ts-form-group ts-inline-filter");return React.createElement("div",{className:i,style:z},!e.hideLabel&&React.createElement("label",null,t.label),q(!0))}const ee=typeof n=="number",{style:X,className:le}=Z(e,"ts-form-group"),re=me(e);return React.createElement("div",{className:le,style:X},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:L,className:`ts-filter ts-popup-target ${ee?"ts-filled":""}`,onClick:Q,onMouseDown:z=>z.preventDefault(),role:"button",tabIndex:0},x&&React.createElement("span",{dangerouslySetInnerHTML:{__html:x}}),React.createElement("div",{className:"ts-filter-text"},P!==null?P:T),React.createElement("div",{className:"ts-down-icon"})),React.createElement(de,{isOpen:_,target:L,title:"",icon:x,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:$,onClear:j,onClose:()=>C(!1),className:`${h}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:re.style},React.createElement("div",{className:"ts-form-group"},React.createElement("label",null,t.label,t.description&&React.createElement("small",null,t.description)),q(!1))))}function st(e){return e==null||e===""?[]:typeof e=="string"?e.split(",").map(t=>t.trim()).filter(t=>t!==""):Array.isArray(e)?e.length>0&&typeof e[0]=="string"?e:e.length>0&&typeof e[0]=="number"?e.map(String):[]:[]}function Se(e){return e.length===0?null:e.join(",")}function lt({config:e,filterData:t,value:n,onChange:s,blockId:d,narrowedValues:h,isNarrowing:l}){const a=d?`voxel-popup-${d}`:"",g=G(null),m=G(null),[p,T]=H(!1),[u,x]=H(""),L=t.props||{},D=L.multiple??!0,_=L.taxonomy_label??"",C=L.placeholder||t.label||_||"Select",R=e.displayAs||L.display_as||"popup",B=e.hideEmptyTerms??L.hide_empty_terms??!1,V=L.per_page??20,[S,c]=H(1),f=t.icon||"",y=L.taxonomy||e.filterKey,b=h?.terms?.[y],o=v(E=>{const w=(N,U,se)=>{const K={...N,parentRef:U||void 0,hasSelection:!1,depth:se};return N.children&&N.children.length>0&&(K.children=N.children.map(O=>w(O,K,se+1))),K};return E.map(N=>w(N,null,0))},[]),k=ie(()=>{const E=L.terms||[];return o(E)},[L,o]),Q=ie(()=>{const E=new Map,w=N=>{E.set(N.slug,N),N.children&&N.children.forEach(U=>w(U))};return k.forEach(N=>w(N)),E},[k]),$=ie(()=>{const E=[],w=N=>{N.forEach(U=>{B&&b&&U.term_taxonomy_id&&b[U.term_taxonomy_id]===0||(E.push(U),U.children&&U.children.length>0&&w(U.children))})};return w(k),E},[k,B,b]),j=v(E=>!b||!E.term_taxonomy_id?null:b[E.term_taxonomy_id]??null,[b]),P=ie(()=>st(n),[n]),q=v(E=>E.slug?P.includes(E.slug):!1,[P]),ee=ie(()=>$.filter(E=>E.slug&&P.includes(E.slug)),[$,P]),X=ie(()=>{const E=V*S;return $.slice(0,E)},[$,V,S]),le=$.length>V*S,re=ie(()=>{if(!u)return X;const E=u.toLowerCase();return $.filter(w=>w.label.toLowerCase().includes(E))},[$,X,u]);Y(()=>{p&&(x(""),$.length>=15&&setTimeout(()=>m.current?.focus(),50))},[p,$.length]);const z=v(()=>{T(!0)},[]),i=v(E=>{const w=E.slug;if(w)if(D){let N=[...P];if(N.includes(w)){N=N.filter(se=>se!==w);let U=E.parentRef;for(;U;)U.children?.some(K=>N.includes(K.slug)||K.hasSelection)||(U.hasSelection=!1),U=U.parentRef;s(Se(N))}else{N.push(w);let U=E.parentRef;for(;U;)N=N.filter(K=>K!==U.slug),U.hasSelection=!0,U=U.parentRef;const se=new Set;N.forEach(K=>{const O=Q.get(K);if(!O)return;let J=O.parentRef;const I=[];let ne=!1;for(;J;){if(J.slug===w){ne=!0;break}I.push(J),J=J.parentRef}ne&&(se.add(O.slug),I.forEach(W=>{W.hasSelection=!1}))}),N=N.filter(K=>!se.has(K)),s(Se(N))}}else s(Se([w])),R!=="inline"&&T(!1)},[D,P,s,Q,R]),M=v(()=>{T(!1)},[]),A=v(()=>{s(null)},[s]),te=P.length>0,ce=te&&ee[0]?.label||C,F=ee.length>1?ee.length-1:0;if(R==="inline"){const{style:E,className:w}=Z(e,"ts-form-group inline-terms-wrapper ts-inline-filter min-scroll");return React.createElement("div",{className:`${w}${l?" ts-loading":""}`,style:E},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:"ts-term-dropdown ts-multilevel-dropdown inline-multilevel"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},X.map(N=>{const U=q(N),se=j(N),K=se===0;return React.createElement("li",{key:N.slug,className:`${U?"ts-selected":""}${K?" ts-disabled":""}`},React.createElement("a",{href:"#",className:"flexify",onClick:O=>{O.preventDefault(),K||i(N)}},React.createElement("div",{className:"ts-checkbox-container"},React.createElement("label",{className:`container-${D?"checkbox":"radio"}`},React.createElement("input",{type:D?"checkbox":"radio",checked:U,readOnly:!0,disabled:!0,hidden:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,N.depth>0?"— ".repeat(N.depth):"",N.label),se!==null&&React.createElement("span",{className:"ts-term-count"},"(",se,")"),N.icon&&React.createElement("div",{className:"ts-term-icon",dangerouslySetInnerHTML:{__html:N.icon}})))}),le&&React.createElement("li",{className:"ts-term-centered"},React.createElement("a",{href:"#",onClick:N=>{N.preventDefault(),c(U=>U+1)},className:"flexify"},React.createElement("div",{className:"ts-term-icon"},ue.reload||React.createElement("span",null,"↻")),React.createElement("span",null,"Load more"))))))}if(R==="buttons"){const{style:E,className:w}=Z(e,"ts-form-group");return React.createElement("div",{className:w,style:E},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("ul",{className:"simplify-ul addon-buttons flexify"},$.map(N=>{const U=q(N);return React.createElement("li",{key:N.slug,className:`flexify ${U?"adb-selected":""}`,onClick:()=>i(N)},N.label)})))}const{style:ae,className:oe}=Z(e,"ts-form-group"),r=me(e);return React.createElement("div",{className:oe,style:ae},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:g,className:`ts-filter ts-popup-target ${te?"ts-filled":""}`,onClick:z,onMouseDown:E=>E.preventDefault(),role:"button",tabIndex:0},f&&React.createElement("span",{dangerouslySetInnerHTML:{__html:f}}),React.createElement("div",{className:"ts-filter-text"},ce,F>0&&React.createElement("span",{className:"term-count"},"+",F)),React.createElement("div",{className:"ts-down-icon"})),React.createElement(de,{isOpen:p,target:g,title:"",icon:f,saveLabel:"Save",clearLabel:"Clear",showClear:!0,showSave:D,onSave:M,onClear:A,onClose:()=>T(!1),className:`${a}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:r.style},$.length>=15&&React.createElement("div",{className:"ts-sticky-top uib b-bottom"},React.createElement("div",{className:"ts-input-icon flexify"},React.createElement("span",null,ue.search),React.createElement("input",{ref:m,type:"text",value:u,onChange:E=>x(E.target.value),placeholder:"Search",className:"autofocus"}))),React.createElement("div",{className:`ts-term-dropdown ts-multilevel-dropdown ts-md-group${l?" ts-loading":""}`},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},re.map(E=>{const w=q(E),N=j(E),U=N===0;return React.createElement("li",{key:E.slug,className:`${w?"ts-selected":""}${U?" ts-disabled":""}`},React.createElement("a",{href:"#",className:"flexify",onClick:se=>{se.preventDefault(),U||i(E)}},React.createElement("div",{className:"ts-checkbox-container"},React.createElement("label",{className:`container-${D?"checkbox":"radio"}`},React.createElement("input",{type:D?"checkbox":"radio",checked:w,readOnly:!0,disabled:!0,hidden:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,E.depth>0?"— ".repeat(E.depth):"",E.label),N!==null&&React.createElement("span",{className:"ts-term-count"},"(",N,")"),E.icon&&React.createElement("div",{className:"ts-term-icon",dangerouslySetInnerHTML:{__html:E.icon}})))}),!u&&le&&React.createElement("li",{className:"ts-term-centered"},React.createElement("a",{href:"#",onClick:E=>{E.preventDefault(),c(w=>w+1)},className:"flexify"},React.createElement("div",{className:"ts-term-icon"},ue.reload||React.createElement("span",null,"↻")),React.createElement("span",null,"Load more")))),re.length===0&&React.createElement("div",{className:"ts-empty-user-tab"},f&&React.createElement("span",{dangerouslySetInnerHTML:{__html:f}}),React.createElement("p",null,"No results found")))))}const rt=()=>window.noUiSlider;function ye(e){return!e||!e.address?null:e.method==="radius"&&e.lat!==void 0&&e.lng!==void 0?`${e.address};${e.lat},${e.lng},${e.radius||10}`:e.swlat!==void 0&&e.swlng!==void 0&&e.nelat!==void 0&&e.nelng!==void 0?`${e.address};${e.swlat},${e.swlng}..${e.nelat},${e.nelng}`:e.lat!==void 0&&e.lng!==void 0?`${e.address};${e.lat},${e.lng},${e.radius||10}`:e.address}function at(e,t){if(e==null||e==="")return null;if(typeof e=="string"){const n=e.indexOf(";");if(n===-1)return{address:e};const s=e.substring(0,n),d=e.substring(n+1);if(d.includes("..")){const l=d.split(".."),a=l[0].split(","),g=l[1].split(",");return{address:s,method:"area",swlat:Number(a[0]),swlng:Number(a[1]),nelat:Number(g[0]),nelng:Number(g[1])}}const h=d.split(",");return{address:s,method:"radius",lat:Number(h[0]),lng:Number(h[1]),radius:h[2]?Number(h[2]):t}}return typeof e=="object"?e:null}function ct({config:e,filterData:t,value:n,onChange:s,blockId:d}){const h=d?`voxel-popup-${d}`:"",l=G(null),a=G(null),g=G(null),m=G(null),p=G(null),[T,u]=H(!1),[x,L]=H(!1),D=G(null),_=t.props||{},C=_.radius||{},R=C.default??10,B=C.min??0,V=C.max??100,S=C.step??1,c=C.units||"km",f=_.display_proximity_as||"popup",y=_.placeholder||t.label||"Location",b=_.default_search_method||"area";(_.l10n||{}).visibleArea;const k=e.displayAs||t.props?.display_as||"popup",Q=t.icon||"",$=at(n,R)||{},[j,P]=H($.address||""),[q,ee]=H($.radius||R),X=v(W=>Math.round(W*1e6)/1e6,[]),le=v(W=>`${W}${c==="mi"?"mi":"km"}`,[c]),re=v(()=>{if(!m.current||p.current)return;const W=rt();if(!W){console.error("noUiSlider not loaded - window.noUiSlider is undefined");return}W.create(m.current,{start:q,connect:[!0,!1],step:S,range:{min:B,max:V},behaviour:"tap-drag"}),p.current=m.current.noUiSlider,p.current.on("update",pe=>{ee(Math.round(Number(pe[0])))}),p.current.on("change",pe=>{const fe=Math.round(Number(pe[0]));f==="inline"&&$.lat&&s(ye({...$,radius:fe}))})},[q,S,B,V,f,$,s]),z=v(()=>{p.current&&(p.current.destroy(),p.current=null)},[]);Y(()=>{if(f==="inline"&&$.lat){const W=setTimeout(()=>re(),50);return()=>{clearTimeout(W),z()}}},[f,$.lat,re,z]),Y(()=>{if(x){const W=setTimeout(()=>re(),50);return()=>clearTimeout(W)}return()=>z()},[x,re,z]),Y(()=>{const W=$.radius||R;ee(W),p.current&&p.current.set([W])},[$.radius,R]);const i=v(()=>{if(g.current||!a.current||typeof window>"u")return;const W=window.Voxel?.Maps;if(!W){console.warn("Voxel.Maps not available for autocomplete");return}W.await(()=>{if(g.current)return;const pe=e.autocomplete||{};g.current=new W.Autocomplete(a.current,fe=>{if(fe){const Ve=fe.viewport.getSouthWest(),Le=fe.viewport.getNorthEast(),We={address:fe.address,method:b,swlat:X(Ve.getLatitude()),swlng:X(Ve.getLongitude()),nelat:X(Le.getLatitude()),nelng:X(Le.getLongitude()),lat:X(fe.latlng.getLatitude()),lng:X(fe.latlng.getLongitude()),radius:$.radius||R};P(fe.address),s(ye(We)),k==="popup"&&u(!1)}else P(""),s(null)},pe)})},[e.autocomplete,s,k,R,b,$.radius,X]);Y(()=>{(T||k==="inline")&&(P($.address||""),T&&setTimeout(()=>a.current?.focus(),50))},[T,k,$.address]);const M=v(()=>{u(!0)},[]),A=v(()=>{i()},[i]),te=W=>{P(W.target.value),k==="inline"&&(W.target.value?s(ye({...$,address:W.target.value})):s(null))},ce=W=>{W.preventDefault(),W.stopPropagation(),"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(pe=>{const fe={address:"Current Location",method:"radius",lat:pe.coords.latitude,lng:pe.coords.longitude,radius:R};P("Current Location"),s(ye(fe)),k==="popup"&&u(!1)},pe=>{console.error("Geolocation error:",pe)})},F=v(()=>{s(j?ye({...$,address:j}):null),u(!1)},[j,$,s]),ae=v(()=>{P(""),s(null)},[s]),oe=v(W=>{W.key==="Enter"&&(W.preventDefault(),F())},[F]),r=v(()=>{$.lat&&s(ye({...$,radius:q})),L(!1)},[$,q,s]),E=v(()=>{ee(R),p.current&&p.current.set([R]),$.lat&&s(ye({...$,radius:R}))},[R,$,s]),w=!!$.address||!!$.lat,N=w?$.address||"Location set":y,U=()=>React.createElement("div",{className:"ts-input-icon flexify",style:{position:"relative"}},Q&&React.createElement("span",{dangerouslySetInnerHTML:{__html:Q}}),React.createElement("input",{ref:a,type:"text",className:"inline-input",placeholder:y,value:j,onChange:te,onKeyDown:oe,onFocus:A}),React.createElement("a",{href:"#",className:"inline-user-location ts-icon-btn",onClick:ce,title:"Use my location","aria-label":"Use my location"},ue.crosshairs)),se=()=>React.createElement("div",{className:"range-slider-wrapper"},React.createElement("div",{className:"range-value"},le(q)),React.createElement("div",{ref:m,className:"range-slider"})),K=()=>!$.lat||f==="inline"?null:React.createElement("div",{className:"ts-form-group ts-proximity-filter"},React.createElement("label",null,_.proximity_label||"Radius"),React.createElement("div",{ref:D,className:`ts-filter ts-popup-target ${$.radius?"ts-filled":""}`,onClick:()=>L(!0),onMouseDown:W=>W.preventDefault(),role:"button",tabIndex:0},React.createElement("div",{className:"ts-filter-text"},le($.radius||R)),React.createElement("div",{className:"ts-down-icon"})),React.createElement(de,{isOpen:x,target:D,title:"",saveLabel:"Save",clearLabel:"Reset",showClear:!0,onSave:r,onClear:E,onClose:()=>L(!1),className:`${h}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:ne.style},React.createElement("div",{className:"ts-form-group"},React.createElement("label",null,_.proximity_label||"Search radius"),se()))),O=()=>f!=="inline"||!$.lat?null:React.createElement("div",{className:"ts-form-group ts-inline-proximity"},React.createElement("label",null,_.proximity_label||"Radius",": ",le(q)),React.createElement("div",{ref:m,className:"range-slider"}));if(k==="inline"){const{style:W,className:pe}=Z(e,"ts-form-group ts-inline-filter");return React.createElement(React.Fragment,null,React.createElement("div",{className:pe,style:W},!e.hideLabel&&React.createElement("label",null,t.label),U()),O(),K())}const{style:J,className:I}=Z(e,"ts-form-group"),ne=me(e);return React.createElement(React.Fragment,null,React.createElement("div",{className:I,style:J},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:l,className:`ts-filter ts-popup-target ${w?"ts-filled":""}`,onClick:M,onMouseDown:W=>W.preventDefault(),role:"button",tabIndex:0},Q&&React.createElement("span",{dangerouslySetInnerHTML:{__html:Q}}),React.createElement("div",{className:"ts-filter-text"},N),React.createElement("div",{className:"ts-down-icon"})),React.createElement(de,{isOpen:T,target:l,title:"",icon:Q,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:F,onClear:ae,onClose:()=>u(!1),className:`${h}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:ne.style},React.createElement("div",{className:"ts-form-group"},U()))),O(),K())}function ot(e){if(e==null||e==="")return{date:"",slots:1};if(typeof e=="string")return{date:e,slots:1};if(typeof e=="object"){const t=e;return{date:t.date||"",slots:t.slots||1}}return{date:"",slots:1}}const ve=e=>{if(!e)return null;try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t:null}catch{return null}},Re=e=>{if(!e)return null;const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${s}`},Ee=e=>{if(!e)return"";try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):""}catch{return e}};function it({config:e,filterData:t,value:n,onChange:s,blockId:d}){const h=[d?`voxel-popup-${d}`:"",e.id?`elementor-repeater-item-${e.id}`:""].filter(Boolean).join(" "),l=G(null),a=G(null),[g,m]=H(!1),p=t.props||{},u=(p.inputMode||"date-range")==="date-range",x=p.l10n||{},L=x.pickDate||t.label||"Choose date",D=p.presets||[],_=t.icon||"",C=ot(n),R=C.date,B=C.slots;let V="",S="";u&&R&&R.includes("..")?[V,S]=R.split(".."):!u&&R&&(V=R);const[c,f]=H(()=>ve(V)),[y,b]=H(()=>ve(S)),[o,k]=H("start"),[Q,$]=H(B);Y(()=>{if(g){if(u&&R&&R.includes("..")){const[F,ae]=R.split("..");f(ve(F)),b(ve(ae))}else!u&&R&&f(ve(R));$(B),k("start")}},[g,u,R,B]);const j=v(()=>{m(!0)},[]),P=v(F=>{if(u&&F&&a.current)if(o==="start")f(F),k("end"),a.current.setStartRange(F),a.current.setEndRange(null),a.current.draw();else if(c&&F<c)f(F),b(null),a.current.setStartRange(F),a.current.setEndRange(null),a.current.draw();else{b(F),k("start"),a.current.setEndRange(F),a.current.draw();const ae=Re(c),oe=Re(F);ae&&oe&&(s(`${ae}..${oe}`),m(!1))}else f(F)},[u,o,c,s]);v(F=>{$(Number(F.target.value)||1)},[]);const q=v(F=>{if(u){const ae=Re(c),oe=Re(y);ae&&oe&&s(`${ae}..${oe}`)}else{const oe=Re(F!==void 0?F:c);oe&&s(oe)}m(!1)},[u,c,y,s]),ee=v(()=>{f(null),b(null),$(1),s(null),a.current&&(a.current.setStartRange(null),a.current.setEndRange(null))},[s]),X=v(F=>{s(F)},[s]),le=v(()=>typeof n=="string"&&n.includes(".."),[n]),re=u?!!(V&&S):!!R,z=u?le():!!n,i=v(F=>n===F,[n]),M=ie(()=>{if(u&&D.length>0){if(le()){const F=Ee(V),ae=Ee(S);return`${F} - ${ae}`}return L}if(!re)return L;if(u){const F=Ee(V),ae=Ee(S),oe=`${F} — ${ae}`;return B>1?`${oe} (${B})`:oe}else{const F=Ee(R);return B>1?`${F} (${B})`:F}},[u,D.length,le,re,V,S,R,B,L]),{style:A,className:te}=Z(e,"ts-form-group"),ce=me(e);return React.createElement(React.Fragment,null,u&&D.map(F=>React.createElement("div",{key:F.key,className:te,style:A},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter ${i(F.key)?"ts-filled":""}`,onClick:()=>X(F.key),role:"button",tabIndex:0},React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,F.label))))),React.createElement("div",{className:te,style:A},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:l,className:`ts-filter ts-popup-target ${z?"ts-filled":""}`,onClick:j,onMouseDown:F=>F.preventDefault(),role:"button",tabIndex:0},_&&React.createElement("span",{dangerouslySetInnerHTML:{__html:_}}),React.createElement("div",{className:"ts-filter-text"},M),React.createElement("div",{className:"ts-down-icon"})),React.createElement(de,{isOpen:g,target:l,title:"",icon:_,saveLabel:x.save||"Save",clearLabel:x.clear||"Clear",showSave:u,onSave:q,onClear:ee,onClose:()=>m(!1),className:`${h}${u?" ts-availability-wrapper xl-height xl-width":" md-width xl-height"}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:ce.style},u&&React.createElement("div",{className:"ts-popup-head flexify"},React.createElement("div",{className:"ts-popup-name flexify"},_&&React.createElement("span",{dangerouslySetInnerHTML:{__html:_}}),React.createElement("span",null,React.createElement("span",{className:o==="start"?"chosen":"",onClick:()=>k("start"),style:{cursor:"pointer"}},c?Ee(Re(c)):x.checkIn||"Check-in"),React.createElement("span",null," — "),React.createElement("span",{className:o==="end"?"chosen":"",onClick:()=>k("end"),style:{cursor:"pointer"}},y?Ee(Re(y)):x.checkOut||"Check-out")))),React.createElement($e,{value:c,onChange:P,...!u&&{onSelect:q},pickerConfig:{minDate:new Date,...u?{numberOfMonths:2,theme:"pika-range"}:{}},onPickerReady:F=>{a.current=F,u&&c&&(F.setStartRange(c),y&&F.setEndRange(y))}}))))}function ut(e,t){if(e==null||e==="")return{from:"",to:""};if(typeof e=="string"){if(t&&e.includes("..")){const n=e.split("..");return{from:n[0]||"",to:n[1]||""}}return{from:e,to:""}}return{from:"",to:""}}function xe(e,t,n){return!e&&!t?null:n?e&&t?`${e}..${t}`:e?`${e}..`:t?`..${t}`:null:e||null}const he=e=>{if(!e)return null;try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t:null}catch{return null}},be=e=>{if(!e)return null;const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${s}`},ge=e=>{if(!e)return"";try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}):""}catch{return e}},Me=e=>e?e.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}):"";function dt(e){return typeof e=="string"&&e.includes("..")}function De({config:e,filterData:t,value:n,onChange:s,blockId:d}){const h=d?`voxel-popup-${d}`:"",l=G(null),a=t.props||{},g=a.inputMode==="date-range"||a.inputMode===void 0,m=a.l10n||{},p=m.from||"From",T=m.to||"To",u=m.pickDate||"Choose date",x=g?a.presets||[]:[],L=a.displayValue||{start:null,end:null},D=t.icon||"",_=ut(n,g),C=_.from,R=_.to,[B,V]=H(!1),[S,c]=H(!1),[f,y]=H(()=>he(C)),[b,o]=H("start"),[k,Q]=H(()=>he(C)),[$,j]=H(()=>he(R)),P=G(null),q=v(()=>{y(he(C)),c(!0)},[C]),ee=v((I="start")=>{const ne=he(C),W=he(R);Q(ne),j(W),o(I==="end"&&!W?"start":I),c(!0)},[C,R]),X=v(I=>{y(I)},[]),le=v(I=>{V(!0);const W=be(I!==void 0?I:f)||"";s(xe(W,"",!1)),c(!1)},[f,s]),re=v(()=>{V(!0),y(null),s(null)},[s]),z=G(b);z.current=b;const i=G(k);i.current=k;const M=G($);M.current=$;const A=v(I=>{Q(I),i.current=I,P.current&&(P.current.setStartRange(I),M.current&&I&&I>M.current&&(j(null),M.current=null,P.current.setEndRange(null)))},[]),te=v(I=>{j(I),M.current=I,P.current&&P.current.setEndRange(I)},[]),ce=v(()=>{V(!0);let I=be(i.current)||"",ne=be(M.current)||"";I&&!ne&&(ne=I),s(xe(I,ne,!0)),c(!1)},[s]),F=v(()=>{V(!0),A(null),te(null),o("start"),P.current&&P.current.draw(!0),s(null)},[s,A,te]),ae=v(I=>{z.current==="start"?(A(I),o("end")):(te(I),o("start"),setTimeout(()=>{V(!0);const ne=be(i.current)||"";let W=be(I)||"";ne&&!W&&(W=ne),s(xe(ne,W,!0)),c(!1)},0)),P.current&&P.current.draw(!0)},[A,te,s]),oe=v(I=>{P.current=I;const ne=he(C),W=he(R);ne&&I.setStartRange(ne),W&&I.setEndRange(W),I.draw(!0)},[C,R]),r=ie(()=>({numberOfMonths:2,theme:"pika-range",disableDayFn:I=>!!(z.current==="end"&&i.current&&I<i.current),selectDayFn:I=>i.current&&I.toDateString()===i.current.toDateString()||M.current&&I.toDateString()===M.current.toDateString()||void 0}),[]),E=v(I=>{V(!0),s(n===I?null:I)},[n,s]),w=g?dt(n):n!=null&&n!=="",N=ie(()=>{if(!w)return u;if(g){const ne=B?ge(C):L.start||ge(C),W=B?ge(R):L.end||ge(R);return ne&&W?`${ne} - ${W}`:ne||u}return(B?ge(C):L.start||ge(C))||u},[w,g,C,R,u,B,L]),U=k?Me(k):p,se=$?Me($):T,{style:K,className:O}=Z(e,"ts-form-group"),J=me(e);return React.createElement(React.Fragment,null,x.map(I=>React.createElement("div",{key:I.key,className:O,style:K},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter${n===I.key?" ts-filled":""}`,onClick:()=>E(I.key),role:"button",tabIndex:0},React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,I.label))))),React.createElement("div",{className:O,style:K},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:l,className:`ts-filter ts-popup-target${w?" ts-filled":""}`,onClick:g?()=>ee("start"):q,onMouseDown:I=>I.preventDefault(),role:"button",tabIndex:0},D&&React.createElement("span",{dangerouslySetInnerHTML:{__html:D}}),React.createElement("div",{className:"ts-filter-text"},N),React.createElement("div",{className:"ts-down-icon"})),!g&&React.createElement(de,{isOpen:S,target:l,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:le,onClear:re,onClose:()=>c(!1),className:`${h} md-width xl-height${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:J.style},React.createElement($e,{value:f,onChange:X,onSelect:le})),g&&React.createElement(de,{isOpen:S,target:l,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:ce,onClear:F,onClose:()=>c(!1),className:`${h} ts-availability-wrapper xl-width xl-height${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:J.style},React.createElement("div",{className:"ts-popup-head flexify"},React.createElement("div",{className:"ts-popup-name flexify"},D&&React.createElement("span",{dangerouslySetInnerHTML:{__html:D}}),React.createElement("span",null,React.createElement("span",{className:b==="start"?"chosen":"",onClick:()=>o("start"),style:{cursor:"pointer"}},U),k&&React.createElement(React.Fragment,null,React.createElement("span",null," — "),React.createElement("span",{className:b==="end"?"chosen":"",onClick:()=>o("end"),style:{cursor:"pointer"}},se))))),React.createElement($e,{value:null,onChange:()=>{},onSelect:ae,pickerConfig:r,onPickerReady:oe}))))}function pt({config:e,filterData:t,value:n,onChange:s}){const d=n!=null&&n!==!1&&n!==""&&n!==0,h=p=>{p.preventDefault(),s(d?null:1)},l=t.props?.placeholder||t.label||"Open now";if(e.openInPopup||t.props?.openInPopup||!1){const{style:p,className:T}=Z(e,"ts-form-group"),u=t.icon||"";return React.createElement("div",{className:T,style:p},React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter ts-popup-target${d?" ts-filled":""}`,onClick:h,role:"button",tabIndex:0},u&&React.createElement("span",{dangerouslySetInnerHTML:{__html:u}}),React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,l))))}const{style:g,className:m}=Z(e,"ts-form-group switcher-label ts-inline-filter");return React.createElement("div",{className:m,style:g},React.createElement("label",{className:"ts-keep-visible"},React.createElement("div",{className:"switch-slider"},React.createElement("div",{className:"onoffswitch"},React.createElement("input",{type:"checkbox",className:"onoffswitch-checkbox",checked:d,onChange:h,tabIndex:0}),React.createElement("label",{className:"onoffswitch-label",onClick:h}))),l))}function Oe(e){return typeof e!="string"||!e?null:e.split("(")[0]}function Be(e){return Math.round(e*1e5)/1e5}function mt({config:e,filterData:t,value:n,onChange:s,blockId:d,allFilterValues:h,allFiltersData:l,postFeedId:a}){const g=d?`voxel-popup-${d}`:"",m=G(null),[p,T]=H(!1),[u,x]=H(!1),L=t.props||{},D=e.displayAs||t.props?.display_as||"popup",_=L.placeholder||t.label||"Order By",C=ie(()=>{const i=L.choices||{};return Array.isArray(i)?i:Object.entries(i).map(([M,A])=>({key:M,label:A.label||A,placeholder:A.placeholder||A.label||A,icon:A.icon||"",requires_location:A.requires_location||!1,has_location:A.has_location||!1}))},[L.choices]),R=t.icon||"",B=ie(()=>l&&l.find(i=>i.type==="location")||null,[l]),V=ie(()=>{if(!B||!h)return null;const i=h[B.key];return!i||typeof i!="object"?null:i},[B,h]),S=v(i=>{if(V){const{lat:M,lng:A,method:te,address:ce}=V;if(M&&A){if(te==="radius"){i(M,A),x(!1);return}i(M,A),x(!1);return}if(ce&&window.Voxel?.Maps?.getGeocoder){window.Voxel.Maps.getGeocoder().geocode(ce,F=>{F?i(F.latlng?.getLatitude?.()||F.lat,F.latlng?.getLongitude?.()||F.lng):c(i),x(!1)});return}}c(i)},[V]),c=v(i=>{if(!navigator.geolocation){x(!1);return}navigator.geolocation.getCurrentPosition(M=>{const A=Be(M.coords.latitude),te=Be(M.coords.longitude);i(A,te),x(!1)},()=>{const M=window.Voxel_Config;window.Voxel?.alert&&M?.l10n?.positionFail&&window.Voxel.alert(M.l10n.positionFail,"error"),x(!1)})},[]),f=Oe(n),y=C.find(i=>i.key===f)?.requires_location;Y(()=>{if(!y||!V)return;const{lat:i,lng:M,method:A}=V;A==="radius"&&i&&M&&f&&s(`${f}(${i},${M})`)},[V?.lat,V?.lng]);const b=v(()=>{T(!0)},[]),o=v(i=>{i.requires_location?(x(i.key),S((M,A)=>{s(i.key+`(${M},${A})`),T(!1)})):(s(i.key),T(!1))},[s,S]),k=v(i=>{i.requires_location?(x(i.key),S((M,A)=>{s(i.key+`(${M},${A})`)})):s(i.key)},[s,S]),Q=v(()=>{s(null)},[s]),$=typeof n=="string"?n:"",j=!!$,P=Oe($),q=C.find(i=>i.key===P),ee=q?.label||_;Y(()=>{q?.requires_location&&!q?.has_location&&P&&(D==="buttons"?o(q):k(q))},[]);const X=i=>React.createElement("div",{className:"ts-term-dropdown ts-md-group"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list min-scroll"},C.map(M=>{const A=P===M.key,te=u===M.key;return React.createElement("li",{key:M.key,className:A?"ts-selected":""},React.createElement("a",{href:"#",className:`flexify${te?" vx-pending":""}`,onClick:ce=>{ce.preventDefault(),i(M)}},React.createElement("div",{className:"ts-radio-container"},React.createElement("label",{className:"container-radio"},React.createElement("input",{type:"radio",value:M.key,checked:A,readOnly:!0,disabled:!0,hidden:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,M.label),M.icon&&React.createElement("div",{className:"ts-term-icon"},React.createElement("span",{dangerouslySetInnerHTML:{__html:M.icon}}))))})));if(D==="buttons"){const{style:i,className:M}=Z(e,"ts-form-group");return React.createElement("div",{className:M,style:i},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("ul",{className:"simplify-ul addon-buttons flexify"},C.map(A=>{const te=P===A.key,ce=u===A.key;return React.createElement("li",{key:A.key,className:`flexify${te?" adb-selected":""}${ce?" vx-pending":""}`,onClick:()=>k(A)},A.placeholder||A.label)})))}if(D==="alt-btn")return React.createElement(React.Fragment,null,C.map(i=>{const M=P===i.key,A=u===i.key,{style:te,className:ce}=Z(e,"ts-form-group");return React.createElement("div",{key:i.key,className:ce,style:te},!e.hideLabel&&React.createElement("label",null,i.label),React.createElement("div",{className:`ts-filter${M?" ts-filled":""}${A?" vx-pending":""}`,onClick:()=>k(i)},i.icon&&React.createElement("span",{dangerouslySetInnerHTML:{__html:i.icon}}),React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,i.placeholder||i.label))))}));if(D==="post-feed"&&a){const i=`[data-block-id="${a}"] .post-feed-header, .elementor-element-${a} .post-feed-header`,M=document.querySelector(i);if(M&&!M.querySelector(".vxf-sort"))return Te(React.createElement(ft,{filterData:t,filterIcon:R,placeholder:_,options:C,currentKey:P,hasValue:j,displayValue:ee,loading:u,selectDropdownChoice:o,handleClear:Q,renderRadioList:X,popupClassName:g,config:e}),M)}const{style:le,className:re}=Z(e,"ts-form-group"),z=me(e);return React.createElement("div",{className:re,style:le},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:m,className:`ts-filter ts-popup-target${j?" ts-filled":""}`,onClick:b,onMouseDown:i=>i.preventDefault(),role:"button",tabIndex:0},R&&React.createElement("span",{dangerouslySetInnerHTML:{__html:R}}),React.createElement("div",{className:"ts-filter-text"},ee),React.createElement("div",{className:"ts-down-icon"})),React.createElement(de,{isOpen:p,target:m,title:"",icon:R,saveLabel:"Save",clearLabel:"Clear",showClear:j,showSave:!1,onSave:()=>T(!1),onClear:Q,onClose:()=>T(!1),className:`hide-head ${g}${e.popupCenterPosition?" ts-popup-centered":""}`.trim(),popupStyle:z.style},X(o)))}function ft({filterData:e,filterIcon:t,placeholder:n,options:s,currentKey:d,hasValue:h,displayValue:l,loading:a,selectDropdownChoice:g,handleClear:m,renderRadioList:p,popupClassName:T,config:u}){const x=G(null),[L,D]=H(!1),_=me(u);return React.createElement("div",{className:`vxf-sort ts-popup-target${h?" ts-filled":""}`,ref:x},React.createElement("a",{href:"#",onClick:C=>{C.preventDefault(),D(!L)}},h?l:n,React.createElement("div",{className:"ts-down-icon"})),React.createElement(de,{isOpen:L,target:x,title:"",icon:t,saveLabel:"Save",clearLabel:"Clear",showClear:h,showSave:!1,onSave:()=>D(!1),onClear:()=>{m(),D(!1)},onClose:()=>D(!1),className:`hide-d ${T}${u.popupCenterPosition?" ts-popup-centered":""}`.trim(),popupStyle:_.style},p(C=>{g(C),D(!1)})))}function ht({config:e,filterData:t,value:n,onChange:s,blockId:d}){const h=d?`voxel-popup-${d}`:"",[l,a]=H(!1),g=G(null),m=t.props||{},p=e.displayAs||t.props?.display_as||"popup",T=m.placeholder||t.label||"Status",u=ie(()=>{const b=m.choices||{};return Array.isArray(b)?b:Object.entries(b).map(([o,k])=>({key:o,label:k.label||k}))},[m.choices]),x=t.icon||"",L=v(b=>{s(b),a(!1)},[s]),D=v(()=>{s(""),a(!1)},[s]),_=v(()=>{a(!0)},[]),C=typeof n=="string"?n:"",R=!!C,B=u.find(b=>b.key===C),V=R&&B?.label||T,S=()=>React.createElement("div",{className:"ts-term-dropdown ts-md-group"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list min-scroll"},u.map(b=>{const o=C===b.key;return React.createElement("li",{key:b.key},React.createElement("a",{href:"#",className:"flexify",onClick:k=>{k.preventDefault(),L(b.key)}},React.createElement("div",{className:"ts-radio-container"},React.createElement("label",{className:"container-radio"},React.createElement("input",{type:"radio",value:b.key,checked:o,readOnly:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,b.label),x&&React.createElement("div",{className:"ts-term-icon"},React.createElement("span",{dangerouslySetInnerHTML:{__html:x}}))))})));if(p==="buttons")return React.createElement(React.Fragment,null,u.map(b=>{const o=C===b.key,{style:k,className:Q}=Z(e,"ts-form-group");return React.createElement("div",{key:b.key,className:Q,style:k},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter${o?" ts-filled":""}`,onClick:()=>s(b.key)},x&&React.createElement("span",{dangerouslySetInnerHTML:{__html:x}}),React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,b.label))))}));const{style:c,className:f}=Z(e,"ts-form-group"),y=me(e);return React.createElement("div",{className:f,style:c},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:g,className:`ts-filter ts-popup-target ${R?"ts-filled":""}`,onClick:_,onMouseDown:b=>b.preventDefault(),role:"button",tabIndex:0},x&&React.createElement("span",{dangerouslySetInnerHTML:{__html:x}}),React.createElement("div",{className:"ts-filter-text"},V),React.createElement("div",{className:"ts-down-icon"})),React.createElement(de,{isOpen:l,target:g,title:"",icon:x,saveLabel:"Save",showSave:!1,showClear:R,onClear:D,onSave:()=>a(!1),onClose:()=>a(!1),className:`hide-head ${h}${e.popupCenterPosition?" ts-popup-centered":""}`.trim(),popupStyle:y.style},S()))}function yt(e){const{userId:t,skip:n=!1}=e,[s,d]=H(null),[h,l]=H(!1),[a,g]=H(null),m=v(async()=>{if(!t||n){d(null);return}l(!0),g(null);try{const p=Ae(),T=await fetch(`${p}voxel-fse/v1/search-form/user-data?user_id=${t}`);if(T.ok){const u=await T.json();d({id:u.id,name:u.name,avatar:u.avatar||""})}else d({id:t,name:"Unknown",avatar:""}),g("User not found")}catch(p){console.error("useUserData: Error fetching user data:",p),d({id:t,name:"Unknown",avatar:""}),g(p instanceof Error?p.message:"Failed to fetch user data")}finally{l(!1)}},[t,n]);return Y(()=>{m()},[m]),{userData:s,isLoading:h,error:a,refetch:m}}function Rt({config:e,filterData:t,value:n}){const s=G(null),d=t.props||{},h=t.icon||"",l=d.user;let a;n!==void 0?a=n:t.value!==null&&t.value!==void 0?a=t.value:a=null;const g=a?Number(a):null,m=g!==null&&!isNaN(g)&&g>0,p=!!l?.name,{userData:T,isLoading:u}=yt({userId:m?g:null,skip:p}),x=p?{name:l.name,avatar:l.avatar||""}:T;if(!m)return null;const L=x?.name||(u?"Loading...":"Unknown"),{style:D,className:_}=Z(e,"ts-form-group");return React.createElement("div",{className:_,style:D},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:s,className:`ts-filter ts-popup-target ts-filled${u?" ts-loading":""}`},React.createElement("span",{dangerouslySetInnerHTML:{__html:h}}),React.createElement("div",{className:"ts-filter-text"},L)))}function Et({config:e,filterData:t,value:n,onChange:s,blockId:d}){const h=G(null),l=d?`voxel-popup-${d}`:"",g=(t.props||{}).post,m=t.icon||"";let p=null;n!==void 0?n===null?p=null:typeof n=="number"?p=n:typeof n=="string"&&n!==""&&(p=Number(n)):t.value!==null&&t.value!==void 0&&(p=typeof t.value=="number"?t.value:Number(t.value));const T=p!==null&&!isNaN(p)&&p>0,u=v(()=>{s(null)},[s]);if(!T)return null;const x=g?.title||"Unknown",{style:L,className:D}=Z(e,"ts-form-group"),_=me(e);return React.createElement("div",{className:D,style:L},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:h,className:"ts-filter ts-popup-target ts-filled",role:"button",tabIndex:0},m&&React.createElement("span",{dangerouslySetInnerHTML:{__html:m}}),React.createElement("div",{className:"ts-filter-text"},x),React.createElement("div",{className:"ts-down-icon"})),React.createElement(de,{isOpen:!1,target:h,showClear:!0,showSave:!1,onSave:()=>{},onClear:u,onClose:()=>{},className:`${l}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:_.style}))}function ke({config:e,filterData:t,value:n,onChange:s}){const[d,h]=H(!1),[l,a]=H(""),[g,m]=H([]),[p,T]=H(!1),u=G(null),x=t.props||{},L=x.placeholder||t.label||"Following",D=x.user,_=t.icon||"",C=o=>{const k=o.target.value;a(k),k.length>=2?(T(!0),setTimeout(()=>{m([]),T(!1)},300)):m([])},R=(o,k)=>{s({id:o,name:k}),h(!1),a("")},B=o=>{o.preventDefault(),h(!d)};Y(()=>{const o=k=>{u.current&&!u.current.contains(k.target)&&h(!1)};return d&&document.addEventListener("mousedown",o),()=>{document.removeEventListener("mousedown",o)}},[d]);let V=null;if(n!==void 0){const o=n;o===null?V=null:typeof o=="number"?V=o:typeof o=="object"&&o?.id&&(V=o.id)}else t.value!==null&&t.value!==void 0&&(V=typeof t.value=="number"?t.value:Number(t.value));const S=V!==null&&!isNaN(V)&&V>0;let c=L;if(S){const o=n;o&&typeof o=="object"&&o.name?c=o.name:D?.name&&(c=D.name)}const{style:f,className:y}=Z(e,"ts-form-group"),b=me(e);return React.createElement("div",{className:y,style:f,ref:u},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter ts-popup-target ${S?"ts-filled":""}`,onClick:B,onMouseDown:o=>o.preventDefault(),role:"button",tabIndex:0},_&&React.createElement("span",{dangerouslySetInnerHTML:{__html:_}}),React.createElement("div",{className:"ts-filter-text"},c),React.createElement("div",{className:"ts-down-icon"})),d&&React.createElement("div",{className:"ts-field-popup-container"},React.createElement("div",{className:b.className,style:b.style},React.createElement("div",{className:"ts-popup-content-wrapper min-scroll"},React.createElement("div",{className:"ts-form-group"},React.createElement("div",{className:"flexify ts-input-icon"},React.createElement("span",null,ue.search),React.createElement("input",{type:"text",className:"inline-input",value:l,onChange:C,placeholder:"Search..."}))),p?React.createElement("div",{className:"ts-loading"},React.createElement("span",{className:"ts-loader"})):g.length>0?React.createElement("div",{className:"ts-term-dropdown"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},g.map(o=>React.createElement("li",{key:o.id},React.createElement("a",{href:"#",className:"flexify",onClick:k=>{k.preventDefault(),R(o.id,o.name)}},React.createElement("span",null,o.name)))))):l.length>=2?React.createElement("div",{className:"ts-empty-user-list"},React.createElement("span",null,"No results found")):null))))}function gt({config:e,filterData:t,value:n,onChange:s}){const[d,h]=H(!1),[l,a]=H(""),[g,m]=H([]),[p,T]=H(!1),u=G(null),x=t.props||{},L=x.placeholder||t.label||"Following Post",D=x.post,_=t.icon||"",C=o=>{const k=o.target.value;a(k),k.length>=2?(T(!0),setTimeout(()=>{m([]),T(!1)},300)):m([])},R=(o,k)=>{s({id:o,title:k}),h(!1),a("")},B=o=>{o.preventDefault(),h(!d)};Y(()=>{const o=k=>{u.current&&!u.current.contains(k.target)&&h(!1)};return d&&document.addEventListener("mousedown",o),()=>{document.removeEventListener("mousedown",o)}},[d]);let V=null;if(n!==void 0){const o=n;o===null?V=null:typeof o=="number"?V=o:typeof o=="object"&&o?.id&&(V=o.id)}else t.value!==null&&t.value!==void 0&&(V=typeof t.value=="number"?t.value:Number(t.value));const S=V!==null&&!isNaN(V)&&V>0;let c=L;if(S){const o=n;o&&typeof o=="object"&&o.title?c=o.title:D?.title&&(c=D.title)}const{style:f,className:y}=Z(e,"ts-form-group"),b=me(e);return React.createElement("div",{className:y,style:f,ref:u},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter ts-popup-target ${S?"ts-filled":""}`,onClick:B,onMouseDown:o=>o.preventDefault(),role:"button",tabIndex:0},_&&React.createElement("span",{dangerouslySetInnerHTML:{__html:_}}),React.createElement("div",{className:"ts-filter-text"},c),React.createElement("div",{className:"ts-down-icon"})),d&&React.createElement("div",{className:"ts-field-popup-container"},React.createElement("div",{className:b.className,style:b.style},React.createElement("div",{className:"ts-popup-content-wrapper min-scroll"},React.createElement("div",{className:"ts-form-group"},React.createElement("div",{className:"flexify ts-input-icon"},React.createElement("span",null,ue.search),React.createElement("input",{type:"text",className:"inline-input",value:l,onChange:C,placeholder:"Search posts..."}))),p?React.createElement("div",{className:"ts-loading"},React.createElement("span",{className:"ts-loader"})):g.length>0?React.createElement("div",{className:"ts-term-dropdown"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},g.map(o=>React.createElement("li",{key:o.id},React.createElement("a",{href:"#",className:"flexify",onClick:k=>{k.preventDefault(),R(o.id,o.title)}},React.createElement("span",null,o.title)))))):l.length>=2?React.createElement("div",{className:"ts-empty-user-list"},React.createElement("span",null,"No posts found")):null))))}function vt({config:e,filterData:t,value:n,onChange:s}){const d=t.props||{},h=d.openInPopup===!0,l=d.placeholder||t.label||"",a=t.icon||"",g=n!=null&&n!==""&&n!==!1,m=u=>{u.preventDefault(),s(g?"":1)};if(h){const{style:u,className:x}=Z(e,"ts-form-group");return React.createElement("div",{className:x,style:u},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter${g?" ts-filled":""}`,onClick:m,onMouseDown:L=>L.preventDefault(),role:"button",tabIndex:0},a&&React.createElement("span",{dangerouslySetInnerHTML:{__html:a}}),React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,l))))}const{style:p,className:T}=Z(e,"ts-form-group switcher-label ts-inline-filter");return React.createElement("div",{className:T,style:p},React.createElement("label",{className:"ts-keep-visible"},React.createElement("div",{className:"switch-slider"},React.createElement("div",{className:"onoffswitch"},React.createElement("input",{type:"checkbox",className:"onoffswitch-checkbox",checked:g,onChange:m,tabIndex:0}),React.createElement("label",{className:"onoffswitch-label",onClick:m}))),l))}function bt({config:e,filterData:t}){const n=t.description||"",{style:s,className:d}=Z(e,"ts-form-group ui-heading");return React.createElement("div",{className:d,style:s},React.createElement("label",null,e.label||t.label,n&&React.createElement("small",null,n)))}function Nt({postTypes:e,currentPostType:t,onChange:n,blockId:s,style:d}){const h=s?`voxel-popup-${s}`:"",[l,a]=H(!1),g=G(null),m=v(_=>{n(_),a(!1)},[n]),p=v(()=>{a(!0)},[]),T=e.find(_=>_.key===t),u=T?.label||"Select type",x=!!t,L=T?.icon||"",D=()=>React.createElement("div",{className:"ts-term-dropdown ts-md-group"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list min-scroll"},e.map(_=>{const C=t===_.key;return React.createElement("li",{key:_.key},React.createElement("a",{href:"#",className:"flexify",onClick:R=>{R.preventDefault(),m(_.key)}},React.createElement("div",{className:"ts-radio-container"},React.createElement("label",{className:"container-radio"},React.createElement("input",{type:"radio",checked:C,disabled:!0,hidden:!0,readOnly:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,_.label),React.createElement("div",{className:"ts-term-icon ts-pull-right"},_.icon&&React.createElement("span",{dangerouslySetInnerHTML:{__html:_.icon}}))))})));return React.createElement("div",{className:"ts-form-group choose-cpt-filter",style:d},React.createElement("label",null,"Post type"),React.createElement("div",{ref:g,className:`ts-filter ts-popup-target ${x?"ts-filled":""}`,onClick:p,onMouseDown:_=>_.preventDefault(),role:"button",tabIndex:0},L&&React.createElement("span",{dangerouslySetInnerHTML:{__html:L}}),React.createElement("div",{className:"ts-filter-text"},u),React.createElement("div",{className:"ts-down-icon"})),React.createElement(de,{isOpen:l,target:g,title:"",icon:L,saveLabel:"Save",showSave:!1,showClear:!1,onSave:()=>a(!1),onClose:()=>a(!1),className:`hide-head ${h}`.trim()},D()))}const wt={"common:is_empty":(e,t)=>t==null||t==="","common:is_not_empty":(e,t)=>t!=null&&t!=="","text:equals":(e,t)=>t===e.value,"text:not_equals":(e,t)=>t!==e.value,"text:contains":(e,t)=>typeof t!="string"||!e.value?!1:new RegExp(e.value,"i").test(t),"taxonomy:contains":(e,t)=>typeof t!="string"||!e.value?!1:t.split(",").includes(e.value),"taxonomy:not_contains":(e,t)=>typeof t!="string"||!e.value?!0:!t.split(",").includes(e.value),"number:equals":(e,t)=>{const n=parseFloat(String(t)),s=parseFloat(e.value||"0");return n===s},"number:not_equals":(e,t)=>{const n=parseFloat(String(t)),s=parseFloat(e.value||"0");return n!==s},"number:gt":(e,t)=>{const n=parseFloat(String(t)),s=parseFloat(e.value||"0");return n>s},"number:gte":(e,t)=>{const n=parseFloat(String(t)),s=parseFloat(e.value||"0");return n>=s},"number:lt":(e,t)=>{const n=parseFloat(String(t)),s=parseFloat(e.value||"0");return n<s},"number:lte":(e,t)=>{const n=parseFloat(String(t)),s=parseFloat(e.value||"0");return n<=s}};function St(e,t,n){const s=wt[e.type];if(!s)return console.warn(`[filterConditions] Unknown condition type: ${e.type}`),!1;let d=t;return n==="order-by"&&typeof t=="string"&&t.length>0&&(d=t.split("(")[0]),s(e,d)}function xt(e,t="show",n,s){if(!e||e.length===0)return!0;let d=!1;return e.forEach(h=>{if(!h.length)return;let l=!0;h.forEach(a=>{const g=n[a.source],p=s[a.source]?.type;St(a,g,p)||(l=!1)}),l&&(d=!0)}),t==="hide"?!d:d}function kt(e,t,n){return xt(e.conditions,e.conditions_behavior||"show",t,n)}function Tt(){const e=()=>{if(typeof window>"u")return"desktop";const s=window.innerWidth;return s<=767?"mobile":s<=1024?"tablet":"desktop"},[t,n]=H(e);return Y(()=>{const s=()=>{n(e())};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),t}function Ot({attributes:e,postTypes:t,context:n,editorDeviceType:s,onSubmit:d,onPostTypeChange:h,onFilterChange:l}){const a=G(null),g=G(null),{state:m,setCurrentPostType:p,setFilterValue:T,togglePortal:u,submit:x,clearAll:L,narrowedValues:D,narrowingFilters:_}=qe({attributes:e,postTypes:t,context:n,onSubmit:d,onPostTypeChange:h,onFilterChange:l}),C=Ue(r=>{if(n!=="editor")return null;const{isListViewOpened:E,isEditorSidebarOpened:w}=r("core/edit-post");return{leftVisible:E?.()??!1,rightVisible:w?.()??!1}}),R=ie(()=>{if(n!=="editor"||!C||s&&s!=="desktop")return{width:"100%",left:"0",right:"0",zIndex:9999};const r=C.leftVisible?350:0,E=C.rightVisible?280:0;return r===0&&E===0?{}:{width:`calc(100% - ${r+E}px)`,left:`${r}px`,right:`${E}px`,zIndex:9999}},[n,C,s]),[B,V]=H(""),[S,c]=H("");Y(()=>{const r=async()=>{const w=e.searchButtonText??"";if(Ce(w)){const N=Pe(w),U=await Ie(N);V(U)}else V(w)},E=async()=>{const w=e.resetButtonText??"Reset";if(Ce(w)){const N=Pe(w),U=await Ie(N);c(U)}else c(w)};r(),E()},[e.searchButtonText,e.resetButtonText]),Y(()=>{if(!m.portalActive)return;const r=E=>{E.key==="Escape"&&u()};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[m.portalActive,u]),Y(()=>{if(!m.portalActive)return;const r=w=>{const N=w.target;a.current?.contains(N)||n==="editor"&&(N.closest(".interface-interface-skeleton__sidebar")||N.closest(".edit-post-sidebar")||N.closest(".block-editor-block-inspector")||N.closest(".components-popover")||N.closest(".components-modal"))||u()},E=requestAnimationFrame(()=>{document.addEventListener("mousedown",r)});return()=>{cancelAnimationFrame(E),document.removeEventListener("mousedown",r)}},[m.portalActive,u,n]),Y(()=>{if(n!=="frontend")return;const r=E=>{const w=E;w.detail?.searchFormId&&w.detail.searchFormId!==e.blockId||L()};return window.addEventListener("voxel-search-clear",r),()=>window.removeEventListener("voxel-search-clear",r)},[n,e.blockId,L]);const f=t.find(r=>r.key===m.currentPostType),y=e.filterLists?.[m.currentPostType]||[],b=r=>{x()},o=(r=!1)=>{L(r)},k={};f?.filters?.forEach(r=>{k[r.key]=r});const Q=r=>{if(!(n==="frontend"?Ye(r):!0))return null;const w=r;if(n==="frontend"&&w.conditions&&!kt(w,m.filterValues,k))return null;const N=f?.filters?.find(O=>O.key===r.filterKey);if(!N)return null;const U=r.defaultValueEnabled&&r.defaultValue!==void 0&&r.defaultValue!==""&&!(N.type==="range"&&r.defaultValue===".."),se={...N,value:U?r.defaultValue:N.value},K={config:r,filterData:se,value:m.filterValues[r.filterKey],onChange:O=>T(r.filterKey,O),narrowedValues:D,isNarrowing:_,blockId:e.blockId,context:n};switch(N.type){case"keywords":return React.createElement(Xe,{key:r.id,...K});case"range":return React.createElement(et,{key:r.id,...K});case"stepper":return React.createElement(nt,{key:r.id,...K});case"terms":return React.createElement(lt,{key:r.id,...K});case"location":return React.createElement(ct,{key:r.id,...K});case"availability":return React.createElement(it,{key:r.id,...K});case"date":return React.createElement(De,{key:r.id,...K});case"recurring-date":return React.createElement(De,{key:r.id,...K});case"open-now":return React.createElement(pt,{key:r.id,...K});case"order-by":return React.createElement(mt,{key:r.id,...K,allFilterValues:m.filterValues,allFiltersData:f?.filters,postFeedId:e.postToFeedId});case"post-status":return React.createElement(ht,{key:r.id,...K});case"user":return React.createElement(Rt,{key:r.id,...K});case"relations":return React.createElement(Et,{key:r.id,...K});case"following":return React.createElement(ke,{key:r.id,...K});case"followed-by":return React.createElement(ke,{key:r.id,...K});case"following-user":return React.createElement(ke,{key:r.id,...K});case"following-post":return React.createElement(gt,{key:r.id,...K});case"switcher":return React.createElement(vt,{key:r.id,...K});case"ui-heading":return React.createElement(bt,{key:r.id,...K});default:return null}},$=(r=!0)=>React.createElement("div",{className:"ts-filter-wrapper flexify"},e.showPostTypeFilter&&t.length>1&&React.createElement(Nt,{postTypes:t,currentPostType:m.currentPostType,onChange:p,style:oe()}),y.map(E=>Q(E)),r&&e.showSearchButton&&React.createElement("div",{className:"ts-form-group flexify ts-form-submit",id:"sf_submit",style:ae("search")},React.createElement("button",{type:"button",onClick:()=>b(),className:`ts-btn ts-btn-2 ts-btn-large ts-search-btn ${m.loading&&!m.resetting?"ts-loading-btn":""}`},m.loading&&!m.resetting&&React.createElement("div",{className:"ts-loader-wrapper"},React.createElement("span",{className:"ts-loader"})),Ne(e.searchButtonIcon,ue.search),B&&B)),r&&e.showResetButton&&React.createElement("div",{className:"ts-form-group flexify ts-form-reset",style:ae("reset")},React.createElement("a",{href:"#",onClick:E=>{E.preventDefault(),o(!1)},className:"ts-filter",role:"button"},Ne(e.resetButtonIcon,ue.reload),S&&React.createElement("div",{className:"ts-filter-text"},S)))),j=Tt(),P=n==="editor"&&s?s:j,q=P==="desktop"&&(e.mfSwitcherDesktop??!1)||P==="tablet"&&(e.mfSwitcherTablet??!1)||P==="mobile"&&(e.mfSwitcherMobile??!1),ee=()=>P==="desktop"?e.mfSwitcherDesktopDefault??"feed":P==="tablet"?e.mfSwitcherTabletDefault??"feed":e.mfSwitcherMobileDefault??"feed",[X,le]=H(ee);Y(()=>{le(ee())},[P,e.mfSwitcherDesktopDefault,e.mfSwitcherTabletDefault,e.mfSwitcherMobileDefault]);const re=(r,E)=>{if(!r)return null;const w=g.current?.ownerDocument||document,N=w.getElementById(r);if(N)return N;const U=E==="map"?"voxel-fse-map-":"voxel-fse-post-feed-",se=r.replace(/^#/,""),K=`.${U}${se}`,O=w.querySelector(K);return O||null},z=()=>{le("feed");const r=P,E=re(e.postToMapId||"","map"),w=re(e.postToFeedId||"","feed");E&&E.classList.add(`vx-hidden-${r}`),w&&w.classList.remove(`vx-hidden-${r}`)},i=()=>{le("map");const r=P,E=re(e.postToMapId||"","map"),w=re(e.postToFeedId||"","feed");E&&E.classList.remove(`vx-hidden-${r}`),w&&w.classList.remove(`vx-hidden-${r}`)};Y(()=>{n==="editor"&&q&&(X==="feed"?z():i())},[P,X,n,q,e.postToMapId,e.postToFeedId]);const M=()=>{if(!q)return null;const r=[e.mfSwitcherDesktop?"":"vx-hidden-desktop",e.mfSwitcherTablet?"":"vx-hidden-tablet",e.mfSwitcherMobile?"":"vx-hidden-mobile"].filter(Boolean).join(" "),E=React.createElement("div",{className:`ts-switcher-btn ${r}`,style:n==="editor"?R:{}},React.createElement("a",{href:"#",className:`ts-btn ts-btn-1 ${X==="feed"?`vx-hidden-${P}`:""}`,onClick:w=>{w.preventDefault(),z()},role:"button"},ue.grid,"List view"),React.createElement("a",{href:"#",className:`ts-btn ts-btn-1 ${X==="map"?`vx-hidden-${P}`:""}`,onClick:w=>{w.preventDefault(),i()},role:"button"},ue.marker,"Map view"));return n==="editor"?E:Te(React.createElement("div",{className:`voxel-fse-search-form-${e.blockId}`,"data-voxel-id":e.blockId},E),document.body)},A=P==="desktop"&&(e.formToggleDesktop??!1)||P==="tablet"&&(e.formToggleTablet??!0)||P==="mobile"&&(e.formToggleMobile??!0),te=A,ce=!A,F={postTypes:t.map(r=>({key:r.key,label:r.label,filters:r.filters})),currentPostType:m.currentPostType,filterLists:e.filterLists||{},portalMode:e.portalMode||{desktop:!1,tablet:!1,mobile:!1},showPostTypeFilter:e.showPostTypeFilter??!0,showSearchButton:e.showSearchButton??!0,showResetButton:e.showResetButton??!1,searchButtonText:e.searchButtonText||"",resetButtonText:e.resetButtonText||"",formToggleDesktop:e.formToggleDesktop??!1,formToggleTablet:e.formToggleTablet??!0,formToggleMobile:e.formToggleMobile??!0,searchButtonWidth:e.searchButtonWidth,searchButtonWidth_tablet:e.searchButtonWidth_tablet,searchButtonWidth_mobile:e.searchButtonWidth_mobile,searchButtonWidthUnit:e.searchButtonWidthUnit||"%",resetButtonWidth:e.resetButtonWidth,resetButtonWidth_tablet:e.resetButtonWidth_tablet,resetButtonWidth_mobile:e.resetButtonWidth_mobile,resetButtonWidthUnit:e.resetButtonWidthUnit||"%"},ae=r=>{const E=r==="search"?e.searchButtonWidthUnit||"%":e.resetButtonWidthUnit||"%";let w;return r==="search"?P==="mobile"?w=e.searchButtonWidth_mobile??e.searchButtonWidth_tablet??e.searchButtonWidth:P==="tablet"?w=e.searchButtonWidth_tablet??e.searchButtonWidth:w=e.searchButtonWidth:P==="mobile"?w=e.resetButtonWidth_mobile??e.resetButtonWidth_tablet??e.resetButtonWidth:P==="tablet"?w=e.resetButtonWidth_tablet??e.resetButtonWidth:w=e.resetButtonWidth,w!==void 0?{width:`${w}${E}`,flexGrow:0,flexShrink:0}:{}},oe=()=>{let r;return P==="mobile"?r=e.postTypeFilterWidth_mobile??e.postTypeFilterWidth_tablet??e.postTypeFilterWidth:P==="tablet"?r=e.postTypeFilterWidth_tablet??e.postTypeFilterWidth:r=e.postTypeFilterWidth,r!==void 0?{width:`${r}%`,flexGrow:0,flexShrink:0}:{}};return React.createElement(React.Fragment,null,React.createElement("div",{className:"ts-form ts-search-widget","data-v-app":"",ref:g},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(F)}}),te&&React.createElement("div",{className:"ts-filter-wrapper flexify"},React.createElement("a",{href:"#",onClick:r=>{r.preventDefault(),u()},onMouseDown:r=>r.preventDefault(),className:`ts-filter-toggle ts-btn ts-btn-1 ${m.activeFilterCount>0?"ts-filled":""}`,role:"button","aria-expanded":m.portalActive},ue.filterslider,React.createElement("div",{className:"ts-toggle-text"},"Filter results"),m.activeFilterCount>0&&React.createElement("span",{className:"ts-filter-count"},m.activeFilterCount))),React.createElement("form",{method:"GET",onSubmit:r=>(r.preventDefault(),!1)},ce&&React.createElement("div",{className:"ts-inline-filters"},$())),React.createElement("div",{className:"hidden"},React.createElement("div",{className:"ts-search-portal"}))),m.portalActive&&Te(React.createElement("div",{className:`ts-search-portal vx-popup elementor voxel-fse-search-form-${e.blockId}`,"data-voxel-id":e.blockId},React.createElement("div",{className:"ts-popup-root elementor-element"},React.createElement("div",{className:"ts-form ts-search-widget no-render elementor-element"},React.createElement("div",{className:"ts-field-popup-container"},React.createElement("div",{className:"ts-field-popup triggers-blur",ref:a},React.createElement("div",{className:"ts-popup-content-wrapper min-scroll"},React.createElement("div",{className:"ts-form-group"},$())),React.createElement("div",{className:"ts-popup-controller"},React.createElement("ul",{className:"flexify simplify-ul"},React.createElement("li",{className:"flexify ts-popup-close"},React.createElement("a",{href:"#",onClick:r=>{r.preventDefault(),u()},className:"ts-icon-btn",role:"button","aria-label":"Close"},Ne(e.closeIcon,ue.close))),React.createElement("li",{className:"flexify hide-d"},React.createElement("a",{href:"#",onClick:r=>{r.preventDefault(),o(!0)},className:"ts-icon-btn",role:"button"},ue.reload)),React.createElement("li",{className:"flexify hide-m"},React.createElement("a",{href:"#",onClick:r=>{r.preventDefault(),o(!0)},className:"ts-btn ts-btn-1",role:"button"},"Clear")),React.createElement("li",{className:"flexify"},React.createElement("a",{href:"#",onClick:r=>{r.preventDefault(),b(),u()},className:"ts-btn ts-btn-2",role:"button"},"Search"))))))))),document.body),M())}export{Ot as S};
