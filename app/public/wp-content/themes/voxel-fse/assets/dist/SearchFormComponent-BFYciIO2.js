import{useState as q,useRef as G,useMemo as ce,useEffect as Y,useCallback as b}from"react";import{createPortal as Te}from"react-dom";import{useSelect as Ue}from"@wordpress/data";import{a as Be}from"./siteUrl-7x5eJEvc.js";import He from"@wordpress/api-fetch";import{V as oe,r as Ne}from"./voxelIcons-B76o57vm.js";import"./voxelShim-DB_Ue-9R.js";import"./backgroundElements-Ui-iCrLV.js";import"./MediaPopup-BnHnsf_s.js";import{F as ie,D as Le}from"./DatePicker-pD2Z7qly.js";function je(e,t){const n={},s=[t];return e.width&&e.width>0&&(n.width=`${e.width}%`,n.flexGrow=0,n.flexShrink=0),e.hideFilter&&s.push("vx-hidden"),e.alignContent&&(n.justifyContent=e.alignContent),e.hideLabel&&s.push("hide-label"),{style:n,className:s.join(" ")}}function ee(e,t){return je(e,t)}function de(e){const t={},n=["ts-field-popup","triggers-blur"];return e.customPopupEnabled&&(e.popupMinWidth&&e.popupMinWidth>0&&(t.minWidth=`${e.popupMinWidth}px`),e.popupMaxWidth&&e.popupMaxWidth>0&&(t.maxWidth=`${e.popupMaxWidth}px`),e.popupMaxHeight&&e.popupMaxHeight>0&&(t.maxHeight=`${e.popupMaxHeight}px`),e.popupCenterPosition&&n.push("ts-popup-centered")),{style:t,className:n.join(" ")}}function qe({attributes:e,postTypes:t,context:n,onSubmit:s,onPostTypeChange:d,onFilterChange:y}){const[r,a]=q(()=>({currentPostType:e.postTypes[0]||"",filterValues:{},activeFilterCount:0,portalActive:!1,loading:!1,resetting:!1,narrowedValues:null,narrowingFilters:!1,lastModifiedFilter:null})),N=G(!1),h=G(!1),m=G(null),L=ce(()=>t.find(w=>w.key===r.currentPostType),[t,r.currentPostType]),E=ce(()=>e.filterLists[r.currentPostType]||[],[e.filterLists,r.currentPostType]);Y(()=>{e.postTypes.length>0&&!e.postTypes.includes(r.currentPostType)&&a(w=>({...w,currentPostType:e.postTypes[0],filterValues:{}}))},[e.postTypes,r.currentPostType]),Y(()=>{if(!L?.filters)return;const w={};let u=!1;L.filters.forEach(f=>{f.key in r.filterValues||f.value!==null&&f.value!==void 0&&(w[f.key]=f.value,u=!0)}),u&&a(f=>({...f,filterValues:{...f.filterValues,...w}}))},[L?.filters,r.currentPostType]),Y(()=>{if(n!=="editor"||r.resetting||!L?.filters)return;(e.filterLists?.[r.currentPostType]||[]).forEach(u=>{const f=r.filterValues[u.filterKey];u.defaultValueEnabled&&u.defaultValue!==void 0&&u.defaultValue!==""&&u.defaultValue!==null?f!==u.defaultValue&&f!==null&&a(p=>({...p,filterValues:{...p.filterValues,[u.filterKey]:u.defaultValue}})):f!=null&&a(p=>({...p,filterValues:{...p.filterValues,[u.filterKey]:void 0}}))})},[n,r.currentPostType,e.filterLists,r.resetting,L?.filters]),Y(()=>{const w=Object.values(r.filterValues).filter(u=>u!=null&&u!==""&&u!==!1).length;a(u=>({...u,activeFilterCount:w}))},[r.filterValues]);const I=b(w=>{a(u=>u.currentPostType===w?u:{...u,currentPostType:w,filterValues:{}}),n==="editor"&&d&&d(w),n==="editor"&&y&&y({}),n==="frontend"&&window.dispatchEvent(new CustomEvent("voxel-search-form-post-type-changed",{detail:{searchFormId:e.blockId,postType:w}})),n==="frontend"&&s&&(h.current&&e.updateUrl!==!1&&_e({},w),h.current=!0,setTimeout(()=>{s({postType:w})},50))},[n,s,d,y,e.updateUrl]),v=b((w,u)=>{h.current=!0,a(f=>{const p={...f.filterValues,[w]:u};return n==="editor"&&y&&setTimeout(()=>y(p),0),{...f,filterValues:p,lastModifiedFilter:w}})},[n,y]),D=b((w=!1)=>{const u={};L?.filters?.forEach(p=>{p.resets_to!==null&&p.resets_to!==void 0?u[p.key]=p.resets_to:u[p.key]=null});const f=Object.values(u).filter(p=>p!=null&&p!=="").length;if(a(p=>({...p,filterValues:u,activeFilterCount:f,resetting:!0,portalActive:w?!1:p.portalActive,narrowedValues:null,lastModifiedFilter:null})),setTimeout(()=>{a(p=>({...p,resetting:!1}))},100),n==="editor"&&y&&y(u),n==="frontend"){e.updateUrl!==!1&&Ke(r.currentPostType);const p=new CustomEvent("voxel-search-clear",{detail:{postType:r.currentPostType}});window.dispatchEvent(p)}},[n,r.currentPostType,y,e.updateUrl,L?.filters]),F=b(()=>{a(w=>({...w,portalActive:!w.portalActive}))},[]),_=b(async()=>{if(!e.adaptiveFiltering||n!=="frontend")return;if(N.current){N.current=!1;return}const w=E.filter(p=>p.type==="range"||p.type==="terms");if(w.length===0)return;const u=new URLSearchParams;u.set("type",r.currentPostType),r.lastModifiedFilter&&u.set("_last_modified",r.lastModifiedFilter),Object.entries(r.filterValues).forEach(([p,g])=>{g!=null&&g!==""&&(Array.isArray(g)?u.set(p,g.join(",")):typeof g=="object"?u.set(p,JSON.stringify(g)):u.set(p,String(g)))});const f=[];w.forEach(p=>{if(p.type==="terms"){const g=L?.filters?.find(c=>c.key===p.filterKey);if(g?.props?.terms){const c=C=>{C.forEach(J=>{J.term_taxonomy_id&&f.push(J.term_taxonomy_id),J.children&&Array.isArray(J.children)&&c(J.children)})};c(g.props.terms)}}}),a(p=>({...p,narrowingFilters:!0}));try{const p=Be(),g=await fetch(`${p}voxel-fse/v1/search-form/narrow-filters?${u.toString()}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({term_taxonomy_ids:f})});if(!g.ok)throw new Error(`HTTP ${g.status}`);const c=await g.json();c.success&&c.data?(a(C=>({...C,narrowedValues:{ranges:c.data.ranges||{},terms:c.data.terms||{}},narrowingFilters:!1})),N.current=!0):a(C=>({...C,narrowingFilters:!1}))}catch(p){console.error("[useSearchForm] Adaptive filtering error:",p),a(g=>({...g,narrowingFilters:!1}))}},[e.adaptiveFiltering,n,E,r.currentPostType,r.filterValues,L]);Y(()=>{if(!(!e.adaptiveFiltering||n!=="frontend"))return m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{_()},300),()=>{m.current&&clearTimeout(m.current)}},[r.filterValues,e.adaptiveFiltering,n,_]);const k=b((w,u)=>{a(f=>({...f,loading:!0})),s&&s({postType:u,...w}),n==="frontend"&&e.updateUrl!==!1&&h.current&&_e(w,u),a(f=>({...f,loading:!1}))},[n,s,e.updateUrl]),W=G(null);Y(()=>{if(e.searchOn==="change"&&n==="frontend"){const w=JSON.stringify({type:r.currentPostType,filters:r.filterValues});if(W.current===w)return;if(W.current===null){W.current=w;return}W.current=w;const u=setTimeout(()=>{k(r.filterValues,r.currentPostType)},300);return()=>{clearTimeout(u)}}},[r.filterValues,r.currentPostType,e.searchOn,n,k]),Y(()=>{if(n!=="frontend")return;const w=f=>{f.detail?.searchFormId===e.blockId&&a(g=>({...g,loading:!0}))},u=f=>{f.detail?.searchFormId===e.blockId&&a(g=>({...g,loading:!1}))};return window.addEventListener("voxel-fse:feed-loading",w),window.addEventListener("voxel-fse:feed-loaded",u),()=>{window.removeEventListener("voxel-fse:feed-loading",w),window.removeEventListener("voxel-fse:feed-loaded",u)}},[n,e.blockId]);const T=b(()=>{h.current=!0,k(r.filterValues,r.currentPostType)},[k,r.filterValues,r.currentPostType]);return{state:r,setCurrentPostType:I,setFilterValue:v,clearAll:D,togglePortal:F,submit:T,currentPostTypeConfig:L,filterConfigs:E,narrowedValues:r.narrowedValues,narrowingFilters:r.narrowingFilters}}function Ke(e){const t=new URL(window.location.href),n=[];t.searchParams.forEach((s,d)=>{(d.startsWith("filter_")||d==="post_type")&&n.push(d),d==="type"&&!e&&n.push(d),d!=="type"&&d!=="page"&&d!=="pg"&&n.push(d)}),n.forEach(s=>t.searchParams.delete(s)),e&&t.searchParams.set("type",e),window.history.replaceState({},"",t.toString())}function ze(e,t){return Object.hasOwn(t,e)}function _e(e,t){const n=new URL(window.location.href),s=[];n.searchParams.forEach((d,y)=>{(y.startsWith("filter_")||y==="post_type")&&s.push(y),(y==="type"||ze(y,e))&&s.push(y)}),s.forEach(d=>n.searchParams.delete(d)),t&&n.searchParams.set("type",t),Object.entries(e).forEach(([d,y])=>{if(!(y==null||y==="")&&!(typeof y=="string"&&y==="..")&&!(typeof y=="object"&&!Array.isArray(y)&&!Object.values(y).some(N=>N!=null&&N!=="")))if(Array.isArray(y)){const r=y.join(",");r&&n.searchParams.set(d,r)}else typeof y=="object"?n.searchParams.set(d,JSON.stringify(y)):n.searchParams.set(d,String(y))}),window.history.replaceState({},"",n.toString())}function $e(e){return typeof e=="string"&&e.includes("@tags()")}function Ie(e){if(!$e(e))return e;const t=e.match(/@tags\(\)(.*?)@endtags\(\)/s);return t?t[1]:e}async function Pe(e,t={}){try{return(await He({path:"/voxel-fse/v1/dynamic-data/render",method:"POST",data:{expression:e,context:t}})).rendered}catch(n){return console.error("Failed to render dynamic tag:",n),e}}function we(){return typeof document>"u"?!1:document.body.classList.contains("logged-in")}function Ge(){return typeof document>"u"?[]:Array.from(document.body.classList).filter(n=>n.startsWith("role-")||["administrator","editor","author","contributor","subscriber"].includes(n)).map(n=>n.replace("role-",""))}function Je(e){const t=e.filterKey;switch(t){case"user:logged_in":return we();case"user:logged_out":return!we();case"user:role":{if(!we())return!1;const n=Ge(),s=e.value||"";switch(e.operator){case"equals":return n.includes(s);case"not_equals":return!n.includes(s);default:return n.includes(s)}}default:return console.warn(`Unknown visibility rule type: ${t}`),!0}}function Qe(e){return!e||e.length===0?!0:e.every(t=>Je(t))}function Ye(e){const{rowVisibility:t="show",visibilityRules:n=[]}=e;if(!n||n.length===0)return!0;const s=Qe(n);return t==="hide"?!s:s}function Xe({config:e,filterData:t,value:n,onChange:s,blockId:d}){const y=d?`voxel-popup-${d}`:"",r=G(null),a=G(null),[N,h]=q(!1),[m,L]=q(""),[E,I]=q(""),v=typeof n=="string"?n:"",D=t.props?.placeholder||t.label||"Type keywords...",F=e.displayAs||t.props?.display_as||"popup",_=t.icon||"";Y(()=>{I(v)},[v]),Y(()=>{N&&(L(v),setTimeout(()=>{a.current?.focus()},50))},[N,v]);const k=K=>{I(K.target.value)},W=b(()=>{const K=E.trim();s(K.length>0?K:"")},[E,s]),T=b(K=>{K.key==="Enter"&&(K.preventDefault(),W())},[W]),w=K=>{L(K.target.value)},u=b(()=>{h(!0)},[]),f=b(()=>{const K=m.trim();s(K.length>0?K:""),h(!1)},[m,s]),p=b(()=>{L(""),s("")},[s]),g=b(K=>{K.key==="Enter"&&(K.preventDefault(),f())},[f]);if(F==="inline"){const{style:K,className:P}=ee(e,"ts-form-group ts-inline-filter");return React.createElement("div",{className:P,style:K},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:"ts-input-icon flexify"},_&&React.createElement("span",{dangerouslySetInnerHTML:{__html:_}}),React.createElement("input",{type:"text",value:E,onChange:k,onBlur:W,onKeyDown:T,placeholder:D,className:"inline-input"})))}const c=v.trim().length>0,{style:C,className:J}=ee(e,"ts-form-group"),$=de(e);return React.createElement("div",{className:J,style:C},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:r,className:`ts-filter ts-popup-target ${c?"ts-filled":""}`,onClick:u,onMouseDown:K=>K.preventDefault(),role:"button",tabIndex:0},_&&React.createElement("span",{dangerouslySetInnerHTML:{__html:_}}),React.createElement("div",{className:"ts-filter-text"},c?v:D)),React.createElement(ie,{isOpen:N,target:r,title:"",icon:_,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:f,onClear:p,onClose:()=>h(!1),className:`${y}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:$.style},React.createElement("div",{className:"ts-input-icon ts-sticky-top flexify"},React.createElement("span",null,oe.search),React.createElement("input",{ref:a,type:"text",value:m,onChange:w,onKeyDown:g,placeholder:D,className:"autofocus border-none"}))))}const Ze=()=>window.noUiSlider;function Fe(e){if(e==null||e==="")return[];if(Array.isArray(e))return e.map(Number).filter(s=>!isNaN(s));if(typeof e=="string"&&e.includes("..")){const n=e.split(".."),s=[];if(n[0]!==""){const d=Number(n[0]);isNaN(d)||s.push(d)}if(n[1]!==""){const d=Number(n[1]);isNaN(d)||s.push(d)}return s}const t=Number(e);return isNaN(t)?[]:[t]}function et({config:e,filterData:t,value:n,onChange:s,blockId:d,narrowedValues:y,isNarrowing:r}){const a=[d?`voxel-popup-${d}`:"",e.id?`elementor-repeater-item-${e.id}`:""].filter(Boolean).join(" "),N=G(null),h=G(null),m=G(null),[L,E]=q(!1),I=t.props||{},v=I.range_start??I.min??0,D=I.range_end??I.max??100,F=I.step_size??I.step??1,_=I.placeholder||t.label||"Range",k=e.displayAs||t.props?.display_as||"popup",W=I.handles||"single",T=I.compare||"in_range",w=e.filterKey,u=y?.ranges?.[w],f=u?.min??v,p=u?.max??D,g=typeof I.format=="object"?I.format:{numeric:!1,prefix:"",suffix:""},c=g.prefix||"",C=g.suffix||"",J=t.icon||"",$=W==="single"?[T==="in_range"?p:f]:T==="in_range"?[f,p]:[f,f],K=Fe(n),P=K.length>0?K:$,[z,te]=q(P),X=b(x=>{const j=g.numeric?x.toLocaleString():String(x);return`${c}${j}${C}`},[g.numeric,c,C]),re=b(x=>x.map(j=>X(j)).join(" — "),[X]),se=n!=null&&n!=="",H=se?re(K.length>0?K:z):_,o=re(z),M=b(()=>{if(!h.current||m.current)return;let x,j;W==="single"?(j=T==="in_range"?[1,0]:[0,1],x=[...z]):(j=T==="in_range"?[0,1,0]:[1,0,1],x=[...z]);const V=Ze();if(!V){console.error("noUiSlider not loaded - window.noUiSlider is undefined");return}V.create(h.current,{start:x,connect:j,range:{min:f,max:p},step:F,behaviour:"tap-drag"}),m.current=h.current.noUiSlider,m.current.on("update",Z=>{te(Z.map(O=>Number(O)))}),requestAnimationFrame(()=>{m.current&&m.current.set(x,!1)})},[W,T,z,f,p,F]),A=b(()=>{m.current&&(m.current.destroy(),m.current=null)},[]);Y(()=>{const x=Fe(n),j=x.length>0?x:$;te(j),m.current&&(m.current.set(j,!1),requestAnimationFrame(()=>{m.current&&m.current.set(j,!1)}))},[n,f,p,W,T]),Y(()=>{if(L&&k==="popup"){const x=setTimeout(()=>{M()},100);return()=>clearTimeout(x)}return()=>{k==="popup"&&A()}},[L,k,M,A]),Y(()=>{if(k==="inline")return M(),()=>A()},[k,M,A]),Y(()=>{if(!m.current||!u)return;const x=z.map(j=>j<f?f:j>p?p:j);m.current.updateOptions({range:{min:f,max:p},start:x}),te(x)},[u,f,p,W]);const ne=b(()=>{E(!0)},[]),ae=b(x=>!x.length||x.some(j=>typeof j!="number")?!1:x.join("..")!==$.join(".."),[$]),le=b(x=>ae(x)?x.join(".."):null,[ae]),pe=x=>{const V=[x.target.value===""?f:Number(x.target.value),z[1]??p];te(V),m.current&&m.current.set(V),k==="minmax"&&s(le(V))},me=x=>{const j=x.target.value===""?p:Number(x.target.value),V=[z[0]??f,j];te(V),m.current&&m.current.set(V),k==="minmax"&&s(le(V))},B=b(()=>{s(le(z)),E(!1)},[z,le,s]),l=b(()=>{te($),m.current&&m.current.set($),s(null)},[$,s]),R=()=>React.createElement("div",{className:"ts-minmax"},React.createElement("input",{type:"number",className:"inline-input input-no-icon",placeholder:String(f),value:z[0]??f,onChange:pe,min:f,max:typeof z[1]=="number"?z[1]:p,step:F}),React.createElement("input",{type:"number",className:"inline-input input-no-icon",placeholder:String(p),value:z[1]??p,onChange:me,min:typeof z[0]=="number"?z[0]:f,max:p,step:F})),i=()=>React.createElement("div",{className:`range-slider-wrapper${r?" ts-loading":""}`},React.createElement("div",{className:"range-value"},o),React.createElement("div",{ref:h,className:"range-slider"}),u&&(u.min!==v||u.max!==D)&&React.createElement("div",{className:"range-narrowed-indicator"},React.createElement("small",null,"Showing ",X(f)," — ",X(p)," based on current results")));if(k==="minmax"&&W==="double"){const{style:x,className:j}=ee(e,"ts-form-group");return React.createElement("div",{className:j,style:x},!e.hideLabel&&React.createElement("label",null,t.label),R())}if(k==="inline"){const{style:x,className:j}=ee(e,"ts-form-group ts-inline-filter");return React.createElement("div",{className:j,style:x},!e.hideLabel&&React.createElement("label",null,t.label),i())}const{style:S,className:U}=ee(e,"ts-form-group"),Q=de(e);return React.createElement("div",{className:U,style:S},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:N,className:`ts-filter ts-popup-target ${se?"ts-filled":""}`,onClick:ne,onMouseDown:x=>x.preventDefault(),role:"button",tabIndex:0},J&&React.createElement("span",{dangerouslySetInnerHTML:{__html:J}}),React.createElement("div",{className:"ts-filter-text"},H),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ie,{isOpen:L,target:N,title:"",icon:J,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:B,onClear:l,onClose:()=>E(!1),className:`${a}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:Q.style},React.createElement("div",{className:"ts-form-group"},React.createElement("label",null,t.label,t.description&&React.createElement("small",null,t.description)),i())))}function tt(e,t){let n=null;return function(...s){n&&clearTimeout(n),n=setTimeout(()=>e.apply(this,s),t)}}function nt({config:e,filterData:t,value:n,onChange:s,blockId:d}){const y=d?`voxel-popup-${d}`:"",r=t.props||{},a=typeof r.range_start=="number"?r.range_start:0,N=typeof r.range_end=="number"?r.range_end:1e3,h=typeof r.step_size=="number"?r.step_size:1,m=typeof r.precision=="number"?r.precision:0,L=r.placeholder||t.label||"Any",E=e.displayAs||r.display_as||"popup",I=t.icon||"",v=G(null),D=G(null),[F,_]=q(!1),[k,W]=q(typeof n=="number"?n:""),T=b(H=>{if(H===""||typeof H!="number"||isNaN(H))return"";let o=H;return o<a&&(o=a),o>N&&(o=N),Number(o.toFixed(m))},[a,N,m]),w=b(H=>typeof H=="number",[]),u=b(H=>{const o=T(H);w(o)?s(o):s("")},[T,w,s]),f=ce(()=>tt(H=>u(H),300),[u]);Y(()=>{W(typeof n=="number"?n:"")},[n]),Y(()=>{F&&W(typeof n=="number"?n:"")},[F,n]);const p=H=>{H.preventDefault();let o;typeof k!="number"?o=a:(o=T(k+h),typeof o!="number"&&(o=a)),W(o),E==="inline"&&f(o)},g=H=>{H.preventDefault();let o;typeof k!="number"?o=a:(o=T(k-h),typeof o!="number"&&(o=a)),W(o),E==="inline"&&f(o)},c=H=>{const o=H.target.value;if(o===""){W(""),E==="inline"&&f("");return}const M=parseFloat(o);if(!isNaN(M)){const A=T(M);W(A),E==="inline"&&f(A)}},C=b(()=>{u(k)},[k,u]),J=b(()=>{_(!0)},[]),$=b(()=>{u(k),_(!1)},[k,u]),K=b(()=>{W(""),s(""),D.current?.focus()},[s]),P=typeof n=="number"?n:null,z=H=>React.createElement("div",{className:"ts-stepper-input flexify"},React.createElement("button",{type:"button",className:`ts-stepper-left ts-icon-btn${H?" inline-btn-ts":""}`,onClick:g},React.createElement("i",{className:"las la-minus"})),React.createElement("input",{ref:D,type:"number",className:"ts-input-box",min:a,max:N,step:h,value:k,onChange:c,onBlur:H?C:void 0,placeholder:L}),React.createElement("button",{type:"button",className:`ts-stepper-right ts-icon-btn${H?" inline-btn-ts":""}`,onClick:p},React.createElement("i",{className:"las la-plus"})));if(E==="inline"){const{style:H,className:o}=ee(e,"ts-form-group ts-inline-filter");return React.createElement("div",{className:o,style:H},!e.hideLabel&&React.createElement("label",null,t.label),z(!0))}const te=typeof n=="number",{style:X,className:re}=ee(e,"ts-form-group"),se=de(e);return React.createElement("div",{className:re,style:X},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:v,className:`ts-filter ts-popup-target ${te?"ts-filled":""}`,onClick:J,onMouseDown:H=>H.preventDefault(),role:"button",tabIndex:0},I&&React.createElement("span",{dangerouslySetInnerHTML:{__html:I}}),React.createElement("div",{className:"ts-filter-text"},P!==null?P:L),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ie,{isOpen:F,target:v,title:"",icon:I,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:$,onClear:K,onClose:()=>_(!1),className:`${y}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:se.style},React.createElement("div",{className:"ts-form-group"},React.createElement("label",null,t.label,t.description&&React.createElement("small",null,t.description)),z(!1))))}function st(e){return e==null||e===""?[]:typeof e=="string"?e.split(",").map(t=>t.trim()).filter(t=>t!==""):Array.isArray(e)?e.length>0&&typeof e[0]=="string"?e:e.length>0&&typeof e[0]=="number"?e.map(String):[]:[]}function Se(e){return e.length===0?null:e.join(",")}function lt({config:e,filterData:t,value:n,onChange:s,blockId:d,narrowedValues:y,isNarrowing:r}){const a=d?`voxel-popup-${d}`:"",N=G(null),h=G(null),[m,L]=q(!1),[E,I]=q(""),v=t.props||{},D=v.multiple??!0,F=v.taxonomy_label??"",_=v.placeholder||t.label||F||"Select",k=e.displayAs||v.display_as||"popup",W=e.hideEmptyTerms??v.hide_empty_terms??!1,T=v.per_page??20,[w,u]=q(1),f=t.icon||"",p=v.taxonomy||e.filterKey,g=y?.terms?.[p],c=b(l=>{const R=(i,S,U)=>{const Q={...i,parentRef:S||void 0,hasSelection:!1,depth:U};return i.children&&i.children.length>0&&(Q.children=i.children.map(x=>R(x,Q,U+1))),Q};return l.map(i=>R(i,null,0))},[]),C=ce(()=>{const l=v.terms||[];return c(l)},[v,c]),J=ce(()=>{const l=new Map,R=i=>{l.set(i.slug,i),i.children&&i.children.forEach(S=>R(S))};return C.forEach(i=>R(i)),l},[C]),$=ce(()=>{const l=[],R=i=>{i.forEach(S=>{W&&g&&S.term_taxonomy_id&&g[S.term_taxonomy_id]===0||(l.push(S),S.children&&S.children.length>0&&R(S.children))})};return R(C),l},[C,W,g]),K=b(l=>!g||!l.term_taxonomy_id?null:g[l.term_taxonomy_id]??null,[g]),P=ce(()=>st(n),[n]),z=b(l=>l.slug?P.includes(l.slug):!1,[P]),te=ce(()=>$.filter(l=>l.slug&&P.includes(l.slug)),[$,P]),X=ce(()=>{const l=T*w;return $.slice(0,l)},[$,T,w]),re=$.length>T*w,se=ce(()=>{if(!E)return X;const l=E.toLowerCase();return $.filter(R=>R.label.toLowerCase().includes(l))},[$,X,E]);Y(()=>{m&&(I(""),$.length>=15&&setTimeout(()=>h.current?.focus(),50))},[m,$.length]);const H=b(()=>{L(!0)},[]),o=b(l=>{const R=l.slug;if(R)if(D){let i=[...P];if(i.includes(R)){i=i.filter(U=>U!==R);let S=l.parentRef;for(;S;)S.children?.some(Q=>i.includes(Q.slug)||Q.hasSelection)||(S.hasSelection=!1),S=S.parentRef;s(Se(i))}else{i.push(R);let S=l.parentRef;for(;S;)i=i.filter(Q=>Q!==S.slug),S.hasSelection=!0,S=S.parentRef;const U=new Set;i.forEach(Q=>{const x=J.get(Q);if(!x)return;let j=x.parentRef;const V=[];let Z=!1;for(;j;){if(j.slug===R){Z=!0;break}V.push(j),j=j.parentRef}Z&&(U.add(x.slug),V.forEach(O=>{O.hasSelection=!1}))}),i=i.filter(Q=>!U.has(Q)),s(Se(i))}}else s(Se([R])),k!=="inline"&&L(!1)},[D,P,s,J,k]),M=b(()=>{L(!1)},[]),A=b(()=>{s(null)},[s]),ne=P.length>0,ae=ne&&te[0]?.label||_,le=te.length>1?te.length-1:0;if(k==="inline"){const{style:l,className:R}=ee(e,"ts-form-group inline-terms-wrapper ts-inline-filter min-scroll");return React.createElement("div",{className:`${R}${r?" ts-loading":""}`,style:l},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:"ts-term-dropdown ts-multilevel-dropdown inline-multilevel"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},X.map(i=>{const S=z(i),U=K(i),Q=U===0;return React.createElement("li",{key:i.slug,className:`${S?"ts-selected":""}${Q?" ts-disabled":""}`},React.createElement("a",{href:"#",className:"flexify",onClick:x=>{x.preventDefault(),Q||o(i)}},React.createElement("div",{className:"ts-checkbox-container"},React.createElement("label",{className:`container-${D?"checkbox":"radio"}`},React.createElement("input",{type:D?"checkbox":"radio",checked:S,readOnly:!0,disabled:!0,hidden:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,i.depth>0?"— ".repeat(i.depth):"",i.label),U!==null&&React.createElement("span",{className:"ts-term-count"},"(",U,")"),i.icon&&React.createElement("div",{className:"ts-term-icon",dangerouslySetInnerHTML:{__html:i.icon}})))}),re&&React.createElement("li",{className:"ts-term-centered"},React.createElement("a",{href:"#",onClick:i=>{i.preventDefault(),u(S=>S+1)},className:"flexify"},React.createElement("div",{className:"ts-term-icon"},oe.reload||React.createElement("span",null,"↻")),React.createElement("span",null,"Load more"))))))}if(k==="buttons"){const{style:l,className:R}=ee(e,"ts-form-group");return React.createElement("div",{className:R,style:l},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("ul",{className:"simplify-ul addon-buttons flexify"},$.map(i=>{const S=z(i);return React.createElement("li",{key:i.slug,className:`flexify ${S?"adb-selected":""}`,onClick:()=>o(i)},i.label)})))}const{style:pe,className:me}=ee(e,"ts-form-group"),B=de(e);return React.createElement("div",{className:me,style:pe},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:N,className:`ts-filter ts-popup-target ${ne?"ts-filled":""}`,onClick:H,onMouseDown:l=>l.preventDefault(),role:"button",tabIndex:0},f&&React.createElement("span",{dangerouslySetInnerHTML:{__html:f}}),React.createElement("div",{className:"ts-filter-text"},ae,le>0&&React.createElement("span",{className:"term-count"},"+",le)),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ie,{isOpen:m,target:N,title:"",icon:f,saveLabel:"Save",clearLabel:"Clear",showClear:!0,showSave:D,onSave:M,onClear:A,onClose:()=>L(!1),className:`${a}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:B.style},$.length>=15&&React.createElement("div",{className:"ts-sticky-top uib b-bottom"},React.createElement("div",{className:"ts-input-icon flexify"},React.createElement("span",null,oe.search),React.createElement("input",{ref:h,type:"text",value:E,onChange:l=>I(l.target.value),placeholder:"Search",className:"autofocus"}))),React.createElement("div",{className:`ts-term-dropdown ts-multilevel-dropdown ts-md-group${r?" ts-loading":""}`},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},se.map(l=>{const R=z(l),i=K(l),S=i===0;return React.createElement("li",{key:l.slug,className:`${R?"ts-selected":""}${S?" ts-disabled":""}`},React.createElement("a",{href:"#",className:"flexify",onClick:U=>{U.preventDefault(),S||o(l)}},React.createElement("div",{className:"ts-checkbox-container"},React.createElement("label",{className:`container-${D?"checkbox":"radio"}`},React.createElement("input",{type:D?"checkbox":"radio",checked:R,readOnly:!0,disabled:!0,hidden:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,l.depth>0?"— ".repeat(l.depth):"",l.label),i!==null&&React.createElement("span",{className:"ts-term-count"},"(",i,")"),l.icon&&React.createElement("div",{className:"ts-term-icon",dangerouslySetInnerHTML:{__html:l.icon}})))}),!E&&re&&React.createElement("li",{className:"ts-term-centered"},React.createElement("a",{href:"#",onClick:l=>{l.preventDefault(),u(R=>R+1)},className:"flexify"},React.createElement("div",{className:"ts-term-icon"},oe.reload||React.createElement("span",null,"↻")),React.createElement("span",null,"Load more")))),se.length===0&&React.createElement("div",{className:"ts-empty-user-tab"},f&&React.createElement("span",{dangerouslySetInnerHTML:{__html:f}}),React.createElement("p",null,"No results found")))))}const rt=()=>window.noUiSlider;function ye(e){return!e||!e.address?null:e.method==="radius"&&e.lat!==void 0&&e.lng!==void 0?`${e.address};${e.lat},${e.lng},${e.radius||10}`:e.swlat!==void 0&&e.swlng!==void 0&&e.nelat!==void 0&&e.nelng!==void 0?`${e.address};${e.swlat},${e.swlng}..${e.nelat},${e.nelng}`:e.lat!==void 0&&e.lng!==void 0?`${e.address};${e.lat},${e.lng},${e.radius||10}`:e.address}function at(e,t){if(e==null||e==="")return null;if(typeof e=="string"){const n=e.indexOf(";");if(n===-1)return{address:e};const s=e.substring(0,n),d=e.substring(n+1);if(d.includes("..")){const r=d.split(".."),a=r[0].split(","),N=r[1].split(",");return{address:s,method:"area",swlat:Number(a[0]),swlng:Number(a[1]),nelat:Number(N[0]),nelng:Number(N[1])}}const y=d.split(",");return{address:s,method:"radius",lat:Number(y[0]),lng:Number(y[1]),radius:y[2]?Number(y[2]):t}}return typeof e=="object"?e:null}function ct({config:e,filterData:t,value:n,onChange:s,blockId:d}){const y=d?`voxel-popup-${d}`:"",r=G(null),a=G(null),N=G(null),h=G(null),m=G(null),[L,E]=q(!1),[I,v]=q(!1),D=G(null),F=t.props||{},_=F.radius||{},k=_.default??10,W=_.min??0,T=_.max??100,w=_.step??1,u=_.units||"km",f=F.display_proximity_as||"popup",p=F.placeholder||t.label||"Location",g=F.default_search_method||"area";(F.l10n||{}).visibleArea;const C=e.displayAs||t.props?.display_as||"popup",J=t.icon||"",$=at(n,k)||{},[K,P]=q($.address||""),[z,te]=q($.radius||k),X=b(O=>Math.round(O*1e6)/1e6,[]),re=b(O=>`${O}${u==="mi"?"mi":"km"}`,[u]),se=b(()=>{if(!h.current||m.current)return;const O=rt();if(!O){console.error("noUiSlider not loaded - window.noUiSlider is undefined");return}O.create(h.current,{start:z,connect:[!0,!1],step:w,range:{min:W,max:T},behaviour:"tap-drag"}),m.current=h.current.noUiSlider,m.current.on("update",ue=>{te(Math.round(Number(ue[0])))}),m.current.on("change",ue=>{const fe=Math.round(Number(ue[0]));f==="inline"&&$.lat&&s(ye({...$,radius:fe}))})},[z,w,W,T,f,$,s]),H=b(()=>{m.current&&(m.current.destroy(),m.current=null)},[]);Y(()=>{if(f==="inline"&&$.lat){const O=setTimeout(()=>se(),50);return()=>{clearTimeout(O),H()}}},[f,$.lat,se,H]),Y(()=>{if(I){const O=setTimeout(()=>se(),50);return()=>clearTimeout(O)}return()=>H()},[I,se,H]),Y(()=>{const O=$.radius||k;te(O),m.current&&m.current.set([O])},[$.radius,k]);const o=b(()=>{if(N.current||!a.current||typeof window>"u")return;const O=window.Voxel?.Maps;if(!O){console.warn("Voxel.Maps not available for autocomplete");return}O.await(()=>{if(N.current)return;const ue=e.autocomplete||{};N.current=new O.Autocomplete(a.current,fe=>{if(fe){const Ce=fe.viewport.getSouthWest(),Ve=fe.viewport.getNorthEast(),We={address:fe.address,method:g,swlat:X(Ce.getLatitude()),swlng:X(Ce.getLongitude()),nelat:X(Ve.getLatitude()),nelng:X(Ve.getLongitude()),lat:X(fe.latlng.getLatitude()),lng:X(fe.latlng.getLongitude()),radius:$.radius||k};P(fe.address),s(ye(We)),C==="popup"&&E(!1)}else P(""),s(null)},ue)})},[e.autocomplete,s,C,k,g,$.radius,X]);Y(()=>{(L||C==="inline")&&(P($.address||""),L&&setTimeout(()=>a.current?.focus(),50))},[L,C,$.address]);const M=b(()=>{E(!0)},[]),A=b(()=>{o()},[o]),ne=O=>{P(O.target.value),C==="inline"&&(O.target.value?s(ye({...$,address:O.target.value})):s(null))},ae=O=>{O.preventDefault(),O.stopPropagation(),"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(ue=>{const fe={address:"Current Location",method:"radius",lat:ue.coords.latitude,lng:ue.coords.longitude,radius:k};P("Current Location"),s(ye(fe)),C==="popup"&&E(!1)},ue=>{console.error("Geolocation error:",ue)})},le=b(()=>{s(K?ye({...$,address:K}):null),E(!1)},[K,$,s]),pe=b(()=>{P(""),s(null)},[s]),me=b(O=>{O.key==="Enter"&&(O.preventDefault(),le())},[le]),B=b(()=>{$.lat&&s(ye({...$,radius:z})),v(!1)},[$,z,s]),l=b(()=>{te(k),m.current&&m.current.set([k]),$.lat&&s(ye({...$,radius:k}))},[k,$,s]),R=!!$.address||!!$.lat,i=R?$.address||"Location set":p,S=()=>React.createElement("div",{className:"ts-input-icon flexify",style:{position:"relative"}},J&&React.createElement("span",{dangerouslySetInnerHTML:{__html:J}}),React.createElement("input",{ref:a,type:"text",className:"inline-input",placeholder:p,value:K,onChange:ne,onKeyDown:me,onFocus:A}),React.createElement("a",{href:"#",className:"inline-user-location ts-icon-btn",onClick:ae,title:"Use my location","aria-label":"Use my location"},oe.crosshairs)),U=()=>React.createElement("div",{className:"range-slider-wrapper"},React.createElement("div",{className:"range-value"},re(z)),React.createElement("div",{ref:h,className:"range-slider"})),Q=()=>!$.lat||f==="inline"?null:React.createElement("div",{className:"ts-form-group ts-proximity-filter"},React.createElement("label",null,F.proximity_label||"Radius"),React.createElement("div",{ref:D,className:`ts-filter ts-popup-target ${$.radius?"ts-filled":""}`,onClick:()=>v(!0),onMouseDown:O=>O.preventDefault(),role:"button",tabIndex:0},React.createElement("div",{className:"ts-filter-text"},re($.radius||k)),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ie,{isOpen:I,target:D,title:"",saveLabel:"Save",clearLabel:"Reset",showClear:!0,onSave:B,onClear:l,onClose:()=>v(!1),className:`${y}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:Z.style},React.createElement("div",{className:"ts-form-group"},React.createElement("label",null,F.proximity_label||"Search radius"),U()))),x=()=>f!=="inline"||!$.lat?null:React.createElement("div",{className:"ts-form-group ts-inline-proximity"},React.createElement("label",null,F.proximity_label||"Radius",": ",re(z)),React.createElement("div",{ref:h,className:"range-slider"}));if(C==="inline"){const{style:O,className:ue}=ee(e,"ts-form-group ts-inline-filter");return React.createElement(React.Fragment,null,React.createElement("div",{className:ue,style:O},!e.hideLabel&&React.createElement("label",null,t.label),S()),x(),Q())}const{style:j,className:V}=ee(e,"ts-form-group"),Z=de(e);return React.createElement(React.Fragment,null,React.createElement("div",{className:V,style:j},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:r,className:`ts-filter ts-popup-target ${R?"ts-filled":""}`,onClick:M,onMouseDown:O=>O.preventDefault(),role:"button",tabIndex:0},J&&React.createElement("span",{dangerouslySetInnerHTML:{__html:J}}),React.createElement("div",{className:"ts-filter-text"},i),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ie,{isOpen:L,target:r,title:"",icon:J,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:le,onClear:pe,onClose:()=>E(!1),className:`${y}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:Z.style},React.createElement("div",{className:"ts-form-group"},S()))),x(),Q())}function ot(e){if(e==null||e==="")return{date:"",slots:1};if(typeof e=="string")return{date:e,slots:1};if(typeof e=="object"){const t=e;return{date:t.date||"",slots:t.slots||1}}return{date:"",slots:1}}const ve=e=>{if(!e)return null;try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t:null}catch{return null}},Re=e=>{if(!e)return null;const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${s}`},Ee=e=>{if(!e)return"";try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):""}catch{return e}};function it({config:e,filterData:t,value:n,onChange:s,blockId:d}){const y=[d?`voxel-popup-${d}`:"",e.id?`elementor-repeater-item-${e.id}`:""].filter(Boolean).join(" "),r=G(null),a=G(null),[N,h]=q(!1),m=G(null),L=G(null),E=t.props||{},v=(E.inputMode||"date-range")==="date-range",D=E.l10n||{},F=D.pickDate||t.label||"Choose date",_=E.presets||[],k=t.icon||"",W=ot(n),T=W.date,w=W.slots;let u="",f="";v&&T&&T.includes("..")?[u,f]=T.split(".."):!v&&T&&(u=T);const[p,g]=q(()=>ve(u)),[c,C]=q(()=>ve(f)),[J,$]=q("start"),[K,P]=q(w);m.current=p,L.current=c;const z=b(B=>{const l=m.current,R=L.current,i=a.current;if(!l||R||!i)return;const S=B.target,U=S.tagName==="TD"?S:S.closest("td");if(!U||U.classList.contains("is-empty")||U.classList.contains("is-disabled"))return;const Q=U.querySelector(".pika-button");if(!Q||Q.disabled)return;U.classList.add("is-endrange");const x=new Date(parseInt(Q.getAttribute("data-pika-year")||"0"),parseInt(Q.getAttribute("data-pika-month")||"0"),parseInt(Q.getAttribute("data-pika-day")||"0")),j=864e5,V=new Date(x.getTime()-j);for(;V>l;){const Z=`.pika-button[data-pika-year="${V.getFullYear()}"][data-pika-month="${V.getMonth()}"][data-pika-day="${V.getDate()}"]`;i.el.querySelector(Z)?.parentElement?.classList.add("is-inrange"),V.setTime(V.getTime()-j)}U.addEventListener("mouseleave",()=>{i.el.querySelectorAll("td.is-inrange:not(.is-disabled)").forEach(O=>O.classList.remove("is-inrange")),U.classList.remove("is-endrange")},{once:!0})},[]);Y(()=>{if(N){if(v&&T&&T.includes("..")){const[B,l]=T.split("..");g(ve(B)),C(ve(l))}else!v&&T&&g(ve(T));P(w),$("start")}},[N,v,T,w]);const te=b(()=>{h(!0)},[]),X=b(B=>{if(v&&B&&a.current)if(J==="start")g(B),C(null),$("end"),a.current.setStartRange(B),a.current.setEndRange(null),a.current.draw();else if(p&&B<p)g(B),C(null),a.current.setStartRange(B),a.current.setEndRange(null),a.current.draw();else{C(B),$("start"),a.current.setEndRange(B),a.current.draw();const l=Re(p),R=Re(B);l&&R&&(s(`${l}..${R}`),h(!1))}else g(B)},[v,J,p,s]);b(B=>{P(Number(B.target.value)||1)},[]);const re=b(B=>{if(v){const l=Re(p),R=Re(c);l&&R&&s(`${l}..${R}`)}else{const R=Re(B!==void 0?B:p);R&&s(R)}h(!1)},[v,p,c,s]),se=b(()=>{g(null),C(null),P(1),s(null),a.current&&(a.current.setStartRange(null),a.current.setEndRange(null))},[s]),H=b(B=>{s(B)},[s]),o=b(()=>typeof n=="string"&&n.includes(".."),[n]),M=v?!!(u&&f):!!T,A=v?o():!!n,ne=b(B=>n===B,[n]),ae=ce(()=>{if(v&&_.length>0){if(o()){const B=Ee(u),l=Ee(f);return`${B} - ${l}`}return F}if(!M)return F;if(v){const B=Ee(u),l=Ee(f),R=`${B} — ${l}`;return w>1?`${R} (${w})`:R}else{const B=Ee(T);return w>1?`${B} (${w})`:B}},[v,_.length,o,M,u,f,T,w,F]),{style:le,className:pe}=ee(e,"ts-form-group"),me=de(e);return React.createElement(React.Fragment,null,v&&_.map(B=>React.createElement("div",{key:B.key,className:pe,style:le},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter ${ne(B.key)?"ts-filled":""}`,onClick:()=>H(B.key),role:"button",tabIndex:0},React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,B.label))))),React.createElement("div",{className:pe,style:le},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:r,className:`ts-filter ts-popup-target ${A?"ts-filled":""}`,onClick:te,onMouseDown:B=>B.preventDefault(),role:"button",tabIndex:0},k&&React.createElement("span",{dangerouslySetInnerHTML:{__html:k}}),React.createElement("div",{className:"ts-filter-text"},ae),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ie,{isOpen:N,target:r,title:"",icon:k,saveLabel:D.save||"Save",clearLabel:D.clear||"Clear",showSave:v,onSave:re,onClear:se,onClose:()=>h(!1),className:`${y}${v?" ts-availability-wrapper xl-height xl-width":" md-width xl-height"}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:me.style},v&&React.createElement("div",{className:"ts-popup-head flexify"},React.createElement("div",{className:"ts-popup-name flexify"},k&&React.createElement("span",{dangerouslySetInnerHTML:{__html:k}}),React.createElement("span",null,React.createElement("span",{className:J==="start"?"chosen":"",onClick:()=>$("start"),style:{cursor:"pointer"}},p?Ee(Re(p)):D.checkIn||"Check-in"),React.createElement("span",null," — "),React.createElement("span",{className:J==="end"?"chosen":"",onClick:()=>$("end"),style:{cursor:"pointer"}},c?Ee(Re(c)):D.checkOut||"Check-out")))),React.createElement(Le,{value:p,onChange:X,...!v&&{onSelect:re},pickerConfig:{minDate:new Date,...v?{numberOfMonths:2,theme:"pika-range",onDraw:B=>B.el.addEventListener("mouseover",z)}:{}},onPickerReady:B=>{a.current=B,v&&p&&(B.setStartRange(p),c&&B.setEndRange(c))}}))))}function ut(e,t){if(e==null||e==="")return{from:"",to:""};if(typeof e=="string"){if(t&&e.includes("..")){const n=e.split("..");return{from:n[0]||"",to:n[1]||""}}return{from:e,to:""}}return{from:"",to:""}}function xe(e,t,n){return!e&&!t?null:n?e&&t?`${e}..${t}`:e?`${e}..`:t?`..${t}`:null:e||null}const he=e=>{if(!e)return null;try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t:null}catch{return null}},be=e=>{if(!e)return null;const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${s}`},ge=e=>{if(!e)return"";try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}):""}catch{return e}},Me=e=>e?e.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}):"";function dt(e){return typeof e=="string"&&e.includes("..")}function De({config:e,filterData:t,value:n,onChange:s,blockId:d}){const y=d?`voxel-popup-${d}`:"",r=G(null),a=t.props||{},N=a.inputMode==="date-range"||a.inputMode===void 0,h=a.l10n||{},m=h.from||"From",L=h.to||"To",E=h.pickDate||"Choose date",I=N?a.presets||[]:[],v=a.displayValue||{start:null,end:null},D=t.icon||"",F=ut(n,N),_=F.from,k=F.to,[W,T]=q(!1),[w,u]=q(!1),[f,p]=q(()=>he(_)),[g,c]=q("start"),[C,J]=q(()=>he(_)),[$,K]=q(()=>he(k)),P=G(null),z=b(()=>{p(he(_)),u(!0)},[_]),te=b((V="start")=>{const Z=he(_),O=he(k);J(Z),K(O),c(V==="end"&&!O?"start":V),u(!0)},[_,k]),X=b(V=>{p(V)},[]),re=b(V=>{T(!0);const O=be(V!==void 0?V:f)||"";s(xe(O,"",!1)),u(!1)},[f,s]),se=b(()=>{T(!0),p(null),s(null)},[s]),H=G(g);H.current=g;const o=G(C);o.current=C;const M=G($);M.current=$;const A=b(V=>{J(V),o.current=V,P.current&&(P.current.setStartRange(V),M.current&&V&&V>M.current&&(K(null),M.current=null,P.current.setEndRange(null)))},[]),ne=b(V=>{K(V),M.current=V,P.current&&P.current.setEndRange(V)},[]),ae=b(()=>{T(!0);let V=be(o.current)||"",Z=be(M.current)||"";V&&!Z&&(Z=V),s(xe(V,Z,!0)),u(!1)},[s]),le=b(()=>{T(!0),A(null),ne(null),c("start"),P.current&&P.current.draw(!0),s(null)},[s,A,ne]),pe=b(V=>{H.current==="start"?(A(V),c("end")):(ne(V),c("start"),setTimeout(()=>{T(!0);const Z=be(o.current)||"";let O=be(V)||"";Z&&!O&&(O=Z),s(xe(Z,O,!0)),u(!1)},0)),P.current&&P.current.draw(!0)},[A,ne,s]),me=b(V=>{P.current=V;const Z=he(_),O=he(k);Z&&V.setStartRange(Z),O&&V.setEndRange(O),V.draw(!0)},[_,k]),B=ce(()=>({numberOfMonths:2,theme:"pika-range",disableDayFn:V=>!!(H.current==="end"&&o.current&&V<o.current),selectDayFn:V=>o.current&&V.toDateString()===o.current.toDateString()||M.current&&V.toDateString()===M.current.toDateString()||void 0}),[]),l=b(V=>{T(!0),s(n===V?null:V)},[n,s]),R=N?dt(n):n!=null&&n!=="",i=ce(()=>{if(!R)return E;if(N){const Z=W?ge(_):v.start||ge(_),O=W?ge(k):v.end||ge(k);return Z&&O?`${Z} - ${O}`:Z||E}return(W?ge(_):v.start||ge(_))||E},[R,N,_,k,E,W,v]),S=C?Me(C):m,U=$?Me($):L,{style:Q,className:x}=ee(e,"ts-form-group"),j=de(e);return React.createElement(React.Fragment,null,I.map(V=>React.createElement("div",{key:V.key,className:x,style:Q},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter${n===V.key?" ts-filled":""}`,onClick:()=>l(V.key),role:"button",tabIndex:0},React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,V.label))))),React.createElement("div",{className:x,style:Q},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:r,className:`ts-filter ts-popup-target${R?" ts-filled":""}`,onClick:N?()=>te("start"):z,onMouseDown:V=>V.preventDefault(),role:"button",tabIndex:0},D&&React.createElement("span",{dangerouslySetInnerHTML:{__html:D}}),React.createElement("div",{className:"ts-filter-text"},i),React.createElement("div",{className:"ts-down-icon"})),!N&&React.createElement(ie,{isOpen:w,target:r,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:re,onClear:se,onClose:()=>u(!1),className:`${y} md-width xl-height${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:j.style},React.createElement(Le,{value:f,onChange:X,onSelect:re})),N&&React.createElement(ie,{isOpen:w,target:r,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:ae,onClear:le,onClose:()=>u(!1),className:`${y} ts-availability-wrapper xl-width xl-height${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:j.style},React.createElement("div",{className:"ts-popup-head flexify"},React.createElement("div",{className:"ts-popup-name flexify"},D&&React.createElement("span",{dangerouslySetInnerHTML:{__html:D}}),React.createElement("span",null,React.createElement("span",{className:g==="start"?"chosen":"",onClick:()=>c("start"),style:{cursor:"pointer"}},S),C&&React.createElement(React.Fragment,null,React.createElement("span",null," — "),React.createElement("span",{className:g==="end"?"chosen":"",onClick:()=>c("end"),style:{cursor:"pointer"}},U))))),React.createElement(Le,{value:null,onChange:()=>{},onSelect:pe,pickerConfig:B,onPickerReady:me}))))}function pt({config:e,filterData:t,value:n,onChange:s}){const d=n!=null&&n!==!1&&n!==""&&n!==0,y=m=>{m.preventDefault(),s(d?null:1)},r=t.props?.placeholder||t.label||"Open now";if(e.openInPopup||t.props?.openInPopup||!1){const{style:m,className:L}=ee(e,"ts-form-group"),E=t.icon||"";return React.createElement("div",{className:L,style:m},React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter ts-popup-target${d?" ts-filled":""}`,onClick:y,role:"button",tabIndex:0},E&&React.createElement("span",{dangerouslySetInnerHTML:{__html:E}}),React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,r))))}const{style:N,className:h}=ee(e,"ts-form-group switcher-label ts-inline-filter");return React.createElement("div",{className:h,style:N},React.createElement("label",{className:"ts-keep-visible"},React.createElement("div",{className:"switch-slider"},React.createElement("div",{className:"onoffswitch"},React.createElement("input",{type:"checkbox",className:"onoffswitch-checkbox",checked:d,onChange:y,tabIndex:0}),React.createElement("label",{className:"onoffswitch-label",onClick:y}))),r))}function Oe(e){return typeof e!="string"||!e?null:e.split("(")[0]}function Ae(e){return Math.round(e*1e5)/1e5}function mt({config:e,filterData:t,value:n,onChange:s,blockId:d,allFilterValues:y,allFiltersData:r,postFeedId:a}){const N=d?`voxel-popup-${d}`:"",h=G(null),[m,L]=q(!1),[E,I]=q(!1),v=t.props||{},D=e.displayAs||t.props?.display_as||"popup",F=v.placeholder||t.label||"Order By",_=ce(()=>{const o=v.choices||{};return Array.isArray(o)?o:Object.entries(o).map(([M,A])=>({key:M,label:A.label||A,placeholder:A.placeholder||A.label||A,icon:A.icon||"",requires_location:A.requires_location||!1,has_location:A.has_location||!1}))},[v.choices]),k=t.icon||"",W=ce(()=>r&&r.find(o=>o.type==="location")||null,[r]),T=ce(()=>{if(!W||!y)return null;const o=y[W.key];return!o||typeof o!="object"?null:o},[W,y]),w=b(o=>{if(T){const{lat:M,lng:A,method:ne,address:ae}=T;if(M&&A){if(ne==="radius"){o(M,A),I(!1);return}o(M,A),I(!1);return}if(ae&&window.Voxel?.Maps?.getGeocoder){window.Voxel.Maps.getGeocoder().geocode(ae,le=>{le?o(le.latlng?.getLatitude?.()||le.lat,le.latlng?.getLongitude?.()||le.lng):u(o),I(!1)});return}}u(o)},[T]),u=b(o=>{if(!navigator.geolocation){I(!1);return}navigator.geolocation.getCurrentPosition(M=>{const A=Ae(M.coords.latitude),ne=Ae(M.coords.longitude);o(A,ne),I(!1)},()=>{const M=window.Voxel_Config;window.Voxel?.alert&&M?.l10n?.positionFail&&window.Voxel.alert(M.l10n.positionFail,"error"),I(!1)})},[]),f=Oe(n),p=_.find(o=>o.key===f)?.requires_location;Y(()=>{if(!p||!T)return;const{lat:o,lng:M,method:A}=T;A==="radius"&&o&&M&&f&&s(`${f}(${o},${M})`)},[T?.lat,T?.lng]);const g=b(()=>{L(!0)},[]),c=b(o=>{o.requires_location?(I(o.key),w((M,A)=>{s(o.key+`(${M},${A})`),L(!1)})):(s(o.key),L(!1))},[s,w]),C=b(o=>{o.requires_location?(I(o.key),w((M,A)=>{s(o.key+`(${M},${A})`)})):s(o.key)},[s,w]),J=b(()=>{s(null)},[s]),$=typeof n=="string"?n:"",K=!!$,P=Oe($),z=_.find(o=>o.key===P),te=z?.label||F;Y(()=>{z?.requires_location&&!z?.has_location&&P&&(D==="buttons"?c(z):C(z))},[]);const X=o=>React.createElement("div",{className:"ts-term-dropdown ts-md-group"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list min-scroll"},_.map(M=>{const A=P===M.key,ne=E===M.key;return React.createElement("li",{key:M.key,className:A?"ts-selected":""},React.createElement("a",{href:"#",className:`flexify${ne?" vx-pending":""}`,onClick:ae=>{ae.preventDefault(),o(M)}},React.createElement("div",{className:"ts-radio-container"},React.createElement("label",{className:"container-radio"},React.createElement("input",{type:"radio",value:M.key,checked:A,readOnly:!0,disabled:!0,hidden:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,M.label),M.icon&&React.createElement("div",{className:"ts-term-icon"},React.createElement("span",{dangerouslySetInnerHTML:{__html:M.icon}}))))})));if(D==="buttons"){const{style:o,className:M}=ee(e,"ts-form-group");return React.createElement("div",{className:M,style:o},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("ul",{className:"simplify-ul addon-buttons flexify"},_.map(A=>{const ne=P===A.key,ae=E===A.key;return React.createElement("li",{key:A.key,className:`flexify${ne?" adb-selected":""}${ae?" vx-pending":""}`,onClick:()=>C(A)},A.placeholder||A.label)})))}if(D==="alt-btn")return React.createElement(React.Fragment,null,_.map(o=>{const M=P===o.key,A=E===o.key,{style:ne,className:ae}=ee(e,"ts-form-group");return React.createElement("div",{key:o.key,className:ae,style:ne},!e.hideLabel&&React.createElement("label",null,o.label),React.createElement("div",{className:`ts-filter${M?" ts-filled":""}${A?" vx-pending":""}`,onClick:()=>C(o)},o.icon&&React.createElement("span",{dangerouslySetInnerHTML:{__html:o.icon}}),React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,o.placeholder||o.label))))}));if(D==="post-feed"&&a){const o=`[data-block-id="${a}"] .post-feed-header, .elementor-element-${a} .post-feed-header`,M=document.querySelector(o);if(M&&!M.querySelector(".vxf-sort"))return Te(React.createElement(ft,{filterData:t,filterIcon:k,placeholder:F,options:_,currentKey:P,hasValue:K,displayValue:te,loading:E,selectDropdownChoice:c,handleClear:J,renderRadioList:X,popupClassName:N,config:e}),M)}const{style:re,className:se}=ee(e,"ts-form-group"),H=de(e);return React.createElement("div",{className:se,style:re},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:h,className:`ts-filter ts-popup-target${K?" ts-filled":""}`,onClick:g,onMouseDown:o=>o.preventDefault(),role:"button",tabIndex:0},k&&React.createElement("span",{dangerouslySetInnerHTML:{__html:k}}),React.createElement("div",{className:"ts-filter-text"},te),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ie,{isOpen:m,target:h,title:"",icon:k,saveLabel:"Save",clearLabel:"Clear",showClear:K,showSave:!1,onSave:()=>L(!1),onClear:J,onClose:()=>L(!1),className:`hide-head ${N}${e.popupCenterPosition?" ts-popup-centered":""}`.trim(),popupStyle:H.style},X(c)))}function ft({filterData:e,filterIcon:t,placeholder:n,options:s,currentKey:d,hasValue:y,displayValue:r,loading:a,selectDropdownChoice:N,handleClear:h,renderRadioList:m,popupClassName:L,config:E}){const I=G(null),[v,D]=q(!1),F=de(E);return React.createElement("div",{className:`vxf-sort ts-popup-target${y?" ts-filled":""}`,ref:I},React.createElement("a",{href:"#",onClick:_=>{_.preventDefault(),D(!v)}},y?r:n,React.createElement("div",{className:"ts-down-icon"})),React.createElement(ie,{isOpen:v,target:I,title:"",icon:t,saveLabel:"Save",clearLabel:"Clear",showClear:y,showSave:!1,onSave:()=>D(!1),onClear:()=>{h(),D(!1)},onClose:()=>D(!1),className:`hide-d ${L}${E.popupCenterPosition?" ts-popup-centered":""}`.trim(),popupStyle:F.style},m(_=>{N(_),D(!1)})))}function ht({config:e,filterData:t,value:n,onChange:s,blockId:d}){const y=d?`voxel-popup-${d}`:"",[r,a]=q(!1),N=G(null),h=t.props||{},m=e.displayAs||t.props?.display_as||"popup",L=h.placeholder||t.label||"Status",E=ce(()=>{const g=h.choices||{};return Array.isArray(g)?g:Object.entries(g).map(([c,C])=>({key:c,label:C.label||C}))},[h.choices]),I=t.icon||"",v=b(g=>{s(g),a(!1)},[s]),D=b(()=>{s(""),a(!1)},[s]),F=b(()=>{a(!0)},[]),_=typeof n=="string"?n:"",k=!!_,W=E.find(g=>g.key===_),T=k&&W?.label||L,w=()=>React.createElement("div",{className:"ts-term-dropdown ts-md-group"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list min-scroll"},E.map(g=>{const c=_===g.key;return React.createElement("li",{key:g.key},React.createElement("a",{href:"#",className:"flexify",onClick:C=>{C.preventDefault(),v(g.key)}},React.createElement("div",{className:"ts-radio-container"},React.createElement("label",{className:"container-radio"},React.createElement("input",{type:"radio",value:g.key,checked:c,readOnly:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,g.label),I&&React.createElement("div",{className:"ts-term-icon"},React.createElement("span",{dangerouslySetInnerHTML:{__html:I}}))))})));if(m==="buttons")return React.createElement(React.Fragment,null,E.map(g=>{const c=_===g.key,{style:C,className:J}=ee(e,"ts-form-group");return React.createElement("div",{key:g.key,className:J,style:C},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter${c?" ts-filled":""}`,onClick:()=>s(g.key)},I&&React.createElement("span",{dangerouslySetInnerHTML:{__html:I}}),React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,g.label))))}));const{style:u,className:f}=ee(e,"ts-form-group"),p=de(e);return React.createElement("div",{className:f,style:u},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:N,className:`ts-filter ts-popup-target ${k?"ts-filled":""}`,onClick:F,onMouseDown:g=>g.preventDefault(),role:"button",tabIndex:0},I&&React.createElement("span",{dangerouslySetInnerHTML:{__html:I}}),React.createElement("div",{className:"ts-filter-text"},T),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ie,{isOpen:r,target:N,title:"",icon:I,saveLabel:"Save",showSave:!1,showClear:k,onClear:D,onSave:()=>a(!1),onClose:()=>a(!1),className:`hide-head ${y}${e.popupCenterPosition?" ts-popup-centered":""}`.trim(),popupStyle:p.style},w()))}function yt(e){const{userId:t,skip:n=!1}=e,[s,d]=q(null),[y,r]=q(!1),[a,N]=q(null),h=b(async()=>{if(!t||n){d(null);return}r(!0),N(null);try{const m=Be(),L=await fetch(`${m}voxel-fse/v1/search-form/user-data?user_id=${t}`);if(L.ok){const E=await L.json();d({id:E.id,name:E.name,avatar:E.avatar||""})}else d({id:t,name:"Unknown",avatar:""}),N("User not found")}catch(m){console.error("useUserData: Error fetching user data:",m),d({id:t,name:"Unknown",avatar:""}),N(m instanceof Error?m.message:"Failed to fetch user data")}finally{r(!1)}},[t,n]);return Y(()=>{h()},[h]),{userData:s,isLoading:y,error:a,refetch:h}}function Rt({config:e,filterData:t,value:n}){const s=G(null),d=t.props||{},y=t.icon||"",r=d.user;let a;n!==void 0?a=n:t.value!==null&&t.value!==void 0?a=t.value:a=null;const N=a?Number(a):null,h=N!==null&&!isNaN(N)&&N>0,m=!!r?.name,{userData:L,isLoading:E}=yt({userId:h?N:null,skip:m}),I=m?{name:r.name,avatar:r.avatar||""}:L;if(!h)return null;const v=I?.name||(E?"Loading...":"Unknown"),{style:D,className:F}=ee(e,"ts-form-group");return React.createElement("div",{className:F,style:D},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:s,className:`ts-filter ts-popup-target ts-filled${E?" ts-loading":""}`},React.createElement("span",{dangerouslySetInnerHTML:{__html:y}}),React.createElement("div",{className:"ts-filter-text"},v)))}function Et({config:e,filterData:t,value:n,onChange:s,blockId:d}){const y=G(null),r=d?`voxel-popup-${d}`:"",N=(t.props||{}).post,h=t.icon||"";let m=null;n!==void 0?n===null?m=null:typeof n=="number"?m=n:typeof n=="string"&&n!==""&&(m=Number(n)):t.value!==null&&t.value!==void 0&&(m=typeof t.value=="number"?t.value:Number(t.value));const L=m!==null&&!isNaN(m)&&m>0,E=b(()=>{s(null)},[s]);if(!L)return null;const I=N?.title||"Unknown",{style:v,className:D}=ee(e,"ts-form-group"),F=de(e);return React.createElement("div",{className:D,style:v},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:y,className:"ts-filter ts-popup-target ts-filled",role:"button",tabIndex:0},h&&React.createElement("span",{dangerouslySetInnerHTML:{__html:h}}),React.createElement("div",{className:"ts-filter-text"},I),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ie,{isOpen:!1,target:y,showClear:!0,showSave:!1,onSave:()=>{},onClear:E,onClose:()=>{},className:`${r}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:F.style}))}function ke({config:e,filterData:t,value:n,onChange:s}){const[d,y]=q(!1),[r,a]=q(""),[N,h]=q([]),[m,L]=q(!1),E=G(null),I=t.props||{},v=I.placeholder||t.label||"Following",D=I.user,F=t.icon||"",_=c=>{const C=c.target.value;a(C),C.length>=2?(L(!0),setTimeout(()=>{h([]),L(!1)},300)):h([])},k=(c,C)=>{s({id:c,name:C}),y(!1),a("")},W=c=>{c.preventDefault(),y(!d)};Y(()=>{const c=C=>{E.current&&!E.current.contains(C.target)&&y(!1)};return d&&document.addEventListener("mousedown",c),()=>{document.removeEventListener("mousedown",c)}},[d]);let T=null;if(n!==void 0){const c=n;c===null?T=null:typeof c=="number"?T=c:typeof c=="object"&&c?.id&&(T=c.id)}else t.value!==null&&t.value!==void 0&&(T=typeof t.value=="number"?t.value:Number(t.value));const w=T!==null&&!isNaN(T)&&T>0;let u=v;if(w){const c=n;c&&typeof c=="object"&&c.name?u=c.name:D?.name&&(u=D.name)}const{style:f,className:p}=ee(e,"ts-form-group"),g=de(e);return React.createElement("div",{className:p,style:f,ref:E},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter ts-popup-target ${w?"ts-filled":""}`,onClick:W,onMouseDown:c=>c.preventDefault(),role:"button",tabIndex:0},F&&React.createElement("span",{dangerouslySetInnerHTML:{__html:F}}),React.createElement("div",{className:"ts-filter-text"},u),React.createElement("div",{className:"ts-down-icon"})),d&&React.createElement("div",{className:"ts-field-popup-container"},React.createElement("div",{className:g.className,style:g.style},React.createElement("div",{className:"ts-popup-content-wrapper min-scroll"},React.createElement("div",{className:"ts-form-group"},React.createElement("div",{className:"flexify ts-input-icon"},React.createElement("span",null,oe.search),React.createElement("input",{type:"text",className:"inline-input",value:r,onChange:_,placeholder:"Search..."}))),m?React.createElement("div",{className:"ts-loading"},React.createElement("span",{className:"ts-loader"})):N.length>0?React.createElement("div",{className:"ts-term-dropdown"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},N.map(c=>React.createElement("li",{key:c.id},React.createElement("a",{href:"#",className:"flexify",onClick:C=>{C.preventDefault(),k(c.id,c.name)}},React.createElement("span",null,c.name)))))):r.length>=2?React.createElement("div",{className:"ts-empty-user-list"},React.createElement("span",null,"No results found")):null))))}function gt({config:e,filterData:t,value:n,onChange:s}){const[d,y]=q(!1),[r,a]=q(""),[N,h]=q([]),[m,L]=q(!1),E=G(null),I=t.props||{},v=I.placeholder||t.label||"Following Post",D=I.post,F=t.icon||"",_=c=>{const C=c.target.value;a(C),C.length>=2?(L(!0),setTimeout(()=>{h([]),L(!1)},300)):h([])},k=(c,C)=>{s({id:c,title:C}),y(!1),a("")},W=c=>{c.preventDefault(),y(!d)};Y(()=>{const c=C=>{E.current&&!E.current.contains(C.target)&&y(!1)};return d&&document.addEventListener("mousedown",c),()=>{document.removeEventListener("mousedown",c)}},[d]);let T=null;if(n!==void 0){const c=n;c===null?T=null:typeof c=="number"?T=c:typeof c=="object"&&c?.id&&(T=c.id)}else t.value!==null&&t.value!==void 0&&(T=typeof t.value=="number"?t.value:Number(t.value));const w=T!==null&&!isNaN(T)&&T>0;let u=v;if(w){const c=n;c&&typeof c=="object"&&c.title?u=c.title:D?.title&&(u=D.title)}const{style:f,className:p}=ee(e,"ts-form-group"),g=de(e);return React.createElement("div",{className:p,style:f,ref:E},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter ts-popup-target ${w?"ts-filled":""}`,onClick:W,onMouseDown:c=>c.preventDefault(),role:"button",tabIndex:0},F&&React.createElement("span",{dangerouslySetInnerHTML:{__html:F}}),React.createElement("div",{className:"ts-filter-text"},u),React.createElement("div",{className:"ts-down-icon"})),d&&React.createElement("div",{className:"ts-field-popup-container"},React.createElement("div",{className:g.className,style:g.style},React.createElement("div",{className:"ts-popup-content-wrapper min-scroll"},React.createElement("div",{className:"ts-form-group"},React.createElement("div",{className:"flexify ts-input-icon"},React.createElement("span",null,oe.search),React.createElement("input",{type:"text",className:"inline-input",value:r,onChange:_,placeholder:"Search posts..."}))),m?React.createElement("div",{className:"ts-loading"},React.createElement("span",{className:"ts-loader"})):N.length>0?React.createElement("div",{className:"ts-term-dropdown"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},N.map(c=>React.createElement("li",{key:c.id},React.createElement("a",{href:"#",className:"flexify",onClick:C=>{C.preventDefault(),k(c.id,c.title)}},React.createElement("span",null,c.title)))))):r.length>=2?React.createElement("div",{className:"ts-empty-user-list"},React.createElement("span",null,"No posts found")):null))))}function vt({config:e,filterData:t,value:n,onChange:s}){const d=t.props||{},y=d.openInPopup===!0,r=d.placeholder||t.label||"",a=t.icon||"",N=n!=null&&n!==""&&n!==!1,h=E=>{E.preventDefault(),s(N?"":1)};if(y){const{style:E,className:I}=ee(e,"ts-form-group");return React.createElement("div",{className:I,style:E},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter${N?" ts-filled":""}`,onClick:h,onMouseDown:v=>v.preventDefault(),role:"button",tabIndex:0},a&&React.createElement("span",{dangerouslySetInnerHTML:{__html:a}}),React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,r))))}const{style:m,className:L}=ee(e,"ts-form-group switcher-label ts-inline-filter");return React.createElement("div",{className:L,style:m},React.createElement("label",{className:"ts-keep-visible"},React.createElement("div",{className:"switch-slider"},React.createElement("div",{className:"onoffswitch"},React.createElement("input",{type:"checkbox",className:"onoffswitch-checkbox",checked:N,onChange:h,tabIndex:0}),React.createElement("label",{className:"onoffswitch-label",onClick:h}))),r))}function bt({config:e,filterData:t}){const n=t.description||"",{style:s,className:d}=ee(e,"ts-form-group ui-heading");return React.createElement("div",{className:d,style:s},React.createElement("label",null,e.label||t.label,n&&React.createElement("small",null,n)))}function Nt({postTypes:e,currentPostType:t,onChange:n,blockId:s,style:d}){const y=s?`voxel-popup-${s}`:"",[r,a]=q(!1),N=G(null),h=b(F=>{n(F),a(!1)},[n]),m=b(()=>{a(!0)},[]),L=e.find(F=>F.key===t),E=L?.label||"Select type",I=!!t,v=L?.icon||"",D=()=>React.createElement("div",{className:"ts-term-dropdown ts-md-group"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list min-scroll"},e.map(F=>{const _=t===F.key;return React.createElement("li",{key:F.key},React.createElement("a",{href:"#",className:"flexify",onClick:k=>{k.preventDefault(),h(F.key)}},React.createElement("div",{className:"ts-radio-container"},React.createElement("label",{className:"container-radio"},React.createElement("input",{type:"radio",checked:_,disabled:!0,hidden:!0,readOnly:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,F.label),React.createElement("div",{className:"ts-term-icon ts-pull-right"},F.icon&&React.createElement("span",{dangerouslySetInnerHTML:{__html:F.icon}}))))})));return React.createElement("div",{className:"ts-form-group choose-cpt-filter",style:d},React.createElement("label",null,"Post type"),React.createElement("div",{ref:N,className:`ts-filter ts-popup-target ${I?"ts-filled":""}`,onClick:m,onMouseDown:F=>F.preventDefault(),role:"button",tabIndex:0},v&&React.createElement("span",{dangerouslySetInnerHTML:{__html:v}}),React.createElement("div",{className:"ts-filter-text"},E),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ie,{isOpen:r,target:N,title:"",icon:v,saveLabel:"Save",showSave:!1,showClear:!1,onSave:()=>a(!1),onClose:()=>a(!1),className:`hide-head ${y}`.trim()},D()))}const wt={"common:is_empty":(e,t)=>t==null||t==="","common:is_not_empty":(e,t)=>t!=null&&t!=="","text:equals":(e,t)=>t===e.value,"text:not_equals":(e,t)=>t!==e.value,"text:contains":(e,t)=>typeof t!="string"||!e.value?!1:new RegExp(e.value,"i").test(t),"taxonomy:contains":(e,t)=>typeof t!="string"||!e.value?!1:t.split(",").includes(e.value),"taxonomy:not_contains":(e,t)=>typeof t!="string"||!e.value?!0:!t.split(",").includes(e.value),"number:equals":(e,t)=>{const n=parseFloat(String(t)),s=parseFloat(e.value||"0");return n===s},"number:not_equals":(e,t)=>{const n=parseFloat(String(t)),s=parseFloat(e.value||"0");return n!==s},"number:gt":(e,t)=>{const n=parseFloat(String(t)),s=parseFloat(e.value||"0");return n>s},"number:gte":(e,t)=>{const n=parseFloat(String(t)),s=parseFloat(e.value||"0");return n>=s},"number:lt":(e,t)=>{const n=parseFloat(String(t)),s=parseFloat(e.value||"0");return n<s},"number:lte":(e,t)=>{const n=parseFloat(String(t)),s=parseFloat(e.value||"0");return n<=s}};function St(e,t,n){const s=wt[e.type];if(!s)return console.warn(`[filterConditions] Unknown condition type: ${e.type}`),!1;let d=t;return n==="order-by"&&typeof t=="string"&&t.length>0&&(d=t.split("(")[0]),s(e,d)}function xt(e,t="show",n,s){if(!e||e.length===0)return!0;let d=!1;return e.forEach(y=>{if(!y.length)return;let r=!0;y.forEach(a=>{const N=n[a.source],m=s[a.source]?.type;St(a,N,m)||(r=!1)}),r&&(d=!0)}),t==="hide"?!d:d}function kt(e,t,n){return xt(e.conditions,e.conditions_behavior||"show",t,n)}function Tt(){const e=()=>{if(typeof window>"u")return"desktop";const s=window.innerWidth;return s<=767?"mobile":s<=1024?"tablet":"desktop"},[t,n]=q(e);return Y(()=>{const s=()=>{n(e())};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),t}function Ot({attributes:e,postTypes:t,context:n,editorDeviceType:s,onSubmit:d,onPostTypeChange:y,onFilterChange:r}){const a=G(null),N=G(null),{state:h,setCurrentPostType:m,setFilterValue:L,togglePortal:E,submit:I,clearAll:v,narrowedValues:D,narrowingFilters:F}=qe({attributes:e,postTypes:t,context:n,onSubmit:d,onPostTypeChange:y,onFilterChange:r}),_=Ue(l=>{if(n!=="editor")return null;const{isListViewOpened:R,isEditorSidebarOpened:i}=l("core/edit-post");return{leftVisible:R?.()??!1,rightVisible:i?.()??!1}}),k=ce(()=>{if(n!=="editor"||!_||s&&s!=="desktop")return{width:"100%",left:"0",right:"0",zIndex:9999};const l=_.leftVisible?350:0,R=_.rightVisible?280:0;return l===0&&R===0?{}:{width:`calc(100% - ${l+R}px)`,left:`${l}px`,right:`${R}px`,zIndex:9999}},[n,_,s]),[W,T]=q(""),[w,u]=q("");Y(()=>{const l=async()=>{const i=e.searchButtonText??"";if($e(i)){const S=Ie(i),U=await Pe(S);T(U)}else T(i)},R=async()=>{const i=e.resetButtonText??"Reset";if($e(i)){const S=Ie(i),U=await Pe(S);u(U)}else u(i)};l(),R()},[e.searchButtonText,e.resetButtonText]),Y(()=>{if(!h.portalActive)return;const l=R=>{R.key==="Escape"&&E()};return document.addEventListener("keydown",l),()=>document.removeEventListener("keydown",l)},[h.portalActive,E]),Y(()=>{if(!h.portalActive)return;const l=i=>{const S=i.target;a.current?.contains(S)||n==="editor"&&(S.closest(".interface-interface-skeleton__sidebar")||S.closest(".edit-post-sidebar")||S.closest(".block-editor-block-inspector")||S.closest(".components-popover")||S.closest(".components-modal"))||E()},R=requestAnimationFrame(()=>{document.addEventListener("mousedown",l)});return()=>{cancelAnimationFrame(R),document.removeEventListener("mousedown",l)}},[h.portalActive,E,n]),Y(()=>{if(n!=="frontend")return;const l=R=>{const i=R;i.detail?.searchFormId&&i.detail.searchFormId!==e.blockId||v()};return window.addEventListener("voxel-search-clear",l),()=>window.removeEventListener("voxel-search-clear",l)},[n,e.blockId,v]),Y(()=>{if(n!=="frontend")return;const l=R=>{const{searchFormId:i,postType:S}=R.detail||{};i===e.blockId&&S&&m(S)};return window.addEventListener("voxel-switch-post-type",l),()=>window.removeEventListener("voxel-switch-post-type",l)},[n,e.blockId,m]);const f=t.find(l=>l.key===h.currentPostType),p=e.filterLists?.[h.currentPostType]||[],g=l=>{I()},c=(l=!1)=>{v(l)},C={};f?.filters?.forEach(l=>{C[l.key]=l});const J=l=>{if(!(n==="frontend"?Ye(l):!0))return null;const i=l;if(n==="frontend"&&i.conditions&&!kt(i,h.filterValues,C))return null;const S=f?.filters?.find(j=>j.key===l.filterKey);if(!S)return null;const U=l.defaultValueEnabled&&l.defaultValue!==void 0&&l.defaultValue!==""&&!(S.type==="range"&&l.defaultValue===".."),Q={...S,value:U?l.defaultValue:S.value},x={config:l,filterData:Q,value:h.filterValues[l.filterKey],onChange:j=>L(l.filterKey,j),narrowedValues:D,isNarrowing:F,blockId:e.blockId,context:n};switch(S.type){case"keywords":return React.createElement(Xe,{key:l.id,...x});case"range":return React.createElement(et,{key:l.id,...x});case"stepper":return React.createElement(nt,{key:l.id,...x});case"terms":return React.createElement(lt,{key:l.id,...x});case"location":return React.createElement(ct,{key:l.id,...x});case"availability":return React.createElement(it,{key:l.id,...x});case"date":return React.createElement(De,{key:l.id,...x});case"recurring-date":return React.createElement(De,{key:l.id,...x});case"open-now":return React.createElement(pt,{key:l.id,...x});case"order-by":return React.createElement(mt,{key:l.id,...x,allFilterValues:h.filterValues,allFiltersData:f?.filters,postFeedId:e.postToFeedId});case"post-status":return React.createElement(ht,{key:l.id,...x});case"user":return React.createElement(Rt,{key:l.id,...x});case"relations":return React.createElement(Et,{key:l.id,...x});case"following":return React.createElement(ke,{key:l.id,...x});case"followed-by":return React.createElement(ke,{key:l.id,...x});case"following-user":return React.createElement(ke,{key:l.id,...x});case"following-post":return React.createElement(gt,{key:l.id,...x});case"switcher":return React.createElement(vt,{key:l.id,...x});case"ui-heading":return React.createElement(bt,{key:l.id,...x});default:return null}},$=(l=!0)=>React.createElement("div",{className:"ts-filter-wrapper flexify"},e.showPostTypeFilter&&t.length>1&&React.createElement(Nt,{postTypes:t,currentPostType:h.currentPostType,onChange:m,style:B()}),p.map(R=>J(R)),l&&e.showSearchButton&&React.createElement("div",{className:"ts-form-group flexify ts-form-submit",id:"sf_submit",style:me("search")},React.createElement("button",{type:"button",onClick:()=>g(),className:`ts-btn ts-btn-2 ts-btn-large ts-search-btn ${h.loading&&!h.resetting?"ts-loading-btn":""}`},h.loading&&!h.resetting&&React.createElement("div",{className:"ts-loader-wrapper"},React.createElement("span",{className:"ts-loader"})),Ne(e.searchButtonIcon,oe.search),W&&W)),l&&e.showResetButton&&React.createElement("div",{className:"ts-form-group flexify ts-form-reset",style:me("reset")},React.createElement("a",{href:"#",onClick:R=>{R.preventDefault(),c(!1)},className:"ts-filter",role:"button"},Ne(e.resetButtonIcon,oe.reload),w&&React.createElement("div",{className:"ts-filter-text"},w)))),K=Tt(),P=n==="editor"&&s?s:K,z=P==="desktop"&&(e.mfSwitcherDesktop??!1)||P==="tablet"&&(e.mfSwitcherTablet??!1)||P==="mobile"&&(e.mfSwitcherMobile??!1),te=()=>P==="desktop"?e.mfSwitcherDesktopDefault??"feed":P==="tablet"?e.mfSwitcherTabletDefault??"feed":e.mfSwitcherMobileDefault??"feed",[X,re]=q(te),se=G(null);Y(()=>{re(te())},[P,e.mfSwitcherDesktopDefault,e.mfSwitcherTabletDefault,e.mfSwitcherMobileDefault]);const H=(l,R)=>{if(!l)return null;const i=N.current?.ownerDocument||document,S=i.getElementById(l);if(S)return S;const U=R==="map"?"voxel-fse-map-":"voxel-fse-post-feed-",Q=l.replace(/^#/,""),x=`.${U}${Q}`,j=i.querySelector(x);return j||null},o=()=>{re("feed");const l=P,R=H(e.postToMapId||"","map"),i=H(e.postToFeedId||"","feed");if(R){R.classList.add(`vx-hidden-${l}`);const S=R.closest(".voxel-fse-flex-container");S&&S.classList.add(`vx-hidden-${l}`);const U=R.querySelector(".ts-map");U&&se.current&&(U.style.height=se.current.height,U.style.minHeight=se.current.minHeight)}if(i){i.classList.remove(`vx-hidden-${l}`);const S=i.closest(".voxel-fse-flex-container");S&&S.classList.remove(`vx-hidden-${l}`)}},M=()=>{re("map");const l=P,R=H(e.postToMapId||"","map"),i=H(e.postToFeedId||"","feed");if(i){i.classList.add(`vx-hidden-${l}`);const S=i.closest(".voxel-fse-flex-container");S&&S.classList.add(`vx-hidden-${l}`)}if(R){R.classList.remove(`vx-hidden-${l}`);const S=R.closest(".voxel-fse-flex-container");S&&S.classList.remove(`vx-hidden-${l}`);const U=R.querySelector(".ts-map");if(U){se.current||(se.current={height:U.style.height||"",minHeight:U.style.minHeight||""});const Q=R.style.getPropertyValue("--vx-map-height");Q?(U.style.height=Q,U.style.minHeight=Q):requestAnimationFrame(()=>{const x=R.getBoundingClientRect().top;U.style.height=`calc(100vh - ${Math.round(x)}px)`,U.style.minHeight=`calc(100vh - ${Math.round(x)}px)`})}}};Y(()=>{z&&(X==="feed"?o():M())},[P,X,z,e.postToMapId,e.postToFeedId]);const A=()=>{if(!z)return null;const l=[e.mfSwitcherDesktop?"":"vx-hidden-desktop",e.mfSwitcherTablet?"":"vx-hidden-tablet",e.mfSwitcherMobile?"":"vx-hidden-mobile"].filter(Boolean).join(" "),R=React.createElement("div",{className:`ts-switcher-btn ${l}`,style:n==="editor"?k:{}},React.createElement("a",{href:"#",className:`ts-btn ts-btn-1 ${X==="feed"?`vx-hidden-${P}`:""}`,onClick:i=>{i.preventDefault(),o()},role:"button"},oe.grid,"List view"),React.createElement("a",{href:"#",className:`ts-btn ts-btn-1 ${X==="map"?`vx-hidden-${P}`:""}`,onClick:i=>{i.preventDefault(),M()},role:"button"},oe.marker,"Map view"));return n==="editor"?R:Te(React.createElement("div",{className:`voxel-fse-search-form-${e.blockId}`,"data-voxel-id":e.blockId},R),document.body)},ne=P==="desktop"&&(e.formToggleDesktop??!1)||P==="tablet"&&(e.formToggleTablet??!0)||P==="mobile"&&(e.formToggleMobile??!0),ae=ne,le=!ne,pe={postTypes:t.map(l=>({key:l.key,label:l.label,filters:l.filters})),currentPostType:h.currentPostType,filterLists:e.filterLists||{},portalMode:e.portalMode||{desktop:!1,tablet:!1,mobile:!1},showPostTypeFilter:e.showPostTypeFilter??!0,showSearchButton:e.showSearchButton??!0,showResetButton:e.showResetButton??!1,searchButtonText:e.searchButtonText||"",resetButtonText:e.resetButtonText||"",formToggleDesktop:e.formToggleDesktop??!1,formToggleTablet:e.formToggleTablet??!0,formToggleMobile:e.formToggleMobile??!0,searchButtonWidth:e.searchButtonWidth,searchButtonWidth_tablet:e.searchButtonWidth_tablet,searchButtonWidth_mobile:e.searchButtonWidth_mobile,searchButtonWidthUnit:e.searchButtonWidthUnit||"%",resetButtonWidth:e.resetButtonWidth,resetButtonWidth_tablet:e.resetButtonWidth_tablet,resetButtonWidth_mobile:e.resetButtonWidth_mobile,resetButtonWidthUnit:e.resetButtonWidthUnit||"%"},me=l=>{const R=l==="search"?e.searchButtonWidthUnit||"%":e.resetButtonWidthUnit||"%";let i;return l==="search"?P==="mobile"?i=e.searchButtonWidth_mobile??e.searchButtonWidth_tablet??e.searchButtonWidth:P==="tablet"?i=e.searchButtonWidth_tablet??e.searchButtonWidth:i=e.searchButtonWidth:P==="mobile"?i=e.resetButtonWidth_mobile??e.resetButtonWidth_tablet??e.resetButtonWidth:P==="tablet"?i=e.resetButtonWidth_tablet??e.resetButtonWidth:i=e.resetButtonWidth,i!==void 0?{width:`${i}${R}`,flexGrow:0,flexShrink:0}:{}},B=()=>{let l;return P==="mobile"?l=e.postTypeFilterWidth_mobile??e.postTypeFilterWidth_tablet??e.postTypeFilterWidth:P==="tablet"?l=e.postTypeFilterWidth_tablet??e.postTypeFilterWidth:l=e.postTypeFilterWidth,l!==void 0?{width:`${l}%`,flexGrow:0,flexShrink:0}:{}};return React.createElement(React.Fragment,null,React.createElement("div",{className:"ts-form ts-search-widget","data-v-app":"",ref:N},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(pe)}}),ae&&React.createElement("div",{className:"ts-filter-wrapper flexify"},React.createElement("a",{href:"#",onClick:l=>{l.preventDefault(),E()},onMouseDown:l=>l.preventDefault(),className:`ts-filter-toggle ts-btn ts-btn-1 ${h.activeFilterCount>0?"ts-filled":""}`,role:"button","aria-expanded":h.portalActive},oe.filterslider,React.createElement("div",{className:"ts-toggle-text"},"Filter results"),h.activeFilterCount>0&&React.createElement("span",{className:"ts-filter-count"},h.activeFilterCount))),React.createElement("form",{method:"GET",onSubmit:l=>(l.preventDefault(),!1)},le&&React.createElement("div",{className:"ts-inline-filters"},$())),React.createElement("div",{className:"hidden"},React.createElement("div",{className:"ts-search-portal"}))),h.portalActive&&Te(React.createElement("div",{className:`ts-search-portal vx-popup elementor voxel-fse-search-form-${e.blockId}`,"data-voxel-id":e.blockId},React.createElement("div",{className:"ts-popup-root elementor-element"},React.createElement("div",{className:"ts-form ts-search-widget no-render elementor-element"},React.createElement("div",{className:"ts-field-popup-container"},React.createElement("div",{className:"ts-field-popup triggers-blur",ref:a},React.createElement("div",{className:"ts-popup-content-wrapper min-scroll"},React.createElement("div",{className:"ts-form-group"},$())),React.createElement("div",{className:"ts-popup-controller"},React.createElement("ul",{className:"flexify simplify-ul"},React.createElement("li",{className:"flexify ts-popup-close"},React.createElement("a",{href:"#",onClick:l=>{l.preventDefault(),E()},className:"ts-icon-btn",role:"button","aria-label":"Close"},Ne(e.closeIcon,oe.close))),React.createElement("li",{className:"flexify hide-d"},React.createElement("a",{href:"#",onClick:l=>{l.preventDefault(),c(!0)},className:"ts-icon-btn",role:"button"},oe.reload)),React.createElement("li",{className:"flexify hide-m"},React.createElement("a",{href:"#",onClick:l=>{l.preventDefault(),c(!0)},className:"ts-btn ts-btn-1",role:"button"},"Clear")),React.createElement("li",{className:"flexify"},React.createElement("a",{href:"#",onClick:l=>{l.preventDefault(),g(),E()},className:"ts-btn ts-btn-2",role:"button"},"Search"))))))))),document.body),A())}export{Ot as S};
