import{useState as P,useRef as z,useMemo as ne,useEffect as Y,useCallback as S}from"react";import{createPortal as Ae}from"react-dom";import{a as Me}from"./siteUrl-7x5eJEvc.js";import De from"@wordpress/api-fetch";import{V as se,r as Ne}from"./voxelIcons-DHmdKhqs.js";import"./voxelShim-DB_Ue-9R.js";import"./backgroundElements-Ui-iCrLV.js";import"./MediaPopup-CXePoOCG.js";import{F as te,D as Re}from"./DatePicker-NCeMpzfF.js";import Oe from"nouislider";function We(e,t){const n={},a=[t];return e.width&&e.width>0&&(n.width=`${e.width}%`,n.flexGrow=0,n.flexShrink=0),e.hideFilter&&a.push("vx-hidden"),e.alignContent&&(n.justifyContent=e.alignContent),e.hideLabel&&a.push("hide-label"),{style:n,className:a.join(" ")}}function Q(e,t){return We(e,t)}function ae(e){const t={},n=["ts-field-popup","triggers-blur"];return e.customPopupEnabled&&(e.popupMinWidth&&e.popupMinWidth>0&&(t.minWidth=`${e.popupMinWidth}px`),e.popupMaxWidth&&e.popupMaxWidth>0&&(t.maxWidth=`${e.popupMaxWidth}px`),e.popupMaxHeight&&e.popupMaxHeight>0&&(t.maxHeight=`${e.popupMaxHeight}px`),e.popupCenterPosition&&n.push("ts-popup-centered")),{style:t,className:n.join(" ")}}function Ue({attributes:e,postTypes:t,context:n,onSubmit:a,onPostTypeChange:m,onFilterChange:E}){const[u,d]=P(()=>({currentPostType:e.postTypes[0]||"",filterValues:{},activeFilterCount:0,portalActive:!1,loading:!1,resetting:!1,narrowedValues:null,narrowingFilters:!1,lastModifiedFilter:null})),c=z(!1),g=z(null),o=ne(()=>t.find(i=>i.key===u.currentPostType),[t,u.currentPostType]),w=ne(()=>e.filterLists[u.currentPostType]||[],[e.filterLists,u.currentPostType]);Y(()=>{e.postTypes.length>0&&!e.postTypes.includes(u.currentPostType)&&d(i=>({...i,currentPostType:e.postTypes[0],filterValues:{}}))},[e.postTypes,u.currentPostType]),Y(()=>{if(!o?.filters)return;const i={};let p=!1;o.filters.forEach(N=>{N.key in u.filterValues||N.value!==null&&N.value!==void 0&&(i[N.key]=N.value,p=!0)}),p&&d(N=>({...N,filterValues:{...N.filterValues,...i}}))},[o?.filters,u.currentPostType]),Y(()=>{if(n!=="editor"||u.resetting||!o?.filters)return;(e.filterLists?.[u.currentPostType]||[]).forEach(p=>{const N=u.filterValues[p.filterKey];p.defaultValueEnabled&&p.defaultValue!==void 0&&p.defaultValue!==""&&p.defaultValue!==null?N!==p.defaultValue&&N!==null&&d(y=>({...y,filterValues:{...y.filterValues,[p.filterKey]:p.defaultValue}})):N!=null&&d(y=>({...y,filterValues:{...y.filterValues,[p.filterKey]:void 0}}))})},[n,u.currentPostType,e.filterLists,u.resetting,o?.filters]),Y(()=>{const i=Object.values(u.filterValues).filter(p=>p!=null&&p!==""&&p!==!1).length;d(p=>({...p,activeFilterCount:i}))},[u.filterValues]);const r=S(i=>{d(p=>p.currentPostType===i?p:{...p,currentPostType:i,filterValues:{}}),n==="editor"&&m&&m(i),n==="editor"&&E&&E({}),n==="frontend"&&a&&(e.updateUrl!==!1&&$e({},i),setTimeout(()=>{a({postType:i})},50))},[n,a,m,E,e.updateUrl]),b=S((i,p)=>{d(N=>{const y={...N.filterValues,[i]:p};return n==="editor"&&E&&setTimeout(()=>E(y),0),{...N,filterValues:y,lastModifiedFilter:i}})},[n,E]),F=S((i=!1)=>{const p={};o?.filters?.forEach(y=>{y.resets_to!==null&&y.resets_to!==void 0?p[y.key]=y.resets_to:p[y.key]=null});const N=Object.values(p).filter(y=>y!=null&&y!=="").length;if(d(y=>({...y,filterValues:p,activeFilterCount:N,resetting:!0,portalActive:i?!1:y.portalActive,narrowedValues:null,lastModifiedFilter:null})),setTimeout(()=>{d(y=>({...y,resetting:!1}))},100),n==="editor"&&E&&E(p),n==="frontend"){e.updateUrl!==!1&&je(u.currentPostType);const y=new CustomEvent("voxel-search-clear",{detail:{postType:u.currentPostType}});window.dispatchEvent(y)}},[n,u.currentPostType,E,e.updateUrl,o?.filters]),C=S(()=>{d(i=>({...i,portalActive:!i.portalActive}))},[]),x=S(async()=>{if(!e.adaptiveFiltering||n!=="frontend")return;if(c.current){c.current=!1;return}const i=w.filter(y=>y.type==="range"||y.type==="terms");if(i.length===0)return;const p=new URLSearchParams;p.set("type",u.currentPostType),u.lastModifiedFilter&&p.set("_last_modified",u.lastModifiedFilter),Object.entries(u.filterValues).forEach(([y,v])=>{v!=null&&v!==""&&(Array.isArray(v)?p.set(y,v.join(",")):typeof v=="object"?p.set(y,JSON.stringify(v)):p.set(y,String(v)))});const N=[];i.forEach(y=>{if(y.type==="terms"){const v=o?.filters?.find(R=>R.key===y.filterKey);if(v?.props?.terms){const R=h=>{h.forEach(l=>{l.term_taxonomy_id&&N.push(l.term_taxonomy_id),l.children&&Array.isArray(l.children)&&R(l.children)})};R(v.props.terms)}}}),d(y=>({...y,narrowingFilters:!0}));try{const y=Me(),v=await fetch(`${y}voxel-fse/v1/search-form/narrow-filters?${p.toString()}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({term_taxonomy_ids:N})});if(!v.ok)throw new Error(`HTTP ${v.status}`);const R=await v.json();R.success&&R.data?(d(h=>({...h,narrowedValues:{ranges:R.data.ranges||{},terms:R.data.terms||{}},narrowingFilters:!1})),c.current=!0):d(h=>({...h,narrowingFilters:!1}))}catch(y){console.error("[useSearchForm] Adaptive filtering error:",y),d(v=>({...v,narrowingFilters:!1}))}},[e.adaptiveFiltering,n,w,u.currentPostType,u.filterValues,o]);Y(()=>{if(!(!e.adaptiveFiltering||n!=="frontend"))return g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{x()},300),()=>{g.current&&clearTimeout(g.current)}},[u.filterValues,e.adaptiveFiltering,n,x]);const k=S((i,p)=>{d(N=>({...N,loading:!0})),a&&a({postType:p,...i}),n==="frontend"&&e.updateUrl!==!1&&$e(i,p),d(N=>({...N,loading:!1}))},[n,a,e.updateUrl]);Y(()=>{if(e.searchOn==="change"&&n==="frontend"){const i=setTimeout(()=>{k(u.filterValues,u.currentPostType)},300);return()=>{clearTimeout(i)}}},[u.filterValues,u.currentPostType,e.searchOn,n,k]);const T=S(()=>{k(u.filterValues,u.currentPostType)},[k,u.filterValues,u.currentPostType]);return{state:u,setCurrentPostType:r,setFilterValue:b,clearAll:F,togglePortal:C,submit:T,currentPostTypeConfig:o,filterConfigs:w,narrowedValues:u.narrowedValues,narrowingFilters:u.narrowingFilters}}function je(e){const t=new URL(window.location.href),n=[];t.searchParams.forEach((a,m)=>{(m.startsWith("filter_")||m==="post_type")&&n.push(m),m==="type"&&!e&&n.push(m),m!=="type"&&m!=="page"&&m!=="pg"&&n.push(m)}),n.forEach(a=>t.searchParams.delete(a)),e&&t.searchParams.set("type",e),window.history.replaceState({},"",t.toString())}function He(e,t){return Object.hasOwn(t,e)}function $e(e,t){const n=new URL(window.location.href),a=[];n.searchParams.forEach((m,E)=>{(E.startsWith("filter_")||E==="post_type")&&a.push(E),(E==="type"||He(E,e))&&a.push(E)}),a.forEach(m=>n.searchParams.delete(m)),t&&n.searchParams.set("type",t),Object.entries(e).forEach(([m,E])=>{E!=null&&E!==""&&(Array.isArray(E)?n.searchParams.set(m,E.join(",")):typeof E=="object"?n.searchParams.set(m,JSON.stringify(E)):n.searchParams.set(m,String(E)))}),window.history.replaceState({},"",n.toString())}function ke(e){return typeof e=="string"&&e.includes("@tags()")}function _e(e){if(!ke(e))return e;const t=e.match(/@tags\(\)(.*?)@endtags\(\)/s);return t?t[1]:e}async function Ve(e,t={}){try{return(await De({path:"/voxel-fse/v1/dynamic-data/render",method:"POST",data:{expression:e,context:t}})).rendered}catch(n){return console.error("Failed to render dynamic tag:",n),e}}function we(){return typeof document>"u"?!1:document.body.classList.contains("logged-in")}function Ke(){return typeof document>"u"?[]:Array.from(document.body.classList).filter(n=>n.startsWith("role-")||["administrator","editor","author","contributor","subscriber"].includes(n)).map(n=>n.replace("role-",""))}function qe(e){const t=e.filterKey;switch(t){case"user:logged_in":return we();case"user:logged_out":return!we();case"user:role":{if(!we())return!1;const n=Ke(),a=e.value||"";switch(e.operator){case"equals":return n.includes(a);case"not_equals":return!n.includes(a);default:return n.includes(a)}}default:return console.warn(`Unknown visibility rule type: ${t}`),!0}}function ze(e){return!e||e.length===0?!0:e.every(t=>qe(t))}function Ge(e){const{rowVisibility:t="show",visibilityRules:n=[]}=e;if(!n||n.length===0)return!0;const a=ze(n);return t==="hide"?!a:a}function Je({config:e,filterData:t,value:n,onChange:a,blockId:m}){const E=m?`voxel-popup-${m}`:"",u=z(null),d=z(null),[c,g]=P(!1),[o,w]=P(""),r=typeof n=="string"?n:"",b=t.props?.placeholder||t.label||"Type keywords...",F=e.displayAs||t.props?.display_as||"inline",C=t.icon||"";Y(()=>{c&&(w(r),setTimeout(()=>{d.current?.focus()},50))},[c,r]);const x=l=>{a(l.target.value)},k=l=>{w(l.target.value)},T=S(()=>{g(!0)},[]),i=S(()=>{a(o),g(!1)},[o,a]),p=S(()=>{w(""),a("")},[a]),N=S(l=>{l.key==="Enter"&&(l.preventDefault(),i())},[i]);if(F==="inline"){const{style:l,className:f}=Q(e,"ts-form-group ts-inline-filter");return React.createElement("div",{className:f,style:l},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:"ts-input-icon flexify"},C&&React.createElement("span",{dangerouslySetInnerHTML:{__html:C}}),React.createElement("input",{type:"text",value:r,onChange:x,placeholder:b,className:"inline-input"})))}const y=r.length>0,{style:v,className:R}=Q(e,"ts-form-group"),h=ae(e);return React.createElement("div",{className:R,style:v},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:u,className:`ts-filter ts-popup-target ${y?"ts-filled":""}`,onClick:T,onMouseDown:l=>l.preventDefault(),role:"button",tabIndex:0},C&&React.createElement("span",{dangerouslySetInnerHTML:{__html:C}}),React.createElement("div",{className:"ts-filter-text"},y?r:b)),React.createElement(te,{isOpen:c,target:u,title:"",icon:C,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:i,onClear:p,onClose:()=>g(!1),className:`${E}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:h.style},React.createElement("div",{className:"ts-input-icon ts-sticky-top flexify"},React.createElement("span",null,se.search),React.createElement("input",{ref:d,type:"text",value:o,onChange:k,onKeyDown:N,placeholder:b,className:"autofocus border-none"}))))}function Fe(e,t,n){if(e==null||e==="")return{min:t,max:n};if(typeof e=="string"&&e.includes("..")){const a=e.split(".."),m=a[0]!==""?Number(a[0]):t,E=a[1]!==""?Number(a[1]):n;return{min:isNaN(m)?t:m,max:isNaN(E)?n:E}}if(typeof e=="object"){const a=e;return{min:a.min??t,max:a.max??n}}return typeof e=="number"?{min:e,max:n}:{min:t,max:n}}function Ye({config:e,filterData:t,value:n,onChange:a,blockId:m,narrowedValues:E,isNarrowing:u}){const d=[m?`voxel-popup-${m}`:"",e.id?`elementor-repeater-item-${e.id}`:""].filter(Boolean).join(" "),c=z(null),g=z(null),o=z(null),[w,r]=P(!1),b=t.props||{},F=b.min??0,C=b.max??100,x=b.step??1,k=b.placeholder||t.label||"Range",T=e.displayAs||t.props?.display_as||"popup",i=b.handles||"double",p=b.compare||"in_range",N=e.filterKey,y=E?.ranges?.[N],v=y?.min??F,R=y?.max??C,h=b.format||"number",l=b.prefix||(typeof h=="object"?h.prefix:"")||"",f=b.suffix||(typeof h=="object"?h.suffix:"")||"",B=t.icon||"",K=Fe(n,v,R),[$,q]=P(K.min),[M,U]=P(K.max),O=S(I=>h==="price"?`${l}${I.toLocaleString()}${f}`:`${l}${I}${f}`,[h,l,f]),s=n!=null&&n!==""&&(K.min!==v||K.max!==R),G=s?`${O(K.min)} — ${O(K.max)}`:k,D=`${O($)} — ${O(M)}`,_=S(()=>{if(!g.current||o.current)return;const I=$,H=M;let fe,ue;i==="double"?(fe=[I,H],ue=!0):p==="in_range"?(fe=[H],ue=[!1,!0]):(fe=[I],ue=[!0,!1]),Oe.create(g.current,{start:fe,connect:ue,range:{min:v,max:R},step:x,behaviour:"tap-drag"}),o.current=g.current.noUiSlider,o.current.on("update",A=>{i==="double"?(q(Math.round(Number(A[0]))),U(Math.round(Number(A[1])))):p==="in_range"?U(Math.round(Number(A[0]))):q(Math.round(Number(A[0])))}),requestAnimationFrame(()=>{o.current&&(i==="double"?o.current.set([I,H],!1):o.current.set([I],!1))})},[i,p,$,M,v,R,x]),X=S(()=>{o.current&&(o.current.destroy(),o.current=null)},[]);Y(()=>{const I=Fe(n,v,R);if(q(I.min),U(I.max),o.current){const H=i==="double"?[I.min,I.max]:[I.min];o.current.set(H,!1),requestAnimationFrame(()=>{o.current&&o.current.set(H,!1)})}},[n,v,R,i]),Y(()=>{if(w&&T==="popup"){const I=setTimeout(()=>{_()},100);return()=>clearTimeout(I)}return()=>{T==="popup"&&X()}},[w,T,_,X]),Y(()=>{if(T==="inline")return _(),()=>X()},[T,_,X]),Y(()=>{if(!o.current||!y)return;o.current.updateOptions({range:{min:v,max:R}},!0);let I=$,H=M;I<v&&(I=v),I>R&&(I=R),i==="double"&&(H<v&&(H=v),H>R&&(H=R),I>H&&(I=H)),i==="double"?o.current.set([I,H]):o.current.set([I]),q(I),U(H)},[y,v,R,i]);const W=S(()=>{r(!0)},[]),L=S((I,H)=>I===v&&H===R?null:i==="double"?`${I}..${H}`:p==="greater_than"||p==="in_range"?`${I}..`:`..${H}`,[i,p,v,R]),J=I=>{const H=I.target.value===""?v:Number(I.target.value);q(H),o.current&&o.current.set(i==="double"?[H,M]:[H]),T==="minmax"&&a(L(H,M))},V=I=>{const H=I.target.value===""?R:Number(I.target.value);U(H),o.current&&o.current.set([$,H]),T==="minmax"&&a(L($,H))},j=S(()=>{a(L($,M)),r(!1)},[$,M,L,a]),ee=S(()=>{q(v),U(R),o.current&&o.current.set(i==="double"?[v,R]:[v]),a(null)},[v,R,i,a]),Z=()=>React.createElement("div",{className:"ts-minmax"},React.createElement("input",{type:"number",className:"inline-input input-no-icon",placeholder:String(v),value:$,onChange:J,min:v,max:M,step:x}),i==="double"&&React.createElement("input",{type:"number",className:"inline-input input-no-icon",placeholder:String(R),value:M,onChange:V,min:$,max:R,step:x})),le=()=>React.createElement("div",{className:`range-slider-wrapper${u?" ts-loading":""}`},React.createElement("div",{className:"range-value"},D),React.createElement("div",{ref:g,className:"range-slider"}),y&&(y.min!==F||y.max!==C)&&React.createElement("div",{className:"range-narrowed-indicator"},React.createElement("small",null,"Showing ",O(v)," — ",O(R)," based on current results")));if(T==="minmax"&&i==="double"){const{style:I,className:H}=Q(e,"ts-form-group");return React.createElement("div",{className:H,style:I},!e.hideLabel&&React.createElement("label",null,t.label),Z())}if(T==="inline"){const{style:I,className:H}=Q(e,"ts-form-group ts-inline-filter");return React.createElement("div",{className:H,style:I},!e.hideLabel&&React.createElement("label",null,t.label),le())}const{style:re,className:de}=Q(e,"ts-form-group"),ie=ae(e);return React.createElement("div",{className:de,style:re},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:c,className:`ts-filter ts-popup-target ${s?"ts-filled":""}`,onClick:W,onMouseDown:I=>I.preventDefault(),role:"button",tabIndex:0},B&&React.createElement("span",{dangerouslySetInnerHTML:{__html:B}}),React.createElement("div",{className:"ts-filter-text"},G),React.createElement("div",{className:"ts-down-icon"})),React.createElement(te,{isOpen:w,target:c,title:"",icon:B,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:j,onClear:ee,onClose:()=>r(!1),className:`${d}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:ie.style},React.createElement("div",{className:"ts-form-group"},React.createElement("label",null,t.label,t.description&&React.createElement("small",null,t.description)),le())))}function Qe(e,t){let n=null;return function(...a){n&&clearTimeout(n),n=setTimeout(()=>e.apply(this,a),t)}}function Xe({config:e,filterData:t,value:n,onChange:a,blockId:m}){const E=m?`voxel-popup-${m}`:"",u=t.props||{},d=u.min??0,c=u.max??99,g=u.step??1,o=u.default??d,w=u.placeholder||t.label||"Any",r=e.displayAs||t.props?.display_as||"popup",b=t.icon||"",F=z(null),[C,x]=P(!1),k=typeof n=="number"?n:o,[T,i]=P(k),p=ne(()=>Qe(M=>a(M),300),[a]);Y(()=>{i(typeof n=="number"?n:o)},[n,o]),Y(()=>{C&&i(k)},[C,k]);const N=M=>{M.preventDefault();const U=Math.max(d,T-g);i(U),r==="inline"&&p(U)},y=M=>{M.preventDefault();const U=Math.min(c,T+g);i(U),r==="inline"&&p(U)},v=M=>{const U=parseInt(M.target.value,10);if(!isNaN(U)){const O=Math.min(c,Math.max(d,U));i(O),r==="inline"&&p(O)}},R=S(()=>{x(!0)},[]),h=S(()=>{a(T),x(!1)},[T,a]),l=S(()=>{i(o),a(o)},[o,a]),f=()=>React.createElement("div",{className:"ts-stepper-input flexify"},React.createElement("button",{type:"button",className:"ts-stepper-left ts-icon-btn inline-btn-ts",onClick:N},React.createElement("i",{className:"las la-minus"})),React.createElement("input",{type:"number",className:"ts-input-box",min:d,max:c,step:g,value:T,onChange:v,placeholder:w}),React.createElement("button",{type:"button",className:"ts-stepper-right ts-icon-btn inline-btn-ts",onClick:y},React.createElement("i",{className:"las la-plus"})));if(r==="inline"){const{style:M,className:U}=Q(e,"ts-form-group ts-inline-filter");return React.createElement("div",{className:U,style:M},!e.hideLabel&&React.createElement("label",null,t.label),f())}const B=k!==o,{style:K,className:$}=Q(e,"ts-form-group"),q=ae(e);return React.createElement("div",{className:$,style:K},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:F,className:`ts-filter ts-popup-target ${B?"ts-filled":""}`,onClick:R,onMouseDown:M=>M.preventDefault(),role:"button",tabIndex:0},b&&React.createElement("span",{dangerouslySetInnerHTML:{__html:b}}),React.createElement("div",{className:"ts-filter-text"},B?T:w),React.createElement("div",{className:"ts-down-icon"})),React.createElement(te,{isOpen:C,target:F,title:"",icon:b,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:h,onClear:l,onClose:()=>x(!1),className:`${E}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:q.style},React.createElement("div",{className:"ts-form-group"},React.createElement("label",null,t.label,t.description&&React.createElement("small",null,t.description)),f())))}function Ze(e){return e==null||e===""?[]:typeof e=="string"?e.split(",").map(t=>t.trim()).filter(t=>t!==""):Array.isArray(e)?e.length>0&&typeof e[0]=="string"?e:e.length>0&&typeof e[0]=="number"?e.map(String):[]:[]}function Se(e){return e.length===0?null:e.join(",")}function et({config:e,filterData:t,value:n,onChange:a,blockId:m,narrowedValues:E,isNarrowing:u}){const d=m?`voxel-popup-${m}`:"",c=z(null),g=z(null),[o,w]=P(!1),[r,b]=P(""),F=t.props||{},C=F.multiple??!0,x=F.placeholder||t.label||"Select",k=e.displayAs||F.display_as||"popup",T=e.hideEmptyTerms??F.hide_empty_terms??!1,i=t.icon||"",p=F.taxonomy||e.filterKey,N=E?.terms?.[p],y=S(L=>{const J=(V,j,ee)=>{const Z={...V,parentRef:j||void 0,hasSelection:!1,depth:ee};return V.children&&V.children.length>0&&(Z.children=V.children.map(le=>J(le,Z,ee+1))),Z};return L.map(V=>J(V,null,0))},[]),v=ne(()=>{const L=F.terms||[];return y(L)},[F,y]),R=ne(()=>{const L=new Map,J=V=>{L.set(V.slug,V),V.children&&V.children.forEach(j=>J(j))};return v.forEach(V=>J(V)),L},[v]),h=ne(()=>{const L=[],J=V=>{V.forEach(j=>{T&&N&&j.term_taxonomy_id&&N[j.term_taxonomy_id]===0||(L.push(j),j.children&&j.children.length>0&&J(j.children))})};return J(v),L},[v,T,N]),l=S(L=>!N||!L.term_taxonomy_id?null:N[L.term_taxonomy_id]??null,[N]),f=ne(()=>Ze(n),[n]),B=S(L=>L.slug?f.includes(L.slug):!1,[f]),K=ne(()=>h.filter(L=>L.slug&&f.includes(L.slug)),[h,f]),$=ne(()=>{if(!r)return h;const L=r.toLowerCase();return h.filter(J=>J.label.toLowerCase().includes(L))},[h,r]);Y(()=>{o&&(b(""),h.length>=15&&setTimeout(()=>g.current?.focus(),50))},[o,h.length]);const q=S(()=>{w(!0)},[]),M=S(L=>{const J=L.slug;if(J)if(C){let V=[...f];if(V.includes(J)){V=V.filter(ee=>ee!==J);let j=L.parentRef;for(;j;)j.children?.some(Z=>V.includes(Z.slug)||Z.hasSelection)||(j.hasSelection=!1),j=j.parentRef;a(Se(V))}else{V.push(J);let j=L.parentRef;for(;j;)V=V.filter(Z=>Z!==j.slug),j.hasSelection=!0,j=j.parentRef;const ee=new Set;V.forEach(Z=>{const le=R.get(Z);if(!le)return;let re=le.parentRef;const de=[];let ie=!1;for(;re;){if(re.slug===J){ie=!0;break}de.push(re),re=re.parentRef}ie&&(ee.add(le.slug),de.forEach(I=>{I.hasSelection=!1}))}),V=V.filter(Z=>!ee.has(Z)),a(Se(V))}}else a(Se([J])),k!=="inline"&&w(!1)},[C,f,a,R,k]),U=S(()=>{w(!1)},[]),O=S(()=>{a(null)},[a]),s=f.length>0,G=s&&K[0]?.label||x,D=K.length>1?K.length-1:0;if(k==="inline"){const{style:L,className:J}=Q(e,"ts-form-group inline-terms-wrapper ts-inline-filter min-scroll");return React.createElement("div",{className:`${J}${u?" ts-loading":""}`,style:L},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:"ts-term-dropdown ts-multilevel-dropdown inline-multilevel"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},h.map(V=>{const j=B(V),ee=l(V),Z=ee===0;return React.createElement("li",{key:V.slug,className:`${j?"ts-selected":""}${Z?" ts-disabled":""}`},React.createElement("a",{href:"#",className:"flexify",onClick:le=>{le.preventDefault(),Z||M(V)}},React.createElement("div",{className:"ts-checkbox-container"},React.createElement("label",{className:`container-${C?"checkbox":"radio"}`},React.createElement("input",{type:C?"checkbox":"radio",checked:j,readOnly:!0,disabled:!0,hidden:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,V.depth>0?"— ".repeat(V.depth):"",V.label),ee!==null&&React.createElement("span",{className:"ts-term-count"},"(",ee,")"),V.icon&&React.createElement("div",{className:"ts-term-icon",dangerouslySetInnerHTML:{__html:V.icon}})))}))))}if(k==="buttons"){const{style:L,className:J}=Q(e,"ts-form-group");return React.createElement("div",{className:J,style:L},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("ul",{className:"simplify-ul addon-buttons flexify"},h.map(V=>{const j=B(V);return React.createElement("li",{key:V.slug,className:`flexify ${j?"adb-selected":""}`,onClick:()=>M(V)},V.label)})))}const{style:_,className:X}=Q(e,"ts-form-group"),W=ae(e);return React.createElement("div",{className:X,style:_},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:c,className:`ts-filter ts-popup-target ${s?"ts-filled":""}`,onClick:q,onMouseDown:L=>L.preventDefault(),role:"button",tabIndex:0},i&&React.createElement("span",{dangerouslySetInnerHTML:{__html:i}}),React.createElement("div",{className:"ts-filter-text"},G,D>0&&React.createElement("span",{className:"term-count"},"+",D)),React.createElement("div",{className:"ts-down-icon"})),React.createElement(te,{isOpen:o,target:c,title:"",icon:i,saveLabel:"Save",clearLabel:"Clear",showClear:!0,showSave:C,onSave:U,onClear:O,onClose:()=>w(!1),className:`${d}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:W.style},h.length>=15&&React.createElement("div",{className:"ts-sticky-top uib b-bottom"},React.createElement("div",{className:"ts-input-icon flexify"},React.createElement("span",null,se.search),React.createElement("input",{ref:g,type:"text",value:r,onChange:L=>b(L.target.value),placeholder:"Search",className:"autofocus"}))),React.createElement("div",{className:`ts-term-dropdown ts-multilevel-dropdown ts-md-group${u?" ts-loading":""}`},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},$.map(L=>{const J=B(L),V=l(L),j=V===0;return React.createElement("li",{key:L.slug,className:`${J?"ts-selected":""}${j?" ts-disabled":""}`},React.createElement("a",{href:"#",className:"flexify",onClick:ee=>{ee.preventDefault(),j||M(L)}},React.createElement("div",{className:"ts-checkbox-container"},React.createElement("label",{className:`container-${C?"checkbox":"radio"}`},React.createElement("input",{type:C?"checkbox":"radio",checked:J,readOnly:!0,disabled:!0,hidden:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,L.depth>0?"— ".repeat(L.depth):"",L.label),V!==null&&React.createElement("span",{className:"ts-term-count"},"(",V,")"),L.icon&&React.createElement("div",{className:"ts-term-icon",dangerouslySetInnerHTML:{__html:L.icon}})))})),$.length===0&&React.createElement("div",{className:"ts-empty-user-tab"},i&&React.createElement("span",{dangerouslySetInnerHTML:{__html:i}}),React.createElement("p",null,"No results found")))))}function pe(e){return!e||!e.address?null:e.swlat!==void 0&&e.swlng!==void 0&&e.nelat!==void 0&&e.nelng!==void 0?`${e.address};${e.swlat},${e.swlng}..${e.nelat},${e.nelng}`:e.lat!==void 0&&e.lng!==void 0?`${e.address};${e.lat},${e.lng},${e.radius||25}`:e.address}function tt(e,t){if(e==null||e==="")return null;if(typeof e=="string"){const n=e.indexOf(";");if(n===-1)return{address:e};const a=e.substring(0,n),m=e.substring(n+1);if(m.includes("..")){const u=m.split(".."),d=u[0].split(","),c=u[1].split(",");return{address:a,swlat:Number(d[0]),swlng:Number(d[1]),nelat:Number(c[0]),nelng:Number(c[1])}}const E=m.split(",");return{address:a,lat:Number(E[0]),lng:Number(E[1]),radius:E[2]?Number(E[2]):t}}return typeof e=="object"?e:null}function nt({config:e,filterData:t,value:n,onChange:a,blockId:m}){const E=m?`voxel-popup-${m}`:"",u=z(null),d=z(null),c=z(null),g=z(null),o=z(null),[w,r]=P(!1),[b,F]=P(!1),C=z(null),x=t.props||{},k=x.radius||{},T=k.default??25,i=k.min??1,p=k.max??100,N=k.step??1,y=x.units||"km",v=x.display_proximity_as||"popup",R=x.placeholder||t.label||"Location",h=e.displayAs||t.props?.display_as||"popup",l=t.icon||"",f=tt(n,T)||{},[B,K]=P(f.address||""),[$,q]=P(f.radius||T),M=S(A=>Math.round(A*1e6)/1e6,[]),U=S(A=>`${A}${y==="mi"?"mi":"km"}`,[y]),O=S(()=>{!g.current||o.current||(Oe.create(g.current,{start:$,connect:[!0,!1],step:N,range:{min:i,max:p},behaviour:"tap-drag"}),o.current=g.current.noUiSlider,o.current.on("update",A=>{q(Math.round(Number(A[0])))}),o.current.on("change",A=>{const ce=Math.round(Number(A[0]));v==="inline"&&f.lat&&a(pe({...f,radius:ce}))}))},[$,N,i,p,v,f,a]),s=S(()=>{o.current&&(o.current.destroy(),o.current=null)},[]);Y(()=>{if(v==="inline"&&f.lat){const A=setTimeout(()=>O(),50);return()=>{clearTimeout(A),s()}}},[v,f.lat,O,s]),Y(()=>{if(b){const A=setTimeout(()=>O(),50);return()=>clearTimeout(A)}return()=>s()},[b,O,s]),Y(()=>{const A=f.radius||T;q(A),o.current&&o.current.set([A])},[f.radius,T]);const G=S(()=>{if(c.current||!d.current||typeof window>"u")return;const A=window.Voxel?.Maps;if(!A){console.warn("Voxel.Maps not available for autocomplete");return}A.await(()=>{if(c.current)return;const ce=e.autocomplete||{};c.current=new A.Autocomplete(d.current,oe=>{if(oe){const Ce=oe.viewport.getSouthWest(),Le=oe.viewport.getNorthEast(),Be={address:oe.address,swlat:M(Ce.getLatitude()),swlng:M(Ce.getLongitude()),nelat:M(Le.getLatitude()),nelng:M(Le.getLongitude()),lat:M(oe.latlng.getLatitude()),lng:M(oe.latlng.getLongitude()),radius:f.radius||T};K(oe.address),a(pe(Be)),h==="popup"&&r(!1)}else K(""),a(null)},ce)})},[e.autocomplete,a,h,T,f.radius,M]);Y(()=>{(w||h==="inline")&&(K(f.address||""),w&&setTimeout(()=>d.current?.focus(),50))},[w,h,f.address]);const D=S(()=>{r(!0)},[]),_=S(()=>{G()},[G]),X=A=>{K(A.target.value),h==="inline"&&(A.target.value?a(pe({...f,address:A.target.value})):a(null))},W=A=>{A.preventDefault(),A.stopPropagation(),"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(ce=>{const oe={address:"Current Location",lat:ce.coords.latitude,lng:ce.coords.longitude,radius:T};K("Current Location"),a(pe(oe)),h==="popup"&&r(!1)},ce=>{console.error("Geolocation error:",ce)})},L=S(()=>{a(B?pe({...f,address:B}):null),r(!1)},[B,f,a]),J=S(()=>{K(""),a(null)},[a]),V=S(A=>{A.key==="Enter"&&(A.preventDefault(),L())},[L]),j=S(()=>{f.lat&&a(pe({...f,radius:$})),F(!1)},[f,$,a]),ee=S(()=>{q(T),o.current&&o.current.set([T]),f.lat&&a(pe({...f,radius:T}))},[T,f,a]),Z=!!f.address||!!f.lat,le=Z?f.address||"Location set":R,re=()=>React.createElement("div",{className:"ts-input-icon flexify",style:{position:"relative"}},l&&React.createElement("span",{dangerouslySetInnerHTML:{__html:l}}),React.createElement("input",{ref:d,type:"text",className:"inline-input",placeholder:R,value:B,onChange:X,onKeyDown:V,onFocus:_}),React.createElement("a",{href:"#",className:"inline-user-location ts-icon-btn",onClick:W,title:"Use my location","aria-label":"Use my location"},se.crosshairs)),de=()=>React.createElement("div",{className:"range-slider-wrapper"},React.createElement("div",{className:"range-value"},U($)),React.createElement("div",{ref:g,className:"range-slider"})),ie=()=>!f.lat||v==="inline"?null:React.createElement("div",{className:"ts-form-group ts-proximity-filter"},React.createElement("label",null,x.proximity_label||"Radius"),React.createElement("div",{ref:C,className:`ts-filter ts-popup-target ${f.radius?"ts-filled":""}`,onClick:()=>F(!0),onMouseDown:A=>A.preventDefault(),role:"button",tabIndex:0},React.createElement("div",{className:"ts-filter-text"},U(f.radius||T)),React.createElement("div",{className:"ts-down-icon"})),React.createElement(te,{isOpen:b,target:C,title:"",saveLabel:"Save",clearLabel:"Reset",showClear:!0,onSave:j,onClear:ee,onClose:()=>F(!1),className:`${E}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:ue.style},React.createElement("div",{className:"ts-form-group"},React.createElement("label",null,x.proximity_label||"Search radius"),de()))),I=()=>v!=="inline"||!f.lat?null:React.createElement("div",{className:"ts-form-group ts-inline-proximity"},React.createElement("label",null,x.proximity_label||"Radius",": ",U($)),React.createElement("div",{ref:g,className:"range-slider"}));if(h==="inline"){const{style:A,className:ce}=Q(e,"ts-form-group ts-inline-filter");return React.createElement(React.Fragment,null,React.createElement("div",{className:ce,style:A},!e.hideLabel&&React.createElement("label",null,t.label),re()),I(),ie())}const{style:H,className:fe}=Q(e,"ts-form-group"),ue=ae(e);return React.createElement(React.Fragment,null,React.createElement("div",{className:fe,style:H},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:u,className:`ts-filter ts-popup-target ${Z?"ts-filled":""}`,onClick:D,onMouseDown:A=>A.preventDefault(),role:"button",tabIndex:0},l&&React.createElement("span",{dangerouslySetInnerHTML:{__html:l}}),React.createElement("div",{className:"ts-filter-text"},le),React.createElement("div",{className:"ts-down-icon"})),React.createElement(te,{isOpen:w,target:u,title:"",icon:l,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:L,onClear:J,onClose:()=>r(!1),className:`${E}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:ue.style},React.createElement("div",{className:"ts-form-group"},re()))),I(),ie())}function at(e){if(e==null||e==="")return{date:"",slots:1};if(typeof e=="string")return{date:e,slots:1};if(typeof e=="object"){const t=e;return{date:t.date||"",slots:t.slots||1}}return{date:"",slots:1}}const he=e=>{if(!e)return null;try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t:null}catch{return null}},me=e=>{if(!e)return null;const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${a}`},ye=e=>{if(!e)return"";try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):""}catch{return e}};function lt({config:e,filterData:t,value:n,onChange:a,blockId:m}){const E=[m?`voxel-popup-${m}`:"",e.id?`elementor-repeater-item-${e.id}`:""].filter(Boolean).join(" "),u=z(null),d=z(null),[c,g]=P(!1),o=t.props||{},r=(o.inputMode||"date-range")==="date-range",b=o.l10n||{},F=b.pickDate||t.label||"Select dates",C=t.icon||"",x=at(n),k=x.date,T=x.slots;let i="",p="";r&&k&&k.includes("..")?[i,p]=k.split(".."):!r&&k&&(i=k);const[N,y]=P(()=>he(i)),[v,R]=P(()=>he(p)),[h,l]=P("start"),[f,B]=P(T);Y(()=>{if(c){if(r&&k&&k.includes("..")){const[_,X]=k.split("..");y(he(_)),R(he(X))}else!r&&k&&y(he(k));B(T),l("start")}},[c,r,k,T]);const K=S(()=>{g(!0)},[]),$=S(_=>{if(r&&_&&d.current)if(h==="start")y(_),l("end"),d.current.setStartRange(_),d.current.setEndRange(null),d.current.draw();else if(N&&_<N)y(_),R(null),d.current.setStartRange(_),d.current.setEndRange(null),d.current.draw();else{R(_),l("start"),d.current.setEndRange(_),d.current.draw();const X=me(N),W=me(_);X&&W&&(a(`${X}..${W}`),g(!1))}else y(_)},[r,h,N,a]);S(_=>{B(Number(_.target.value)||1)},[]);const q=S(_=>{if(r){const X=me(N),W=me(v);X&&W&&a(`${X}..${W}`)}else{const W=me(_!==void 0?_:N);W&&a(W)}g(!1)},[r,N,v,a]),M=S(()=>{y(null),R(null),B(1),a(null),d.current&&(d.current.setStartRange(null),d.current.setEndRange(null))},[a]),U=r?!!(i&&p):!!k,O=ne(()=>{if(!U)return F;if(r){const _=ye(i),X=ye(p),W=`${_} — ${X}`;return T>1?`${W} (${T})`:W}else{const _=ye(k);return T>1?`${_} (${T})`:_}},[r,U,i,p,k,T,F]),{style:s,className:G}=Q(e,"ts-form-group"),D=ae(e);return React.createElement("div",{className:G,style:s},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:u,className:`ts-filter ts-popup-target ${U?"ts-filled":""}`,onClick:K,onMouseDown:_=>_.preventDefault(),role:"button",tabIndex:0},C&&React.createElement("span",{dangerouslySetInnerHTML:{__html:C}}),React.createElement("div",{className:"ts-filter-text"},O),React.createElement("div",{className:"ts-down-icon"})),React.createElement(te,{isOpen:c,target:u,title:"",icon:C,saveLabel:b.save||"Save",clearLabel:b.clear||"Clear",showSave:r,onSave:q,onClear:M,onClose:()=>g(!1),className:`${E}${r?" ts-availability-wrapper xl-height xl-width":" md-width xl-height"}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:D.style},r&&React.createElement("div",{className:"ts-popup-head flexify"},React.createElement("div",{className:"ts-popup-name flexify"},C&&React.createElement("span",{dangerouslySetInnerHTML:{__html:C}}),React.createElement("span",null,React.createElement("span",{className:h==="start"?"chosen":"",onClick:()=>l("start"),style:{cursor:"pointer"}},N?ye(me(N)):b.checkIn||"Check-in"),React.createElement("span",null," — "),React.createElement("span",{className:h==="end"?"chosen":"",onClick:()=>l("end"),style:{cursor:"pointer"}},v?ye(me(v)):b.checkOut||"Check-out")))),React.createElement(Re,{value:N,onChange:$,...!r&&{onSelect:q},pickerConfig:{minDate:new Date,...r?{theme:"pika-range"}:{}},onPickerReady:_=>{d.current=_,r&&N&&(_.setStartRange(N),v&&_.setEndRange(v))}})))}function st(e,t){if(e==null||e==="")return{from:"",to:""};if(typeof e=="string"){if(t&&e.includes("..")){const n=e.split("..");return{from:n[0]||"",to:n[1]||""}}return{from:e,to:""}}if(typeof e=="object"){const n=e;return{from:n.from||"",to:n.to||""}}return{from:"",to:""}}function Ee(e,t,n){return!e&&!t?null:n?e&&t?`${e}..${t}`:e?`${e}..`:t?`..${t}`:null:e||null}const ve=e=>{if(!e)return null;try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t:null}catch{return null}},Pe=e=>{if(!e)return null;const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${a}`},be=e=>{if(!e)return"";try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}):""}catch{return e}};function rt({config:e,filterData:t,value:n,onChange:a,blockId:m}){const E=m?`voxel-popup-${m}`:"",u=z(null),d=t.props||{},c=d.enable_range??!1,g=d.placeholder||t.label||"Select date",o=t.icon||"",w=st(n,c),r=w.from,b=w.to,[F,C]=P(!1),[x,k]=P(!1),[T,i]=P(()=>ve(r)),[p,N]=P(()=>ve(b)),y=S(()=>{i(ve(r)),C(!0)},[r]),v=S(()=>{N(ve(b)),k(!0)},[b]),R=S(s=>{i(s)},[]),h=S(s=>{N(s)},[]),l=S(s=>{const D=Pe(s!==void 0?s:T)||"";a(Ee(D,b,c)),C(!1)},[T,c,b,a]),f=S(s=>{const D=Pe(s!==void 0?s:p)||"";a(Ee(r,D,c)),k(!1)},[p,r,c,a]),B=S(()=>{i(null),a(Ee("",b,c))},[c,b,a]),K=S(()=>{N(null),a(Ee(r,"",c))},[r,c,a]),$=c?!!r||!!b:!!r,q=ne(()=>{if(!$)return g;if(c){const s=[];return r&&s.push(be(r)),b&&s.push(be(b)),s.join(" - ")||g}return be(r)||g},[$,c,r,b,g]),{style:M,className:U}=Q(e,"ts-form-group"),O=ae(e);return React.createElement("div",{className:U,style:M},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:u,className:`ts-filter ts-popup-target ${$?"ts-filled":""}`,onClick:y,onMouseDown:s=>s.preventDefault(),role:"button",tabIndex:0},o&&React.createElement("span",{dangerouslySetInnerHTML:{__html:o}}),React.createElement("div",{className:"ts-filter-text"},q),React.createElement("div",{className:"ts-down-icon"})),React.createElement(te,{isOpen:F,target:u,title:c?"From":"",icon:o,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:l,onClear:B,onClose:()=>C(!1),className:`${E}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:O.style},React.createElement(Re,{value:T,onChange:R,onSelect:l}),c&&React.createElement("div",{className:"ts-form-group",style:{marginTop:"12px",borderTop:"1px solid var(--ts-shade-5)",paddingTop:"12px"}},React.createElement("label",null,"To"),React.createElement("div",{className:`ts-filter ts-popup-target ${b?"ts-filled":""}`,onClick:s=>{s.stopPropagation(),C(!1),setTimeout(()=>v(),100)},role:"button",tabIndex:0},o&&React.createElement("span",{dangerouslySetInnerHTML:{__html:o}}),React.createElement("div",{className:"ts-filter-text"},b?be(b):"Select end date")))),c&&React.createElement(te,{isOpen:x,target:u,title:"To",icon:o,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:f,onClear:K,onClose:()=>k(!1),className:`${E}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:O.style},React.createElement(Re,{value:p,onChange:h,onSelect:f})))}const ge=e=>{if(!e)return null;try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t:null}catch{return null}},Ie=e=>{if(!e)return null;const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${a}`},Te=e=>{if(!e)return"";try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}):""}catch{return e}};function ct({config:e,filterData:t,value:n,onChange:a,blockId:m}){const E=m?`voxel-popup-${m}`:"",u=z(null),c=(t.props||{}).placeholder||t.label||"Date",g=t.icon||"",o=n||{},w=o.from||"",r=o.to||"",[b,F]=P(!1),[C,x]=P(!1),[k,T]=P(()=>ge(w)),[i,p]=P(()=>ge(r)),N=S(()=>{T(ge(w)),F(!0)},[w]),y=S(()=>{p(ge(r)),x(!0)},[r]),v=S(O=>{T(O)},[]),R=S(O=>{p(O)},[]),h=S(O=>{const G=Ie(O!==void 0?O:k)||"";a({from:G,to:r}),F(!1)},[k,r,a]),l=S(O=>{const G=Ie(O!==void 0?O:i)||"";a({from:w,to:G}),x(!1)},[i,w,a]),f=S(()=>{T(null),a({from:"",to:r})},[r,a]),B=S(()=>{p(null),a({from:w,to:""})},[w,a]),K=!!w||!!r,$=ne(()=>{if(!K)return c;const O=[];return w&&O.push(Te(w)),r&&O.push(Te(r)),O.join(" - ")||c},[K,w,r,c]),{style:q,className:M}=Q(e,"ts-form-group"),U=ae(e);return React.createElement("div",{className:M,style:q},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:u,className:`ts-filter ts-popup-target ${K?"ts-filled":""}`,onClick:N,onMouseDown:O=>O.preventDefault(),role:"button",tabIndex:0},g&&React.createElement("span",{dangerouslySetInnerHTML:{__html:g}}),React.createElement("div",{className:"ts-filter-text"},$),React.createElement("div",{className:"ts-down-icon"})),React.createElement(te,{isOpen:b,target:u,title:"From",icon:g,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:h,onClear:f,onClose:()=>F(!1),className:`${E}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:U.style},React.createElement(Re,{value:k,onChange:v,onSelect:h}),React.createElement("div",{className:"ts-form-group",style:{marginTop:"12px",borderTop:"1px solid var(--ts-shade-5)",paddingTop:"12px"}},React.createElement("label",null,"To"),React.createElement("div",{className:`ts-filter ts-popup-target ${r?"ts-filled":""}`,onClick:O=>{O.stopPropagation(),F(!1),setTimeout(()=>y(),100)},role:"button",tabIndex:0},g&&React.createElement("span",{dangerouslySetInnerHTML:{__html:g}}),React.createElement("div",{className:"ts-filter-text"},r?Te(r):"Select end date")))),React.createElement(te,{isOpen:C,target:u,title:"To",icon:g,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:l,onClear:B,onClose:()=>x(!1),className:`${E}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:U.style},React.createElement(Re,{value:i,onChange:R,onSelect:l})))}function ot({config:e,filterData:t,value:n,onChange:a}){const m=n===!0||n==="true"||n==="1",E=g=>{g.preventDefault(),a(!m)},u=t.props?.placeholder||t.label||"Open now",{style:d,className:c}=Q(e,"ts-form-group switcher-label ts-inline-filter");return React.createElement("div",{className:c,style:d},React.createElement("label",null,React.createElement("div",{className:"switch-slider"},React.createElement("div",{className:"onoffswitch",onClick:E},React.createElement("input",{type:"checkbox",className:"onoffswitch-checkbox",checked:m,readOnly:!0}),React.createElement("label",{className:"onoffswitch-label",onClick:E}))),u))}function it({config:e,filterData:t,value:n,onChange:a,blockId:m}){const E=m?`voxel-popup-${m}`:"",u=z(null),[d,c]=P(!1),g=t.props||{},o=e.displayAs||t.props?.display_as||"popup",w=g.placeholder||t.label||"Order By",r=ne(()=>{const h=g.choices||{};return Array.isArray(h)?h:Object.entries(h).map(([l,f])=>({key:l,label:f.label||f,placeholder:f.placeholder||f.label||f,icon:f.icon||""}))},[g.choices]),b=t.icon||"",F=S(()=>{c(!0)},[]),C=S(h=>{a(h),o==="popup"&&c(!1)},[a,o]),x=S(()=>{a(null)},[a]),k=typeof n=="string"?n:"",T=!!k,i=r.find(h=>h.key===k),p=i?.placeholder||i?.label||w,N=()=>React.createElement("div",{className:"ts-term-dropdown ts-md-group"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list min-scroll"},r.map(h=>{const l=k===h.key;return React.createElement("li",{key:h.key,className:l?"ts-selected":""},React.createElement("a",{href:"#",className:"flexify",onClick:f=>{f.preventDefault(),C(h.key)}},React.createElement("div",{className:"ts-radio-container"},React.createElement("label",{className:"container-radio"},React.createElement("input",{type:"radio",value:h.key,checked:l,readOnly:!0,disabled:!0,hidden:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,h.label),h.icon&&React.createElement("div",{className:"ts-term-icon"},React.createElement("span",{dangerouslySetInnerHTML:{__html:h.icon}}))))})));if(o==="buttons"){const{style:h,className:l}=Q(e,"ts-form-group");return React.createElement("div",{className:l,style:h},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("ul",{className:"simplify-ul addon-buttons flexify"},r.map(f=>{const B=k===f.key;return React.createElement("li",{key:f.key,className:`flexify${B?" adb-selected":""}`,onClick:()=>C(f.key)},f.placeholder||f.label)})))}if(o==="alt-btn")return React.createElement(React.Fragment,null,r.map(h=>{const l=k===h.key,{style:f,className:B}=Q(e,"ts-form-group");return React.createElement("div",{key:h.key,className:B,style:f},!e.hideLabel&&React.createElement("label",null,h.label),React.createElement("div",{className:`ts-filter${l?" ts-filled":""}`,onClick:()=>C(h.key)},h.icon&&React.createElement("span",{dangerouslySetInnerHTML:{__html:h.icon}}),React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,h.placeholder||h.label))))}));const{style:y,className:v}=Q(e,"ts-form-group"),R=ae(e);return React.createElement("div",{className:v,style:y},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:u,className:`ts-filter ts-popup-target ${T?"ts-filled":""}`,onClick:F,onMouseDown:h=>h.preventDefault(),role:"button",tabIndex:0},b&&React.createElement("span",{dangerouslySetInnerHTML:{__html:b}}),React.createElement("div",{className:"ts-filter-text"},p),React.createElement("div",{className:"ts-down-icon"})),React.createElement(te,{isOpen:d,target:u,title:"",icon:b,saveLabel:"Save",clearLabel:"Clear",showClear:T,showSave:!1,onSave:()=>c(!1),onClear:x,onClose:()=>c(!1),className:`hide-head ${E}${e.popupCenterPosition?" ts-popup-centered":""}`.trim(),popupStyle:R.style},N()))}function ut({config:e,filterData:t,value:n,onChange:a,blockId:m}){const E=m?`voxel-popup-${m}`:"",[u,d]=P(!1),c=z(null),g=t.props||{},o=e.displayAs||t.props?.display_as||"popup",w=g.placeholder||t.label||"Status",r=ne(()=>{const R=g.choices||{};return Array.isArray(R)?R:Object.entries(R).map(([h,l])=>({key:h,label:l.label||l}))},[g.choices]),b=t.icon||"",F=S(R=>{a(R),d(!1)},[a]),C=S(()=>{d(!0)},[]),x=typeof n=="string"?n:"",k=!!x,T=r.find(R=>R.key===x),i=k&&T?.label||w,p=()=>React.createElement("div",{className:"ts-term-dropdown ts-md-group"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list min-scroll"},r.map(R=>{const h=x===R.key;return React.createElement("li",{key:R.key},React.createElement("a",{href:"#",className:"flexify",onClick:l=>{l.preventDefault(),F(R.key)}},React.createElement("div",{className:"ts-radio-container"},React.createElement("label",{className:"container-radio"},React.createElement("input",{type:"radio",value:R.key,checked:h,readOnly:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,R.label),b&&React.createElement("div",{className:"ts-term-icon"},React.createElement("span",{dangerouslySetInnerHTML:{__html:b}}))))})));if(o==="buttons")return React.createElement(React.Fragment,null,r.map(R=>{const h=x===R.key,{style:l,className:f}=Q(e,"ts-form-group");return React.createElement("div",{key:R.key,className:f,style:l},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter${h?" ts-filled":""}`,onClick:()=>a(R.key)},b&&React.createElement("span",{dangerouslySetInnerHTML:{__html:b}}),React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,R.label))))}));const{style:N,className:y}=Q(e,"ts-form-group"),v=ae(e);return React.createElement("div",{className:y,style:N},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:c,className:`ts-filter ts-popup-target ${k?"ts-filled":""}`,onClick:C,onMouseDown:R=>R.preventDefault(),role:"button",tabIndex:0},b&&React.createElement("span",{dangerouslySetInnerHTML:{__html:b}}),React.createElement("div",{className:"ts-filter-text"},i),React.createElement("div",{className:"ts-down-icon"})),React.createElement(te,{isOpen:u,target:c,title:"",icon:b,saveLabel:"Save",showSave:!1,showClear:!1,onSave:()=>d(!1),onClose:()=>d(!1),className:`hide-head ${E}${e.popupCenterPosition?" ts-popup-centered":""}`.trim(),popupStyle:v.style},p()))}function pt(e){const{userId:t,skip:n=!1}=e,[a,m]=P(null),[E,u]=P(!1),[d,c]=P(null),g=S(async()=>{if(!t||n){m(null);return}u(!0),c(null);try{const o=Me(),w=await fetch(`${o}voxel-fse/v1/search-form/user-data?user_id=${t}`);if(w.ok){const r=await w.json();m({id:r.id,name:r.name,avatar:r.avatar||""})}else m({id:t,name:"Unknown",avatar:""}),c("User not found")}catch(o){console.error("useUserData: Error fetching user data:",o),m({id:t,name:"Unknown",avatar:""}),c(o instanceof Error?o.message:"Failed to fetch user data")}finally{u(!1)}},[t,n]);return Y(()=>{g()},[g]),{userData:a,isLoading:E,error:d,refetch:g}}function mt({config:e,filterData:t,value:n}){const a=z(null),m=t.props||{},E=t.icon||"",u=m.user;let d;n!==void 0?d=n:t.value!==null&&t.value!==void 0?d=t.value:d=null;const c=d?Number(d):null,g=c!==null&&!isNaN(c)&&c>0,o=!!u?.name,{userData:w,isLoading:r}=pt({userId:g?c:null,skip:o}),b=o?{name:u.name,avatar:u.avatar||""}:w;if(!g)return null;const F=b?.name||(r?"Loading...":"Unknown"),{style:C,className:x}=Q(e,"ts-form-group");return React.createElement("div",{className:x,style:C},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:a,className:`ts-filter ts-popup-target ts-filled${r?" ts-loading":""}`},React.createElement("span",{dangerouslySetInnerHTML:{__html:E}}),React.createElement("div",{className:"ts-filter-text"},F)))}function dt({config:e,filterData:t,value:n,onChange:a,blockId:m}){const E=m?`voxel-popup-${m}`:"",u=z(null),d=z(null),[c,g]=P(!1),[o,w]=P(""),[r,b]=P([]),[F,C]=P(!1),x=t.props||{},k=x.placeholder||t.label||"Related",T=x.post,i=t.icon||"";Y(()=>{c&&(w(""),b([]),setTimeout(()=>d.current?.focus(),50))},[c]);const p=S(()=>{g(!0)},[]),N=S($=>{const q=$.target.value;w(q),q.length>=2?(C(!0),setTimeout(()=>{b([]),C(!1)},300)):b([])},[]),y=S(($,q)=>{a({id:$,title:q}),g(!1),w("")},[a]),v=S(()=>{a(null),w(""),b([])},[a]);let R=null;if(n!==void 0){const $=n;$===null?R=null:typeof $=="number"?R=$:typeof $=="object"&&$?.id&&(R=$.id)}else t.value!==null&&t.value!==void 0&&(R=typeof t.value=="number"?t.value:Number(t.value));const h=R!==null&&!isNaN(R)&&R>0;let l=k;if(h){const $=n;$&&typeof $=="object"&&$.title?l=$.title:T?.title&&(l=T.title)}const{style:f,className:B}=Q(e,"ts-form-group"),K=ae(e);return React.createElement("div",{className:B,style:f},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:u,className:`ts-filter ts-popup-target ${h?"ts-filled":""}`,onClick:p,onMouseDown:$=>$.preventDefault(),role:"button",tabIndex:0},i&&React.createElement("span",{dangerouslySetInnerHTML:{__html:i}}),React.createElement("div",{className:"ts-filter-text"},l),React.createElement("div",{className:"ts-down-icon"})),React.createElement(te,{isOpen:c,target:u,title:"",icon:i,saveLabel:"Save",clearLabel:"Clear",showClear:h,showSave:!1,onSave:()=>g(!1),onClear:v,onClose:()=>g(!1),className:`${E}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:K.style},React.createElement("div",{className:"ts-form-group"},React.createElement("div",{className:"flexify ts-input-icon"},React.createElement("span",null,se.search),React.createElement("input",{ref:d,type:"text",className:"inline-input",value:o,onChange:N,placeholder:"Search..."}))),F?React.createElement("div",{className:"ts-loading"},React.createElement("span",{className:"ts-loader"})):r.length>0?React.createElement("div",{className:"ts-term-dropdown"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},r.map($=>React.createElement("li",{key:$.id},React.createElement("a",{href:"#",className:"flexify",onClick:q=>{q.preventDefault(),y($.id,$.title)}},React.createElement("span",null,$.title)))))):o.length>=2?React.createElement("div",{className:"ts-empty-user-tab"},i&&React.createElement("span",{dangerouslySetInnerHTML:{__html:i}}),React.createElement("p",null,"No results found")):null))}function xe({config:e,filterData:t,value:n,onChange:a}){const[m,E]=P(!1),[u,d]=P(""),[c,g]=P([]),[o,w]=P(!1),r=z(null),b=t.props||{},F=b.placeholder||t.label||"Following",C=b.user,x=t.icon||"",k=l=>{const f=l.target.value;d(f),f.length>=2?(w(!0),setTimeout(()=>{g([]),w(!1)},300)):g([])},T=(l,f)=>{a({id:l,name:f}),E(!1),d("")},i=l=>{l.preventDefault(),E(!m)};Y(()=>{const l=f=>{r.current&&!r.current.contains(f.target)&&E(!1)};return m&&document.addEventListener("mousedown",l),()=>{document.removeEventListener("mousedown",l)}},[m]);let p=null;if(n!==void 0){const l=n;l===null?p=null:typeof l=="number"?p=l:typeof l=="object"&&l?.id&&(p=l.id)}else t.value!==null&&t.value!==void 0&&(p=typeof t.value=="number"?t.value:Number(t.value));const N=p!==null&&!isNaN(p)&&p>0;let y=F;if(N){const l=n;l&&typeof l=="object"&&l.name?y=l.name:C?.name&&(y=C.name)}const{style:v,className:R}=Q(e,"ts-form-group"),h=ae(e);return React.createElement("div",{className:R,style:v,ref:r},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter ts-popup-target ${N?"ts-filled":""}`,onClick:i,onMouseDown:l=>l.preventDefault(),role:"button",tabIndex:0},x&&React.createElement("span",{dangerouslySetInnerHTML:{__html:x}}),React.createElement("div",{className:"ts-filter-text"},y),React.createElement("div",{className:"ts-down-icon"})),m&&React.createElement("div",{className:"ts-field-popup-container"},React.createElement("div",{className:h.className,style:h.style},React.createElement("div",{className:"ts-popup-content-wrapper min-scroll"},React.createElement("div",{className:"ts-form-group"},React.createElement("div",{className:"flexify ts-input-icon"},React.createElement("span",null,se.search),React.createElement("input",{type:"text",className:"inline-input",value:u,onChange:k,placeholder:"Search..."}))),o?React.createElement("div",{className:"ts-loading"},React.createElement("span",{className:"ts-loader"})):c.length>0?React.createElement("div",{className:"ts-term-dropdown"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},c.map(l=>React.createElement("li",{key:l.id},React.createElement("a",{href:"#",className:"flexify",onClick:f=>{f.preventDefault(),T(l.id,l.name)}},React.createElement("span",null,l.name)))))):u.length>=2?React.createElement("div",{className:"ts-empty-user-list"},React.createElement("span",null,"No results found")):null))))}function ft({config:e,filterData:t,value:n,onChange:a}){const[m,E]=P(!1),[u,d]=P(""),[c,g]=P([]),[o,w]=P(!1),r=z(null),b=t.props||{},F=b.placeholder||t.label||"Following Post",C=b.post,x=t.icon||"",k=l=>{const f=l.target.value;d(f),f.length>=2?(w(!0),setTimeout(()=>{g([]),w(!1)},300)):g([])},T=(l,f)=>{a({id:l,title:f}),E(!1),d("")},i=l=>{l.preventDefault(),E(!m)};Y(()=>{const l=f=>{r.current&&!r.current.contains(f.target)&&E(!1)};return m&&document.addEventListener("mousedown",l),()=>{document.removeEventListener("mousedown",l)}},[m]);let p=null;if(n!==void 0){const l=n;l===null?p=null:typeof l=="number"?p=l:typeof l=="object"&&l?.id&&(p=l.id)}else t.value!==null&&t.value!==void 0&&(p=typeof t.value=="number"?t.value:Number(t.value));const N=p!==null&&!isNaN(p)&&p>0;let y=F;if(N){const l=n;l&&typeof l=="object"&&l.title?y=l.title:C?.title&&(y=C.title)}const{style:v,className:R}=Q(e,"ts-form-group"),h=ae(e);return React.createElement("div",{className:R,style:v,ref:r},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter ts-popup-target ${N?"ts-filled":""}`,onClick:i,onMouseDown:l=>l.preventDefault(),role:"button",tabIndex:0},x&&React.createElement("span",{dangerouslySetInnerHTML:{__html:x}}),React.createElement("div",{className:"ts-filter-text"},y),React.createElement("div",{className:"ts-down-icon"})),m&&React.createElement("div",{className:"ts-field-popup-container"},React.createElement("div",{className:h.className,style:h.style},React.createElement("div",{className:"ts-popup-content-wrapper min-scroll"},React.createElement("div",{className:"ts-form-group"},React.createElement("div",{className:"flexify ts-input-icon"},React.createElement("span",null,se.search),React.createElement("input",{type:"text",className:"inline-input",value:u,onChange:k,placeholder:"Search posts..."}))),o?React.createElement("div",{className:"ts-loading"},React.createElement("span",{className:"ts-loader"})):c.length>0?React.createElement("div",{className:"ts-term-dropdown"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},c.map(l=>React.createElement("li",{key:l.id},React.createElement("a",{href:"#",className:"flexify",onClick:f=>{f.preventDefault(),T(l.id,l.title)}},React.createElement("span",null,l.title)))))):u.length>=2?React.createElement("div",{className:"ts-empty-user-list"},React.createElement("span",null,"No posts found")):null))))}function ht({config:e,filterData:t,value:n,onChange:a}){const m=n===!0||n==="true"||n==="1",E=c=>{c.preventDefault(),a(!m)},{style:u,className:d}=Q(e,"ts-form-group switcher-label ts-inline-filter");return React.createElement("div",{className:d,style:u},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("label",{className:`onoffswitch ts-${m?"on":"off"}`,onClick:E},React.createElement("input",{type:"checkbox",className:"onoffswitch-checkbox",checked:m,readOnly:!0}),React.createElement("span",{className:"onoffswitch-trigger"})))}function yt({config:e,filterData:t}){const n=t.props?.description||"",{style:a,className:m}=Q(e,"ts-form-group ui-heading");return React.createElement("div",{className:m,style:a},React.createElement("label",null,e.label||t.label,n&&React.createElement("small",null,n)))}function Rt({postTypes:e,currentPostType:t,onChange:n,blockId:a,style:m}){const E=a?`voxel-popup-${a}`:"",[u,d]=P(!1),c=z(null),g=S(x=>{n(x),d(!1)},[n]),o=S(()=>{d(!0)},[]),w=e.find(x=>x.key===t),r=w?.label||"Select type",b=!!t,F=w?.icon||"",C=()=>React.createElement("div",{className:"ts-term-dropdown ts-md-group"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list min-scroll"},e.map(x=>{const k=t===x.key;return React.createElement("li",{key:x.key},React.createElement("a",{href:"#",className:"flexify",onClick:T=>{T.preventDefault(),g(x.key)}},React.createElement("div",{className:"ts-radio-container"},React.createElement("label",{className:"container-radio"},React.createElement("input",{type:"radio",checked:k,disabled:!0,hidden:!0,readOnly:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,x.label),React.createElement("div",{className:"ts-term-icon ts-pull-right"},x.icon&&React.createElement("span",{dangerouslySetInnerHTML:{__html:x.icon}}))))})));return React.createElement("div",{className:"ts-form-group choose-cpt-filter",style:m},React.createElement("label",null,"Post type"),React.createElement("div",{ref:c,className:`ts-filter ts-popup-target ${b?"ts-filled":""}`,onClick:o,onMouseDown:x=>x.preventDefault(),role:"button",tabIndex:0},F&&React.createElement("span",{dangerouslySetInnerHTML:{__html:F}}),React.createElement("div",{className:"ts-filter-text"},r),React.createElement("div",{className:"ts-down-icon"})),React.createElement(te,{isOpen:u,target:c,title:"",icon:F,saveLabel:"Save",showSave:!1,showClear:!1,onSave:()=>d(!1),onClose:()=>d(!1),className:`hide-head ${E}`.trim()},C()))}const Et={"common:is_empty":(e,t)=>t==null||t==="","common:is_not_empty":(e,t)=>t!=null&&t!=="","text:equals":(e,t)=>t===e.value,"text:not_equals":(e,t)=>t!==e.value,"text:contains":(e,t)=>typeof t!="string"||!e.value?!1:new RegExp(e.value,"i").test(t),"taxonomy:contains":(e,t)=>typeof t!="string"||!e.value?!1:t.split(",").includes(e.value),"taxonomy:not_contains":(e,t)=>typeof t!="string"||!e.value?!0:!t.split(",").includes(e.value),"number:equals":(e,t)=>{const n=parseFloat(String(t)),a=parseFloat(e.value||"0");return n===a},"number:not_equals":(e,t)=>{const n=parseFloat(String(t)),a=parseFloat(e.value||"0");return n!==a},"number:gt":(e,t)=>{const n=parseFloat(String(t)),a=parseFloat(e.value||"0");return n>a},"number:gte":(e,t)=>{const n=parseFloat(String(t)),a=parseFloat(e.value||"0");return n>=a},"number:lt":(e,t)=>{const n=parseFloat(String(t)),a=parseFloat(e.value||"0");return n<a},"number:lte":(e,t)=>{const n=parseFloat(String(t)),a=parseFloat(e.value||"0");return n<=a}};function vt(e,t,n){const a=Et[e.type];if(!a)return console.warn(`[filterConditions] Unknown condition type: ${e.type}`),!1;let m=t;return n==="order-by"&&typeof t=="string"&&t.length>0&&(m=t.split("(")[0]),a(e,m)}function bt(e,t="show",n,a){if(!e||e.length===0)return!0;let m=!1;return e.forEach(E=>{if(!E.length)return;let u=!0;E.forEach(d=>{const c=n[d.source],o=a[d.source]?.type;vt(d,c,o)||(u=!1)}),u&&(m=!0)}),t==="hide"?!m:m}function gt(e,t,n){return bt(e.conditions,e.conditions_behavior||"show",t,n)}function Nt(){const e=()=>{if(typeof window>"u")return"desktop";const a=window.innerWidth;return a<=767?"mobile":a<=1024?"tablet":"desktop"},[t,n]=P(e);return Y(()=>{const a=()=>{n(e())};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),t}function Ft({attributes:e,postTypes:t,context:n,editorDeviceType:a,onSubmit:m,onPostTypeChange:E,onFilterChange:u}){z(null);const d=z(null),{state:c,setCurrentPostType:g,setFilterValue:o,togglePortal:w,submit:r,clearAll:b,narrowedValues:F,narrowingFilters:C}=Ue({attributes:e,postTypes:t,context:n,onSubmit:m,onPostTypeChange:E,onFilterChange:u}),[x,k]=P(""),[T,i]=P("");Y(()=>{const s=async()=>{const D=e.searchButtonText??"";if(ke(D)){const _=_e(D),X=await Ve(_);k(X)}else k(D)},G=async()=>{const D=e.resetButtonText??"Reset";if(ke(D)){const _=_e(D),X=await Ve(_);i(X)}else i(D)};s(),G()},[e.searchButtonText,e.resetButtonText]),Y(()=>{if(!c.portalActive)return;const s=G=>{G.key==="Escape"&&w()};return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[c.portalActive,w]),Y(()=>{if(!c.portalActive)return;const s=D=>{const _=D.target;d.current?.contains(_)||n==="editor"&&(_.closest(".interface-interface-skeleton__sidebar")||_.closest(".edit-post-sidebar")||_.closest(".block-editor-block-inspector")||_.closest(".components-popover")||_.closest(".components-modal"))||w()},G=requestAnimationFrame(()=>{document.addEventListener("mousedown",s)});return()=>{cancelAnimationFrame(G),document.removeEventListener("mousedown",s)}},[c.portalActive,w,n]),Y(()=>{if(n!=="frontend")return;const s=G=>{const D=G;D.detail?.searchFormId&&D.detail.searchFormId!==e.blockId||b()};return window.addEventListener("voxel-search-clear",s),()=>window.removeEventListener("voxel-search-clear",s)},[n,e.blockId,b]);const p=t.find(s=>s.key===c.currentPostType),N=e.filterLists?.[c.currentPostType]||[],y=s=>{r()},v=(s=!1)=>{b(s)},R={};p?.filters?.forEach(s=>{R[s.key]=s});const h=s=>{if(!(n==="frontend"?Ge(s):!0))return null;const D=s;if(n==="frontend"&&D.conditions&&!gt(D,c.filterValues,R))return null;const _=p?.filters?.find(L=>L.key===s.filterKey);if(!_)return null;const X={..._,value:s.defaultValueEnabled&&s.defaultValue!==void 0?s.defaultValue:_.value},W={config:s,filterData:X,value:c.filterValues[s.filterKey],onChange:L=>o(s.filterKey,L),narrowedValues:F,isNarrowing:C,blockId:e.blockId,context:n};switch(_.type){case"keywords":return React.createElement(Je,{key:s.id,...W});case"range":return React.createElement(Ye,{key:s.id,...W});case"stepper":return React.createElement(Xe,{key:s.id,...W});case"terms":return React.createElement(et,{key:s.id,...W});case"location":return React.createElement(nt,{key:s.id,...W});case"availability":return React.createElement(lt,{key:s.id,...W});case"date":return React.createElement(rt,{key:s.id,...W});case"recurring-date":return React.createElement(ct,{key:s.id,...W});case"open-now":return React.createElement(ot,{key:s.id,...W});case"order-by":return React.createElement(it,{key:s.id,...W});case"post-status":return React.createElement(ut,{key:s.id,...W});case"user":return React.createElement(mt,{key:s.id,...W});case"relations":return React.createElement(dt,{key:s.id,...W});case"following":return React.createElement(xe,{key:s.id,...W});case"followed-by":return React.createElement(xe,{key:s.id,...W});case"following-user":return React.createElement(xe,{key:s.id,...W});case"following-post":return React.createElement(ft,{key:s.id,...W});case"switcher":return React.createElement(ht,{key:s.id,...W});case"ui-heading":return React.createElement(yt,{key:s.id,...W});default:return null}},l=(s=!0)=>React.createElement("div",{className:"ts-filter-wrapper flexify"},e.showPostTypeFilter&&t.length>1&&React.createElement(Rt,{postTypes:t,currentPostType:c.currentPostType,onChange:g,style:O()}),N.map(G=>h(G)),s&&e.showSearchButton&&React.createElement("div",{className:"ts-form-group flexify ts-form-submit",id:"sf_submit",style:U("search")},React.createElement("button",{type:"button",onClick:()=>y(),className:`ts-btn ts-btn-2 ts-btn-large ts-search-btn ${c.loading&&!c.resetting?"ts-loading-btn":""}`},c.loading&&!c.resetting&&React.createElement("div",{className:"ts-loader-wrapper"},React.createElement("span",{className:"ts-loader"})),Ne(e.searchButtonIcon,se.search),x&&x)),s&&e.showResetButton&&React.createElement("div",{className:"ts-form-group flexify ts-form-reset",style:U("reset")},React.createElement("a",{href:"#",onClick:G=>{G.preventDefault(),v(!1)},className:"ts-filter",role:"button"},Ne(e.resetButtonIcon,se.reload),T&&React.createElement("div",{className:"ts-filter-text"},T)))),f=Nt(),B=n==="editor"&&a?a:f,K=B==="desktop"&&(e.formToggleDesktop??!1)||B==="tablet"&&(e.formToggleTablet??!0)||B==="mobile"&&(e.formToggleMobile??!0),$=K,q=!K,M={postTypes:t.map(s=>({key:s.key,label:s.label,filters:s.filters})),currentPostType:c.currentPostType,filterLists:e.filterLists||{},portalMode:e.portalMode||{desktop:!1,tablet:!1,mobile:!1},showPostTypeFilter:e.showPostTypeFilter??!0,showSearchButton:e.showSearchButton??!0,showResetButton:e.showResetButton??!1,searchButtonText:e.searchButtonText||"",resetButtonText:e.resetButtonText||"",formToggleDesktop:e.formToggleDesktop??!1,formToggleTablet:e.formToggleTablet??!0,formToggleMobile:e.formToggleMobile??!0,searchButtonWidth:e.searchButtonWidth,searchButtonWidth_tablet:e.searchButtonWidth_tablet,searchButtonWidth_mobile:e.searchButtonWidth_mobile,searchButtonWidthUnit:e.searchButtonWidthUnit||"%",resetButtonWidth:e.resetButtonWidth,resetButtonWidth_tablet:e.resetButtonWidth_tablet,resetButtonWidth_mobile:e.resetButtonWidth_mobile,resetButtonWidthUnit:e.resetButtonWidthUnit||"%"},U=s=>{const G=s==="search"?e.searchButtonWidthUnit||"%":e.resetButtonWidthUnit||"%";let D;return s==="search"?B==="mobile"?D=e.searchButtonWidth_mobile??e.searchButtonWidth_tablet??e.searchButtonWidth:B==="tablet"?D=e.searchButtonWidth_tablet??e.searchButtonWidth:D=e.searchButtonWidth:B==="mobile"?D=e.resetButtonWidth_mobile??e.resetButtonWidth_tablet??e.resetButtonWidth:B==="tablet"?D=e.resetButtonWidth_tablet??e.resetButtonWidth:D=e.resetButtonWidth,D!==void 0?{width:`${D}${G}`,flexGrow:0,flexShrink:0}:{}},O=()=>{let s;return B==="mobile"?s=e.postTypeFilterWidth_mobile??e.postTypeFilterWidth_tablet??e.postTypeFilterWidth:B==="tablet"?s=e.postTypeFilterWidth_tablet??e.postTypeFilterWidth:s=e.postTypeFilterWidth,s!==void 0?{width:`${s}%`,flexGrow:0,flexShrink:0}:{}};return React.createElement(React.Fragment,null,React.createElement("div",{className:"ts-form ts-search-widget","data-v-app":""},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(M)}}),$&&React.createElement("div",{className:"ts-filter-wrapper flexify"},React.createElement("a",{href:"#",onClick:s=>{s.preventDefault(),w()},onMouseDown:s=>s.preventDefault(),className:`ts-filter-toggle ts-btn ts-btn-1 ${c.activeFilterCount>0?"ts-filled":""}`,role:"button","aria-expanded":c.portalActive},se.filterslider,React.createElement("div",{className:"ts-toggle-text"},"Filter results"),c.activeFilterCount>0&&React.createElement("span",{className:"ts-filter-count"},c.activeFilterCount))),React.createElement("form",{method:"GET",onSubmit:s=>(s.preventDefault(),!1)},q&&React.createElement("div",{className:"ts-inline-filters"},l())),React.createElement("div",{className:"hidden"},React.createElement("div",{className:"ts-search-portal"}))),c.portalActive&&Ae(React.createElement("div",{className:`ts-search-portal vx-popup elementor voxel-fse-search-form-${e.blockId}`,"data-voxel-id":e.blockId},React.createElement("div",{className:"ts-popup-root elementor-element"},React.createElement("div",{className:"ts-form ts-search-widget no-render elementor-element"},React.createElement("div",{className:"ts-field-popup-container"},React.createElement("div",{className:"ts-field-popup triggers-blur",ref:d},React.createElement("div",{className:"ts-popup-content-wrapper min-scroll"},React.createElement("div",{className:"ts-form-group"},l())),React.createElement("div",{className:"ts-popup-controller"},React.createElement("ul",{className:"flexify simplify-ul"},React.createElement("li",{className:"flexify ts-popup-close"},React.createElement("a",{href:"#",onClick:s=>{s.preventDefault(),w()},className:"ts-icon-btn",role:"button","aria-label":"Close"},Ne(e.closeIcon,se.close))),React.createElement("li",{className:"flexify hide-d"},React.createElement("a",{href:"#",onClick:s=>{s.preventDefault(),v(!0)},className:"ts-icon-btn",role:"button"},se.reload)),React.createElement("li",{className:"flexify hide-m"},React.createElement("a",{href:"#",onClick:s=>{s.preventDefault(),v(!0)},className:"ts-btn ts-btn-1",role:"button"},"Clear")),React.createElement("li",{className:"flexify"},React.createElement("a",{href:"#",onClick:s=>{s.preventDefault(),y(),w()},className:"ts-btn ts-btn-2",role:"button"},"Search"))))))))),document.body))}export{Ft as S};
