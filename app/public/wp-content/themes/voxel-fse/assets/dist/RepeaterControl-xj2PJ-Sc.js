import{__ as l}from"@wordpress/i18n";import{Button as C,TextControl as H,SelectControl as K}from"@wordpress/components";import{S as M,q as X}from"./TypographyPopup-BXz72zyZ.js";import{b as Y,d as P,s as Z,K as A,P as ee,D as te,c as ae,S as oe,v as le,a as ne,u as se,C as re}from"./RepeaterControl-BJok1GGr.js";import{useState as ce,useEffect as ie,useCallback as D}from"react";import{useSelect as me}from"@wordpress/data";function Re({rowVisibility:r="show",visibilityRules:t=[],onRowVisibilityChange:m,onEditVisibilityRules:u,onClearVisibilityRules:y,showLoopSection:R=!1,loopSource:g,loopProperty:S,loopLimit:w,loopOffset:h,onEditLoop:d,onClearLoop:b,onLoopLimitChange:p,onLoopOffsetChange:x,inlineVisibilityLayout:c=!1,className:I=""}){const s=t&&t.length>0,i=!!g;return React.createElement("div",{className:`voxel-fse-loop-visibility-wrapper ${I}`.trim()},R&&React.createElement("div",{className:"voxel-fse-loop-section"},React.createElement(M,{label:l("Loop repeater row","voxel-fse")}),i?React.createElement("p",{className:"voxel-fse-loop-source"},"@",g,"(",S||"",")"):React.createElement("p",{className:"voxel-fse-control-note"},l("No loop configured","voxel-fse")),React.createElement("div",{className:"voxel-fse-filter-actions-row"},React.createElement(C,{variant:"primary",onClick:d},l("Edit loop","voxel-fse")),i&&b&&React.createElement(C,{variant:"secondary",onClick:b},l("Remove","voxel-fse"))),i&&React.createElement(React.Fragment,null,React.createElement("div",{className:"voxel-fse-loop-field"},React.createElement(H,{label:l("Loop limit","voxel-fse"),help:l("If a hard limit is set, the loop will stop there even if there are additional items left","voxel-fse"),value:String(w??""),onChange:n=>p?.(n),type:"number"})),React.createElement("div",{className:"voxel-fse-loop-field"},React.createElement(H,{label:l("Loop offset","voxel-fse"),help:l("Skip a set amount of items from the start of the loop","voxel-fse"),value:String(h??""),onChange:n=>x?.(n),type:"number"})))),React.createElement("div",{className:"voxel-fse-visibility-section"},React.createElement(M,{label:l("Row visibility","voxel-fse")}),c?React.createElement("div",{className:"voxel-fse-row-visibility-header"},React.createElement("label",{className:"components-base-control__label"},l("Row visibility","voxel-fse")),React.createElement(K,{value:r,options:[{label:l("Show this row if","voxel-fse"),value:"show"},{label:l("Hide this row if","voxel-fse"),value:"hide"}],onChange:n=>m(n),__nextHasNoMarginBottom:!0})):React.createElement(K,{value:r,options:[{label:l("Show this row if","voxel-fse"),value:"show"},{label:l("Hide this row if","voxel-fse"),value:"hide"}],onChange:n=>m(n),__nextHasNoMarginBottom:!0}),s?React.createElement("div",{className:"voxel-fse-visibility-rules-display"},t.map((n,E)=>React.createElement("p",{key:n.id||E,className:"voxel-fse-visibility-rule-text"},X(n)))):React.createElement("p",{className:"voxel-fse-control-note"},l("No visibility rules added.","voxel-fse")),React.createElement("div",{className:"voxel-fse-filter-actions-row"},React.createElement(C,{variant:"primary",onClick:u},l("Edit rules","voxel-fse")),s&&React.createElement(C,{variant:"secondary",onClick:y},l("Remove","voxel-fse")))))}const _=()=>"item_"+Math.random().toString(36).substr(2,9),ge=_,v=r=>r.id||r._id||"";function de({item:r,index:t,isExpanded:m,onToggleExpand:u,onUpdate:y,onRemove:R,onClone:g,getItemLabel:S,renderContent:w,showClone:h=!0,showDelete:d=!0}){const b=v(r),{attributes:p,listeners:x,setNodeRef:c,transform:I,transition:s,isDragging:i}=se({id:b}),n={transform:re.Transform.toString(I),transition:s,opacity:1,zIndex:i?1e3:"auto"},E=S(r,t);return React.createElement("div",{ref:c,style:n,className:`voxel-fse-repeater-item ${m?"is-expanded":""} ${i?"is-dragging":""}`},React.createElement("div",{className:"voxel-fse-repeater-item-header",...p,...x,onClick:u,role:"button",tabIndex:0,onKeyDown:f=>{(f.key==="Enter"||f.key===" ")&&u()}},React.createElement("span",{className:"voxel-fse-repeater-item-label"},E),React.createElement("span",{className:"voxel-fse-repeater-item-actions"},h&&React.createElement("button",{type:"button",className:"voxel-fse-repeater-action-btn voxel-fse-repeater-clone",onClick:f=>{f.stopPropagation(),g()},title:l("Clone","voxel-fse")},React.createElement("i",{className:"eicon-copy"})),d&&React.createElement("button",{type:"button",className:"voxel-fse-repeater-action-btn voxel-fse-repeater-delete",onClick:f=>{f.stopPropagation(),R()},title:l("Delete","voxel-fse")},React.createElement("i",{className:"eicon-close"})))),m&&React.createElement("div",{className:"voxel-fse-repeater-item-content"},w({item:r,index:t,onUpdate:y,onRemove:R})))}function he({label:r,items:t,onChange:m,getItemLabel:u,renderContent:y,createItem:R,addButtonText:g=l("Add Item","voxel-fse"),showClone:S=!0,showDelete:w=!0,minItems:h=0,maxItems:d,className:b="",attributes:p,setAttributes:x,stateAttribute:c="repeaterExpandedItem"}){const I=me(e=>e("core/block-editor").getSelectedBlockClientId(),[]),s=I?`voxel_repeater_${I}_${c}`:null,i=!!(p&&x),[n,E]=ce(()=>{if(i&&p[c]!==void 0)return p[c];if(s){const e=sessionStorage.getItem(s);if(e){if(t.some(a=>v(a)===e))return e;sessionStorage.removeItem(s)}}return null});ie(()=>{const e=p?.[c];if(i&&e!==void 0&&e!==n){E(e);return}if(n===null&&s){const o=sessionStorage.getItem(s);o&&t.some(a=>v(a)===o)&&E(o)}},[i,p?.[c],n,s,t,c]);const f=n,k=D(e=>{s&&(e?sessionStorage.setItem(s,e):sessionStorage.removeItem(s)),i&&x({[c]:e}),E(e)},[s,i,x,c]),F=Y(P(ee,{activationConstraint:{distance:8}}),P(A,{coordinateGetter:Z})),V=D((e,o)=>`Item #${o+1}`,[]),z=u||V,G=D(()=>({_id:_()}),[]),T=R||G,q=e=>{const{active:o,over:a}=e;if(a&&o.id!==a.id){const N=t.findIndex(L=>v(L)===o.id),B=t.findIndex(L=>v(L)===a.id);N!==-1&&B!==-1&&m(ne(t,N,B))}},U=()=>{if(d&&t.length>=d)return;const e=T(),o=v(e);m([...t,e]),k(o)},j=e=>{t.length<=h||(m(t.filter(o=>v(o)!==e)),f===e&&k(null))},J=(e,o)=>{m(t.map(a=>v(a)===e?{...a,...o}:a))},O=(e,o)=>{if(d&&t.length>=d)return;const a={...e};a._id?a._id=_():a.id=_();const N=[...t.slice(0,o+1),a,...t.slice(o+1)];m(N)},Q=t.map(e=>v(e)),$=!d||t.length<d,W=t.length>h;return React.createElement("div",{className:`voxel-fse-repeater-control ${b}`},r&&React.createElement("span",{className:"voxel-fse-repeater-label"},r),React.createElement("div",{className:"voxel-fse-repeater-items"},React.createElement(te,{sensors:F,collisionDetection:ae,onDragEnd:q},React.createElement(oe,{items:Q,strategy:le},t.map((e,o)=>{const a=v(e);return React.createElement(de,{key:a,item:e,index:o,isExpanded:f===a,onToggleExpand:()=>k(f===a?null:a),onUpdate:N=>J(a,N),onRemove:()=>j(a),onClone:()=>O(e,o),getItemLabel:z,renderContent:y,showClone:S&&$,showDelete:w&&W})}))),$&&React.createElement(C,{variant:"secondary",onClick:U,className:"voxel-fse-repeater-add-btn"},React.createElement("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},React.createElement("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})),g)))}export{Re as L,he as R,ge as g};
