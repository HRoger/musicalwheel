import{useState as q,useRef as G,useMemo as ce,useEffect as Y,useCallback as v}from"react";import{createPortal as Te}from"react-dom";import{useSelect as Ue}from"@wordpress/data";import{a as Be}from"./siteUrl-7x5eJEvc.js";import He from"@wordpress/api-fetch";import{V as oe,r as Ne}from"./voxelIcons-B76o57vm.js";import"./voxelShim-DB_Ue-9R.js";import"./backgroundElements-Ui-iCrLV.js";import"./MediaPopup-M_962PvX.js";import{F as ie,D as $e}from"./DatePicker-pD2Z7qly.js";function je(e,t){const n={},s=[t];return e.width&&e.width>0&&(n.width=`${e.width}%`,n.flexGrow=0,n.flexShrink=0),e.hideFilter&&s.push("vx-hidden"),e.alignContent&&(n.justifyContent=e.alignContent),e.hideLabel&&s.push("hide-label"),{style:n,className:s.join(" ")}}function ee(e,t){return je(e,t)}function de(e){const t={},n=["ts-field-popup","triggers-blur"];return e.customPopupEnabled&&(e.popupMinWidth&&e.popupMinWidth>0&&(t.minWidth=`${e.popupMinWidth}px`),e.popupMaxWidth&&e.popupMaxWidth>0&&(t.maxWidth=`${e.popupMaxWidth}px`),e.popupMaxHeight&&e.popupMaxHeight>0&&(t.maxHeight=`${e.popupMaxHeight}px`),e.popupCenterPosition&&n.push("ts-popup-centered")),{style:t,className:n.join(" ")}}function qe({attributes:e,postTypes:t,context:n,onSubmit:s,onPostTypeChange:u,onFilterChange:y}){const[r,o]=q(()=>({currentPostType:e.postTypes[0]||"",filterValues:{},activeFilterCount:0,portalActive:!1,loading:!1,resetting:!1,narrowedValues:null,narrowingFilters:!1,lastModifiedFilter:null})),b=G(!1),f=G(!1),m=G(null),$=ce(()=>t.find(x=>x.key===r.currentPostType),[t,r.currentPostType]),E=ce(()=>e.filterLists[r.currentPostType]||[],[e.filterLists,r.currentPostType]);Y(()=>{e.postTypes.length>0&&!e.postTypes.includes(r.currentPostType)&&o(x=>({...x,currentPostType:e.postTypes[0],filterValues:{}}))},[e.postTypes,r.currentPostType]),Y(()=>{if(!$?.filters)return;const x={};let d=!1;$.filters.forEach(h=>{h.key in r.filterValues||h.value!==null&&h.value!==void 0&&(x[h.key]=h.value,d=!0)}),d&&o(h=>({...h,filterValues:{...h.filterValues,...x}}))},[$?.filters,r.currentPostType]),Y(()=>{if(n!=="editor"||r.resetting||!$?.filters)return;(e.filterLists?.[r.currentPostType]||[]).forEach(d=>{const h=r.filterValues[d.filterKey];d.defaultValueEnabled&&d.defaultValue!==void 0&&d.defaultValue!==""&&d.defaultValue!==null?h!==d.defaultValue&&h!==null&&o(p=>({...p,filterValues:{...p.filterValues,[d.filterKey]:d.defaultValue}})):h!=null&&o(p=>({...p,filterValues:{...p.filterValues,[d.filterKey]:void 0}}))})},[n,r.currentPostType,e.filterLists,r.resetting,$?.filters]),Y(()=>{const x=Object.values(r.filterValues).filter(d=>d!=null&&d!==""&&d!==!1).length;o(d=>({...d,activeFilterCount:x}))},[r.filterValues]);const P=v(x=>{o(d=>d.currentPostType===x?d:{...d,currentPostType:x,filterValues:{}}),n==="editor"&&u&&u(x),n==="editor"&&y&&y({}),n==="frontend"&&s&&(f.current&&e.updateUrl!==!1&&_e({},x),f.current=!0,setTimeout(()=>{s({postType:x})},50))},[n,s,u,y,e.updateUrl]),g=v((x,d)=>{f.current=!0,o(h=>{const p={...h.filterValues,[x]:d};return n==="editor"&&y&&setTimeout(()=>y(p),0),{...h,filterValues:p,lastModifiedFilter:x}})},[n,y]),D=v((x=!1)=>{const d={};$?.filters?.forEach(p=>{p.resets_to!==null&&p.resets_to!==void 0?d[p.key]=p.resets_to:d[p.key]=null});const h=Object.values(d).filter(p=>p!=null&&p!=="").length;if(o(p=>({...p,filterValues:d,activeFilterCount:h,resetting:!0,portalActive:x?!1:p.portalActive,narrowedValues:null,lastModifiedFilter:null})),setTimeout(()=>{o(p=>({...p,resetting:!1}))},100),n==="editor"&&y&&y(d),n==="frontend"){e.updateUrl!==!1&&Ke(r.currentPostType);const p=new CustomEvent("voxel-search-clear",{detail:{postType:r.currentPostType}});window.dispatchEvent(p)}},[n,r.currentPostType,y,e.updateUrl,$?.filters]),F=v(()=>{o(x=>({...x,portalActive:!x.portalActive}))},[]),_=v(async()=>{if(!e.adaptiveFiltering||n!=="frontend")return;if(b.current){b.current=!1;return}const x=E.filter(p=>p.type==="range"||p.type==="terms");if(x.length===0)return;const d=new URLSearchParams;d.set("type",r.currentPostType),r.lastModifiedFilter&&d.set("_last_modified",r.lastModifiedFilter),Object.entries(r.filterValues).forEach(([p,N])=>{N!=null&&N!==""&&(Array.isArray(N)?d.set(p,N.join(",")):typeof N=="object"?d.set(p,JSON.stringify(N)):d.set(p,String(N)))});const h=[];x.forEach(p=>{if(p.type==="terms"){const N=$?.filters?.find(a=>a.key===p.filterKey);if(N?.props?.terms){const a=C=>{C.forEach(J=>{J.term_taxonomy_id&&h.push(J.term_taxonomy_id),J.children&&Array.isArray(J.children)&&a(J.children)})};a(N.props.terms)}}}),o(p=>({...p,narrowingFilters:!0}));try{const p=Be(),N=await fetch(`${p}voxel-fse/v1/search-form/narrow-filters?${d.toString()}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({term_taxonomy_ids:h})});if(!N.ok)throw new Error(`HTTP ${N.status}`);const a=await N.json();a.success&&a.data?(o(C=>({...C,narrowedValues:{ranges:a.data.ranges||{},terms:a.data.terms||{}},narrowingFilters:!1})),b.current=!0):o(C=>({...C,narrowingFilters:!1}))}catch(p){console.error("[useSearchForm] Adaptive filtering error:",p),o(N=>({...N,narrowingFilters:!1}))}},[e.adaptiveFiltering,n,E,r.currentPostType,r.filterValues,$]);Y(()=>{if(!(!e.adaptiveFiltering||n!=="frontend"))return m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{_()},300),()=>{m.current&&clearTimeout(m.current)}},[r.filterValues,e.adaptiveFiltering,n,_]);const S=v((x,d)=>{o(h=>({...h,loading:!0})),s&&s({postType:d,...x}),n==="frontend"&&e.updateUrl!==!1&&f.current&&_e(x,d),o(h=>({...h,loading:!1}))},[n,s,e.updateUrl]),W=G(null);Y(()=>{if(e.searchOn==="change"&&n==="frontend"){const x=JSON.stringify({type:r.currentPostType,filters:r.filterValues});if(W.current===x)return;if(W.current===null){W.current=x;return}W.current=x;const d=setTimeout(()=>{S(r.filterValues,r.currentPostType)},300);return()=>{clearTimeout(d)}}},[r.filterValues,r.currentPostType,e.searchOn,n,S]);const T=v(()=>{f.current=!0,S(r.filterValues,r.currentPostType)},[S,r.filterValues,r.currentPostType]);return{state:r,setCurrentPostType:P,setFilterValue:g,clearAll:D,togglePortal:F,submit:T,currentPostTypeConfig:$,filterConfigs:E,narrowedValues:r.narrowedValues,narrowingFilters:r.narrowingFilters}}function Ke(e){const t=new URL(window.location.href),n=[];t.searchParams.forEach((s,u)=>{(u.startsWith("filter_")||u==="post_type")&&n.push(u),u==="type"&&!e&&n.push(u),u!=="type"&&u!=="page"&&u!=="pg"&&n.push(u)}),n.forEach(s=>t.searchParams.delete(s)),e&&t.searchParams.set("type",e),window.history.replaceState({},"",t.toString())}function ze(e,t){return Object.hasOwn(t,e)}function _e(e,t){const n=new URL(window.location.href),s=[];n.searchParams.forEach((u,y)=>{(y.startsWith("filter_")||y==="post_type")&&s.push(y),(y==="type"||ze(y,e))&&s.push(y)}),s.forEach(u=>n.searchParams.delete(u)),t&&n.searchParams.set("type",t),Object.entries(e).forEach(([u,y])=>{if(!(y==null||y==="")&&!(typeof y=="string"&&y==="..")&&!(typeof y=="object"&&!Array.isArray(y)&&!Object.values(y).some(b=>b!=null&&b!=="")))if(Array.isArray(y)){const r=y.join(",");r&&n.searchParams.set(u,r)}else typeof y=="object"?n.searchParams.set(u,JSON.stringify(y)):n.searchParams.set(u,String(y))}),window.history.replaceState({},"",n.toString())}function Le(e){return typeof e=="string"&&e.includes("@tags()")}function Pe(e){if(!Le(e))return e;const t=e.match(/@tags\(\)(.*?)@endtags\(\)/s);return t?t[1]:e}async function Ie(e,t={}){try{return(await He({path:"/voxel-fse/v1/dynamic-data/render",method:"POST",data:{expression:e,context:t}})).rendered}catch(n){return console.error("Failed to render dynamic tag:",n),e}}function we(){return typeof document>"u"?!1:document.body.classList.contains("logged-in")}function Ge(){return typeof document>"u"?[]:Array.from(document.body.classList).filter(n=>n.startsWith("role-")||["administrator","editor","author","contributor","subscriber"].includes(n)).map(n=>n.replace("role-",""))}function Je(e){const t=e.filterKey;switch(t){case"user:logged_in":return we();case"user:logged_out":return!we();case"user:role":{if(!we())return!1;const n=Ge(),s=e.value||"";switch(e.operator){case"equals":return n.includes(s);case"not_equals":return!n.includes(s);default:return n.includes(s)}}default:return console.warn(`Unknown visibility rule type: ${t}`),!0}}function Qe(e){return!e||e.length===0?!0:e.every(t=>Je(t))}function Ye(e){const{rowVisibility:t="show",visibilityRules:n=[]}=e;if(!n||n.length===0)return!0;const s=Qe(n);return t==="hide"?!s:s}function Xe({config:e,filterData:t,value:n,onChange:s,blockId:u}){const y=u?`voxel-popup-${u}`:"",r=G(null),o=G(null),[b,f]=q(!1),[m,$]=q(""),[E,P]=q(""),g=typeof n=="string"?n:"",D=t.props?.placeholder||t.label||"Type keywords...",F=e.displayAs||t.props?.display_as||"popup",_=t.icon||"";Y(()=>{P(g)},[g]),Y(()=>{b&&($(g),setTimeout(()=>{o.current?.focus()},50))},[b,g]);const S=K=>{P(K.target.value)},W=v(()=>{const K=E.trim();s(K.length>0?K:"")},[E,s]),T=v(K=>{K.key==="Enter"&&(K.preventDefault(),W())},[W]),x=K=>{$(K.target.value)},d=v(()=>{f(!0)},[]),h=v(()=>{const K=m.trim();s(K.length>0?K:""),f(!1)},[m,s]),p=v(()=>{$(""),s("")},[s]),N=v(K=>{K.key==="Enter"&&(K.preventDefault(),h())},[h]);if(F==="inline"){const{style:K,className:I}=ee(e,"ts-form-group ts-inline-filter");return React.createElement("div",{className:I,style:K},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:"ts-input-icon flexify"},_&&React.createElement("span",{dangerouslySetInnerHTML:{__html:_}}),React.createElement("input",{type:"text",value:E,onChange:S,onBlur:W,onKeyDown:T,placeholder:D,className:"inline-input"})))}const a=g.trim().length>0,{style:C,className:J}=ee(e,"ts-form-group"),L=de(e);return React.createElement("div",{className:J,style:C},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:r,className:`ts-filter ts-popup-target ${a?"ts-filled":""}`,onClick:d,onMouseDown:K=>K.preventDefault(),role:"button",tabIndex:0},_&&React.createElement("span",{dangerouslySetInnerHTML:{__html:_}}),React.createElement("div",{className:"ts-filter-text"},a?g:D)),React.createElement(ie,{isOpen:b,target:r,title:"",icon:_,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:h,onClear:p,onClose:()=>f(!1),className:`${y}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:L.style},React.createElement("div",{className:"ts-input-icon ts-sticky-top flexify"},React.createElement("span",null,oe.search),React.createElement("input",{ref:o,type:"text",value:m,onChange:x,onKeyDown:N,placeholder:D,className:"autofocus border-none"}))))}const Ze=()=>window.noUiSlider;function Fe(e){if(e==null||e==="")return[];if(Array.isArray(e))return e.map(Number).filter(s=>!isNaN(s));if(typeof e=="string"&&e.includes("..")){const n=e.split(".."),s=[];if(n[0]!==""){const u=Number(n[0]);isNaN(u)||s.push(u)}if(n[1]!==""){const u=Number(n[1]);isNaN(u)||s.push(u)}return s}const t=Number(e);return isNaN(t)?[]:[t]}function et({config:e,filterData:t,value:n,onChange:s,blockId:u,narrowedValues:y,isNarrowing:r}){const o=[u?`voxel-popup-${u}`:"",e.id?`elementor-repeater-item-${e.id}`:""].filter(Boolean).join(" "),b=G(null),f=G(null),m=G(null),[$,E]=q(!1),P=t.props||{},g=P.range_start??P.min??0,D=P.range_end??P.max??100,F=P.step_size??P.step??1,_=P.placeholder||t.label||"Range",S=e.displayAs||t.props?.display_as||"popup",W=P.handles||"single",T=P.compare||"in_range",x=e.filterKey,d=y?.ranges?.[x],h=d?.min??g,p=d?.max??D,N=typeof P.format=="object"?P.format:{numeric:!1,prefix:"",suffix:""},a=N.prefix||"",C=N.suffix||"",J=t.icon||"",L=W==="single"?[T==="in_range"?p:h]:T==="in_range"?[h,p]:[h,h],K=Fe(n),I=K.length>0?K:L,[z,te]=q(I),X=v(w=>{const j=N.numeric?w.toLocaleString():String(w);return`${a}${j}${C}`},[N.numeric,a,C]),re=v(w=>w.map(j=>X(j)).join(" — "),[X]),se=n!=null&&n!=="",H=se?re(K.length>0?K:z):_,c=re(z),M=v(()=>{if(!f.current||m.current)return;let w,j;W==="single"?(j=T==="in_range"?[1,0]:[0,1],w=[...z]):(j=T==="in_range"?[0,1,0]:[1,0,1],w=[...z]);const V=Ze();if(!V){console.error("noUiSlider not loaded - window.noUiSlider is undefined");return}V.create(f.current,{start:w,connect:j,range:{min:h,max:p},step:F,behaviour:"tap-drag"}),m.current=f.current.noUiSlider,m.current.on("update",Z=>{te(Z.map(O=>Number(O)))}),requestAnimationFrame(()=>{m.current&&m.current.set(w,!1)})},[W,T,z,h,p,F]),A=v(()=>{m.current&&(m.current.destroy(),m.current=null)},[]);Y(()=>{const w=Fe(n),j=w.length>0?w:L;te(j),m.current&&(m.current.set(j,!1),requestAnimationFrame(()=>{m.current&&m.current.set(j,!1)}))},[n,h,p,W,T]),Y(()=>{if($&&S==="popup"){const w=setTimeout(()=>{M()},100);return()=>clearTimeout(w)}return()=>{S==="popup"&&A()}},[$,S,M,A]),Y(()=>{if(S==="inline")return M(),()=>A()},[S,M,A]),Y(()=>{if(!m.current||!d)return;const w=z.map(j=>j<h?h:j>p?p:j);m.current.updateOptions({range:{min:h,max:p},start:w}),te(w)},[d,h,p,W]);const ne=v(()=>{E(!0)},[]),ae=v(w=>!w.length||w.some(j=>typeof j!="number")?!1:w.join("..")!==L.join(".."),[L]),le=v(w=>ae(w)?w.join(".."):null,[ae]),pe=w=>{const V=[w.target.value===""?h:Number(w.target.value),z[1]??p];te(V),m.current&&m.current.set(V),S==="minmax"&&s(le(V))},me=w=>{const j=w.target.value===""?p:Number(w.target.value),V=[z[0]??h,j];te(V),m.current&&m.current.set(V),S==="minmax"&&s(le(V))},B=v(()=>{s(le(z)),E(!1)},[z,le,s]),l=v(()=>{te(L),m.current&&m.current.set(L),s(null)},[L,s]),R=()=>React.createElement("div",{className:"ts-minmax"},React.createElement("input",{type:"number",className:"inline-input input-no-icon",placeholder:String(h),value:z[0]??h,onChange:pe,min:h,max:typeof z[1]=="number"?z[1]:p,step:F}),React.createElement("input",{type:"number",className:"inline-input input-no-icon",placeholder:String(p),value:z[1]??p,onChange:me,min:typeof z[0]=="number"?z[0]:h,max:p,step:F})),i=()=>React.createElement("div",{className:`range-slider-wrapper${r?" ts-loading":""}`},React.createElement("div",{className:"range-value"},c),React.createElement("div",{ref:f,className:"range-slider"}),d&&(d.min!==g||d.max!==D)&&React.createElement("div",{className:"range-narrowed-indicator"},React.createElement("small",null,"Showing ",X(h)," — ",X(p)," based on current results")));if(S==="minmax"&&W==="double"){const{style:w,className:j}=ee(e,"ts-form-group");return React.createElement("div",{className:j,style:w},!e.hideLabel&&React.createElement("label",null,t.label),R())}if(S==="inline"){const{style:w,className:j}=ee(e,"ts-form-group ts-inline-filter");return React.createElement("div",{className:j,style:w},!e.hideLabel&&React.createElement("label",null,t.label),i())}const{style:k,className:U}=ee(e,"ts-form-group"),Q=de(e);return React.createElement("div",{className:U,style:k},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:b,className:`ts-filter ts-popup-target ${se?"ts-filled":""}`,onClick:ne,onMouseDown:w=>w.preventDefault(),role:"button",tabIndex:0},J&&React.createElement("span",{dangerouslySetInnerHTML:{__html:J}}),React.createElement("div",{className:"ts-filter-text"},H),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ie,{isOpen:$,target:b,title:"",icon:J,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:B,onClear:l,onClose:()=>E(!1),className:`${o}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:Q.style},React.createElement("div",{className:"ts-form-group"},React.createElement("label",null,t.label,t.description&&React.createElement("small",null,t.description)),i())))}function tt(e,t){let n=null;return function(...s){n&&clearTimeout(n),n=setTimeout(()=>e.apply(this,s),t)}}function nt({config:e,filterData:t,value:n,onChange:s,blockId:u}){const y=u?`voxel-popup-${u}`:"",r=t.props||{},o=typeof r.range_start=="number"?r.range_start:0,b=typeof r.range_end=="number"?r.range_end:1e3,f=typeof r.step_size=="number"?r.step_size:1,m=typeof r.precision=="number"?r.precision:0,$=r.placeholder||t.label||"Any",E=e.displayAs||r.display_as||"popup",P=t.icon||"",g=G(null),D=G(null),[F,_]=q(!1),[S,W]=q(typeof n=="number"?n:""),T=v(H=>{if(H===""||typeof H!="number"||isNaN(H))return"";let c=H;return c<o&&(c=o),c>b&&(c=b),Number(c.toFixed(m))},[o,b,m]),x=v(H=>typeof H=="number",[]),d=v(H=>{const c=T(H);x(c)?s(c):s("")},[T,x,s]),h=ce(()=>tt(H=>d(H),300),[d]);Y(()=>{W(typeof n=="number"?n:"")},[n]),Y(()=>{F&&W(typeof n=="number"?n:"")},[F,n]);const p=H=>{H.preventDefault();let c;typeof S!="number"?c=o:(c=T(S+f),typeof c!="number"&&(c=o)),W(c),E==="inline"&&h(c)},N=H=>{H.preventDefault();let c;typeof S!="number"?c=o:(c=T(S-f),typeof c!="number"&&(c=o)),W(c),E==="inline"&&h(c)},a=H=>{const c=H.target.value;if(c===""){W(""),E==="inline"&&h("");return}const M=parseFloat(c);if(!isNaN(M)){const A=T(M);W(A),E==="inline"&&h(A)}},C=v(()=>{d(S)},[S,d]),J=v(()=>{_(!0)},[]),L=v(()=>{d(S),_(!1)},[S,d]),K=v(()=>{W(""),s(""),D.current?.focus()},[s]),I=typeof n=="number"?n:null,z=H=>React.createElement("div",{className:"ts-stepper-input flexify"},React.createElement("button",{type:"button",className:`ts-stepper-left ts-icon-btn${H?" inline-btn-ts":""}`,onClick:N},React.createElement("i",{className:"las la-minus"})),React.createElement("input",{ref:D,type:"number",className:"ts-input-box",min:o,max:b,step:f,value:S,onChange:a,onBlur:H?C:void 0,placeholder:$}),React.createElement("button",{type:"button",className:`ts-stepper-right ts-icon-btn${H?" inline-btn-ts":""}`,onClick:p},React.createElement("i",{className:"las la-plus"})));if(E==="inline"){const{style:H,className:c}=ee(e,"ts-form-group ts-inline-filter");return React.createElement("div",{className:c,style:H},!e.hideLabel&&React.createElement("label",null,t.label),z(!0))}const te=typeof n=="number",{style:X,className:re}=ee(e,"ts-form-group"),se=de(e);return React.createElement("div",{className:re,style:X},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:g,className:`ts-filter ts-popup-target ${te?"ts-filled":""}`,onClick:J,onMouseDown:H=>H.preventDefault(),role:"button",tabIndex:0},P&&React.createElement("span",{dangerouslySetInnerHTML:{__html:P}}),React.createElement("div",{className:"ts-filter-text"},I!==null?I:$),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ie,{isOpen:F,target:g,title:"",icon:P,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:L,onClear:K,onClose:()=>_(!1),className:`${y}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:se.style},React.createElement("div",{className:"ts-form-group"},React.createElement("label",null,t.label,t.description&&React.createElement("small",null,t.description)),z(!1))))}function st(e){return e==null||e===""?[]:typeof e=="string"?e.split(",").map(t=>t.trim()).filter(t=>t!==""):Array.isArray(e)?e.length>0&&typeof e[0]=="string"?e:e.length>0&&typeof e[0]=="number"?e.map(String):[]:[]}function Se(e){return e.length===0?null:e.join(",")}function lt({config:e,filterData:t,value:n,onChange:s,blockId:u,narrowedValues:y,isNarrowing:r}){const o=u?`voxel-popup-${u}`:"",b=G(null),f=G(null),[m,$]=q(!1),[E,P]=q(""),g=t.props||{},D=g.multiple??!0,F=g.taxonomy_label??"",_=g.placeholder||t.label||F||"Select",S=e.displayAs||g.display_as||"popup",W=e.hideEmptyTerms??g.hide_empty_terms??!1,T=g.per_page??20,[x,d]=q(1),h=t.icon||"",p=g.taxonomy||e.filterKey,N=y?.terms?.[p],a=v(l=>{const R=(i,k,U)=>{const Q={...i,parentRef:k||void 0,hasSelection:!1,depth:U};return i.children&&i.children.length>0&&(Q.children=i.children.map(w=>R(w,Q,U+1))),Q};return l.map(i=>R(i,null,0))},[]),C=ce(()=>{const l=g.terms||[];return a(l)},[g,a]),J=ce(()=>{const l=new Map,R=i=>{l.set(i.slug,i),i.children&&i.children.forEach(k=>R(k))};return C.forEach(i=>R(i)),l},[C]),L=ce(()=>{const l=[],R=i=>{i.forEach(k=>{W&&N&&k.term_taxonomy_id&&N[k.term_taxonomy_id]===0||(l.push(k),k.children&&k.children.length>0&&R(k.children))})};return R(C),l},[C,W,N]),K=v(l=>!N||!l.term_taxonomy_id?null:N[l.term_taxonomy_id]??null,[N]),I=ce(()=>st(n),[n]),z=v(l=>l.slug?I.includes(l.slug):!1,[I]),te=ce(()=>L.filter(l=>l.slug&&I.includes(l.slug)),[L,I]),X=ce(()=>{const l=T*x;return L.slice(0,l)},[L,T,x]),re=L.length>T*x,se=ce(()=>{if(!E)return X;const l=E.toLowerCase();return L.filter(R=>R.label.toLowerCase().includes(l))},[L,X,E]);Y(()=>{m&&(P(""),L.length>=15&&setTimeout(()=>f.current?.focus(),50))},[m,L.length]);const H=v(()=>{$(!0)},[]),c=v(l=>{const R=l.slug;if(R)if(D){let i=[...I];if(i.includes(R)){i=i.filter(U=>U!==R);let k=l.parentRef;for(;k;)k.children?.some(Q=>i.includes(Q.slug)||Q.hasSelection)||(k.hasSelection=!1),k=k.parentRef;s(Se(i))}else{i.push(R);let k=l.parentRef;for(;k;)i=i.filter(Q=>Q!==k.slug),k.hasSelection=!0,k=k.parentRef;const U=new Set;i.forEach(Q=>{const w=J.get(Q);if(!w)return;let j=w.parentRef;const V=[];let Z=!1;for(;j;){if(j.slug===R){Z=!0;break}V.push(j),j=j.parentRef}Z&&(U.add(w.slug),V.forEach(O=>{O.hasSelection=!1}))}),i=i.filter(Q=>!U.has(Q)),s(Se(i))}}else s(Se([R])),S!=="inline"&&$(!1)},[D,I,s,J,S]),M=v(()=>{$(!1)},[]),A=v(()=>{s(null)},[s]),ne=I.length>0,ae=ne&&te[0]?.label||_,le=te.length>1?te.length-1:0;if(S==="inline"){const{style:l,className:R}=ee(e,"ts-form-group inline-terms-wrapper ts-inline-filter min-scroll");return React.createElement("div",{className:`${R}${r?" ts-loading":""}`,style:l},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:"ts-term-dropdown ts-multilevel-dropdown inline-multilevel"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},X.map(i=>{const k=z(i),U=K(i),Q=U===0;return React.createElement("li",{key:i.slug,className:`${k?"ts-selected":""}${Q?" ts-disabled":""}`},React.createElement("a",{href:"#",className:"flexify",onClick:w=>{w.preventDefault(),Q||c(i)}},React.createElement("div",{className:"ts-checkbox-container"},React.createElement("label",{className:`container-${D?"checkbox":"radio"}`},React.createElement("input",{type:D?"checkbox":"radio",checked:k,readOnly:!0,disabled:!0,hidden:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,i.depth>0?"— ".repeat(i.depth):"",i.label),U!==null&&React.createElement("span",{className:"ts-term-count"},"(",U,")"),i.icon&&React.createElement("div",{className:"ts-term-icon",dangerouslySetInnerHTML:{__html:i.icon}})))}),re&&React.createElement("li",{className:"ts-term-centered"},React.createElement("a",{href:"#",onClick:i=>{i.preventDefault(),d(k=>k+1)},className:"flexify"},React.createElement("div",{className:"ts-term-icon"},oe.reload||React.createElement("span",null,"↻")),React.createElement("span",null,"Load more"))))))}if(S==="buttons"){const{style:l,className:R}=ee(e,"ts-form-group");return React.createElement("div",{className:R,style:l},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("ul",{className:"simplify-ul addon-buttons flexify"},L.map(i=>{const k=z(i);return React.createElement("li",{key:i.slug,className:`flexify ${k?"adb-selected":""}`,onClick:()=>c(i)},i.label)})))}const{style:pe,className:me}=ee(e,"ts-form-group"),B=de(e);return React.createElement("div",{className:me,style:pe},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:b,className:`ts-filter ts-popup-target ${ne?"ts-filled":""}`,onClick:H,onMouseDown:l=>l.preventDefault(),role:"button",tabIndex:0},h&&React.createElement("span",{dangerouslySetInnerHTML:{__html:h}}),React.createElement("div",{className:"ts-filter-text"},ae,le>0&&React.createElement("span",{className:"term-count"},"+",le)),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ie,{isOpen:m,target:b,title:"",icon:h,saveLabel:"Save",clearLabel:"Clear",showClear:!0,showSave:D,onSave:M,onClear:A,onClose:()=>$(!1),className:`${o}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:B.style},L.length>=15&&React.createElement("div",{className:"ts-sticky-top uib b-bottom"},React.createElement("div",{className:"ts-input-icon flexify"},React.createElement("span",null,oe.search),React.createElement("input",{ref:f,type:"text",value:E,onChange:l=>P(l.target.value),placeholder:"Search",className:"autofocus"}))),React.createElement("div",{className:`ts-term-dropdown ts-multilevel-dropdown ts-md-group${r?" ts-loading":""}`},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},se.map(l=>{const R=z(l),i=K(l),k=i===0;return React.createElement("li",{key:l.slug,className:`${R?"ts-selected":""}${k?" ts-disabled":""}`},React.createElement("a",{href:"#",className:"flexify",onClick:U=>{U.preventDefault(),k||c(l)}},React.createElement("div",{className:"ts-checkbox-container"},React.createElement("label",{className:`container-${D?"checkbox":"radio"}`},React.createElement("input",{type:D?"checkbox":"radio",checked:R,readOnly:!0,disabled:!0,hidden:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,l.depth>0?"— ".repeat(l.depth):"",l.label),i!==null&&React.createElement("span",{className:"ts-term-count"},"(",i,")"),l.icon&&React.createElement("div",{className:"ts-term-icon",dangerouslySetInnerHTML:{__html:l.icon}})))}),!E&&re&&React.createElement("li",{className:"ts-term-centered"},React.createElement("a",{href:"#",onClick:l=>{l.preventDefault(),d(R=>R+1)},className:"flexify"},React.createElement("div",{className:"ts-term-icon"},oe.reload||React.createElement("span",null,"↻")),React.createElement("span",null,"Load more")))),se.length===0&&React.createElement("div",{className:"ts-empty-user-tab"},h&&React.createElement("span",{dangerouslySetInnerHTML:{__html:h}}),React.createElement("p",null,"No results found")))))}const rt=()=>window.noUiSlider;function ye(e){return!e||!e.address?null:e.method==="radius"&&e.lat!==void 0&&e.lng!==void 0?`${e.address};${e.lat},${e.lng},${e.radius||10}`:e.swlat!==void 0&&e.swlng!==void 0&&e.nelat!==void 0&&e.nelng!==void 0?`${e.address};${e.swlat},${e.swlng}..${e.nelat},${e.nelng}`:e.lat!==void 0&&e.lng!==void 0?`${e.address};${e.lat},${e.lng},${e.radius||10}`:e.address}function at(e,t){if(e==null||e==="")return null;if(typeof e=="string"){const n=e.indexOf(";");if(n===-1)return{address:e};const s=e.substring(0,n),u=e.substring(n+1);if(u.includes("..")){const r=u.split(".."),o=r[0].split(","),b=r[1].split(",");return{address:s,method:"area",swlat:Number(o[0]),swlng:Number(o[1]),nelat:Number(b[0]),nelng:Number(b[1])}}const y=u.split(",");return{address:s,method:"radius",lat:Number(y[0]),lng:Number(y[1]),radius:y[2]?Number(y[2]):t}}return typeof e=="object"?e:null}function ct({config:e,filterData:t,value:n,onChange:s,blockId:u}){const y=u?`voxel-popup-${u}`:"",r=G(null),o=G(null),b=G(null),f=G(null),m=G(null),[$,E]=q(!1),[P,g]=q(!1),D=G(null),F=t.props||{},_=F.radius||{},S=_.default??10,W=_.min??0,T=_.max??100,x=_.step??1,d=_.units||"km",h=F.display_proximity_as||"popup",p=F.placeholder||t.label||"Location",N=F.default_search_method||"area";(F.l10n||{}).visibleArea;const C=e.displayAs||t.props?.display_as||"popup",J=t.icon||"",L=at(n,S)||{},[K,I]=q(L.address||""),[z,te]=q(L.radius||S),X=v(O=>Math.round(O*1e6)/1e6,[]),re=v(O=>`${O}${d==="mi"?"mi":"km"}`,[d]),se=v(()=>{if(!f.current||m.current)return;const O=rt();if(!O){console.error("noUiSlider not loaded - window.noUiSlider is undefined");return}O.create(f.current,{start:z,connect:[!0,!1],step:x,range:{min:W,max:T},behaviour:"tap-drag"}),m.current=f.current.noUiSlider,m.current.on("update",ue=>{te(Math.round(Number(ue[0])))}),m.current.on("change",ue=>{const fe=Math.round(Number(ue[0]));h==="inline"&&L.lat&&s(ye({...L,radius:fe}))})},[z,x,W,T,h,L,s]),H=v(()=>{m.current&&(m.current.destroy(),m.current=null)},[]);Y(()=>{if(h==="inline"&&L.lat){const O=setTimeout(()=>se(),50);return()=>{clearTimeout(O),H()}}},[h,L.lat,se,H]),Y(()=>{if(P){const O=setTimeout(()=>se(),50);return()=>clearTimeout(O)}return()=>H()},[P,se,H]),Y(()=>{const O=L.radius||S;te(O),m.current&&m.current.set([O])},[L.radius,S]);const c=v(()=>{if(b.current||!o.current||typeof window>"u")return;const O=window.Voxel?.Maps;if(!O){console.warn("Voxel.Maps not available for autocomplete");return}O.await(()=>{if(b.current)return;const ue=e.autocomplete||{};b.current=new O.Autocomplete(o.current,fe=>{if(fe){const Ce=fe.viewport.getSouthWest(),Ve=fe.viewport.getNorthEast(),We={address:fe.address,method:N,swlat:X(Ce.getLatitude()),swlng:X(Ce.getLongitude()),nelat:X(Ve.getLatitude()),nelng:X(Ve.getLongitude()),lat:X(fe.latlng.getLatitude()),lng:X(fe.latlng.getLongitude()),radius:L.radius||S};I(fe.address),s(ye(We)),C==="popup"&&E(!1)}else I(""),s(null)},ue)})},[e.autocomplete,s,C,S,N,L.radius,X]);Y(()=>{($||C==="inline")&&(I(L.address||""),$&&setTimeout(()=>o.current?.focus(),50))},[$,C,L.address]);const M=v(()=>{E(!0)},[]),A=v(()=>{c()},[c]),ne=O=>{I(O.target.value),C==="inline"&&(O.target.value?s(ye({...L,address:O.target.value})):s(null))},ae=O=>{O.preventDefault(),O.stopPropagation(),"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(ue=>{const fe={address:"Current Location",method:"radius",lat:ue.coords.latitude,lng:ue.coords.longitude,radius:S};I("Current Location"),s(ye(fe)),C==="popup"&&E(!1)},ue=>{console.error("Geolocation error:",ue)})},le=v(()=>{s(K?ye({...L,address:K}):null),E(!1)},[K,L,s]),pe=v(()=>{I(""),s(null)},[s]),me=v(O=>{O.key==="Enter"&&(O.preventDefault(),le())},[le]),B=v(()=>{L.lat&&s(ye({...L,radius:z})),g(!1)},[L,z,s]),l=v(()=>{te(S),m.current&&m.current.set([S]),L.lat&&s(ye({...L,radius:S}))},[S,L,s]),R=!!L.address||!!L.lat,i=R?L.address||"Location set":p,k=()=>React.createElement("div",{className:"ts-input-icon flexify",style:{position:"relative"}},J&&React.createElement("span",{dangerouslySetInnerHTML:{__html:J}}),React.createElement("input",{ref:o,type:"text",className:"inline-input",placeholder:p,value:K,onChange:ne,onKeyDown:me,onFocus:A}),React.createElement("a",{href:"#",className:"inline-user-location ts-icon-btn",onClick:ae,title:"Use my location","aria-label":"Use my location"},oe.crosshairs)),U=()=>React.createElement("div",{className:"range-slider-wrapper"},React.createElement("div",{className:"range-value"},re(z)),React.createElement("div",{ref:f,className:"range-slider"})),Q=()=>!L.lat||h==="inline"?null:React.createElement("div",{className:"ts-form-group ts-proximity-filter"},React.createElement("label",null,F.proximity_label||"Radius"),React.createElement("div",{ref:D,className:`ts-filter ts-popup-target ${L.radius?"ts-filled":""}`,onClick:()=>g(!0),onMouseDown:O=>O.preventDefault(),role:"button",tabIndex:0},React.createElement("div",{className:"ts-filter-text"},re(L.radius||S)),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ie,{isOpen:P,target:D,title:"",saveLabel:"Save",clearLabel:"Reset",showClear:!0,onSave:B,onClear:l,onClose:()=>g(!1),className:`${y}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:Z.style},React.createElement("div",{className:"ts-form-group"},React.createElement("label",null,F.proximity_label||"Search radius"),U()))),w=()=>h!=="inline"||!L.lat?null:React.createElement("div",{className:"ts-form-group ts-inline-proximity"},React.createElement("label",null,F.proximity_label||"Radius",": ",re(z)),React.createElement("div",{ref:f,className:"range-slider"}));if(C==="inline"){const{style:O,className:ue}=ee(e,"ts-form-group ts-inline-filter");return React.createElement(React.Fragment,null,React.createElement("div",{className:ue,style:O},!e.hideLabel&&React.createElement("label",null,t.label),k()),w(),Q())}const{style:j,className:V}=ee(e,"ts-form-group"),Z=de(e);return React.createElement(React.Fragment,null,React.createElement("div",{className:V,style:j},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:r,className:`ts-filter ts-popup-target ${R?"ts-filled":""}`,onClick:M,onMouseDown:O=>O.preventDefault(),role:"button",tabIndex:0},J&&React.createElement("span",{dangerouslySetInnerHTML:{__html:J}}),React.createElement("div",{className:"ts-filter-text"},i),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ie,{isOpen:$,target:r,title:"",icon:J,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:le,onClear:pe,onClose:()=>E(!1),className:`${y}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:Z.style},React.createElement("div",{className:"ts-form-group"},k()))),w(),Q())}function ot(e){if(e==null||e==="")return{date:"",slots:1};if(typeof e=="string")return{date:e,slots:1};if(typeof e=="object"){const t=e;return{date:t.date||"",slots:t.slots||1}}return{date:"",slots:1}}const ve=e=>{if(!e)return null;try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t:null}catch{return null}},Re=e=>{if(!e)return null;const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${s}`},Ee=e=>{if(!e)return"";try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):""}catch{return e}};function it({config:e,filterData:t,value:n,onChange:s,blockId:u}){const y=[u?`voxel-popup-${u}`:"",e.id?`elementor-repeater-item-${e.id}`:""].filter(Boolean).join(" "),r=G(null),o=G(null),[b,f]=q(!1),m=G(null),$=G(null),E=t.props||{},g=(E.inputMode||"date-range")==="date-range",D=E.l10n||{},F=D.pickDate||t.label||"Choose date",_=E.presets||[],S=t.icon||"",W=ot(n),T=W.date,x=W.slots;let d="",h="";g&&T&&T.includes("..")?[d,h]=T.split(".."):!g&&T&&(d=T);const[p,N]=q(()=>ve(d)),[a,C]=q(()=>ve(h)),[J,L]=q("start"),[K,I]=q(x);m.current=p,$.current=a;const z=v(B=>{const l=m.current,R=$.current,i=o.current;if(!l||R||!i)return;const k=B.target,U=k.tagName==="TD"?k:k.closest("td");if(!U||U.classList.contains("is-empty")||U.classList.contains("is-disabled"))return;const Q=U.querySelector(".pika-button");if(!Q||Q.disabled)return;U.classList.add("is-endrange");const w=new Date(parseInt(Q.getAttribute("data-pika-year")||"0"),parseInt(Q.getAttribute("data-pika-month")||"0"),parseInt(Q.getAttribute("data-pika-day")||"0")),j=864e5,V=new Date(w.getTime()-j);for(;V>l;){const Z=`.pika-button[data-pika-year="${V.getFullYear()}"][data-pika-month="${V.getMonth()}"][data-pika-day="${V.getDate()}"]`;i.el.querySelector(Z)?.parentElement?.classList.add("is-inrange"),V.setTime(V.getTime()-j)}U.addEventListener("mouseleave",()=>{i.el.querySelectorAll("td.is-inrange:not(.is-disabled)").forEach(O=>O.classList.remove("is-inrange")),U.classList.remove("is-endrange")},{once:!0})},[]);Y(()=>{if(b){if(g&&T&&T.includes("..")){const[B,l]=T.split("..");N(ve(B)),C(ve(l))}else!g&&T&&N(ve(T));I(x),L("start")}},[b,g,T,x]);const te=v(()=>{f(!0)},[]),X=v(B=>{if(g&&B&&o.current)if(J==="start")N(B),C(null),L("end"),o.current.setStartRange(B),o.current.setEndRange(null),o.current.draw();else if(p&&B<p)N(B),C(null),o.current.setStartRange(B),o.current.setEndRange(null),o.current.draw();else{C(B),L("start"),o.current.setEndRange(B),o.current.draw();const l=Re(p),R=Re(B);l&&R&&(s(`${l}..${R}`),f(!1))}else N(B)},[g,J,p,s]);v(B=>{I(Number(B.target.value)||1)},[]);const re=v(B=>{if(g){const l=Re(p),R=Re(a);l&&R&&s(`${l}..${R}`)}else{const R=Re(B!==void 0?B:p);R&&s(R)}f(!1)},[g,p,a,s]),se=v(()=>{N(null),C(null),I(1),s(null),o.current&&(o.current.setStartRange(null),o.current.setEndRange(null))},[s]),H=v(B=>{s(B)},[s]),c=v(()=>typeof n=="string"&&n.includes(".."),[n]),M=g?!!(d&&h):!!T,A=g?c():!!n,ne=v(B=>n===B,[n]),ae=ce(()=>{if(g&&_.length>0){if(c()){const B=Ee(d),l=Ee(h);return`${B} - ${l}`}return F}if(!M)return F;if(g){const B=Ee(d),l=Ee(h),R=`${B} — ${l}`;return x>1?`${R} (${x})`:R}else{const B=Ee(T);return x>1?`${B} (${x})`:B}},[g,_.length,c,M,d,h,T,x,F]),{style:le,className:pe}=ee(e,"ts-form-group"),me=de(e);return React.createElement(React.Fragment,null,g&&_.map(B=>React.createElement("div",{key:B.key,className:pe,style:le},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter ${ne(B.key)?"ts-filled":""}`,onClick:()=>H(B.key),role:"button",tabIndex:0},React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,B.label))))),React.createElement("div",{className:pe,style:le},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:r,className:`ts-filter ts-popup-target ${A?"ts-filled":""}`,onClick:te,onMouseDown:B=>B.preventDefault(),role:"button",tabIndex:0},S&&React.createElement("span",{dangerouslySetInnerHTML:{__html:S}}),React.createElement("div",{className:"ts-filter-text"},ae),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ie,{isOpen:b,target:r,title:"",icon:S,saveLabel:D.save||"Save",clearLabel:D.clear||"Clear",showSave:g,onSave:re,onClear:se,onClose:()=>f(!1),className:`${y}${g?" ts-availability-wrapper xl-height xl-width":" md-width xl-height"}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:me.style},g&&React.createElement("div",{className:"ts-popup-head flexify"},React.createElement("div",{className:"ts-popup-name flexify"},S&&React.createElement("span",{dangerouslySetInnerHTML:{__html:S}}),React.createElement("span",null,React.createElement("span",{className:J==="start"?"chosen":"",onClick:()=>L("start"),style:{cursor:"pointer"}},p?Ee(Re(p)):D.checkIn||"Check-in"),React.createElement("span",null," — "),React.createElement("span",{className:J==="end"?"chosen":"",onClick:()=>L("end"),style:{cursor:"pointer"}},a?Ee(Re(a)):D.checkOut||"Check-out")))),React.createElement($e,{value:p,onChange:X,...!g&&{onSelect:re},pickerConfig:{minDate:new Date,...g?{numberOfMonths:2,theme:"pika-range",onDraw:B=>B.el.addEventListener("mouseover",z)}:{}},onPickerReady:B=>{o.current=B,g&&p&&(B.setStartRange(p),a&&B.setEndRange(a))}}))))}function ut(e,t){if(e==null||e==="")return{from:"",to:""};if(typeof e=="string"){if(t&&e.includes("..")){const n=e.split("..");return{from:n[0]||"",to:n[1]||""}}return{from:e,to:""}}return{from:"",to:""}}function xe(e,t,n){return!e&&!t?null:n?e&&t?`${e}..${t}`:e?`${e}..`:t?`..${t}`:null:e||null}const he=e=>{if(!e)return null;try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t:null}catch{return null}},be=e=>{if(!e)return null;const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${s}`},ge=e=>{if(!e)return"";try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}):""}catch{return e}},Me=e=>e?e.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}):"";function dt(e){return typeof e=="string"&&e.includes("..")}function De({config:e,filterData:t,value:n,onChange:s,blockId:u}){const y=u?`voxel-popup-${u}`:"",r=G(null),o=t.props||{},b=o.inputMode==="date-range"||o.inputMode===void 0,f=o.l10n||{},m=f.from||"From",$=f.to||"To",E=f.pickDate||"Choose date",P=b?o.presets||[]:[],g=o.displayValue||{start:null,end:null},D=t.icon||"",F=ut(n,b),_=F.from,S=F.to,[W,T]=q(!1),[x,d]=q(!1),[h,p]=q(()=>he(_)),[N,a]=q("start"),[C,J]=q(()=>he(_)),[L,K]=q(()=>he(S)),I=G(null),z=v(()=>{p(he(_)),d(!0)},[_]),te=v((V="start")=>{const Z=he(_),O=he(S);J(Z),K(O),a(V==="end"&&!O?"start":V),d(!0)},[_,S]),X=v(V=>{p(V)},[]),re=v(V=>{T(!0);const O=be(V!==void 0?V:h)||"";s(xe(O,"",!1)),d(!1)},[h,s]),se=v(()=>{T(!0),p(null),s(null)},[s]),H=G(N);H.current=N;const c=G(C);c.current=C;const M=G(L);M.current=L;const A=v(V=>{J(V),c.current=V,I.current&&(I.current.setStartRange(V),M.current&&V&&V>M.current&&(K(null),M.current=null,I.current.setEndRange(null)))},[]),ne=v(V=>{K(V),M.current=V,I.current&&I.current.setEndRange(V)},[]),ae=v(()=>{T(!0);let V=be(c.current)||"",Z=be(M.current)||"";V&&!Z&&(Z=V),s(xe(V,Z,!0)),d(!1)},[s]),le=v(()=>{T(!0),A(null),ne(null),a("start"),I.current&&I.current.draw(!0),s(null)},[s,A,ne]),pe=v(V=>{H.current==="start"?(A(V),a("end")):(ne(V),a("start"),setTimeout(()=>{T(!0);const Z=be(c.current)||"";let O=be(V)||"";Z&&!O&&(O=Z),s(xe(Z,O,!0)),d(!1)},0)),I.current&&I.current.draw(!0)},[A,ne,s]),me=v(V=>{I.current=V;const Z=he(_),O=he(S);Z&&V.setStartRange(Z),O&&V.setEndRange(O),V.draw(!0)},[_,S]),B=ce(()=>({numberOfMonths:2,theme:"pika-range",disableDayFn:V=>!!(H.current==="end"&&c.current&&V<c.current),selectDayFn:V=>c.current&&V.toDateString()===c.current.toDateString()||M.current&&V.toDateString()===M.current.toDateString()||void 0}),[]),l=v(V=>{T(!0),s(n===V?null:V)},[n,s]),R=b?dt(n):n!=null&&n!=="",i=ce(()=>{if(!R)return E;if(b){const Z=W?ge(_):g.start||ge(_),O=W?ge(S):g.end||ge(S);return Z&&O?`${Z} - ${O}`:Z||E}return(W?ge(_):g.start||ge(_))||E},[R,b,_,S,E,W,g]),k=C?Me(C):m,U=L?Me(L):$,{style:Q,className:w}=ee(e,"ts-form-group"),j=de(e);return React.createElement(React.Fragment,null,P.map(V=>React.createElement("div",{key:V.key,className:w,style:Q},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter${n===V.key?" ts-filled":""}`,onClick:()=>l(V.key),role:"button",tabIndex:0},React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,V.label))))),React.createElement("div",{className:w,style:Q},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:r,className:`ts-filter ts-popup-target${R?" ts-filled":""}`,onClick:b?()=>te("start"):z,onMouseDown:V=>V.preventDefault(),role:"button",tabIndex:0},D&&React.createElement("span",{dangerouslySetInnerHTML:{__html:D}}),React.createElement("div",{className:"ts-filter-text"},i),React.createElement("div",{className:"ts-down-icon"})),!b&&React.createElement(ie,{isOpen:x,target:r,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:re,onClear:se,onClose:()=>d(!1),className:`${y} md-width xl-height${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:j.style},React.createElement($e,{value:h,onChange:X,onSelect:re})),b&&React.createElement(ie,{isOpen:x,target:r,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:ae,onClear:le,onClose:()=>d(!1),className:`${y} ts-availability-wrapper xl-width xl-height${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:j.style},React.createElement("div",{className:"ts-popup-head flexify"},React.createElement("div",{className:"ts-popup-name flexify"},D&&React.createElement("span",{dangerouslySetInnerHTML:{__html:D}}),React.createElement("span",null,React.createElement("span",{className:N==="start"?"chosen":"",onClick:()=>a("start"),style:{cursor:"pointer"}},k),C&&React.createElement(React.Fragment,null,React.createElement("span",null," — "),React.createElement("span",{className:N==="end"?"chosen":"",onClick:()=>a("end"),style:{cursor:"pointer"}},U))))),React.createElement($e,{value:null,onChange:()=>{},onSelect:pe,pickerConfig:B,onPickerReady:me}))))}function pt({config:e,filterData:t,value:n,onChange:s}){const u=n!=null&&n!==!1&&n!==""&&n!==0,y=m=>{m.preventDefault(),s(u?null:1)},r=t.props?.placeholder||t.label||"Open now";if(e.openInPopup||t.props?.openInPopup||!1){const{style:m,className:$}=ee(e,"ts-form-group"),E=t.icon||"";return React.createElement("div",{className:$,style:m},React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter ts-popup-target${u?" ts-filled":""}`,onClick:y,role:"button",tabIndex:0},E&&React.createElement("span",{dangerouslySetInnerHTML:{__html:E}}),React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,r))))}const{style:b,className:f}=ee(e,"ts-form-group switcher-label ts-inline-filter");return React.createElement("div",{className:f,style:b},React.createElement("label",{className:"ts-keep-visible"},React.createElement("div",{className:"switch-slider"},React.createElement("div",{className:"onoffswitch"},React.createElement("input",{type:"checkbox",className:"onoffswitch-checkbox",checked:u,onChange:y,tabIndex:0}),React.createElement("label",{className:"onoffswitch-label",onClick:y}))),r))}function Oe(e){return typeof e!="string"||!e?null:e.split("(")[0]}function Ae(e){return Math.round(e*1e5)/1e5}function mt({config:e,filterData:t,value:n,onChange:s,blockId:u,allFilterValues:y,allFiltersData:r,postFeedId:o}){const b=u?`voxel-popup-${u}`:"",f=G(null),[m,$]=q(!1),[E,P]=q(!1),g=t.props||{},D=e.displayAs||t.props?.display_as||"popup",F=g.placeholder||t.label||"Order By",_=ce(()=>{const c=g.choices||{};return Array.isArray(c)?c:Object.entries(c).map(([M,A])=>({key:M,label:A.label||A,placeholder:A.placeholder||A.label||A,icon:A.icon||"",requires_location:A.requires_location||!1,has_location:A.has_location||!1}))},[g.choices]),S=t.icon||"",W=ce(()=>r&&r.find(c=>c.type==="location")||null,[r]),T=ce(()=>{if(!W||!y)return null;const c=y[W.key];return!c||typeof c!="object"?null:c},[W,y]),x=v(c=>{if(T){const{lat:M,lng:A,method:ne,address:ae}=T;if(M&&A){if(ne==="radius"){c(M,A),P(!1);return}c(M,A),P(!1);return}if(ae&&window.Voxel?.Maps?.getGeocoder){window.Voxel.Maps.getGeocoder().geocode(ae,le=>{le?c(le.latlng?.getLatitude?.()||le.lat,le.latlng?.getLongitude?.()||le.lng):d(c),P(!1)});return}}d(c)},[T]),d=v(c=>{if(!navigator.geolocation){P(!1);return}navigator.geolocation.getCurrentPosition(M=>{const A=Ae(M.coords.latitude),ne=Ae(M.coords.longitude);c(A,ne),P(!1)},()=>{const M=window.Voxel_Config;window.Voxel?.alert&&M?.l10n?.positionFail&&window.Voxel.alert(M.l10n.positionFail,"error"),P(!1)})},[]),h=Oe(n),p=_.find(c=>c.key===h)?.requires_location;Y(()=>{if(!p||!T)return;const{lat:c,lng:M,method:A}=T;A==="radius"&&c&&M&&h&&s(`${h}(${c},${M})`)},[T?.lat,T?.lng]);const N=v(()=>{$(!0)},[]),a=v(c=>{c.requires_location?(P(c.key),x((M,A)=>{s(c.key+`(${M},${A})`),$(!1)})):(s(c.key),$(!1))},[s,x]),C=v(c=>{c.requires_location?(P(c.key),x((M,A)=>{s(c.key+`(${M},${A})`)})):s(c.key)},[s,x]),J=v(()=>{s(null)},[s]),L=typeof n=="string"?n:"",K=!!L,I=Oe(L),z=_.find(c=>c.key===I),te=z?.label||F;Y(()=>{z?.requires_location&&!z?.has_location&&I&&(D==="buttons"?a(z):C(z))},[]);const X=c=>React.createElement("div",{className:"ts-term-dropdown ts-md-group"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list min-scroll"},_.map(M=>{const A=I===M.key,ne=E===M.key;return React.createElement("li",{key:M.key,className:A?"ts-selected":""},React.createElement("a",{href:"#",className:`flexify${ne?" vx-pending":""}`,onClick:ae=>{ae.preventDefault(),c(M)}},React.createElement("div",{className:"ts-radio-container"},React.createElement("label",{className:"container-radio"},React.createElement("input",{type:"radio",value:M.key,checked:A,readOnly:!0,disabled:!0,hidden:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,M.label),M.icon&&React.createElement("div",{className:"ts-term-icon"},React.createElement("span",{dangerouslySetInnerHTML:{__html:M.icon}}))))})));if(D==="buttons"){const{style:c,className:M}=ee(e,"ts-form-group");return React.createElement("div",{className:M,style:c},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("ul",{className:"simplify-ul addon-buttons flexify"},_.map(A=>{const ne=I===A.key,ae=E===A.key;return React.createElement("li",{key:A.key,className:`flexify${ne?" adb-selected":""}${ae?" vx-pending":""}`,onClick:()=>C(A)},A.placeholder||A.label)})))}if(D==="alt-btn")return React.createElement(React.Fragment,null,_.map(c=>{const M=I===c.key,A=E===c.key,{style:ne,className:ae}=ee(e,"ts-form-group");return React.createElement("div",{key:c.key,className:ae,style:ne},!e.hideLabel&&React.createElement("label",null,c.label),React.createElement("div",{className:`ts-filter${M?" ts-filled":""}${A?" vx-pending":""}`,onClick:()=>C(c)},c.icon&&React.createElement("span",{dangerouslySetInnerHTML:{__html:c.icon}}),React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,c.placeholder||c.label))))}));if(D==="post-feed"&&o){const c=`[data-block-id="${o}"] .post-feed-header, .elementor-element-${o} .post-feed-header`,M=document.querySelector(c);if(M&&!M.querySelector(".vxf-sort"))return Te(React.createElement(ft,{filterData:t,filterIcon:S,placeholder:F,options:_,currentKey:I,hasValue:K,displayValue:te,loading:E,selectDropdownChoice:a,handleClear:J,renderRadioList:X,popupClassName:b,config:e}),M)}const{style:re,className:se}=ee(e,"ts-form-group"),H=de(e);return React.createElement("div",{className:se,style:re},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:f,className:`ts-filter ts-popup-target${K?" ts-filled":""}`,onClick:N,onMouseDown:c=>c.preventDefault(),role:"button",tabIndex:0},S&&React.createElement("span",{dangerouslySetInnerHTML:{__html:S}}),React.createElement("div",{className:"ts-filter-text"},te),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ie,{isOpen:m,target:f,title:"",icon:S,saveLabel:"Save",clearLabel:"Clear",showClear:K,showSave:!1,onSave:()=>$(!1),onClear:J,onClose:()=>$(!1),className:`hide-head ${b}${e.popupCenterPosition?" ts-popup-centered":""}`.trim(),popupStyle:H.style},X(a)))}function ft({filterData:e,filterIcon:t,placeholder:n,options:s,currentKey:u,hasValue:y,displayValue:r,loading:o,selectDropdownChoice:b,handleClear:f,renderRadioList:m,popupClassName:$,config:E}){const P=G(null),[g,D]=q(!1),F=de(E);return React.createElement("div",{className:`vxf-sort ts-popup-target${y?" ts-filled":""}`,ref:P},React.createElement("a",{href:"#",onClick:_=>{_.preventDefault(),D(!g)}},y?r:n,React.createElement("div",{className:"ts-down-icon"})),React.createElement(ie,{isOpen:g,target:P,title:"",icon:t,saveLabel:"Save",clearLabel:"Clear",showClear:y,showSave:!1,onSave:()=>D(!1),onClear:()=>{f(),D(!1)},onClose:()=>D(!1),className:`hide-d ${$}${E.popupCenterPosition?" ts-popup-centered":""}`.trim(),popupStyle:F.style},m(_=>{b(_),D(!1)})))}function ht({config:e,filterData:t,value:n,onChange:s,blockId:u}){const y=u?`voxel-popup-${u}`:"",[r,o]=q(!1),b=G(null),f=t.props||{},m=e.displayAs||t.props?.display_as||"popup",$=f.placeholder||t.label||"Status",E=ce(()=>{const N=f.choices||{};return Array.isArray(N)?N:Object.entries(N).map(([a,C])=>({key:a,label:C.label||C}))},[f.choices]),P=t.icon||"",g=v(N=>{s(N),o(!1)},[s]),D=v(()=>{s(""),o(!1)},[s]),F=v(()=>{o(!0)},[]),_=typeof n=="string"?n:"",S=!!_,W=E.find(N=>N.key===_),T=S&&W?.label||$,x=()=>React.createElement("div",{className:"ts-term-dropdown ts-md-group"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list min-scroll"},E.map(N=>{const a=_===N.key;return React.createElement("li",{key:N.key},React.createElement("a",{href:"#",className:"flexify",onClick:C=>{C.preventDefault(),g(N.key)}},React.createElement("div",{className:"ts-radio-container"},React.createElement("label",{className:"container-radio"},React.createElement("input",{type:"radio",value:N.key,checked:a,readOnly:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,N.label),P&&React.createElement("div",{className:"ts-term-icon"},React.createElement("span",{dangerouslySetInnerHTML:{__html:P}}))))})));if(m==="buttons")return React.createElement(React.Fragment,null,E.map(N=>{const a=_===N.key,{style:C,className:J}=ee(e,"ts-form-group");return React.createElement("div",{key:N.key,className:J,style:C},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter${a?" ts-filled":""}`,onClick:()=>s(N.key)},P&&React.createElement("span",{dangerouslySetInnerHTML:{__html:P}}),React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,N.label))))}));const{style:d,className:h}=ee(e,"ts-form-group"),p=de(e);return React.createElement("div",{className:h,style:d},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:b,className:`ts-filter ts-popup-target ${S?"ts-filled":""}`,onClick:F,onMouseDown:N=>N.preventDefault(),role:"button",tabIndex:0},P&&React.createElement("span",{dangerouslySetInnerHTML:{__html:P}}),React.createElement("div",{className:"ts-filter-text"},T),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ie,{isOpen:r,target:b,title:"",icon:P,saveLabel:"Save",showSave:!1,showClear:S,onClear:D,onSave:()=>o(!1),onClose:()=>o(!1),className:`hide-head ${y}${e.popupCenterPosition?" ts-popup-centered":""}`.trim(),popupStyle:p.style},x()))}function yt(e){const{userId:t,skip:n=!1}=e,[s,u]=q(null),[y,r]=q(!1),[o,b]=q(null),f=v(async()=>{if(!t||n){u(null);return}r(!0),b(null);try{const m=Be(),$=await fetch(`${m}voxel-fse/v1/search-form/user-data?user_id=${t}`);if($.ok){const E=await $.json();u({id:E.id,name:E.name,avatar:E.avatar||""})}else u({id:t,name:"Unknown",avatar:""}),b("User not found")}catch(m){console.error("useUserData: Error fetching user data:",m),u({id:t,name:"Unknown",avatar:""}),b(m instanceof Error?m.message:"Failed to fetch user data")}finally{r(!1)}},[t,n]);return Y(()=>{f()},[f]),{userData:s,isLoading:y,error:o,refetch:f}}function Rt({config:e,filterData:t,value:n}){const s=G(null),u=t.props||{},y=t.icon||"",r=u.user;let o;n!==void 0?o=n:t.value!==null&&t.value!==void 0?o=t.value:o=null;const b=o?Number(o):null,f=b!==null&&!isNaN(b)&&b>0,m=!!r?.name,{userData:$,isLoading:E}=yt({userId:f?b:null,skip:m}),P=m?{name:r.name,avatar:r.avatar||""}:$;if(!f)return null;const g=P?.name||(E?"Loading...":"Unknown"),{style:D,className:F}=ee(e,"ts-form-group");return React.createElement("div",{className:F,style:D},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:s,className:`ts-filter ts-popup-target ts-filled${E?" ts-loading":""}`},React.createElement("span",{dangerouslySetInnerHTML:{__html:y}}),React.createElement("div",{className:"ts-filter-text"},g)))}function Et({config:e,filterData:t,value:n,onChange:s,blockId:u}){const y=G(null),r=u?`voxel-popup-${u}`:"",b=(t.props||{}).post,f=t.icon||"";let m=null;n!==void 0?n===null?m=null:typeof n=="number"?m=n:typeof n=="string"&&n!==""&&(m=Number(n)):t.value!==null&&t.value!==void 0&&(m=typeof t.value=="number"?t.value:Number(t.value));const $=m!==null&&!isNaN(m)&&m>0,E=v(()=>{s(null)},[s]);if(!$)return null;const P=b?.title||"Unknown",{style:g,className:D}=ee(e,"ts-form-group"),F=de(e);return React.createElement("div",{className:D,style:g},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:y,className:"ts-filter ts-popup-target ts-filled",role:"button",tabIndex:0},f&&React.createElement("span",{dangerouslySetInnerHTML:{__html:f}}),React.createElement("div",{className:"ts-filter-text"},P),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ie,{isOpen:!1,target:y,showClear:!0,showSave:!1,onSave:()=>{},onClear:E,onClose:()=>{},className:`${r}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:F.style}))}function ke({config:e,filterData:t,value:n,onChange:s}){const[u,y]=q(!1),[r,o]=q(""),[b,f]=q([]),[m,$]=q(!1),E=G(null),P=t.props||{},g=P.placeholder||t.label||"Following",D=P.user,F=t.icon||"",_=a=>{const C=a.target.value;o(C),C.length>=2?($(!0),setTimeout(()=>{f([]),$(!1)},300)):f([])},S=(a,C)=>{s({id:a,name:C}),y(!1),o("")},W=a=>{a.preventDefault(),y(!u)};Y(()=>{const a=C=>{E.current&&!E.current.contains(C.target)&&y(!1)};return u&&document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[u]);let T=null;if(n!==void 0){const a=n;a===null?T=null:typeof a=="number"?T=a:typeof a=="object"&&a?.id&&(T=a.id)}else t.value!==null&&t.value!==void 0&&(T=typeof t.value=="number"?t.value:Number(t.value));const x=T!==null&&!isNaN(T)&&T>0;let d=g;if(x){const a=n;a&&typeof a=="object"&&a.name?d=a.name:D?.name&&(d=D.name)}const{style:h,className:p}=ee(e,"ts-form-group"),N=de(e);return React.createElement("div",{className:p,style:h,ref:E},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter ts-popup-target ${x?"ts-filled":""}`,onClick:W,onMouseDown:a=>a.preventDefault(),role:"button",tabIndex:0},F&&React.createElement("span",{dangerouslySetInnerHTML:{__html:F}}),React.createElement("div",{className:"ts-filter-text"},d),React.createElement("div",{className:"ts-down-icon"})),u&&React.createElement("div",{className:"ts-field-popup-container"},React.createElement("div",{className:N.className,style:N.style},React.createElement("div",{className:"ts-popup-content-wrapper min-scroll"},React.createElement("div",{className:"ts-form-group"},React.createElement("div",{className:"flexify ts-input-icon"},React.createElement("span",null,oe.search),React.createElement("input",{type:"text",className:"inline-input",value:r,onChange:_,placeholder:"Search..."}))),m?React.createElement("div",{className:"ts-loading"},React.createElement("span",{className:"ts-loader"})):b.length>0?React.createElement("div",{className:"ts-term-dropdown"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},b.map(a=>React.createElement("li",{key:a.id},React.createElement("a",{href:"#",className:"flexify",onClick:C=>{C.preventDefault(),S(a.id,a.name)}},React.createElement("span",null,a.name)))))):r.length>=2?React.createElement("div",{className:"ts-empty-user-list"},React.createElement("span",null,"No results found")):null))))}function gt({config:e,filterData:t,value:n,onChange:s}){const[u,y]=q(!1),[r,o]=q(""),[b,f]=q([]),[m,$]=q(!1),E=G(null),P=t.props||{},g=P.placeholder||t.label||"Following Post",D=P.post,F=t.icon||"",_=a=>{const C=a.target.value;o(C),C.length>=2?($(!0),setTimeout(()=>{f([]),$(!1)},300)):f([])},S=(a,C)=>{s({id:a,title:C}),y(!1),o("")},W=a=>{a.preventDefault(),y(!u)};Y(()=>{const a=C=>{E.current&&!E.current.contains(C.target)&&y(!1)};return u&&document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[u]);let T=null;if(n!==void 0){const a=n;a===null?T=null:typeof a=="number"?T=a:typeof a=="object"&&a?.id&&(T=a.id)}else t.value!==null&&t.value!==void 0&&(T=typeof t.value=="number"?t.value:Number(t.value));const x=T!==null&&!isNaN(T)&&T>0;let d=g;if(x){const a=n;a&&typeof a=="object"&&a.title?d=a.title:D?.title&&(d=D.title)}const{style:h,className:p}=ee(e,"ts-form-group"),N=de(e);return React.createElement("div",{className:p,style:h,ref:E},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter ts-popup-target ${x?"ts-filled":""}`,onClick:W,onMouseDown:a=>a.preventDefault(),role:"button",tabIndex:0},F&&React.createElement("span",{dangerouslySetInnerHTML:{__html:F}}),React.createElement("div",{className:"ts-filter-text"},d),React.createElement("div",{className:"ts-down-icon"})),u&&React.createElement("div",{className:"ts-field-popup-container"},React.createElement("div",{className:N.className,style:N.style},React.createElement("div",{className:"ts-popup-content-wrapper min-scroll"},React.createElement("div",{className:"ts-form-group"},React.createElement("div",{className:"flexify ts-input-icon"},React.createElement("span",null,oe.search),React.createElement("input",{type:"text",className:"inline-input",value:r,onChange:_,placeholder:"Search posts..."}))),m?React.createElement("div",{className:"ts-loading"},React.createElement("span",{className:"ts-loader"})):b.length>0?React.createElement("div",{className:"ts-term-dropdown"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},b.map(a=>React.createElement("li",{key:a.id},React.createElement("a",{href:"#",className:"flexify",onClick:C=>{C.preventDefault(),S(a.id,a.title)}},React.createElement("span",null,a.title)))))):r.length>=2?React.createElement("div",{className:"ts-empty-user-list"},React.createElement("span",null,"No posts found")):null))))}function vt({config:e,filterData:t,value:n,onChange:s}){const u=t.props||{},y=u.openInPopup===!0,r=u.placeholder||t.label||"",o=t.icon||"",b=n!=null&&n!==""&&n!==!1,f=E=>{E.preventDefault(),s(b?"":1)};if(y){const{style:E,className:P}=ee(e,"ts-form-group");return React.createElement("div",{className:P,style:E},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter${b?" ts-filled":""}`,onClick:f,onMouseDown:g=>g.preventDefault(),role:"button",tabIndex:0},o&&React.createElement("span",{dangerouslySetInnerHTML:{__html:o}}),React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,r))))}const{style:m,className:$}=ee(e,"ts-form-group switcher-label ts-inline-filter");return React.createElement("div",{className:$,style:m},React.createElement("label",{className:"ts-keep-visible"},React.createElement("div",{className:"switch-slider"},React.createElement("div",{className:"onoffswitch"},React.createElement("input",{type:"checkbox",className:"onoffswitch-checkbox",checked:b,onChange:f,tabIndex:0}),React.createElement("label",{className:"onoffswitch-label",onClick:f}))),r))}function bt({config:e,filterData:t}){const n=t.description||"",{style:s,className:u}=ee(e,"ts-form-group ui-heading");return React.createElement("div",{className:u,style:s},React.createElement("label",null,e.label||t.label,n&&React.createElement("small",null,n)))}function Nt({postTypes:e,currentPostType:t,onChange:n,blockId:s,style:u}){const y=s?`voxel-popup-${s}`:"",[r,o]=q(!1),b=G(null),f=v(F=>{n(F),o(!1)},[n]),m=v(()=>{o(!0)},[]),$=e.find(F=>F.key===t),E=$?.label||"Select type",P=!!t,g=$?.icon||"",D=()=>React.createElement("div",{className:"ts-term-dropdown ts-md-group"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list min-scroll"},e.map(F=>{const _=t===F.key;return React.createElement("li",{key:F.key},React.createElement("a",{href:"#",className:"flexify",onClick:S=>{S.preventDefault(),f(F.key)}},React.createElement("div",{className:"ts-radio-container"},React.createElement("label",{className:"container-radio"},React.createElement("input",{type:"radio",checked:_,disabled:!0,hidden:!0,readOnly:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,F.label),React.createElement("div",{className:"ts-term-icon ts-pull-right"},F.icon&&React.createElement("span",{dangerouslySetInnerHTML:{__html:F.icon}}))))})));return React.createElement("div",{className:"ts-form-group choose-cpt-filter",style:u},React.createElement("label",null,"Post type"),React.createElement("div",{ref:b,className:`ts-filter ts-popup-target ${P?"ts-filled":""}`,onClick:m,onMouseDown:F=>F.preventDefault(),role:"button",tabIndex:0},g&&React.createElement("span",{dangerouslySetInnerHTML:{__html:g}}),React.createElement("div",{className:"ts-filter-text"},E),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ie,{isOpen:r,target:b,title:"",icon:g,saveLabel:"Save",showSave:!1,showClear:!1,onSave:()=>o(!1),onClose:()=>o(!1),className:`hide-head ${y}`.trim()},D()))}const wt={"common:is_empty":(e,t)=>t==null||t==="","common:is_not_empty":(e,t)=>t!=null&&t!=="","text:equals":(e,t)=>t===e.value,"text:not_equals":(e,t)=>t!==e.value,"text:contains":(e,t)=>typeof t!="string"||!e.value?!1:new RegExp(e.value,"i").test(t),"taxonomy:contains":(e,t)=>typeof t!="string"||!e.value?!1:t.split(",").includes(e.value),"taxonomy:not_contains":(e,t)=>typeof t!="string"||!e.value?!0:!t.split(",").includes(e.value),"number:equals":(e,t)=>{const n=parseFloat(String(t)),s=parseFloat(e.value||"0");return n===s},"number:not_equals":(e,t)=>{const n=parseFloat(String(t)),s=parseFloat(e.value||"0");return n!==s},"number:gt":(e,t)=>{const n=parseFloat(String(t)),s=parseFloat(e.value||"0");return n>s},"number:gte":(e,t)=>{const n=parseFloat(String(t)),s=parseFloat(e.value||"0");return n>=s},"number:lt":(e,t)=>{const n=parseFloat(String(t)),s=parseFloat(e.value||"0");return n<s},"number:lte":(e,t)=>{const n=parseFloat(String(t)),s=parseFloat(e.value||"0");return n<=s}};function St(e,t,n){const s=wt[e.type];if(!s)return console.warn(`[filterConditions] Unknown condition type: ${e.type}`),!1;let u=t;return n==="order-by"&&typeof t=="string"&&t.length>0&&(u=t.split("(")[0]),s(e,u)}function xt(e,t="show",n,s){if(!e||e.length===0)return!0;let u=!1;return e.forEach(y=>{if(!y.length)return;let r=!0;y.forEach(o=>{const b=n[o.source],m=s[o.source]?.type;St(o,b,m)||(r=!1)}),r&&(u=!0)}),t==="hide"?!u:u}function kt(e,t,n){return xt(e.conditions,e.conditions_behavior||"show",t,n)}function Tt(){const e=()=>{if(typeof window>"u")return"desktop";const s=window.innerWidth;return s<=767?"mobile":s<=1024?"tablet":"desktop"},[t,n]=q(e);return Y(()=>{const s=()=>{n(e())};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),t}function Ot({attributes:e,postTypes:t,context:n,editorDeviceType:s,onSubmit:u,onPostTypeChange:y,onFilterChange:r}){const o=G(null),b=G(null),{state:f,setCurrentPostType:m,setFilterValue:$,togglePortal:E,submit:P,clearAll:g,narrowedValues:D,narrowingFilters:F}=qe({attributes:e,postTypes:t,context:n,onSubmit:u,onPostTypeChange:y,onFilterChange:r}),_=Ue(l=>{if(n!=="editor")return null;const{isListViewOpened:R,isEditorSidebarOpened:i}=l("core/edit-post");return{leftVisible:R?.()??!1,rightVisible:i?.()??!1}}),S=ce(()=>{if(n!=="editor"||!_||s&&s!=="desktop")return{width:"100%",left:"0",right:"0",zIndex:9999};const l=_.leftVisible?350:0,R=_.rightVisible?280:0;return l===0&&R===0?{}:{width:`calc(100% - ${l+R}px)`,left:`${l}px`,right:`${R}px`,zIndex:9999}},[n,_,s]),[W,T]=q(""),[x,d]=q("");Y(()=>{const l=async()=>{const i=e.searchButtonText??"";if(Le(i)){const k=Pe(i),U=await Ie(k);T(U)}else T(i)},R=async()=>{const i=e.resetButtonText??"Reset";if(Le(i)){const k=Pe(i),U=await Ie(k);d(U)}else d(i)};l(),R()},[e.searchButtonText,e.resetButtonText]),Y(()=>{if(!f.portalActive)return;const l=R=>{R.key==="Escape"&&E()};return document.addEventListener("keydown",l),()=>document.removeEventListener("keydown",l)},[f.portalActive,E]),Y(()=>{if(!f.portalActive)return;const l=i=>{const k=i.target;o.current?.contains(k)||n==="editor"&&(k.closest(".interface-interface-skeleton__sidebar")||k.closest(".edit-post-sidebar")||k.closest(".block-editor-block-inspector")||k.closest(".components-popover")||k.closest(".components-modal"))||E()},R=requestAnimationFrame(()=>{document.addEventListener("mousedown",l)});return()=>{cancelAnimationFrame(R),document.removeEventListener("mousedown",l)}},[f.portalActive,E,n]),Y(()=>{if(n!=="frontend")return;const l=R=>{const i=R;i.detail?.searchFormId&&i.detail.searchFormId!==e.blockId||g()};return window.addEventListener("voxel-search-clear",l),()=>window.removeEventListener("voxel-search-clear",l)},[n,e.blockId,g]);const h=t.find(l=>l.key===f.currentPostType),p=e.filterLists?.[f.currentPostType]||[],N=l=>{P()},a=(l=!1)=>{g(l)},C={};h?.filters?.forEach(l=>{C[l.key]=l});const J=l=>{if(!(n==="frontend"?Ye(l):!0))return null;const i=l;if(n==="frontend"&&i.conditions&&!kt(i,f.filterValues,C))return null;const k=h?.filters?.find(j=>j.key===l.filterKey);if(!k)return null;const U=l.defaultValueEnabled&&l.defaultValue!==void 0&&l.defaultValue!==""&&!(k.type==="range"&&l.defaultValue===".."),Q={...k,value:U?l.defaultValue:k.value},w={config:l,filterData:Q,value:f.filterValues[l.filterKey],onChange:j=>$(l.filterKey,j),narrowedValues:D,isNarrowing:F,blockId:e.blockId,context:n};switch(k.type){case"keywords":return React.createElement(Xe,{key:l.id,...w});case"range":return React.createElement(et,{key:l.id,...w});case"stepper":return React.createElement(nt,{key:l.id,...w});case"terms":return React.createElement(lt,{key:l.id,...w});case"location":return React.createElement(ct,{key:l.id,...w});case"availability":return React.createElement(it,{key:l.id,...w});case"date":return React.createElement(De,{key:l.id,...w});case"recurring-date":return React.createElement(De,{key:l.id,...w});case"open-now":return React.createElement(pt,{key:l.id,...w});case"order-by":return React.createElement(mt,{key:l.id,...w,allFilterValues:f.filterValues,allFiltersData:h?.filters,postFeedId:e.postToFeedId});case"post-status":return React.createElement(ht,{key:l.id,...w});case"user":return React.createElement(Rt,{key:l.id,...w});case"relations":return React.createElement(Et,{key:l.id,...w});case"following":return React.createElement(ke,{key:l.id,...w});case"followed-by":return React.createElement(ke,{key:l.id,...w});case"following-user":return React.createElement(ke,{key:l.id,...w});case"following-post":return React.createElement(gt,{key:l.id,...w});case"switcher":return React.createElement(vt,{key:l.id,...w});case"ui-heading":return React.createElement(bt,{key:l.id,...w});default:return null}},L=(l=!0)=>React.createElement("div",{className:"ts-filter-wrapper flexify"},e.showPostTypeFilter&&t.length>1&&React.createElement(Nt,{postTypes:t,currentPostType:f.currentPostType,onChange:m,style:B()}),p.map(R=>J(R)),l&&e.showSearchButton&&React.createElement("div",{className:"ts-form-group flexify ts-form-submit",id:"sf_submit",style:me("search")},React.createElement("button",{type:"button",onClick:()=>N(),className:`ts-btn ts-btn-2 ts-btn-large ts-search-btn ${f.loading&&!f.resetting?"ts-loading-btn":""}`},f.loading&&!f.resetting&&React.createElement("div",{className:"ts-loader-wrapper"},React.createElement("span",{className:"ts-loader"})),Ne(e.searchButtonIcon,oe.search),W&&W)),l&&e.showResetButton&&React.createElement("div",{className:"ts-form-group flexify ts-form-reset",style:me("reset")},React.createElement("a",{href:"#",onClick:R=>{R.preventDefault(),a(!1)},className:"ts-filter",role:"button"},Ne(e.resetButtonIcon,oe.reload),x&&React.createElement("div",{className:"ts-filter-text"},x)))),K=Tt(),I=n==="editor"&&s?s:K,z=I==="desktop"&&(e.mfSwitcherDesktop??!1)||I==="tablet"&&(e.mfSwitcherTablet??!1)||I==="mobile"&&(e.mfSwitcherMobile??!1),te=()=>I==="desktop"?e.mfSwitcherDesktopDefault??"feed":I==="tablet"?e.mfSwitcherTabletDefault??"feed":e.mfSwitcherMobileDefault??"feed",[X,re]=q(te),se=G(null);Y(()=>{re(te())},[I,e.mfSwitcherDesktopDefault,e.mfSwitcherTabletDefault,e.mfSwitcherMobileDefault]);const H=(l,R)=>{if(!l)return null;const i=b.current?.ownerDocument||document,k=i.getElementById(l);if(k)return k;const U=R==="map"?"voxel-fse-map-":"voxel-fse-post-feed-",Q=l.replace(/^#/,""),w=`.${U}${Q}`,j=i.querySelector(w);return j||null},c=()=>{re("feed");const l=I,R=H(e.postToMapId||"","map"),i=H(e.postToFeedId||"","feed");if(R){R.classList.add(`vx-hidden-${l}`);const k=R.closest(".voxel-fse-flex-container");k&&k.classList.add(`vx-hidden-${l}`);const U=R.querySelector(".ts-map");U&&se.current&&(U.style.height=se.current.height,U.style.minHeight=se.current.minHeight)}if(i){i.classList.remove(`vx-hidden-${l}`);const k=i.closest(".voxel-fse-flex-container");k&&k.classList.remove(`vx-hidden-${l}`)}},M=()=>{re("map");const l=I,R=H(e.postToMapId||"","map"),i=H(e.postToFeedId||"","feed");if(i){i.classList.add(`vx-hidden-${l}`);const k=i.closest(".voxel-fse-flex-container");k&&k.classList.add(`vx-hidden-${l}`)}if(R){R.classList.remove(`vx-hidden-${l}`);const k=R.closest(".voxel-fse-flex-container");k&&k.classList.remove(`vx-hidden-${l}`);const U=R.querySelector(".ts-map");if(U){se.current||(se.current={height:U.style.height||"",minHeight:U.style.minHeight||""});const Q=R.style.getPropertyValue("--vx-map-height");Q?(U.style.height=Q,U.style.minHeight=Q):requestAnimationFrame(()=>{const w=R.getBoundingClientRect().top;U.style.height=`calc(100vh - ${Math.round(w)}px)`,U.style.minHeight=`calc(100vh - ${Math.round(w)}px)`})}}};Y(()=>{z&&(X==="feed"?c():M())},[I,X,z,e.postToMapId,e.postToFeedId]);const A=()=>{if(!z)return null;const l=[e.mfSwitcherDesktop?"":"vx-hidden-desktop",e.mfSwitcherTablet?"":"vx-hidden-tablet",e.mfSwitcherMobile?"":"vx-hidden-mobile"].filter(Boolean).join(" "),R=React.createElement("div",{className:`ts-switcher-btn ${l}`,style:n==="editor"?S:{}},React.createElement("a",{href:"#",className:`ts-btn ts-btn-1 ${X==="feed"?`vx-hidden-${I}`:""}`,onClick:i=>{i.preventDefault(),c()},role:"button"},oe.grid,"List view"),React.createElement("a",{href:"#",className:`ts-btn ts-btn-1 ${X==="map"?`vx-hidden-${I}`:""}`,onClick:i=>{i.preventDefault(),M()},role:"button"},oe.marker,"Map view"));return n==="editor"?R:Te(React.createElement("div",{className:`voxel-fse-search-form-${e.blockId}`,"data-voxel-id":e.blockId},R),document.body)},ne=I==="desktop"&&(e.formToggleDesktop??!1)||I==="tablet"&&(e.formToggleTablet??!0)||I==="mobile"&&(e.formToggleMobile??!0),ae=ne,le=!ne,pe={postTypes:t.map(l=>({key:l.key,label:l.label,filters:l.filters})),currentPostType:f.currentPostType,filterLists:e.filterLists||{},portalMode:e.portalMode||{desktop:!1,tablet:!1,mobile:!1},showPostTypeFilter:e.showPostTypeFilter??!0,showSearchButton:e.showSearchButton??!0,showResetButton:e.showResetButton??!1,searchButtonText:e.searchButtonText||"",resetButtonText:e.resetButtonText||"",formToggleDesktop:e.formToggleDesktop??!1,formToggleTablet:e.formToggleTablet??!0,formToggleMobile:e.formToggleMobile??!0,searchButtonWidth:e.searchButtonWidth,searchButtonWidth_tablet:e.searchButtonWidth_tablet,searchButtonWidth_mobile:e.searchButtonWidth_mobile,searchButtonWidthUnit:e.searchButtonWidthUnit||"%",resetButtonWidth:e.resetButtonWidth,resetButtonWidth_tablet:e.resetButtonWidth_tablet,resetButtonWidth_mobile:e.resetButtonWidth_mobile,resetButtonWidthUnit:e.resetButtonWidthUnit||"%"},me=l=>{const R=l==="search"?e.searchButtonWidthUnit||"%":e.resetButtonWidthUnit||"%";let i;return l==="search"?I==="mobile"?i=e.searchButtonWidth_mobile??e.searchButtonWidth_tablet??e.searchButtonWidth:I==="tablet"?i=e.searchButtonWidth_tablet??e.searchButtonWidth:i=e.searchButtonWidth:I==="mobile"?i=e.resetButtonWidth_mobile??e.resetButtonWidth_tablet??e.resetButtonWidth:I==="tablet"?i=e.resetButtonWidth_tablet??e.resetButtonWidth:i=e.resetButtonWidth,i!==void 0?{width:`${i}${R}`,flexGrow:0,flexShrink:0}:{}},B=()=>{let l;return I==="mobile"?l=e.postTypeFilterWidth_mobile??e.postTypeFilterWidth_tablet??e.postTypeFilterWidth:I==="tablet"?l=e.postTypeFilterWidth_tablet??e.postTypeFilterWidth:l=e.postTypeFilterWidth,l!==void 0?{width:`${l}%`,flexGrow:0,flexShrink:0}:{}};return React.createElement(React.Fragment,null,React.createElement("div",{className:"ts-form ts-search-widget","data-v-app":"",ref:b},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(pe)}}),ae&&React.createElement("div",{className:"ts-filter-wrapper flexify"},React.createElement("a",{href:"#",onClick:l=>{l.preventDefault(),E()},onMouseDown:l=>l.preventDefault(),className:`ts-filter-toggle ts-btn ts-btn-1 ${f.activeFilterCount>0?"ts-filled":""}`,role:"button","aria-expanded":f.portalActive},oe.filterslider,React.createElement("div",{className:"ts-toggle-text"},"Filter results"),f.activeFilterCount>0&&React.createElement("span",{className:"ts-filter-count"},f.activeFilterCount))),React.createElement("form",{method:"GET",onSubmit:l=>(l.preventDefault(),!1)},le&&React.createElement("div",{className:"ts-inline-filters"},L())),React.createElement("div",{className:"hidden"},React.createElement("div",{className:"ts-search-portal"}))),f.portalActive&&Te(React.createElement("div",{className:`ts-search-portal vx-popup elementor voxel-fse-search-form-${e.blockId}`,"data-voxel-id":e.blockId},React.createElement("div",{className:"ts-popup-root elementor-element"},React.createElement("div",{className:"ts-form ts-search-widget no-render elementor-element"},React.createElement("div",{className:"ts-field-popup-container"},React.createElement("div",{className:"ts-field-popup triggers-blur",ref:o},React.createElement("div",{className:"ts-popup-content-wrapper min-scroll"},React.createElement("div",{className:"ts-form-group"},L())),React.createElement("div",{className:"ts-popup-controller"},React.createElement("ul",{className:"flexify simplify-ul"},React.createElement("li",{className:"flexify ts-popup-close"},React.createElement("a",{href:"#",onClick:l=>{l.preventDefault(),E()},className:"ts-icon-btn",role:"button","aria-label":"Close"},Ne(e.closeIcon,oe.close))),React.createElement("li",{className:"flexify hide-d"},React.createElement("a",{href:"#",onClick:l=>{l.preventDefault(),a(!0)},className:"ts-icon-btn",role:"button"},oe.reload)),React.createElement("li",{className:"flexify hide-m"},React.createElement("a",{href:"#",onClick:l=>{l.preventDefault(),a(!0)},className:"ts-btn ts-btn-1",role:"button"},"Clear")),React.createElement("li",{className:"flexify"},React.createElement("a",{href:"#",onClick:l=>{l.preventDefault(),N(),E()},className:"ts-btn ts-btn-2",role:"button"},"Search"))))))))),document.body),A())}export{Ot as S};
