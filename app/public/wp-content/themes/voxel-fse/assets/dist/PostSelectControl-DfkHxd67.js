import{useState as s,useRef as B,useCallback as R,useEffect as P}from"react";import{Spinner as M}from"@wordpress/components";import{__ as i}from"@wordpress/i18n";import O from"@wordpress/api-fetch";import{k as ne,o as ae}from"./TypographyPopup-CAcEJ5NA.js";import"@wordpress/block-editor";const W={page:"/wp/v2/pages",post:"/wp/v2/posts",wp_block:"/wp/v2/blocks",elementor_library:"/wp/v2/elementor_library",wp_template:"/wp/v2/templates",wp_template_part:"/wp/v2/template-parts"};function oe(g,a){let l;return((...c)=>{clearTimeout(l),l=setTimeout(()=>g(...c),a)})}function de({label:g,value:a,onChange:l,postTypes:c=["page","wp_block"],placeholder:D=i("Search templates","voxel-fse"),clearText:F=i("CLEAR","voxel-fse"),emptyMessage:j=i("No results found","voxel-fse"),enableDynamicTags:E=!1,context:H="post"}){const[C,v]=s(""),[S,d]=s([]),[Y,T]=s(!1),[G,p]=s(!1),[x,f]=s(null),[I,$]=s(!1),[U,h]=s(!1),w=B(null),q=B(null),m=E&&typeof a=="string"&&a.startsWith("@tags()"),L=R(()=>{if(!m)return a||"";const e=a.match(/@tags\(\)(.*?)@endtags\(\)/s);return e?e[1]:a},[m,a]),J=()=>{h(!0)},K=()=>{window.confirm(i("Are you sure?","voxel-fse"))&&l("")},Q=e=>{e&&l(`@tags()${e}@endtags()`),h(!1)},_=R(async e=>{const t=parseInt(e,10);if(isNaN(t))return null;for(const[u,N]of Object.entries(W))if(!(!c.includes(u)&&!["page","post","wp_block"].includes(u)))try{const n=await O({path:`${N}/${t}`});if(n&&n.id){let r=`#${n.id}`;const y=n.type||u,o=n.template||"";return n.title?.rendered?r=`#${n.id}: ${n.title.rendered}`:y&&(r=`#${n.id}: post type: ${y}`,o&&(r+=` | template: ${o}`)),{id:String(n.id),title:r,type:y}}}catch{}return null},[c]),z=R(async e=>{if(e.length<2)return[];const t=[],u=c.map(async n=>{const r=W[n];if(!r)return[];try{return(await O({path:`${r}?search=${encodeURIComponent(e)}&per_page=10&status=publish,draft,private`})).map(o=>{let b=`#${o.id}`;const k=o.type||n,A=o.template||o.meta?.template||"";if(o.title?.rendered&&(b=`#${o.id}: ${o.title.rendered}`),k&&!b.includes("post type")){const te=k.replace("_"," ");A&&(b=`#${o.id}: post type: ${te} | template: ${A}`)}return{id:String(o.id),title:b,type:k}})}catch{return[]}});return(await Promise.all(u)).forEach(n=>t.push(...n)),t.sort((n,r)=>parseInt(r.id,10)-parseInt(n.id,10))},[c]),X=R(oe(async e=>{if(e.length<2){d([]),p(!1);return}T(!0),p(!0);try{const t=await z(e);d(t)}catch(t){console.error("Search failed:",t),d([])}finally{T(!1)}},300),[z]),Z=e=>{const t=e.target.value;v(t),X(t)},V=e=>{l(e.id),f(e),v(""),d([]),p(!1)},ee=()=>{l(""),f(null),v(""),d([]),p(!1)};return P(()=>{if(m){f(null);return}a&&!x?($(!0),_(a).then(e=>{e&&f(e)}).finally(()=>{$(!1)})):a||f(null)},[a,m,_]),P(()=>{const e=t=>{w.current&&!w.current.contains(t.target)&&p(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),React.createElement("div",{ref:w,className:"vxfse-post-select-control",style:{marginBottom:"16px"}},React.createElement("div",{className:"vxfse-post-select-label",style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"8px"}},React.createElement("div",{style:{display:"flex",alignItems:"center",gap:"8px"}},E&&React.createElement(ne,{onClick:J}),React.createElement("label",{style:{fontSize:"13px",fontWeight:500,textTransform:"capitalize",color:"rgb(30, 30, 30)",margin:0}},g))),m?React.createElement("div",{className:"edit-voxel-tags",style:{backgroundColor:"rgb(47, 47, 49)",borderRadius:"10px",overflow:"hidden",padding:"12px"}},React.createElement("div",{style:{marginBottom:"12px"}},React.createElement("span",{style:{color:"#fff",fontSize:"13px",fontFamily:"inherit",wordBreak:"break-all"}},L())),React.createElement("div",{style:{height:"1px",backgroundColor:"rgba(255, 255, 255, 0.15)",marginBottom:"8px"}}),React.createElement("div",{style:{display:"flex"}},React.createElement("button",{type:"button",className:"edit-tags",onClick:()=>h(!0),style:{flex:1,background:"transparent",border:"none",color:"rgba(255, 255, 255, 0.8)",fontSize:"10px",fontWeight:600,letterSpacing:"0.5px",cursor:"pointer",padding:"6px 0",textAlign:"left"}},i("EDIT TAGS","voxel-fse")),React.createElement("button",{type:"button",className:"disable-tags",onClick:K,style:{flex:1,background:"transparent",border:"none",color:"rgba(255, 255, 255, 0.5)",fontSize:"10px",fontWeight:600,letterSpacing:"0.5px",cursor:"pointer",padding:"6px 0",textAlign:"right"}},i("DISABLE TAGS","voxel-fse")))):React.createElement(React.Fragment,null,(x||I)&&React.createElement("div",{className:"vxfse-post-select-selected",style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",marginBottom:"8px",backgroundColor:"#f9f9f9",border:"1px solid #ddd",borderRadius:"4px",fontSize:"13px",lineHeight:"1.4"}},I?React.createElement("span",{style:{color:"#757575"}},React.createElement(M,{style:{marginRight:"8px"}}),i("Loading...","voxel-fse")):x?React.createElement(React.Fragment,null,React.createElement("span",{style:{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:"#1e1e1e"}},x.title),React.createElement("button",{type:"button",onClick:ee,style:{background:"none",border:"none",color:"#757575",cursor:"pointer",fontSize:"11px",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",padding:"4px 8px",marginLeft:"8px",flexShrink:0},onMouseEnter:e=>{e.target.style.color="#d63638"},onMouseLeave:e=>{e.target.style.color="#757575"}},F)):null),React.createElement("div",{className:"vxfse-post-select-search",style:{position:"relative"}},React.createElement("input",{ref:q,type:"search",value:C,onChange:Z,onFocus:()=>{S.length>0&&p(!0)},placeholder:D,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1,style:{width:"100%",padding:"10px 12px",border:"1px solid #8c8f94",borderRadius:"4px",fontSize:"13px",boxSizing:"border-box",backgroundColor:"#fff"}}),React.createElement("span",{style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",pointerEvents:"none"}},React.createElement("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"#757575"},React.createElement("path",{d:"M2 4l4 4 4-4",stroke:"#757575",strokeWidth:"1.5",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})))),G&&React.createElement("div",{className:"vxfse-post-select-dropdown",style:{position:"absolute",zIndex:1e6,width:"calc(100% - 32px)",maxWidth:"260px",backgroundColor:"#fff",border:"1px solid #ddd",borderTop:"none",borderRadius:"0 0 4px 4px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",maxHeight:"250px",overflowY:"auto"}},Y?React.createElement("div",{style:{padding:"16px",textAlign:"center"}},React.createElement(M,null)):S.length>0?React.createElement("ul",{style:{margin:0,padding:0,listStyle:"none"}},S.map(e=>React.createElement("li",{key:e.id,onClick:()=>V(e),style:{padding:"10px 12px",cursor:"pointer",borderBottom:"1px solid #f0f0f0",fontSize:"13px",color:"#1e1e1e",lineHeight:"1.4"},onMouseEnter:t=>{t.target.style.backgroundColor="#f0f0f0"},onMouseLeave:t=>{t.target.style.backgroundColor="transparent"}},e.title))):C.length>=2?React.createElement("div",{style:{padding:"16px",textAlign:"center",color:"#757575",fontSize:"13px"}},j):null)),E&&U&&React.createElement(ae,{value:L(),onChange:Q,label:g,context:H,onClose:()=>h(!1),autoOpen:!0}))}export{de as P};
