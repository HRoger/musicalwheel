import t,{useState as d,useRef as te,useEffect as L,useCallback as m}from"react";import{Button as k}from"@wordpress/components";import{__ as c}from"@wordpress/i18n";import{k as ne,o as ae}from"./TypographyPopup-CAcEJ5NA.js";import"@wordpress/block-editor";const de=({label:I,value:_,onChange:r,supportsDynamicTags:j=!0,dynamicTagContext:W="post",showSelectedIcon:R=!1})=>{const l={library:_?.library||"",value:_?.value||""},b=e=>e?!["","svg","dynamic"].includes(e):!1,[p,C]=d(!1),[u,z]=d({}),[y,P]=d({}),[s,h]=d(""),[S,x]=d(""),[G,v]=d({}),U=te(null),[J,E]=d(!1),N=()=>{const e=l.value;return typeof e=="string"&&e.startsWith("@tags()")&&e.includes("@endtags()")},T=()=>{if(!N())return l.value||"";const e=l.value.match(/@tags\(\)(.*?)@endtags\(\)/s);return e?e[1]:l.value},F=e=>e?`@tags()${e}@endtags()`:"",V=()=>{E(!0)},M=()=>{window.confirm(c("Are you sure?","voxel-fse"))&&r({library:"",value:""})},Q=e=>{e&&r({library:"dynamic",value:F(e)}),E(!1)},H=N(),$=typeof window<"u"&&window.wp&&window.wp.media;L(()=>{if(p&&window.Voxel_Icon_Picker_Config&&!s){const e=window.Voxel_Icon_Picker_Config,a=Object.keys(e)[0];a&&h(a)}},[p,s]);const X=m(()=>{r({library:"",value:""})},[r]),Y=m(()=>{if(!$||!window.wp?.media){console.warn("WordPress media library not available");return}const e=window.wp.media({title:c("Select SVG Icon","voxel-fse"),button:{text:c("Select","voxel-fse")},multiple:!1,library:{type:"image/svg+xml"}});e.on("select",()=>{const n=e.state().get("selection").first().toJSON();n&&n.url&&r({library:"svg",value:n.url})}),e.open()},[$,r]),A=m(async(e,a)=>{if(!(u[e]||y[e]||!a.fetchJson)){P(n=>({...n,[e]:!0}));try{const n=await fetch(a.fetchJson);if(n.ok){const o=await n.json();let i=[];if(Array.isArray(o))i=o;else if(o&&typeof o=="object"){const f=o;i=f.icons||f.list||[]}z(f=>({...f,[e]:i}))}}catch(n){console.warn(`Failed to load icon list for ${e}:`,n)}finally{P(n=>{const o={...n};return delete o[e],o})}}},[u,y]),Z=m(e=>{if(x(e),!e.trim()){v({});return}const a=window.Voxel_Icon_Picker_Config;if(!a)return;const n={},o=e.toLowerCase();Object.entries(a).forEach(([i,f])=>{const D=(u[i]||f.list||[]).filter(ee=>ee.toLowerCase().includes(o));D.length>0&&(n[i]=D)}),v(n)},[u]);L(()=>{if(p){if(!document.getElementById("vx-backend-css-dynamic")){const e=document.querySelector('link[href*="backend.css"]');let a="";e&&e.href?a=e.href:a=`${window.location.origin}/wp-content/themes/voxel/assets/dist/backend.css`;const n=document.createElement("link");n.id="vx-backend-css-dynamic",n.rel="stylesheet",n.href=a,n.media="all",document.head.appendChild(n)}}else{const e=document.getElementById("vx-backend-css-dynamic");e&&e.remove()}},[p]);const q=m(()=>{if(!window.Voxel_Icon_Picker_Config){console.warn("Voxel icon picker config not available");return}C(!0),x(""),v({});const e=window.Voxel_Icon_Picker_Config;Object.entries(e).forEach(([a,n])=>{n.fetchJson&&A(a,n)})},[A]),w=m(()=>{C(!1),x(""),v({}),h("")},[]),K=m(e=>{h(e),x(""),v({})},[]),B=m((e,a)=>{const n=window.Voxel_Icon_Picker_Config;if(!n||!n[a])return;const o=n[a],i=`${o.displayPrefix} ${o.prefix}${e}`;r({library:"icon",value:i}),w()},[r,w]),g=!window.Voxel_Icon_Picker_Config||!s?null:window.Voxel_Icon_Picker_Config[s],O=g?u[s]||g.list||[]:[];return t.createElement("div",{className:"voxel-icon-picker-control",style:{marginBottom:"16px"}},t.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"}},t.createElement("div",{style:{display:"flex",alignItems:"center",gap:"8px"}},j&&t.createElement(ne,{onClick:V}),t.createElement("label",{style:{fontWeight:500,margin:0}},I))),H?t.createElement("div",{className:"edit-voxel-tags",style:{backgroundColor:"rgb(47, 47, 49)",borderRadius:"10px",overflow:"hidden",padding:"12px"}},t.createElement("div",{style:{marginBottom:"12px"}},t.createElement("span",{style:{color:"#fff",fontSize:"13px",fontFamily:"inherit",wordBreak:"break-all"}},T())),t.createElement("div",{style:{height:"1px",backgroundColor:"rgba(255, 255, 255, 0.15)",marginBottom:"8px"}}),t.createElement("div",{style:{display:"flex"}},t.createElement("button",{type:"button",className:"edit-tags",onClick:V,style:{flex:1,background:"transparent",border:"none",color:"rgba(255, 255, 255, 0.8)",fontSize:"10px",fontWeight:600,letterSpacing:"0.5px",cursor:"pointer",padding:"6px 0",textAlign:"left"}},c("EDIT TAGS","voxel-fse")),t.createElement("button",{type:"button",className:"disable-tags",onClick:M,style:{flex:1,background:"transparent",border:"none",color:"rgba(255, 255, 255, 0.5)",fontSize:"10px",fontWeight:600,letterSpacing:"0.5px",cursor:"pointer",padding:"6px 0",textAlign:"right"}},c("DISABLE TAGS","voxel-fse")))):t.createElement(t.Fragment,null,t.createElement("style",null,`
						.voxel-icon-picker-control .voxel-icon-btn-active.components-button {
							background-color: var(--wp-components-color-accent, var(--wp-admin-theme-color, #3858e9)) !important;
							color: #fff !important;
						}
						.voxel-icon-picker-control .voxel-icon-picker-btn.components-button {
							min-width: 36px !important;
							width: 36px !important;
							height: 36px !important;
							padding: 0 !important;
							display: flex !important;
							align-items: center !important;
							justify-content: center !important;
							overflow: visible !important;
						}
						.voxel-icon-picker-control .voxel-icon-picker-btn.components-button i {
							font-size: 16px !important;
							line-height: 1 !important;
							width: auto !important;
							height: auto !important;
						}
					`),t.createElement("div",{style:{display:"flex",gap:"4px",alignItems:"center"}},t.createElement(k,{variant:l.library===""?"primary":"secondary",onClick:X,title:c("None","voxel-fse"),className:`voxel-icon-picker-btn ${l.library===""?"voxel-icon-btn-active":""}`},t.createElement("i",{className:"eicon-ban","aria-hidden":"true"})),t.createElement(k,{variant:l.library==="svg"?"primary":"secondary",onClick:Y,title:c("Upload SVG","voxel-fse"),className:`voxel-icon-picker-btn ${l.library==="svg"?"voxel-icon-btn-active":""}`},t.createElement("i",{className:"eicon-upload","aria-hidden":"true"})),t.createElement(k,{variant:b(l.library)?"primary":"secondary",onClick:q,title:c("Icon Library","voxel-fse"),className:`voxel-icon-picker-btn ${b(l.library)?"voxel-icon-btn-active":""}`},(R||b(l.library))&&l.value?t.createElement("i",{className:l.value,"aria-hidden":"true"}):l.library==="svg"&&l.value?t.createElement("img",{src:l.value,alt:"",style:{width:"16px",height:"16px"}}):t.createElement("i",{className:"eicon-circle","aria-hidden":"true"})))),p&&t.createElement("div",{className:"icon-picker-modal"},t.createElement("div",{className:"ts-modal-backdrop",onClick:w}),t.createElement("div",{className:"icons-modal ts-theme-options",ref:U},g&&O.length>0?t.createElement("div",{className:"x-row"},t.createElement("div",{className:"inner-tab x-col-4"},t.createElement("div",{className:"x-row"},t.createElement("div",{className:"ts-form-group x-col-12"},t.createElement("label",null,"Search icons"),t.createElement("input",{type:"text",value:S,onChange:e=>Z(e.target.value),placeholder:"Search icon"})),t.createElement("div",{className:"x-col-12"},t.createElement("ul",{className:"inner-tabs vertical-tabs"},window.Voxel_Icon_Picker_Config&&Object.entries(window.Voxel_Icon_Picker_Config).map(([e,a])=>t.createElement("li",{key:e,className:s===e?"current-item":""},t.createElement("a",{href:"#",onClick:n=>{n.preventDefault(),K(e)}},t.createElement("i",{className:a.labelIcon}),t.createElement("span",null,a.label)))))))),t.createElement("div",{className:"icon-list-wrapper min-scroll x-col-8"},S?t.createElement("div",{className:"filtered-icons"},Object.entries(G).map(([e,a])=>{const n=window.Voxel_Icon_Picker_Config?.[e];return n?t.createElement("div",{key:e},t.createElement("code",null,n.label),t.createElement("div",{className:"icon-list"},a.map(o=>t.createElement("div",{key:o,className:"single-icon",onClick:i=>{i.preventDefault(),i.stopPropagation(),B(o,e)},title:o},t.createElement("i",{className:`${n.displayPrefix} ${n.prefix}${o}`}),t.createElement("span",null,o))))):null})):t.createElement("div",{className:"icon-list"},O.map(e=>t.createElement("div",{key:e,className:"single-icon",onClick:a=>{a.preventDefault(),a.stopPropagation(),B(e,s)},title:e},t.createElement("i",{className:`${g.displayPrefix} ${g.prefix}${e}`}),t.createElement("span",null,e)))))):t.createElement("div",{className:"x-row"},t.createElement("div",{className:"x-col-12"},t.createElement("label",null,y[s]?c("Loading icons...","voxel-fse"):c("No icon packs available.","voxel-fse")))))),J&&t.createElement(ae,{value:T(),onChange:Q,label:I,context:W,onClose:()=>E(!1),autoOpen:!0}))};export{de as I};
