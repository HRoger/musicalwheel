import{useState as s,useRef as H,useEffect as C,useCallback as r}from"react";import{__ as x}from"@wordpress/i18n";import{I as G}from"./TypographyPopup-BXz72zyZ.js";function q({label:N,value:y,onChange:o,help:S,supportsDynamicTags:V=!0,dynamicTagContext:A="post"}){const v={library:y?.library||"",value:y?.value||""},[d,E]=s(!1),[m,$]=s({}),[p,R]=s({}),[l,h]=s(""),[k,g]=s(""),[j,f]=s({}),L=H(null);C(()=>{if(d&&window.Voxel_Icon_Picker_Config&&!l){const e=window.Voxel_Icon_Picker_Config,c=Object.keys(e)[0];c&&h(c)}},[d,l]);const w=r(async(e,c)=>{if(!(m[e]||p[e]||!c.fetchJson)){R(t=>({...t,[e]:!0}));try{const t=await fetch(c.fetchJson);if(t.ok){const n=await t.json();let a=[];if(Array.isArray(n))a=n;else if(n&&typeof n=="object"){const i=n;Array.isArray(i.icons)?a=i.icons:Array.isArray(i.list)&&(a=i.list)}$(i=>({...i,[e]:a}))}}catch(t){console.warn(`Failed to load icon list for ${e}:`,t)}finally{R(t=>{const n={...t};return delete n[e],n})}}},[m,p]),O=r(e=>{if(g(e),!e.trim()){f({});return}const c=window.Voxel_Icon_Picker_Config;if(!c)return;const t={},n=e.toLowerCase();Object.entries(c).forEach(([a,i])=>{const P=(m[a]||i.list||[]).filter(F=>F.toLowerCase().includes(n));P.length>0&&(t[a]=P)}),f(t)},[m]),D=r(()=>{if(!window.Voxel_Icon_Picker_Config){console.warn("Voxel icon picker config not available");return}E(!0),g(""),f({});const e=window.Voxel_Icon_Picker_Config;Object.entries(e).forEach(([c,t])=>{t.fetchJson&&w(c,t)})},[w]),b=r(()=>{E(!1),g(""),f({}),h("")},[]),U=r(e=>{h(e),g(""),f({})},[]),_=r((e,c)=>{const t=window.Voxel_Icon_Picker_Config;if(!t||!t[c])return;const n=t[c],a=`${n.displayPrefix} ${n.prefix}${e}`;o({library:"icon",value:a}),b()},[o,b]);C(()=>{if(d&&!document.getElementById("vx-backend-css-dynamic")){const e=document.querySelector('link[href*="backend.css"]');let c="";e&&e.href?c=e.href:c=`${window.location.origin}/wp-content/themes/voxel/assets/dist/backend.css`;const t=document.createElement("link");t.id="vx-backend-css-dynamic",t.rel="stylesheet",t.href=c,t.media="all",document.head.appendChild(t)}},[d]);const u=!window.Voxel_Icon_Picker_Config||!l?null:window.Voxel_Icon_Picker_Config[l],I=u?m[l]||u.list||[]:[],T=e=>{!e||!e.url?o({library:"",value:""}):o({library:"svg",value:e.url})},B=[{label:x("Icon Library","voxel-fse"),onClick:D},{label:x("Upload SVG","voxel-fse"),allowedTypes:["image/svg+xml"]}],J=e=>v.library==="icon"?React.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",minHeight:"100px",color:"#495157"}},React.createElement("i",{className:e.url,style:{fontSize:"40px"}})):React.createElement("img",{src:e.url,alt:"",style:{display:"block",width:"100%",height:"auto",maxHeight:"150px",objectFit:"contain",padding:"10px"}}),Q=e=>{o(e?{library:"dynamic",value:e}:{library:"",value:""})},z=v.library==="dynamic"?v.value:void 0;return React.createElement("div",{className:"voxel-advanced-icon-control"},React.createElement(G,{label:N,value:{url:v.value},onChange:T,buttons:B,renderPreview:J,help:S,responsive:!1,enableDynamicTags:V,dynamicTagValue:z,onDynamicTagChange:Q,dynamicTagContext:A}),d&&React.createElement("div",{className:"icon-picker-modal"},React.createElement("div",{className:"ts-modal-backdrop",onClick:b}),React.createElement("div",{className:"icons-modal ts-theme-options",ref:L},u&&I.length>0?React.createElement("div",{className:"x-row"},React.createElement("div",{className:"inner-tab x-col-4"},React.createElement("div",{className:"x-row"},React.createElement("div",{className:"ts-form-group x-col-12"},React.createElement("label",null,"Search icons"),React.createElement("input",{type:"text",value:k,onChange:e=>O(e.target.value),placeholder:"Search icon"})),React.createElement("div",{className:"x-col-12"},React.createElement("ul",{className:"inner-tabs vertical-tabs"},window.Voxel_Icon_Picker_Config&&Object.entries(window.Voxel_Icon_Picker_Config).map(([e,c])=>React.createElement("li",{key:e,className:l===e?"current-item":""},React.createElement("a",{href:"#",onClick:t=>{t.preventDefault(),U(e)}},React.createElement("i",{className:c.labelIcon}),React.createElement("span",null,c.label)))))))),React.createElement("div",{className:"icon-list-wrapper min-scroll x-col-8"},k?React.createElement("div",{className:"filtered-icons"},Object.entries(j).map(([e,c])=>{const t=window.Voxel_Icon_Picker_Config?.[e];return t?React.createElement("div",{key:e},React.createElement("code",null,t.label),React.createElement("div",{className:"icon-list"},c.map(n=>React.createElement("div",{key:n,className:"single-icon",onClick:a=>{a.preventDefault(),a.stopPropagation(),_(n,e)},title:n},React.createElement("i",{className:`${t.displayPrefix} ${t.prefix}${n}`}),React.createElement("span",null,n))))):null})):React.createElement("div",{className:"icon-list"},I.map(e=>React.createElement("div",{key:e,className:"single-icon",onClick:c=>{c.preventDefault(),c.stopPropagation(),_(e,l)},title:e},React.createElement("i",{className:`${u.displayPrefix} ${u.prefix}${e}`}),React.createElement("span",null,e)))))):React.createElement("div",{className:"x-row"},React.createElement("div",{className:"x-col-12"},React.createElement("label",null,p[l]?x("Loading icons...","voxel-fse"):x("No icon packs available.","voxel-fse")))))))}export{q as A};
