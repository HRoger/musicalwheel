import{useState as I,useRef as G,useMemo as ae,useEffect as J,useCallback as T}from"react";import{createPortal as Ce}from"react-dom";import{a as Oe}from"./siteUrl-7x5eJEvc.js";import We from"@wordpress/api-fetch";import{V as se,r as Ne}from"./voxelIcons-gVyOSQ_B.js";import"./voxelShim-DB_Ue-9R.js";import"./backgroundElements-Ui-iCrLV.js";import"./MediaPopup-CXePoOCG.js";import{F as ne,D as Re}from"./DatePicker-NCeMpzfF.js";import De from"nouislider";function Ae(e,t){const n={},l=[t];return e.width&&e.width>0&&(n.width=`${e.width}%`,n.flexGrow=0,n.flexShrink=0),e.hideFilter&&l.push("vx-hidden"),e.alignContent&&(n.justifyContent=e.alignContent),e.hideLabel&&l.push("hide-label"),{style:n,className:l.join(" ")}}function Y(e,t){return Ae(e,t)}function re(e){const t={},n=["ts-field-popup","triggers-blur"];return e.customPopupEnabled&&(e.popupMinWidth&&e.popupMinWidth>0&&(t.minWidth=`${e.popupMinWidth}px`),e.popupMaxWidth&&e.popupMaxWidth>0&&(t.maxWidth=`${e.popupMaxWidth}px`),e.popupMaxHeight&&e.popupMaxHeight>0&&(t.maxHeight=`${e.popupMaxHeight}px`),e.popupCenterPosition&&n.push("ts-popup-centered")),{style:t,className:n.join(" ")}}function Ue({attributes:e,postTypes:t,context:n,onSubmit:l,onPostTypeChange:d,onFilterChange:E}){const[u,m]=I(()=>({currentPostType:e.postTypes[0]||"",filterValues:{},activeFilterCount:0,portalActive:!1,loading:!1,resetting:!1,narrowedValues:null,narrowingFilters:!1,lastModifiedFilter:null})),c=G(!1),b=G(null),o=ae(()=>t.find(i=>i.key===u.currentPostType),[t,u.currentPostType]),S=ae(()=>e.filterLists[u.currentPostType]||[],[e.filterLists,u.currentPostType]);J(()=>{e.postTypes.length>0&&!e.postTypes.includes(u.currentPostType)&&m(i=>({...i,currentPostType:e.postTypes[0],filterValues:{}}))},[e.postTypes,u.currentPostType]),J(()=>{if(!o?.filters)return;const i={};let p=!1;o.filters.forEach(w=>{w.key in u.filterValues||w.value!==null&&w.value!==void 0&&(i[w.key]=w.value,p=!0)}),p&&m(w=>({...w,filterValues:{...w.filterValues,...i}}))},[o?.filters,u.currentPostType]),J(()=>{if(n!=="editor"||u.resetting||!o?.filters)return;(e.filterLists?.[u.currentPostType]||[]).forEach(p=>{const w=u.filterValues[p.filterKey];p.defaultValueEnabled&&p.defaultValue!==void 0&&p.defaultValue!==""&&p.defaultValue!==null?w!==p.defaultValue&&w!==null&&m(y=>({...y,filterValues:{...y.filterValues,[p.filterKey]:p.defaultValue}})):w!=null&&m(y=>({...y,filterValues:{...y.filterValues,[p.filterKey]:void 0}}))})},[n,u.currentPostType,e.filterLists,u.resetting,o?.filters]),J(()=>{const i=Object.values(u.filterValues).filter(p=>p!=null&&p!==""&&p!==!1).length;m(p=>({...p,activeFilterCount:i}))},[u.filterValues]);const r=T(i=>{m(p=>p.currentPostType===i?p:{...p,currentPostType:i,filterValues:{}}),n==="editor"&&d&&d(i),n==="editor"&&E&&E({}),n==="frontend"&&l&&(e.updateUrl!==!1&&Ve({},i),setTimeout(()=>{l({postType:i})},50))},[n,l,d,E,e.updateUrl]),g=T((i,p)=>{m(w=>{const y={...w.filterValues,[i]:p};return n==="editor"&&E&&setTimeout(()=>E(y),0),{...w,filterValues:y,lastModifiedFilter:i}})},[n,E]),_=T((i=!1)=>{const p={};o?.filters?.forEach(y=>{y.resets_to!==null&&y.resets_to!==void 0?p[y.key]=y.resets_to:p[y.key]=null});const w=Object.values(p).filter(y=>y!=null&&y!=="").length;if(m(y=>({...y,filterValues:p,activeFilterCount:w,resetting:!0,portalActive:i?!1:y.portalActive,narrowedValues:null,lastModifiedFilter:null})),setTimeout(()=>{m(y=>({...y,resetting:!1}))},100),n==="editor"&&E&&E(p),n==="frontend"){e.updateUrl!==!1&&je(u.currentPostType);const y=new CustomEvent("voxel-search-clear",{detail:{postType:u.currentPostType}});window.dispatchEvent(y)}},[n,u.currentPostType,E,e.updateUrl,o?.filters]),C=T(()=>{m(i=>({...i,portalActive:!i.portalActive}))},[]),k=T(async()=>{if(!e.adaptiveFiltering||n!=="frontend")return;if(c.current){c.current=!1;return}const i=S.filter(y=>y.type==="range"||y.type==="terms");if(i.length===0)return;const p=new URLSearchParams;p.set("type",u.currentPostType),u.lastModifiedFilter&&p.set("_last_modified",u.lastModifiedFilter),Object.entries(u.filterValues).forEach(([y,v])=>{v!=null&&v!==""&&(Array.isArray(v)?p.set(y,v.join(",")):typeof v=="object"?p.set(y,JSON.stringify(v)):p.set(y,String(v)))});const w=[];i.forEach(y=>{if(y.type==="terms"){const v=o?.filters?.find(R=>R.key===y.filterKey);if(v?.props?.terms){const R=h=>{h.forEach(a=>{a.term_taxonomy_id&&w.push(a.term_taxonomy_id),a.children&&Array.isArray(a.children)&&R(a.children)})};R(v.props.terms)}}}),m(y=>({...y,narrowingFilters:!0}));try{const y=Oe(),v=await fetch(`${y}voxel-fse/v1/search-form/narrow-filters?${p.toString()}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({term_taxonomy_ids:w})});if(!v.ok)throw new Error(`HTTP ${v.status}`);const R=await v.json();R.success&&R.data?(m(h=>({...h,narrowedValues:{ranges:R.data.ranges||{},terms:R.data.terms||{}},narrowingFilters:!1})),c.current=!0):m(h=>({...h,narrowingFilters:!1}))}catch(y){console.error("[useSearchForm] Adaptive filtering error:",y),m(v=>({...v,narrowingFilters:!1}))}},[e.adaptiveFiltering,n,S,u.currentPostType,u.filterValues,o]);J(()=>{if(!(!e.adaptiveFiltering||n!=="frontend"))return b.current&&clearTimeout(b.current),b.current=setTimeout(()=>{k()},300),()=>{b.current&&clearTimeout(b.current)}},[u.filterValues,e.adaptiveFiltering,n,k]);const $=T((i,p)=>{m(w=>({...w,loading:!0})),l&&l({postType:p,...i}),n==="frontend"&&e.updateUrl!==!1&&Ve(i,p),m(w=>({...w,loading:!1}))},[n,l,e.updateUrl]);J(()=>{if(e.searchOn==="change"&&n==="frontend"){const i=setTimeout(()=>{$(u.filterValues,u.currentPostType)},300);return()=>{clearTimeout(i)}}},[u.filterValues,u.currentPostType,e.searchOn,n,$]);const x=T(()=>{$(u.filterValues,u.currentPostType)},[$,u.filterValues,u.currentPostType]);return{state:u,setCurrentPostType:r,setFilterValue:g,clearAll:_,togglePortal:C,submit:x,currentPostTypeConfig:o,filterConfigs:S,narrowedValues:u.narrowedValues,narrowingFilters:u.narrowingFilters}}function je(e){const t=new URL(window.location.href),n=[];t.searchParams.forEach((l,d)=>{(d.startsWith("filter_")||d==="post_type")&&n.push(d),d==="type"&&!e&&n.push(d),d!=="type"&&d!=="page"&&d!=="pg"&&n.push(d)}),n.forEach(l=>t.searchParams.delete(l)),e&&t.searchParams.set("type",e),window.history.replaceState({},"",t.toString())}function He(e,t){return Object.hasOwn(t,e)}function Ve(e,t){const n=new URL(window.location.href),l=[];n.searchParams.forEach((d,E)=>{(E.startsWith("filter_")||E==="post_type")&&l.push(E),(E==="type"||He(E,e))&&l.push(E)}),l.forEach(d=>n.searchParams.delete(d)),t&&n.searchParams.set("type",t),Object.entries(e).forEach(([d,E])=>{E!=null&&E!==""&&(Array.isArray(E)?n.searchParams.set(d,E.join(",")):typeof E=="object"?n.searchParams.set(d,JSON.stringify(E)):n.searchParams.set(d,String(E)))}),window.history.replaceState({},"",n.toString())}function ke(e){return typeof e=="string"&&e.includes("@tags()")}function Fe(e){if(!ke(e))return e;const t=e.match(/@tags\(\)(.*?)@endtags\(\)/s);return t?t[1]:e}async function _e(e,t={}){try{return(await We({path:"/voxel-fse/v1/dynamic-data/render",method:"POST",data:{expression:e,context:t}})).rendered}catch(n){return console.error("Failed to render dynamic tag:",n),e}}function we(){return typeof document>"u"?!1:document.body.classList.contains("logged-in")}function Ke(){return typeof document>"u"?[]:Array.from(document.body.classList).filter(n=>n.startsWith("role-")||["administrator","editor","author","contributor","subscriber"].includes(n)).map(n=>n.replace("role-",""))}function qe(e){const t=e.filterKey;switch(t){case"user:logged_in":return we();case"user:logged_out":return!we();case"user:role":{if(!we())return!1;const n=Ke(),l=e.value||"";switch(e.operator){case"equals":return n.includes(l);case"not_equals":return!n.includes(l);default:return n.includes(l)}}default:return console.warn(`Unknown visibility rule type: ${t}`),!0}}function ze(e){return!e||e.length===0?!0:e.every(t=>qe(t))}function Ge(e){const{rowVisibility:t="show",visibilityRules:n=[]}=e;if(!n||n.length===0)return!0;const l=ze(n);return t==="hide"?!l:l}function Je({config:e,filterData:t,value:n,onChange:l,blockId:d}){const E=d?`voxel-popup-${d}`:"",u=G(null),m=G(null),[c,b]=I(!1),[o,S]=I(""),r=typeof n=="string"?n:"",g=t.props?.placeholder||t.label||"Type keywords...",_=e.displayAs||t.props?.display_as||"inline",C=t.icon||"";J(()=>{c&&(S(r),setTimeout(()=>{m.current?.focus()},50))},[c,r]);const k=a=>{l(a.target.value)},$=a=>{S(a.target.value)},x=T(()=>{b(!0)},[]),i=T(()=>{l(o),b(!1)},[o,l]),p=T(()=>{S(""),l("")},[l]),w=T(a=>{a.key==="Enter"&&(a.preventDefault(),i())},[i]);if(_==="inline"){const{style:a,className:f}=Y(e,"ts-form-group ts-inline-filter");return React.createElement("div",{className:f,style:a},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:"ts-input-icon flexify"},C&&React.createElement("span",{dangerouslySetInnerHTML:{__html:C}}),React.createElement("input",{type:"text",value:r,onChange:k,placeholder:g,className:"inline-input"})))}const y=r.length>0,{style:v,className:R}=Y(e,"ts-form-group"),h=re(e);return React.createElement("div",{className:R,style:v},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:u,className:`ts-filter ts-popup-target ${y?"ts-filled":""}`,onClick:x,onMouseDown:a=>a.preventDefault(),role:"button",tabIndex:0},C&&React.createElement("span",{dangerouslySetInnerHTML:{__html:C}}),React.createElement("div",{className:"ts-filter-text"},y?r:g)),React.createElement(ne,{isOpen:c,target:u,title:"",icon:C,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:i,onClear:p,onClose:()=>b(!1),className:`${E}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:h.style},React.createElement("div",{className:"ts-input-icon ts-sticky-top flexify"},React.createElement("span",null,se.search),React.createElement("input",{ref:m,type:"text",value:o,onChange:$,onKeyDown:w,placeholder:g,className:"autofocus border-none"}))))}function Pe(e,t,n){if(e==null||e==="")return{min:t,max:n};if(typeof e=="string"&&e.includes("..")){const l=e.split(".."),d=l[0]!==""?Number(l[0]):t,E=l[1]!==""?Number(l[1]):n;return{min:isNaN(d)?t:d,max:isNaN(E)?n:E}}if(typeof e=="object"){const l=e;return{min:l.min??t,max:l.max??n}}return typeof e=="number"?{min:e,max:n}:{min:t,max:n}}function Ye({config:e,filterData:t,value:n,onChange:l,blockId:d,narrowedValues:E,isNarrowing:u}){const m=[d?`voxel-popup-${d}`:"",e.id?`elementor-repeater-item-${e.id}`:""].filter(Boolean).join(" "),c=G(null),b=G(null),o=G(null),[S,r]=I(!1),g=t.props||{},_=g.min??0,C=g.max??100,k=g.step??1,$=g.placeholder||t.label||"Range",x=e.displayAs||t.props?.display_as||"popup",i=g.handles||"double",p=g.compare||"in_range",w=e.filterKey,y=E?.ranges?.[w],v=y?.min??_,R=y?.max??C,h=g.format||"number",a=g.prefix||(typeof h=="object"?h.prefix:"")||"",f=g.suffix||(typeof h=="object"?h.suffix:"")||"",P=t.icon||"",q=Pe(n,v,R),[V,z]=I(q.min),[O,U]=I(q.max),D=T(M=>h==="price"?`${a}${M.toLocaleString()}${f}`:`${a}${M}${f}`,[h,a,f]),j=n!=null&&n!==""&&(q.min!==v||q.max!==R),ee=j?`${D(q.min)} — ${D(q.max)}`:$,le=`${D(V)} — ${D(O)}`,B=T(()=>{if(!b.current||o.current)return;const M=V,H=O;let fe,ue;i==="double"?(fe=[M,H],ue=!0):p==="in_range"?(fe=[H],ue=[!1,!0]):(fe=[M],ue=[!0,!1]),De.create(b.current,{start:fe,connect:ue,range:{min:v,max:R},step:k,behaviour:"tap-drag"}),o.current=b.current.noUiSlider,o.current.on("update",W=>{i==="double"?(z(Math.round(Number(W[0]))),U(Math.round(Number(W[1])))):p==="in_range"?U(Math.round(Number(W[0]))):z(Math.round(Number(W[0])))}),requestAnimationFrame(()=>{o.current&&(i==="double"?o.current.set([M,H],!1):o.current.set([M],!1))})},[i,p,V,O,v,R,k]),X=T(()=>{o.current&&(o.current.destroy(),o.current=null)},[]);J(()=>{const M=Pe(n,v,R);if(z(M.min),U(M.max),o.current){const H=i==="double"?[M.min,M.max]:[M.min];o.current.set(H,!1),requestAnimationFrame(()=>{o.current&&o.current.set(H,!1)})}},[n,v,R,i]),J(()=>{if(S&&x==="popup"){const M=setTimeout(()=>{B()},100);return()=>clearTimeout(M)}return()=>{x==="popup"&&X()}},[S,x,B,X]),J(()=>{if(x==="inline")return B(),()=>X()},[x,B,X]),J(()=>{if(!o.current||!y)return;o.current.updateOptions({range:{min:v,max:R}},!0);let M=V,H=O;M<v&&(M=v),M>R&&(M=R),i==="double"&&(H<v&&(H=v),H>R&&(H=R),M>H&&(M=H)),i==="double"?o.current.set([M,H]):o.current.set([M]),z(M),U(H)},[y,v,R,i]);const Z=T(()=>{r(!0)},[]),F=T((M,H)=>M===v&&H===R?null:i==="double"?`${M}..${H}`:p==="greater_than"||p==="in_range"?`${M}..`:`..${H}`,[i,p,v,R]),s=M=>{const H=M.target.value===""?v:Number(M.target.value);z(H),o.current&&o.current.set(i==="double"?[H,O]:[H]),x==="minmax"&&l(F(H,O))},N=M=>{const H=M.target.value===""?R:Number(M.target.value);U(H),o.current&&o.current.set([V,H]),x==="minmax"&&l(F(V,H))},L=T(()=>{l(F(V,O)),r(!1)},[V,O,F,l]),A=T(()=>{z(v),U(R),o.current&&o.current.set(i==="double"?[v,R]:[v]),l(null)},[v,R,i,l]),Q=()=>React.createElement("div",{className:"ts-minmax"},React.createElement("input",{type:"number",className:"inline-input input-no-icon",placeholder:String(v),value:V,onChange:s,min:v,max:O,step:k}),i==="double"&&React.createElement("input",{type:"number",className:"inline-input input-no-icon",placeholder:String(R),value:O,onChange:N,min:V,max:R,step:k})),K=()=>React.createElement("div",{className:`range-slider-wrapper${u?" ts-loading":""}`},React.createElement("div",{className:"range-value"},le),React.createElement("div",{ref:b,className:"range-slider"}),y&&(y.min!==_||y.max!==C)&&React.createElement("div",{className:"range-narrowed-indicator"},React.createElement("small",null,"Showing ",D(v)," — ",D(R)," based on current results")));if(x==="minmax"&&i==="double"){const{style:M,className:H}=Y(e,"ts-form-group");return React.createElement("div",{className:H,style:M},!e.hideLabel&&React.createElement("label",null,t.label),Q())}if(x==="inline"){const{style:M,className:H}=Y(e,"ts-form-group ts-inline-filter");return React.createElement("div",{className:H,style:M},!e.hideLabel&&React.createElement("label",null,t.label),K())}const{style:te,className:me}=Y(e,"ts-form-group"),ie=re(e);return React.createElement("div",{className:me,style:te},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:c,className:`ts-filter ts-popup-target ${j?"ts-filled":""}`,onClick:Z,onMouseDown:M=>M.preventDefault(),role:"button",tabIndex:0},P&&React.createElement("span",{dangerouslySetInnerHTML:{__html:P}}),React.createElement("div",{className:"ts-filter-text"},ee),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ne,{isOpen:S,target:c,title:"",icon:P,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:L,onClear:A,onClose:()=>r(!1),className:`${m}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:ie.style},React.createElement("div",{className:"ts-form-group"},React.createElement("label",null,t.label,t.description&&React.createElement("small",null,t.description)),K())))}function Qe(e,t){let n=null;return function(...l){n&&clearTimeout(n),n=setTimeout(()=>e.apply(this,l),t)}}function Xe({config:e,filterData:t,value:n,onChange:l,blockId:d}){const E=d?`voxel-popup-${d}`:"",u=t.props||{},m=u.min??0,c=u.max??99,b=u.step??1,o=u.default??m,S=u.placeholder||t.label||"Any",r=e.displayAs||t.props?.display_as||"popup",g=t.icon||"",_=G(null),[C,k]=I(!1),$=typeof n=="number"?n:o,[x,i]=I($),p=ae(()=>Qe(O=>l(O),300),[l]);J(()=>{i(typeof n=="number"?n:o)},[n,o]),J(()=>{C&&i($)},[C,$]);const w=O=>{O.preventDefault();const U=Math.max(m,x-b);i(U),r==="inline"&&p(U)},y=O=>{O.preventDefault();const U=Math.min(c,x+b);i(U),r==="inline"&&p(U)},v=O=>{const U=parseInt(O.target.value,10);if(!isNaN(U)){const D=Math.min(c,Math.max(m,U));i(D),r==="inline"&&p(D)}},R=T(()=>{k(!0)},[]),h=T(()=>{l(x),k(!1)},[x,l]),a=T(()=>{i(o),l(o)},[o,l]),f=()=>React.createElement("div",{className:"ts-stepper-input flexify"},React.createElement("button",{type:"button",className:"ts-stepper-left ts-icon-btn inline-btn-ts",onClick:w},React.createElement("i",{className:"las la-minus"})),React.createElement("input",{type:"number",className:"ts-input-box",min:m,max:c,step:b,value:x,onChange:v,placeholder:S}),React.createElement("button",{type:"button",className:"ts-stepper-right ts-icon-btn inline-btn-ts",onClick:y},React.createElement("i",{className:"las la-plus"})));if(r==="inline"){const{style:O,className:U}=Y(e,"ts-form-group ts-inline-filter");return React.createElement("div",{className:U,style:O},!e.hideLabel&&React.createElement("label",null,t.label),f())}const P=$!==o,{style:q,className:V}=Y(e,"ts-form-group"),z=re(e);return React.createElement("div",{className:V,style:q},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:_,className:`ts-filter ts-popup-target ${P?"ts-filled":""}`,onClick:R,onMouseDown:O=>O.preventDefault(),role:"button",tabIndex:0},g&&React.createElement("span",{dangerouslySetInnerHTML:{__html:g}}),React.createElement("div",{className:"ts-filter-text"},P?x:S),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ne,{isOpen:C,target:_,title:"",icon:g,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:h,onClear:a,onClose:()=>k(!1),className:`${E}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:z.style},React.createElement("div",{className:"ts-form-group"},React.createElement("label",null,t.label,t.description&&React.createElement("small",null,t.description)),f())))}function Ze(e){return e==null||e===""?[]:typeof e=="string"?e.split(",").map(t=>t.trim()).filter(t=>t!==""):Array.isArray(e)?e.length>0&&typeof e[0]=="string"?e:e.length>0&&typeof e[0]=="number"?e.map(String):[]:[]}function Se(e){return e.length===0?null:e.join(",")}function et({config:e,filterData:t,value:n,onChange:l,blockId:d,narrowedValues:E,isNarrowing:u}){const m=d?`voxel-popup-${d}`:"",c=G(null),b=G(null),[o,S]=I(!1),[r,g]=I(""),_=t.props||{},C=_.multiple??!0,k=_.placeholder||t.label||"Select",$=e.displayAs||_.display_as||"popup",x=e.hideEmptyTerms??_.hide_empty_terms??!1,i=t.icon||"",p=_.taxonomy||e.filterKey,w=E?.terms?.[p],y=T(F=>{const s=(N,L,A)=>{const Q={...N,parentRef:L||void 0,hasSelection:!1,depth:A};return N.children&&N.children.length>0&&(Q.children=N.children.map(K=>s(K,Q,A+1))),Q};return F.map(N=>s(N,null,0))},[]),v=ae(()=>{const F=_.terms||[];return y(F)},[_,y]),R=ae(()=>{const F=new Map,s=N=>{F.set(N.slug,N),N.children&&N.children.forEach(L=>s(L))};return v.forEach(N=>s(N)),F},[v]),h=ae(()=>{const F=[],s=N=>{N.forEach(L=>{x&&w&&L.term_taxonomy_id&&w[L.term_taxonomy_id]===0||(F.push(L),L.children&&L.children.length>0&&s(L.children))})};return s(v),F},[v,x,w]),a=T(F=>!w||!F.term_taxonomy_id?null:w[F.term_taxonomy_id]??null,[w]),f=ae(()=>Ze(n),[n]),P=T(F=>F.slug?f.includes(F.slug):!1,[f]),q=ae(()=>h.filter(F=>F.slug&&f.includes(F.slug)),[h,f]),V=ae(()=>{if(!r)return h;const F=r.toLowerCase();return h.filter(s=>s.label.toLowerCase().includes(F))},[h,r]);J(()=>{o&&(g(""),h.length>=15&&setTimeout(()=>b.current?.focus(),50))},[o,h.length]);const z=T(()=>{S(!0)},[]),O=T(F=>{const s=F.slug;if(s)if(C){let N=[...f];if(N.includes(s)){N=N.filter(A=>A!==s);let L=F.parentRef;for(;L;)L.children?.some(Q=>N.includes(Q.slug)||Q.hasSelection)||(L.hasSelection=!1),L=L.parentRef;l(Se(N))}else{N.push(s);let L=F.parentRef;for(;L;)N=N.filter(Q=>Q!==L.slug),L.hasSelection=!0,L=L.parentRef;const A=new Set;N.forEach(Q=>{const K=R.get(Q);if(!K)return;let te=K.parentRef;const me=[];let ie=!1;for(;te;){if(te.slug===s){ie=!0;break}me.push(te),te=te.parentRef}ie&&(A.add(K.slug),me.forEach(M=>{M.hasSelection=!1}))}),N=N.filter(Q=>!A.has(Q)),l(Se(N))}}else l(Se([s])),$!=="inline"&&S(!1)},[C,f,l,R,$]),U=T(()=>{S(!1)},[]),D=T(()=>{l(null)},[l]),j=f.length>0,ee=j&&q[0]?.label||k,le=q.length>1?q.length-1:0;if($==="inline"){const{style:F,className:s}=Y(e,"ts-form-group inline-terms-wrapper ts-inline-filter min-scroll");return React.createElement("div",{className:`${s}${u?" ts-loading":""}`,style:F},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:"ts-term-dropdown ts-multilevel-dropdown inline-multilevel"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},h.map(N=>{const L=P(N),A=a(N),Q=A===0;return React.createElement("li",{key:N.slug,className:`${L?"ts-selected":""}${Q?" ts-disabled":""}`},React.createElement("a",{href:"#",className:"flexify",onClick:K=>{K.preventDefault(),Q||O(N)}},React.createElement("div",{className:"ts-checkbox-container"},React.createElement("label",{className:`container-${C?"checkbox":"radio"}`},React.createElement("input",{type:C?"checkbox":"radio",checked:L,readOnly:!0,disabled:!0,hidden:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,N.depth>0?"— ".repeat(N.depth):"",N.label),A!==null&&React.createElement("span",{className:"ts-term-count"},"(",A,")"),N.icon&&React.createElement("div",{className:"ts-term-icon",dangerouslySetInnerHTML:{__html:N.icon}})))}))))}if($==="buttons"){const{style:F,className:s}=Y(e,"ts-form-group");return React.createElement("div",{className:s,style:F},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("ul",{className:"simplify-ul addon-buttons flexify"},h.map(N=>{const L=P(N);return React.createElement("li",{key:N.slug,className:`flexify ${L?"adb-selected":""}`,onClick:()=>O(N)},N.label)})))}const{style:B,className:X}=Y(e,"ts-form-group"),Z=re(e);return React.createElement("div",{className:X,style:B},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:c,className:`ts-filter ts-popup-target ${j?"ts-filled":""}`,onClick:z,onMouseDown:F=>F.preventDefault(),role:"button",tabIndex:0},i&&React.createElement("span",{dangerouslySetInnerHTML:{__html:i}}),React.createElement("div",{className:"ts-filter-text"},ee,le>0&&React.createElement("span",{className:"term-count"},"+",le)),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ne,{isOpen:o,target:c,title:"",icon:i,saveLabel:"Save",clearLabel:"Clear",showClear:!0,showSave:C,onSave:U,onClear:D,onClose:()=>S(!1),className:`${m}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:Z.style},h.length>=15&&React.createElement("div",{className:"ts-sticky-top uib b-bottom"},React.createElement("div",{className:"ts-input-icon flexify"},React.createElement("span",null,se.search),React.createElement("input",{ref:b,type:"text",value:r,onChange:F=>g(F.target.value),placeholder:"Search",className:"autofocus"}))),React.createElement("div",{className:`ts-term-dropdown ts-multilevel-dropdown ts-md-group${u?" ts-loading":""}`},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},V.map(F=>{const s=P(F),N=a(F),L=N===0;return React.createElement("li",{key:F.slug,className:`${s?"ts-selected":""}${L?" ts-disabled":""}`},React.createElement("a",{href:"#",className:"flexify",onClick:A=>{A.preventDefault(),L||O(F)}},React.createElement("div",{className:"ts-checkbox-container"},React.createElement("label",{className:`container-${C?"checkbox":"radio"}`},React.createElement("input",{type:C?"checkbox":"radio",checked:s,readOnly:!0,disabled:!0,hidden:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,F.depth>0?"— ".repeat(F.depth):"",F.label),N!==null&&React.createElement("span",{className:"ts-term-count"},"(",N,")"),F.icon&&React.createElement("div",{className:"ts-term-icon",dangerouslySetInnerHTML:{__html:F.icon}})))})),V.length===0&&React.createElement("div",{className:"ts-empty-user-tab"},i&&React.createElement("span",{dangerouslySetInnerHTML:{__html:i}}),React.createElement("p",null,"No results found")))))}function pe(e){return!e||!e.address?null:e.swlat!==void 0&&e.swlng!==void 0&&e.nelat!==void 0&&e.nelng!==void 0?`${e.address};${e.swlat},${e.swlng}..${e.nelat},${e.nelng}`:e.lat!==void 0&&e.lng!==void 0?`${e.address};${e.lat},${e.lng},${e.radius||25}`:e.address}function tt(e,t){if(e==null||e==="")return null;if(typeof e=="string"){const n=e.indexOf(";");if(n===-1)return{address:e};const l=e.substring(0,n),d=e.substring(n+1);if(d.includes("..")){const u=d.split(".."),m=u[0].split(","),c=u[1].split(",");return{address:l,swlat:Number(m[0]),swlng:Number(m[1]),nelat:Number(c[0]),nelng:Number(c[1])}}const E=d.split(",");return{address:l,lat:Number(E[0]),lng:Number(E[1]),radius:E[2]?Number(E[2]):t}}return typeof e=="object"?e:null}function nt({config:e,filterData:t,value:n,onChange:l,blockId:d}){const E=d?`voxel-popup-${d}`:"",u=G(null),m=G(null),c=G(null),b=G(null),o=G(null),[S,r]=I(!1),[g,_]=I(!1),C=G(null),k=t.props||{},$=k.radius||{},x=$.default??25,i=$.min??1,p=$.max??100,w=$.step??1,y=k.units||"km",v=k.display_proximity_as||"popup",R=k.placeholder||t.label||"Location",h=e.displayAs||t.props?.display_as||"popup",a=t.icon||"",f=tt(n,x)||{},[P,q]=I(f.address||""),[V,z]=I(f.radius||x),O=T(W=>Math.round(W*1e6)/1e6,[]),U=T(W=>`${W}${y==="mi"?"mi":"km"}`,[y]),D=T(()=>{!b.current||o.current||(De.create(b.current,{start:V,connect:[!0,!1],step:w,range:{min:i,max:p},behaviour:"tap-drag"}),o.current=b.current.noUiSlider,o.current.on("update",W=>{z(Math.round(Number(W[0])))}),o.current.on("change",W=>{const ce=Math.round(Number(W[0]));v==="inline"&&f.lat&&l(pe({...f,radius:ce}))}))},[V,w,i,p,v,f,l]),j=T(()=>{o.current&&(o.current.destroy(),o.current=null)},[]);J(()=>{if(v==="inline"&&f.lat){const W=setTimeout(()=>D(),50);return()=>{clearTimeout(W),j()}}},[v,f.lat,D,j]),J(()=>{if(g){const W=setTimeout(()=>D(),50);return()=>clearTimeout(W)}return()=>j()},[g,D,j]),J(()=>{const W=f.radius||x;z(W),o.current&&o.current.set([W])},[f.radius,x]);const ee=T(()=>{if(c.current||!m.current||typeof window>"u")return;const W=window.Voxel?.Maps;if(!W){console.warn("Voxel.Maps not available for autocomplete");return}W.await(()=>{if(c.current)return;const ce=e.autocomplete||{};c.current=new W.Autocomplete(m.current,oe=>{if(oe){const $e=oe.viewport.getSouthWest(),Le=oe.viewport.getNorthEast(),Be={address:oe.address,swlat:O($e.getLatitude()),swlng:O($e.getLongitude()),nelat:O(Le.getLatitude()),nelng:O(Le.getLongitude()),lat:O(oe.latlng.getLatitude()),lng:O(oe.latlng.getLongitude()),radius:f.radius||x};q(oe.address),l(pe(Be)),h==="popup"&&r(!1)}else q(""),l(null)},ce)})},[e.autocomplete,l,h,x,f.radius,O]);J(()=>{(S||h==="inline")&&(q(f.address||""),S&&setTimeout(()=>m.current?.focus(),50))},[S,h,f.address]);const le=T(()=>{r(!0)},[]),B=T(()=>{ee()},[ee]),X=W=>{q(W.target.value),h==="inline"&&(W.target.value?l(pe({...f,address:W.target.value})):l(null))},Z=W=>{W.preventDefault(),W.stopPropagation(),"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(ce=>{const oe={address:"Current Location",lat:ce.coords.latitude,lng:ce.coords.longitude,radius:x};q("Current Location"),l(pe(oe)),h==="popup"&&r(!1)},ce=>{console.error("Geolocation error:",ce)})},F=T(()=>{l(P?pe({...f,address:P}):null),r(!1)},[P,f,l]),s=T(()=>{q(""),l(null)},[l]),N=T(W=>{W.key==="Enter"&&(W.preventDefault(),F())},[F]),L=T(()=>{f.lat&&l(pe({...f,radius:V})),_(!1)},[f,V,l]),A=T(()=>{z(x),o.current&&o.current.set([x]),f.lat&&l(pe({...f,radius:x}))},[x,f,l]),Q=!!f.address||!!f.lat,K=Q?f.address||"Location set":R,te=()=>React.createElement("div",{className:"ts-input-icon flexify",style:{position:"relative"}},a&&React.createElement("span",{dangerouslySetInnerHTML:{__html:a}}),React.createElement("input",{ref:m,type:"text",className:"inline-input",placeholder:R,value:P,onChange:X,onKeyDown:N,onFocus:B}),React.createElement("a",{href:"#",className:"inline-user-location ts-icon-btn",onClick:Z,title:"Use my location","aria-label":"Use my location"},se.crosshairs)),me=()=>React.createElement("div",{className:"range-slider-wrapper"},React.createElement("div",{className:"range-value"},U(V)),React.createElement("div",{ref:b,className:"range-slider"})),ie=()=>!f.lat||v==="inline"?null:React.createElement("div",{className:"ts-form-group ts-proximity-filter"},React.createElement("label",null,k.proximity_label||"Radius"),React.createElement("div",{ref:C,className:`ts-filter ts-popup-target ${f.radius?"ts-filled":""}`,onClick:()=>_(!0),onMouseDown:W=>W.preventDefault(),role:"button",tabIndex:0},React.createElement("div",{className:"ts-filter-text"},U(f.radius||x)),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ne,{isOpen:g,target:C,title:"",saveLabel:"Save",clearLabel:"Reset",showClear:!0,onSave:L,onClear:A,onClose:()=>_(!1),className:`${E}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:ue.style},React.createElement("div",{className:"ts-form-group"},React.createElement("label",null,k.proximity_label||"Search radius"),me()))),M=()=>v!=="inline"||!f.lat?null:React.createElement("div",{className:"ts-form-group ts-inline-proximity"},React.createElement("label",null,k.proximity_label||"Radius",": ",U(V)),React.createElement("div",{ref:b,className:"range-slider"}));if(h==="inline"){const{style:W,className:ce}=Y(e,"ts-form-group ts-inline-filter");return React.createElement(React.Fragment,null,React.createElement("div",{className:ce,style:W},!e.hideLabel&&React.createElement("label",null,t.label),te()),M(),ie())}const{style:H,className:fe}=Y(e,"ts-form-group"),ue=re(e);return React.createElement(React.Fragment,null,React.createElement("div",{className:fe,style:H},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:u,className:`ts-filter ts-popup-target ${Q?"ts-filled":""}`,onClick:le,onMouseDown:W=>W.preventDefault(),role:"button",tabIndex:0},a&&React.createElement("span",{dangerouslySetInnerHTML:{__html:a}}),React.createElement("div",{className:"ts-filter-text"},K),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ne,{isOpen:S,target:u,title:"",icon:a,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:F,onClear:s,onClose:()=>r(!1),className:`${E}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:ue.style},React.createElement("div",{className:"ts-form-group"},te()))),M(),ie())}function lt(e){if(e==null||e==="")return{date:"",slots:1};if(typeof e=="string")return{date:e,slots:1};if(typeof e=="object"){const t=e;return{date:t.date||"",slots:t.slots||1}}return{date:"",slots:1}}const he=e=>{if(!e)return null;try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t:null}catch{return null}},de=e=>{if(!e)return null;const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${l}`},ye=e=>{if(!e)return"";try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):""}catch{return e}};function at({config:e,filterData:t,value:n,onChange:l,blockId:d}){const E=[d?`voxel-popup-${d}`:"",e.id?`elementor-repeater-item-${e.id}`:""].filter(Boolean).join(" "),u=G(null),m=G(null),[c,b]=I(!1),o=t.props||{},r=(o.inputMode||"date-range")==="date-range",g=o.l10n||{},_=g.pickDate||t.label||"Select dates",C=t.icon||"",k=lt(n),$=k.date,x=k.slots;let i="",p="";r&&$&&$.includes("..")?[i,p]=$.split(".."):!r&&$&&(i=$);const[w,y]=I(()=>he(i)),[v,R]=I(()=>he(p)),[h,a]=I("start"),[f,P]=I(x);J(()=>{if(c){if(r&&$&&$.includes("..")){const[B,X]=$.split("..");y(he(B)),R(he(X))}else!r&&$&&y(he($));P(x),a("start")}},[c,r,$,x]);const q=T(()=>{b(!0)},[]),V=T(B=>{if(r&&B&&m.current)if(h==="start")y(B),a("end"),m.current.setStartRange(B),m.current.setEndRange(null),m.current.draw();else if(w&&B<w)y(B),R(null),m.current.setStartRange(B),m.current.setEndRange(null),m.current.draw();else{R(B),a("start"),m.current.setEndRange(B),m.current.draw();const X=de(w),Z=de(B);X&&Z&&(l(`${X}..${Z}`),b(!1))}else y(B)},[r,h,w,l]);T(B=>{P(Number(B.target.value)||1)},[]);const z=T(B=>{if(r){const X=de(w),Z=de(v);X&&Z&&l(`${X}..${Z}`)}else{const Z=de(B!==void 0?B:w);Z&&l(Z)}b(!1)},[r,w,v,l]),O=T(()=>{y(null),R(null),P(1),l(null),m.current&&(m.current.setStartRange(null),m.current.setEndRange(null))},[l]),U=r?!!(i&&p):!!$,D=ae(()=>{if(!U)return _;if(r){const B=ye(i),X=ye(p),Z=`${B} — ${X}`;return x>1?`${Z} (${x})`:Z}else{const B=ye($);return x>1?`${B} (${x})`:B}},[r,U,i,p,$,x,_]),{style:j,className:ee}=Y(e,"ts-form-group"),le=re(e);return React.createElement("div",{className:ee,style:j},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:u,className:`ts-filter ts-popup-target ${U?"ts-filled":""}`,onClick:q,onMouseDown:B=>B.preventDefault(),role:"button",tabIndex:0},C&&React.createElement("span",{dangerouslySetInnerHTML:{__html:C}}),React.createElement("div",{className:"ts-filter-text"},D),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ne,{isOpen:c,target:u,title:"",icon:C,saveLabel:g.save||"Save",clearLabel:g.clear||"Clear",showSave:r,onSave:z,onClear:O,onClose:()=>b(!1),className:`${E}${r?" ts-availability-wrapper xl-height xl-width":" md-width xl-height"}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:le.style},r&&React.createElement("div",{className:"ts-popup-head flexify"},React.createElement("div",{className:"ts-popup-name flexify"},C&&React.createElement("span",{dangerouslySetInnerHTML:{__html:C}}),React.createElement("span",null,React.createElement("span",{className:h==="start"?"chosen":"",onClick:()=>a("start"),style:{cursor:"pointer"}},w?ye(de(w)):g.checkIn||"Check-in"),React.createElement("span",null," — "),React.createElement("span",{className:h==="end"?"chosen":"",onClick:()=>a("end"),style:{cursor:"pointer"}},v?ye(de(v)):g.checkOut||"Check-out")))),React.createElement(Re,{value:w,onChange:V,...!r&&{onSelect:z},pickerConfig:{minDate:new Date,...r?{theme:"pika-range"}:{}},onPickerReady:B=>{m.current=B,r&&w&&(B.setStartRange(w),v&&B.setEndRange(v))}})))}function st(e,t){if(e==null||e==="")return{from:"",to:""};if(typeof e=="string"){if(t&&e.includes("..")){const n=e.split("..");return{from:n[0]||"",to:n[1]||""}}return{from:e,to:""}}if(typeof e=="object"){const n=e;return{from:n.from||"",to:n.to||""}}return{from:"",to:""}}function Ee(e,t,n){return!e&&!t?null:n?e&&t?`${e}..${t}`:e?`${e}..`:t?`..${t}`:null:e||null}const ve=e=>{if(!e)return null;try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t:null}catch{return null}},Ie=e=>{if(!e)return null;const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${l}`},ge=e=>{if(!e)return"";try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}):""}catch{return e}};function rt({config:e,filterData:t,value:n,onChange:l,blockId:d}){const E=d?`voxel-popup-${d}`:"",u=G(null),m=t.props||{},c=m.enable_range??!1,b=m.placeholder||t.label||"Select date",o=t.icon||"",S=st(n,c),r=S.from,g=S.to,[_,C]=I(!1),[k,$]=I(!1),[x,i]=I(()=>ve(r)),[p,w]=I(()=>ve(g)),y=T(()=>{i(ve(r)),C(!0)},[r]),v=T(()=>{w(ve(g)),$(!0)},[g]),R=T(j=>{i(j)},[]),h=T(j=>{w(j)},[]),a=T(j=>{const le=Ie(j!==void 0?j:x)||"";l(Ee(le,g,c)),C(!1)},[x,c,g,l]),f=T(j=>{const le=Ie(j!==void 0?j:p)||"";l(Ee(r,le,c)),$(!1)},[p,r,c,l]),P=T(()=>{i(null),l(Ee("",g,c))},[c,g,l]),q=T(()=>{w(null),l(Ee(r,"",c))},[r,c,l]),V=c?!!r||!!g:!!r,z=ae(()=>{if(!V)return b;if(c){const j=[];return r&&j.push(ge(r)),g&&j.push(ge(g)),j.join(" - ")||b}return ge(r)||b},[V,c,r,g,b]),{style:O,className:U}=Y(e,"ts-form-group"),D=re(e);return React.createElement("div",{className:U,style:O},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:u,className:`ts-filter ts-popup-target ${V?"ts-filled":""}`,onClick:y,onMouseDown:j=>j.preventDefault(),role:"button",tabIndex:0},o&&React.createElement("span",{dangerouslySetInnerHTML:{__html:o}}),React.createElement("div",{className:"ts-filter-text"},z),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ne,{isOpen:_,target:u,title:c?"From":"",icon:o,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:a,onClear:P,onClose:()=>C(!1),className:`${E}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:D.style},React.createElement(Re,{value:x,onChange:R,onSelect:a}),c&&React.createElement("div",{className:"ts-form-group",style:{marginTop:"12px",borderTop:"1px solid var(--ts-shade-5)",paddingTop:"12px"}},React.createElement("label",null,"To"),React.createElement("div",{className:`ts-filter ts-popup-target ${g?"ts-filled":""}`,onClick:j=>{j.stopPropagation(),C(!1),setTimeout(()=>v(),100)},role:"button",tabIndex:0},o&&React.createElement("span",{dangerouslySetInnerHTML:{__html:o}}),React.createElement("div",{className:"ts-filter-text"},g?ge(g):"Select end date")))),c&&React.createElement(ne,{isOpen:k,target:u,title:"To",icon:o,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:f,onClear:q,onClose:()=>$(!1),className:`${E}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:D.style},React.createElement(Re,{value:p,onChange:h,onSelect:f})))}const be=e=>{if(!e)return null;try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t:null}catch{return null}},Me=e=>{if(!e)return null;const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${l}`},Te=e=>{if(!e)return"";try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}):""}catch{return e}};function ct({config:e,filterData:t,value:n,onChange:l,blockId:d}){const E=d?`voxel-popup-${d}`:"",u=G(null),c=(t.props||{}).placeholder||t.label||"Date",b=t.icon||"",o=n||{},S=o.from||"",r=o.to||"",[g,_]=I(!1),[C,k]=I(!1),[$,x]=I(()=>be(S)),[i,p]=I(()=>be(r)),w=T(()=>{x(be(S)),_(!0)},[S]),y=T(()=>{p(be(r)),k(!0)},[r]),v=T(D=>{x(D)},[]),R=T(D=>{p(D)},[]),h=T(D=>{const ee=Me(D!==void 0?D:$)||"";l({from:ee,to:r}),_(!1)},[$,r,l]),a=T(D=>{const ee=Me(D!==void 0?D:i)||"";l({from:S,to:ee}),k(!1)},[i,S,l]),f=T(()=>{x(null),l({from:"",to:r})},[r,l]),P=T(()=>{p(null),l({from:S,to:""})},[S,l]),q=!!S||!!r,V=ae(()=>{if(!q)return c;const D=[];return S&&D.push(Te(S)),r&&D.push(Te(r)),D.join(" - ")||c},[q,S,r,c]),{style:z,className:O}=Y(e,"ts-form-group"),U=re(e);return React.createElement("div",{className:O,style:z},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:u,className:`ts-filter ts-popup-target ${q?"ts-filled":""}`,onClick:w,onMouseDown:D=>D.preventDefault(),role:"button",tabIndex:0},b&&React.createElement("span",{dangerouslySetInnerHTML:{__html:b}}),React.createElement("div",{className:"ts-filter-text"},V),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ne,{isOpen:g,target:u,title:"From",icon:b,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:h,onClear:f,onClose:()=>_(!1),className:`${E}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:U.style},React.createElement(Re,{value:$,onChange:v,onSelect:h}),React.createElement("div",{className:"ts-form-group",style:{marginTop:"12px",borderTop:"1px solid var(--ts-shade-5)",paddingTop:"12px"}},React.createElement("label",null,"To"),React.createElement("div",{className:`ts-filter ts-popup-target ${r?"ts-filled":""}`,onClick:D=>{D.stopPropagation(),_(!1),setTimeout(()=>y(),100)},role:"button",tabIndex:0},b&&React.createElement("span",{dangerouslySetInnerHTML:{__html:b}}),React.createElement("div",{className:"ts-filter-text"},r?Te(r):"Select end date")))),React.createElement(ne,{isOpen:C,target:u,title:"To",icon:b,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:a,onClear:P,onClose:()=>k(!1),className:`${E}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:U.style},React.createElement(Re,{value:i,onChange:R,onSelect:a})))}function ot({config:e,filterData:t,value:n,onChange:l}){const d=n===!0||n==="true"||n==="1",E=b=>{b.preventDefault(),l(!d)},u=t.props?.placeholder||t.label||"Open now",{style:m,className:c}=Y(e,"ts-form-group switcher-label ts-inline-filter");return React.createElement("div",{className:c,style:m},React.createElement("label",null,React.createElement("div",{className:"switch-slider"},React.createElement("div",{className:"onoffswitch",onClick:E},React.createElement("input",{type:"checkbox",className:"onoffswitch-checkbox",checked:d,readOnly:!0}),React.createElement("label",{className:"onoffswitch-label",onClick:E}))),u))}function it({config:e,filterData:t,value:n,onChange:l,blockId:d}){const E=d?`voxel-popup-${d}`:"",u=G(null),[m,c]=I(!1),b=t.props||{},o=e.displayAs||t.props?.display_as||"popup",S=b.placeholder||t.label||"Order By",r=ae(()=>{const h=b.choices||{};return Array.isArray(h)?h:Object.entries(h).map(([a,f])=>({key:a,label:f.label||f,placeholder:f.placeholder||f.label||f,icon:f.icon||""}))},[b.choices]),g=t.icon||"",_=T(()=>{c(!0)},[]),C=T(h=>{l(h),o==="popup"&&c(!1)},[l,o]),k=T(()=>{l(null)},[l]),$=typeof n=="string"?n:"",x=!!$,i=r.find(h=>h.key===$),p=i?.placeholder||i?.label||S,w=()=>React.createElement("div",{className:"ts-term-dropdown ts-md-group"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list min-scroll"},r.map(h=>{const a=$===h.key;return React.createElement("li",{key:h.key,className:a?"ts-selected":""},React.createElement("a",{href:"#",className:"flexify",onClick:f=>{f.preventDefault(),C(h.key)}},React.createElement("div",{className:"ts-radio-container"},React.createElement("label",{className:"container-radio"},React.createElement("input",{type:"radio",value:h.key,checked:a,readOnly:!0,disabled:!0,hidden:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,h.label),h.icon&&React.createElement("div",{className:"ts-term-icon"},React.createElement("span",{dangerouslySetInnerHTML:{__html:h.icon}}))))})));if(o==="buttons"){const{style:h,className:a}=Y(e,"ts-form-group");return React.createElement("div",{className:a,style:h},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("ul",{className:"simplify-ul addon-buttons flexify"},r.map(f=>{const P=$===f.key;return React.createElement("li",{key:f.key,className:`flexify${P?" adb-selected":""}`,onClick:()=>C(f.key)},f.placeholder||f.label)})))}if(o==="alt-btn")return React.createElement(React.Fragment,null,r.map(h=>{const a=$===h.key,{style:f,className:P}=Y(e,"ts-form-group");return React.createElement("div",{key:h.key,className:P,style:f},!e.hideLabel&&React.createElement("label",null,h.label),React.createElement("div",{className:`ts-filter${a?" ts-filled":""}`,onClick:()=>C(h.key)},h.icon&&React.createElement("span",{dangerouslySetInnerHTML:{__html:h.icon}}),React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,h.placeholder||h.label))))}));const{style:y,className:v}=Y(e,"ts-form-group"),R=re(e);return React.createElement("div",{className:v,style:y},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:u,className:`ts-filter ts-popup-target ${x?"ts-filled":""}`,onClick:_,onMouseDown:h=>h.preventDefault(),role:"button",tabIndex:0},g&&React.createElement("span",{dangerouslySetInnerHTML:{__html:g}}),React.createElement("div",{className:"ts-filter-text"},p),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ne,{isOpen:m,target:u,title:"",icon:g,saveLabel:"Save",clearLabel:"Clear",showClear:x,showSave:!1,onSave:()=>c(!1),onClear:k,onClose:()=>c(!1),className:`hide-head ${E}${e.popupCenterPosition?" ts-popup-centered":""}`.trim(),popupStyle:R.style},w()))}function ut({config:e,filterData:t,value:n,onChange:l,blockId:d}){const E=d?`voxel-popup-${d}`:"",[u,m]=I(!1),c=G(null),b=t.props||{},o=e.displayAs||t.props?.display_as||"popup",S=b.placeholder||t.label||"Status",r=ae(()=>{const R=b.choices||{};return Array.isArray(R)?R:Object.entries(R).map(([h,a])=>({key:h,label:a.label||a}))},[b.choices]),g=t.icon||"",_=T(R=>{l(R),m(!1)},[l]),C=T(()=>{m(!0)},[]),k=typeof n=="string"?n:"",$=!!k,x=r.find(R=>R.key===k),i=$&&x?.label||S,p=()=>React.createElement("div",{className:"ts-term-dropdown ts-md-group"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list min-scroll"},r.map(R=>{const h=k===R.key;return React.createElement("li",{key:R.key},React.createElement("a",{href:"#",className:"flexify",onClick:a=>{a.preventDefault(),_(R.key)}},React.createElement("div",{className:"ts-radio-container"},React.createElement("label",{className:"container-radio"},React.createElement("input",{type:"radio",value:R.key,checked:h,readOnly:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,R.label),g&&React.createElement("div",{className:"ts-term-icon"},React.createElement("span",{dangerouslySetInnerHTML:{__html:g}}))))})));if(o==="buttons")return React.createElement(React.Fragment,null,r.map(R=>{const h=k===R.key,{style:a,className:f}=Y(e,"ts-form-group");return React.createElement("div",{key:R.key,className:f,style:a},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter${h?" ts-filled":""}`,onClick:()=>l(R.key)},g&&React.createElement("span",{dangerouslySetInnerHTML:{__html:g}}),React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,R.label))))}));const{style:w,className:y}=Y(e,"ts-form-group"),v=re(e);return React.createElement("div",{className:y,style:w},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:c,className:`ts-filter ts-popup-target ${$?"ts-filled":""}`,onClick:C,onMouseDown:R=>R.preventDefault(),role:"button",tabIndex:0},g&&React.createElement("span",{dangerouslySetInnerHTML:{__html:g}}),React.createElement("div",{className:"ts-filter-text"},i),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ne,{isOpen:u,target:c,title:"",icon:g,saveLabel:"Save",showSave:!1,showClear:!1,onSave:()=>m(!1),onClose:()=>m(!1),className:`hide-head ${E}${e.popupCenterPosition?" ts-popup-centered":""}`.trim(),popupStyle:v.style},p()))}function pt(e){const{userId:t,skip:n=!1}=e,[l,d]=I(null),[E,u]=I(!1),[m,c]=I(null),b=T(async()=>{if(!t||n){d(null);return}u(!0),c(null);try{const o=Oe(),S=await fetch(`${o}voxel-fse/v1/search-form/user-data?user_id=${t}`);if(S.ok){const r=await S.json();d({id:r.id,name:r.name,avatar:r.avatar||""})}else d({id:t,name:"Unknown",avatar:""}),c("User not found")}catch(o){console.error("useUserData: Error fetching user data:",o),d({id:t,name:"Unknown",avatar:""}),c(o instanceof Error?o.message:"Failed to fetch user data")}finally{u(!1)}},[t,n]);return J(()=>{b()},[b]),{userData:l,isLoading:E,error:m,refetch:b}}function dt({config:e,filterData:t,value:n}){const l=G(null),d=t.props||{},E=t.icon||"",u=d.user;let m;n!==void 0?m=n:t.value!==null&&t.value!==void 0?m=t.value:m=null;const c=m?Number(m):null,b=c!==null&&!isNaN(c)&&c>0,o=!!u?.name,{userData:S,isLoading:r}=pt({userId:b?c:null,skip:o}),g=o?{name:u.name,avatar:u.avatar||""}:S;if(!b)return null;const _=g?.name||(r?"Loading...":"Unknown"),{style:C,className:k}=Y(e,"ts-form-group");return React.createElement("div",{className:k,style:C},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:l,className:`ts-filter ts-popup-target ts-filled${r?" ts-loading":""}`},React.createElement("span",{dangerouslySetInnerHTML:{__html:E}}),React.createElement("div",{className:"ts-filter-text"},_)))}function mt({config:e,filterData:t,value:n,onChange:l,blockId:d}){const E=d?`voxel-popup-${d}`:"",u=G(null),m=G(null),[c,b]=I(!1),[o,S]=I(""),[r,g]=I([]),[_,C]=I(!1),k=t.props||{},$=k.placeholder||t.label||"Related",x=k.post,i=t.icon||"";J(()=>{c&&(S(""),g([]),setTimeout(()=>m.current?.focus(),50))},[c]);const p=T(()=>{b(!0)},[]),w=T(V=>{const z=V.target.value;S(z),z.length>=2?(C(!0),setTimeout(()=>{g([]),C(!1)},300)):g([])},[]),y=T((V,z)=>{l({id:V,title:z}),b(!1),S("")},[l]),v=T(()=>{l(null),S(""),g([])},[l]);let R=null;if(n!==void 0){const V=n;V===null?R=null:typeof V=="number"?R=V:typeof V=="object"&&V?.id&&(R=V.id)}else t.value!==null&&t.value!==void 0&&(R=typeof t.value=="number"?t.value:Number(t.value));const h=R!==null&&!isNaN(R)&&R>0;let a=$;if(h){const V=n;V&&typeof V=="object"&&V.title?a=V.title:x?.title&&(a=x.title)}const{style:f,className:P}=Y(e,"ts-form-group"),q=re(e);return React.createElement("div",{className:P,style:f},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:u,className:`ts-filter ts-popup-target ${h?"ts-filled":""}`,onClick:p,onMouseDown:V=>V.preventDefault(),role:"button",tabIndex:0},i&&React.createElement("span",{dangerouslySetInnerHTML:{__html:i}}),React.createElement("div",{className:"ts-filter-text"},a),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ne,{isOpen:c,target:u,title:"",icon:i,saveLabel:"Save",clearLabel:"Clear",showClear:h,showSave:!1,onSave:()=>b(!1),onClear:v,onClose:()=>b(!1),className:`${E}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:q.style},React.createElement("div",{className:"ts-form-group"},React.createElement("div",{className:"flexify ts-input-icon"},React.createElement("span",null,se.search),React.createElement("input",{ref:m,type:"text",className:"inline-input",value:o,onChange:w,placeholder:"Search..."}))),_?React.createElement("div",{className:"ts-loading"},React.createElement("span",{className:"ts-loader"})):r.length>0?React.createElement("div",{className:"ts-term-dropdown"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},r.map(V=>React.createElement("li",{key:V.id},React.createElement("a",{href:"#",className:"flexify",onClick:z=>{z.preventDefault(),y(V.id,V.title)}},React.createElement("span",null,V.title)))))):o.length>=2?React.createElement("div",{className:"ts-empty-user-tab"},i&&React.createElement("span",{dangerouslySetInnerHTML:{__html:i}}),React.createElement("p",null,"No results found")):null))}function xe({config:e,filterData:t,value:n,onChange:l}){const[d,E]=I(!1),[u,m]=I(""),[c,b]=I([]),[o,S]=I(!1),r=G(null),g=t.props||{},_=g.placeholder||t.label||"Following",C=g.user,k=t.icon||"",$=a=>{const f=a.target.value;m(f),f.length>=2?(S(!0),setTimeout(()=>{b([]),S(!1)},300)):b([])},x=(a,f)=>{l({id:a,name:f}),E(!1),m("")},i=a=>{a.preventDefault(),E(!d)};J(()=>{const a=f=>{r.current&&!r.current.contains(f.target)&&E(!1)};return d&&document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[d]);let p=null;if(n!==void 0){const a=n;a===null?p=null:typeof a=="number"?p=a:typeof a=="object"&&a?.id&&(p=a.id)}else t.value!==null&&t.value!==void 0&&(p=typeof t.value=="number"?t.value:Number(t.value));const w=p!==null&&!isNaN(p)&&p>0;let y=_;if(w){const a=n;a&&typeof a=="object"&&a.name?y=a.name:C?.name&&(y=C.name)}const{style:v,className:R}=Y(e,"ts-form-group"),h=re(e);return React.createElement("div",{className:R,style:v,ref:r},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter ts-popup-target ${w?"ts-filled":""}`,onClick:i,onMouseDown:a=>a.preventDefault(),role:"button",tabIndex:0},k&&React.createElement("span",{dangerouslySetInnerHTML:{__html:k}}),React.createElement("div",{className:"ts-filter-text"},y),React.createElement("div",{className:"ts-down-icon"})),d&&React.createElement("div",{className:"ts-field-popup-container"},React.createElement("div",{className:h.className,style:h.style},React.createElement("div",{className:"ts-popup-content-wrapper min-scroll"},React.createElement("div",{className:"ts-form-group"},React.createElement("div",{className:"flexify ts-input-icon"},React.createElement("span",null,se.search),React.createElement("input",{type:"text",className:"inline-input",value:u,onChange:$,placeholder:"Search..."}))),o?React.createElement("div",{className:"ts-loading"},React.createElement("span",{className:"ts-loader"})):c.length>0?React.createElement("div",{className:"ts-term-dropdown"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},c.map(a=>React.createElement("li",{key:a.id},React.createElement("a",{href:"#",className:"flexify",onClick:f=>{f.preventDefault(),x(a.id,a.name)}},React.createElement("span",null,a.name)))))):u.length>=2?React.createElement("div",{className:"ts-empty-user-list"},React.createElement("span",null,"No results found")):null))))}function ft({config:e,filterData:t,value:n,onChange:l}){const[d,E]=I(!1),[u,m]=I(""),[c,b]=I([]),[o,S]=I(!1),r=G(null),g=t.props||{},_=g.placeholder||t.label||"Following Post",C=g.post,k=t.icon||"",$=a=>{const f=a.target.value;m(f),f.length>=2?(S(!0),setTimeout(()=>{b([]),S(!1)},300)):b([])},x=(a,f)=>{l({id:a,title:f}),E(!1),m("")},i=a=>{a.preventDefault(),E(!d)};J(()=>{const a=f=>{r.current&&!r.current.contains(f.target)&&E(!1)};return d&&document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[d]);let p=null;if(n!==void 0){const a=n;a===null?p=null:typeof a=="number"?p=a:typeof a=="object"&&a?.id&&(p=a.id)}else t.value!==null&&t.value!==void 0&&(p=typeof t.value=="number"?t.value:Number(t.value));const w=p!==null&&!isNaN(p)&&p>0;let y=_;if(w){const a=n;a&&typeof a=="object"&&a.title?y=a.title:C?.title&&(y=C.title)}const{style:v,className:R}=Y(e,"ts-form-group"),h=re(e);return React.createElement("div",{className:R,style:v,ref:r},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter ts-popup-target ${w?"ts-filled":""}`,onClick:i,onMouseDown:a=>a.preventDefault(),role:"button",tabIndex:0},k&&React.createElement("span",{dangerouslySetInnerHTML:{__html:k}}),React.createElement("div",{className:"ts-filter-text"},y),React.createElement("div",{className:"ts-down-icon"})),d&&React.createElement("div",{className:"ts-field-popup-container"},React.createElement("div",{className:h.className,style:h.style},React.createElement("div",{className:"ts-popup-content-wrapper min-scroll"},React.createElement("div",{className:"ts-form-group"},React.createElement("div",{className:"flexify ts-input-icon"},React.createElement("span",null,se.search),React.createElement("input",{type:"text",className:"inline-input",value:u,onChange:$,placeholder:"Search posts..."}))),o?React.createElement("div",{className:"ts-loading"},React.createElement("span",{className:"ts-loader"})):c.length>0?React.createElement("div",{className:"ts-term-dropdown"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},c.map(a=>React.createElement("li",{key:a.id},React.createElement("a",{href:"#",className:"flexify",onClick:f=>{f.preventDefault(),x(a.id,a.title)}},React.createElement("span",null,a.title)))))):u.length>=2?React.createElement("div",{className:"ts-empty-user-list"},React.createElement("span",null,"No posts found")):null))))}function ht({config:e,filterData:t,value:n,onChange:l}){const d=n===!0||n==="true"||n==="1",E=c=>{c.preventDefault(),l(!d)},{style:u,className:m}=Y(e,"ts-form-group switcher-label ts-inline-filter");return React.createElement("div",{className:m,style:u},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("label",{className:`onoffswitch ts-${d?"on":"off"}`,onClick:E},React.createElement("input",{type:"checkbox",className:"onoffswitch-checkbox",checked:d,readOnly:!0}),React.createElement("span",{className:"onoffswitch-trigger"})))}function yt({config:e,filterData:t}){const n=t.props?.description||"",{style:l,className:d}=Y(e,"ts-form-group ui-heading");return React.createElement("div",{className:d,style:l},React.createElement("label",null,e.label||t.label,n&&React.createElement("small",null,n)))}function Rt({postTypes:e,currentPostType:t,onChange:n,blockId:l,style:d}){const E=l?`voxel-popup-${l}`:"",[u,m]=I(!1),c=G(null),b=T(k=>{n(k),m(!1)},[n]),o=T(()=>{m(!0)},[]),S=e.find(k=>k.key===t),r=S?.label||"Select type",g=!!t,_=S?.icon||"",C=()=>React.createElement("div",{className:"ts-term-dropdown ts-md-group"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list min-scroll"},e.map(k=>{const $=t===k.key;return React.createElement("li",{key:k.key},React.createElement("a",{href:"#",className:"flexify",onClick:x=>{x.preventDefault(),b(k.key)}},React.createElement("div",{className:"ts-radio-container"},React.createElement("label",{className:"container-radio"},React.createElement("input",{type:"radio",checked:$,disabled:!0,hidden:!0,readOnly:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,k.label),React.createElement("div",{className:"ts-term-icon ts-pull-right"},k.icon&&React.createElement("span",{dangerouslySetInnerHTML:{__html:k.icon}}))))})));return React.createElement("div",{className:"ts-form-group choose-cpt-filter",style:d},React.createElement("label",null,"Post type"),React.createElement("div",{ref:c,className:`ts-filter ts-popup-target ${g?"ts-filled":""}`,onClick:o,onMouseDown:k=>k.preventDefault(),role:"button",tabIndex:0},_&&React.createElement("span",{dangerouslySetInnerHTML:{__html:_}}),React.createElement("div",{className:"ts-filter-text"},r),React.createElement("div",{className:"ts-down-icon"})),React.createElement(ne,{isOpen:u,target:c,title:"",icon:_,saveLabel:"Save",showSave:!1,showClear:!1,onSave:()=>m(!1),onClose:()=>m(!1),className:`hide-head ${E}`.trim()},C()))}const Et={"common:is_empty":(e,t)=>t==null||t==="","common:is_not_empty":(e,t)=>t!=null&&t!=="","text:equals":(e,t)=>t===e.value,"text:not_equals":(e,t)=>t!==e.value,"text:contains":(e,t)=>typeof t!="string"||!e.value?!1:new RegExp(e.value,"i").test(t),"taxonomy:contains":(e,t)=>typeof t!="string"||!e.value?!1:t.split(",").includes(e.value),"taxonomy:not_contains":(e,t)=>typeof t!="string"||!e.value?!0:!t.split(",").includes(e.value),"number:equals":(e,t)=>{const n=parseFloat(String(t)),l=parseFloat(e.value||"0");return n===l},"number:not_equals":(e,t)=>{const n=parseFloat(String(t)),l=parseFloat(e.value||"0");return n!==l},"number:gt":(e,t)=>{const n=parseFloat(String(t)),l=parseFloat(e.value||"0");return n>l},"number:gte":(e,t)=>{const n=parseFloat(String(t)),l=parseFloat(e.value||"0");return n>=l},"number:lt":(e,t)=>{const n=parseFloat(String(t)),l=parseFloat(e.value||"0");return n<l},"number:lte":(e,t)=>{const n=parseFloat(String(t)),l=parseFloat(e.value||"0");return n<=l}};function vt(e,t,n){const l=Et[e.type];if(!l)return console.warn(`[filterConditions] Unknown condition type: ${e.type}`),!1;let d=t;return n==="order-by"&&typeof t=="string"&&t.length>0&&(d=t.split("(")[0]),l(e,d)}function gt(e,t="show",n,l){if(!e||e.length===0)return!0;let d=!1;return e.forEach(E=>{if(!E.length)return;let u=!0;E.forEach(m=>{const c=n[m.source],o=l[m.source]?.type;vt(m,c,o)||(u=!1)}),u&&(d=!0)}),t==="hide"?!d:d}function bt(e,t,n){return gt(e.conditions,e.conditions_behavior||"show",t,n)}function Nt(){const e=()=>{if(typeof window>"u")return"desktop";const l=window.innerWidth;return l<=767?"mobile":l<=1024?"tablet":"desktop"},[t,n]=I(e);return J(()=>{const l=()=>{n(e())};return l(),window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),t}function _t({attributes:e,postTypes:t,context:n,editorDeviceType:l,onSubmit:d,onPostTypeChange:E,onFilterChange:u}){G(null);const m=G(null),{state:c,setCurrentPostType:b,setFilterValue:o,togglePortal:S,submit:r,clearAll:g,narrowedValues:_,narrowingFilters:C}=Ue({attributes:e,postTypes:t,context:n,onSubmit:d,onPostTypeChange:E,onFilterChange:u}),[k,$]=I(""),[x,i]=I("");J(()=>{const s=async()=>{const L=e.searchButtonText??"";if(ke(L)){const A=Fe(L),Q=await _e(A);$(Q)}else $(L)},N=async()=>{const L=e.resetButtonText??"Reset";if(ke(L)){const A=Fe(L),Q=await _e(A);i(Q)}else i(L)};s(),N()},[e.searchButtonText,e.resetButtonText]),J(()=>{if(!c.portalActive)return;const s=N=>{N.key==="Escape"&&S()};return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[c.portalActive,S]),J(()=>{if(!c.portalActive)return;const s=L=>{const A=L.target;m.current?.contains(A)||n==="editor"&&(A.closest(".interface-interface-skeleton__sidebar")||A.closest(".edit-post-sidebar")||A.closest(".block-editor-block-inspector")||A.closest(".components-popover")||A.closest(".components-modal"))||S()},N=requestAnimationFrame(()=>{document.addEventListener("mousedown",s)});return()=>{cancelAnimationFrame(N),document.removeEventListener("mousedown",s)}},[c.portalActive,S,n]),J(()=>{if(n!=="frontend")return;const s=N=>{const L=N;L.detail?.searchFormId&&L.detail.searchFormId!==e.blockId||g()};return window.addEventListener("voxel-search-clear",s),()=>window.removeEventListener("voxel-search-clear",s)},[n,e.blockId,g]);const p=t.find(s=>s.key===c.currentPostType),w=e.filterLists?.[c.currentPostType]||[],y=s=>{r()},v=(s=!1)=>{g(s)},R={};p?.filters?.forEach(s=>{R[s.key]=s});const h=s=>{if(!(n==="frontend"?Ge(s):!0))return null;const L=s;if(n==="frontend"&&L.conditions&&!bt(L,c.filterValues,R))return null;const A=p?.filters?.find(te=>te.key===s.filterKey);if(!A)return null;const Q={...A,value:s.defaultValueEnabled&&s.defaultValue!==void 0?s.defaultValue:A.value},K={config:s,filterData:Q,value:c.filterValues[s.filterKey],onChange:te=>o(s.filterKey,te),narrowedValues:_,isNarrowing:C,blockId:e.blockId,context:n};switch(A.type){case"keywords":return React.createElement(Je,{key:s.id,...K});case"range":return React.createElement(Ye,{key:s.id,...K});case"stepper":return React.createElement(Xe,{key:s.id,...K});case"terms":return React.createElement(et,{key:s.id,...K});case"location":return React.createElement(nt,{key:s.id,...K});case"availability":return React.createElement(at,{key:s.id,...K});case"date":return React.createElement(rt,{key:s.id,...K});case"recurring-date":return React.createElement(ct,{key:s.id,...K});case"open-now":return React.createElement(ot,{key:s.id,...K});case"order-by":return React.createElement(it,{key:s.id,...K});case"post-status":return React.createElement(ut,{key:s.id,...K});case"user":return React.createElement(dt,{key:s.id,...K});case"relations":return React.createElement(mt,{key:s.id,...K});case"following":return React.createElement(xe,{key:s.id,...K});case"followed-by":return React.createElement(xe,{key:s.id,...K});case"following-user":return React.createElement(xe,{key:s.id,...K});case"following-post":return React.createElement(ft,{key:s.id,...K});case"switcher":return React.createElement(ht,{key:s.id,...K});case"ui-heading":return React.createElement(yt,{key:s.id,...K});default:return null}},a=(s=!0)=>React.createElement("div",{className:"ts-filter-wrapper flexify"},e.showPostTypeFilter&&t.length>1&&React.createElement(Rt,{postTypes:t,currentPostType:c.currentPostType,onChange:b,style:F()}),w.map(N=>h(N)),s&&e.showSearchButton&&React.createElement("div",{className:"ts-form-group flexify ts-form-submit",id:"sf_submit",style:Z("search")},React.createElement("button",{type:"button",onClick:()=>y(),className:`ts-btn ts-btn-2 ts-btn-large ts-search-btn ${c.loading&&!c.resetting?"ts-loading-btn":""}`},c.loading&&!c.resetting&&React.createElement("div",{className:"ts-loader-wrapper"},React.createElement("span",{className:"ts-loader"})),Ne(e.searchButtonIcon,se.search),k&&k)),s&&e.showResetButton&&React.createElement("div",{className:"ts-form-group flexify ts-form-reset",style:Z("reset")},React.createElement("a",{href:"#",onClick:N=>{N.preventDefault(),v(!1)},className:"ts-filter",role:"button"},Ne(e.resetButtonIcon,se.reload),x&&React.createElement("div",{className:"ts-filter-text"},x)))),f=Nt(),P=n==="editor"&&l?l:f,q=P==="desktop"&&(e.mfSwitcherDesktop??!1)||P==="tablet"&&(e.mfSwitcherTablet??!1)||P==="mobile"&&(e.mfSwitcherMobile??!1),V=()=>P==="desktop"?e.mfSwitcherDesktopDefault??"feed":P==="tablet"?e.mfSwitcherTabletDefault??"feed":e.mfSwitcherMobileDefault??"feed",[z,O]=I(V);J(()=>{O(V())},[P,e.mfSwitcherDesktopDefault,e.mfSwitcherTabletDefault,e.mfSwitcherMobileDefault]);const U=()=>{O("feed");const s=P,N=document.getElementById(e.postToMapId||""),L=document.getElementById(e.postToFeedId||"");N&&N.classList.add(`vx-hidden-${s}`),L&&L.classList.remove(`vx-hidden-${s}`)},D=()=>{O("map");const s=P,N=document.getElementById(e.postToMapId||""),L=document.getElementById(e.postToFeedId||"");N&&N.classList.remove(`vx-hidden-${s}`),L&&L.classList.add(`vx-hidden-${s}`)},j=()=>{if(!q||n==="editor")return null;const s=[e.mfSwitcherDesktop?"":"vx-hidden-desktop",e.mfSwitcherTablet?"":"vx-hidden-tablet",e.mfSwitcherMobile?"":"vx-hidden-mobile"].filter(Boolean).join(" ");return Ce(React.createElement("div",{className:`ts-switcher-btn ${s}`},React.createElement("a",{href:"#",className:`ts-btn ts-btn-1 ${z==="feed"?`vx-hidden-${P}`:""}`,onClick:N=>{N.preventDefault(),U()},role:"button"},se.grid,"List view"),React.createElement("a",{href:"#",className:`ts-btn ts-btn-1 ${z==="map"?`vx-hidden-${P}`:""}`,onClick:N=>{N.preventDefault(),D()},role:"button"},se.marker,"Map view")),document.body)},ee=P==="desktop"&&(e.formToggleDesktop??!1)||P==="tablet"&&(e.formToggleTablet??!0)||P==="mobile"&&(e.formToggleMobile??!0),le=ee,B=!ee,X={postTypes:t.map(s=>({key:s.key,label:s.label,filters:s.filters})),currentPostType:c.currentPostType,filterLists:e.filterLists||{},portalMode:e.portalMode||{desktop:!1,tablet:!1,mobile:!1},showPostTypeFilter:e.showPostTypeFilter??!0,showSearchButton:e.showSearchButton??!0,showResetButton:e.showResetButton??!1,searchButtonText:e.searchButtonText||"",resetButtonText:e.resetButtonText||"",formToggleDesktop:e.formToggleDesktop??!1,formToggleTablet:e.formToggleTablet??!0,formToggleMobile:e.formToggleMobile??!0,searchButtonWidth:e.searchButtonWidth,searchButtonWidth_tablet:e.searchButtonWidth_tablet,searchButtonWidth_mobile:e.searchButtonWidth_mobile,searchButtonWidthUnit:e.searchButtonWidthUnit||"%",resetButtonWidth:e.resetButtonWidth,resetButtonWidth_tablet:e.resetButtonWidth_tablet,resetButtonWidth_mobile:e.resetButtonWidth_mobile,resetButtonWidthUnit:e.resetButtonWidthUnit||"%"},Z=s=>{const N=s==="search"?e.searchButtonWidthUnit||"%":e.resetButtonWidthUnit||"%";let L;return s==="search"?P==="mobile"?L=e.searchButtonWidth_mobile??e.searchButtonWidth_tablet??e.searchButtonWidth:P==="tablet"?L=e.searchButtonWidth_tablet??e.searchButtonWidth:L=e.searchButtonWidth:P==="mobile"?L=e.resetButtonWidth_mobile??e.resetButtonWidth_tablet??e.resetButtonWidth:P==="tablet"?L=e.resetButtonWidth_tablet??e.resetButtonWidth:L=e.resetButtonWidth,L!==void 0?{width:`${L}${N}`,flexGrow:0,flexShrink:0}:{}},F=()=>{let s;return P==="mobile"?s=e.postTypeFilterWidth_mobile??e.postTypeFilterWidth_tablet??e.postTypeFilterWidth:P==="tablet"?s=e.postTypeFilterWidth_tablet??e.postTypeFilterWidth:s=e.postTypeFilterWidth,s!==void 0?{width:`${s}%`,flexGrow:0,flexShrink:0}:{}};return React.createElement(React.Fragment,null,React.createElement("div",{className:"ts-form ts-search-widget","data-v-app":""},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(X)}}),le&&React.createElement("div",{className:"ts-filter-wrapper flexify"},React.createElement("a",{href:"#",onClick:s=>{s.preventDefault(),S()},onMouseDown:s=>s.preventDefault(),className:`ts-filter-toggle ts-btn ts-btn-1 ${c.activeFilterCount>0?"ts-filled":""}`,role:"button","aria-expanded":c.portalActive},se.filterslider,React.createElement("div",{className:"ts-toggle-text"},"Filter results"),c.activeFilterCount>0&&React.createElement("span",{className:"ts-filter-count"},c.activeFilterCount))),React.createElement("form",{method:"GET",onSubmit:s=>(s.preventDefault(),!1)},B&&React.createElement("div",{className:"ts-inline-filters"},a())),React.createElement("div",{className:"hidden"},React.createElement("div",{className:"ts-search-portal"}))),c.portalActive&&Ce(React.createElement("div",{className:`ts-search-portal vx-popup elementor voxel-fse-search-form-${e.blockId}`,"data-voxel-id":e.blockId},React.createElement("div",{className:"ts-popup-root elementor-element"},React.createElement("div",{className:"ts-form ts-search-widget no-render elementor-element"},React.createElement("div",{className:"ts-field-popup-container"},React.createElement("div",{className:"ts-field-popup triggers-blur",ref:m},React.createElement("div",{className:"ts-popup-content-wrapper min-scroll"},React.createElement("div",{className:"ts-form-group"},a())),React.createElement("div",{className:"ts-popup-controller"},React.createElement("ul",{className:"flexify simplify-ul"},React.createElement("li",{className:"flexify ts-popup-close"},React.createElement("a",{href:"#",onClick:s=>{s.preventDefault(),S()},className:"ts-icon-btn",role:"button","aria-label":"Close"},Ne(e.closeIcon,se.close))),React.createElement("li",{className:"flexify hide-d"},React.createElement("a",{href:"#",onClick:s=>{s.preventDefault(),v(!0)},className:"ts-icon-btn",role:"button"},se.reload)),React.createElement("li",{className:"flexify hide-m"},React.createElement("a",{href:"#",onClick:s=>{s.preventDefault(),v(!0)},className:"ts-btn ts-btn-1",role:"button"},"Clear")),React.createElement("li",{className:"flexify"},React.createElement("a",{href:"#",onClick:s=>{s.preventDefault(),y(),S()},className:"ts-btn ts-btn-2",role:"button"},"Search"))))))))),document.body),j())}export{_t as S};
