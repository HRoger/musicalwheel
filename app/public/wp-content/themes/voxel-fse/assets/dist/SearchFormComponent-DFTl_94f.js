import{useState as P,useRef as q,useMemo as ae,useEffect as J,useCallback as T}from"react";import{createPortal as Ce}from"react-dom";import{a as Oe}from"./siteUrl-7x5eJEvc.js";import Be from"@wordpress/api-fetch";import{V as re,r as Ne}from"./voxelIcons-gVyOSQ_B.js";import"./voxelShim-DB_Ue-9R.js";import"./backgroundElements-Ui-iCrLV.js";import"./MediaPopup-CXePoOCG.js";import{F as le,D as Re}from"./DatePicker-pD2Z7qly.js";function Ae(e,t){const n={},l=[t];return e.width&&e.width>0&&(n.width=`${e.width}%`,n.flexGrow=0,n.flexShrink=0),e.hideFilter&&l.push("vx-hidden"),e.alignContent&&(n.justifyContent=e.alignContent),e.hideLabel&&l.push("hide-label"),{style:n,className:l.join(" ")}}function Q(e,t){return Ae(e,t)}function ce(e){const t={},n=["ts-field-popup","triggers-blur"];return e.customPopupEnabled&&(e.popupMinWidth&&e.popupMinWidth>0&&(t.minWidth=`${e.popupMinWidth}px`),e.popupMaxWidth&&e.popupMaxWidth>0&&(t.maxWidth=`${e.popupMaxWidth}px`),e.popupMaxHeight&&e.popupMaxHeight>0&&(t.maxHeight=`${e.popupMaxHeight}px`),e.popupCenterPosition&&n.push("ts-popup-centered")),{style:t,className:n.join(" ")}}function We({attributes:e,postTypes:t,context:n,onSubmit:l,onPostTypeChange:m,onFilterChange:R}){const[i,f]=P(()=>({currentPostType:e.postTypes[0]||"",filterValues:{},activeFilterCount:0,portalActive:!1,loading:!1,resetting:!1,narrowedValues:null,narrowingFilters:!1,lastModifiedFilter:null})),c=q(!1),b=q(!1),d=q(null),v=ae(()=>t.find(E=>E.key===i.currentPostType),[t,i.currentPostType]),o=ae(()=>e.filterLists[i.currentPostType]||[],[e.filterLists,i.currentPostType]);J(()=>{e.postTypes.length>0&&!e.postTypes.includes(i.currentPostType)&&f(E=>({...E,currentPostType:e.postTypes[0],filterValues:{}}))},[e.postTypes,i.currentPostType]),J(()=>{if(!v?.filters)return;const E={};let h=!1;v.filters.forEach(y=>{y.key in i.filterValues||y.value!==null&&y.value!==void 0&&(E[y.key]=y.value,h=!0)}),h&&f(y=>({...y,filterValues:{...y.filterValues,...E}}))},[v?.filters,i.currentPostType]),J(()=>{if(n!=="editor"||i.resetting||!v?.filters)return;(e.filterLists?.[i.currentPostType]||[]).forEach(h=>{const y=i.filterValues[h.filterKey];h.defaultValueEnabled&&h.defaultValue!==void 0&&h.defaultValue!==""&&h.defaultValue!==null?y!==h.defaultValue&&y!==null&&f(a=>({...a,filterValues:{...a.filterValues,[h.filterKey]:h.defaultValue}})):y!=null&&f(a=>({...a,filterValues:{...a.filterValues,[h.filterKey]:void 0}}))})},[n,i.currentPostType,e.filterLists,i.resetting,v?.filters]),J(()=>{const E=Object.values(i.filterValues).filter(h=>h!=null&&h!==""&&h!==!1).length;f(h=>({...h,activeFilterCount:E}))},[i.filterValues]);const g=T(E=>{f(h=>h.currentPostType===E?h:{...h,currentPostType:E,filterValues:{}}),n==="editor"&&m&&m(E),n==="editor"&&R&&R({}),n==="frontend"&&l&&(b.current&&e.updateUrl!==!1&&Ve({},E),b.current=!0,setTimeout(()=>{l({postType:E})},50))},[n,l,m,R,e.updateUrl]),I=T((E,h)=>{b.current=!0,f(y=>{const a={...y.filterValues,[E]:h};return n==="editor"&&R&&setTimeout(()=>R(a),0),{...y,filterValues:a,lastModifiedFilter:E}})},[n,R]),L=T((E=!1)=>{const h={};v?.filters?.forEach(a=>{a.resets_to!==null&&a.resets_to!==void 0?h[a.key]=a.resets_to:h[a.key]=null});const y=Object.values(h).filter(a=>a!=null&&a!=="").length;if(f(a=>({...a,filterValues:h,activeFilterCount:y,resetting:!0,portalActive:E?!1:a.portalActive,narrowedValues:null,lastModifiedFilter:null})),setTimeout(()=>{f(a=>({...a,resetting:!1}))},100),n==="editor"&&R&&R(h),n==="frontend"){e.updateUrl!==!1&&Ue(i.currentPostType);const a=new CustomEvent("voxel-search-clear",{detail:{postType:i.currentPostType}});window.dispatchEvent(a)}},[n,i.currentPostType,R,e.updateUrl,v?.filters]),k=T(()=>{f(E=>({...E,portalActive:!E.portalActive}))},[]),$=T(async()=>{if(!e.adaptiveFiltering||n!=="frontend")return;if(c.current){c.current=!1;return}const E=o.filter(a=>a.type==="range"||a.type==="terms");if(E.length===0)return;const h=new URLSearchParams;h.set("type",i.currentPostType),i.lastModifiedFilter&&h.set("_last_modified",i.lastModifiedFilter),Object.entries(i.filterValues).forEach(([a,u])=>{u!=null&&u!==""&&(Array.isArray(u)?h.set(a,u.join(",")):typeof u=="object"?h.set(a,JSON.stringify(u)):h.set(a,String(u)))});const y=[];E.forEach(a=>{if(a.type==="terms"){const u=v?.filters?.find(s=>s.key===a.filterKey);if(u?.props?.terms){const s=p=>{p.forEach(F=>{F.term_taxonomy_id&&y.push(F.term_taxonomy_id),F.children&&Array.isArray(F.children)&&s(F.children)})};s(u.props.terms)}}}),f(a=>({...a,narrowingFilters:!0}));try{const a=Oe(),u=await fetch(`${a}voxel-fse/v1/search-form/narrow-filters?${h.toString()}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({term_taxonomy_ids:y})});if(!u.ok)throw new Error(`HTTP ${u.status}`);const s=await u.json();s.success&&s.data?(f(p=>({...p,narrowedValues:{ranges:s.data.ranges||{},terms:s.data.terms||{}},narrowingFilters:!1})),c.current=!0):f(p=>({...p,narrowingFilters:!1}))}catch(a){console.error("[useSearchForm] Adaptive filtering error:",a),f(u=>({...u,narrowingFilters:!1}))}},[e.adaptiveFiltering,n,o,i.currentPostType,i.filterValues,v]);J(()=>{if(!(!e.adaptiveFiltering||n!=="frontend"))return d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{$()},300),()=>{d.current&&clearTimeout(d.current)}},[i.filterValues,e.adaptiveFiltering,n,$]);const S=T((E,h)=>{f(y=>({...y,loading:!0})),l&&l({postType:h,...E}),n==="frontend"&&e.updateUrl!==!1&&b.current&&Ve(E,h),f(y=>({...y,loading:!1}))},[n,l,e.updateUrl]),w=q(null);J(()=>{if(e.searchOn==="change"&&n==="frontend"){const E=JSON.stringify({type:i.currentPostType,filters:i.filterValues});if(w.current===E)return;if(w.current===null){w.current=E;return}w.current=E;const h=setTimeout(()=>{S(i.filterValues,i.currentPostType)},300);return()=>{clearTimeout(h)}}},[i.filterValues,i.currentPostType,e.searchOn,n,S]);const C=T(()=>{b.current=!0,S(i.filterValues,i.currentPostType)},[S,i.filterValues,i.currentPostType]);return{state:i,setCurrentPostType:g,setFilterValue:I,clearAll:L,togglePortal:k,submit:C,currentPostTypeConfig:v,filterConfigs:o,narrowedValues:i.narrowedValues,narrowingFilters:i.narrowingFilters}}function Ue(e){const t=new URL(window.location.href),n=[];t.searchParams.forEach((l,m)=>{(m.startsWith("filter_")||m==="post_type")&&n.push(m),m==="type"&&!e&&n.push(m),m!=="type"&&m!=="page"&&m!=="pg"&&n.push(m)}),n.forEach(l=>t.searchParams.delete(l)),e&&t.searchParams.set("type",e),window.history.replaceState({},"",t.toString())}function je(e,t){return Object.hasOwn(t,e)}function Ve(e,t){const n=new URL(window.location.href),l=[];n.searchParams.forEach((m,R)=>{(R.startsWith("filter_")||R==="post_type")&&l.push(R),(R==="type"||je(R,e))&&l.push(R)}),l.forEach(m=>n.searchParams.delete(m)),t&&n.searchParams.set("type",t),Object.entries(e).forEach(([m,R])=>{if(!(R==null||R==="")&&!(typeof R=="string"&&R==="..")&&!(typeof R=="object"&&!Array.isArray(R)&&!Object.values(R).some(c=>c!=null&&c!=="")))if(Array.isArray(R)){const i=R.join(",");i&&n.searchParams.set(m,i)}else typeof R=="object"?n.searchParams.set(m,JSON.stringify(R)):n.searchParams.set(m,String(R))}),window.history.replaceState({},"",n.toString())}function ke(e){return typeof e=="string"&&e.includes("@tags()")}function Fe(e){if(!ke(e))return e;const t=e.match(/@tags\(\)(.*?)@endtags\(\)/s);return t?t[1]:e}async function _e(e,t={}){try{return(await Be({path:"/voxel-fse/v1/dynamic-data/render",method:"POST",data:{expression:e,context:t}})).rendered}catch(n){return console.error("Failed to render dynamic tag:",n),e}}function we(){return typeof document>"u"?!1:document.body.classList.contains("logged-in")}function He(){return typeof document>"u"?[]:Array.from(document.body.classList).filter(n=>n.startsWith("role-")||["administrator","editor","author","contributor","subscriber"].includes(n)).map(n=>n.replace("role-",""))}function Ke(e){const t=e.filterKey;switch(t){case"user:logged_in":return we();case"user:logged_out":return!we();case"user:role":{if(!we())return!1;const n=He(),l=e.value||"";switch(e.operator){case"equals":return n.includes(l);case"not_equals":return!n.includes(l);default:return n.includes(l)}}default:return console.warn(`Unknown visibility rule type: ${t}`),!0}}function qe(e){return!e||e.length===0?!0:e.every(t=>Ke(t))}function ze(e){const{rowVisibility:t="show",visibilityRules:n=[]}=e;if(!n||n.length===0)return!0;const l=qe(n);return t==="hide"?!l:l}function Ge({config:e,filterData:t,value:n,onChange:l,blockId:m}){const R=m?`voxel-popup-${m}`:"",i=q(null),f=q(null),[c,b]=P(!1),[d,v]=P(""),o=typeof n=="string"?n:"",g=t.props?.placeholder||t.label||"Type keywords...",I=e.displayAs||t.props?.display_as||"inline",L=t.icon||"";J(()=>{c&&(v(o),setTimeout(()=>{f.current?.focus()},50))},[c,o]);const k=s=>{l(s.target.value)},$=s=>{v(s.target.value)},S=T(()=>{b(!0)},[]),w=T(()=>{l(d),b(!1)},[d,l]),C=T(()=>{v(""),l("")},[l]),E=T(s=>{s.key==="Enter"&&(s.preventDefault(),w())},[w]);if(I==="inline"){const{style:s,className:p}=Q(e,"ts-form-group ts-inline-filter");return React.createElement("div",{className:p,style:s},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:"ts-input-icon flexify"},L&&React.createElement("span",{dangerouslySetInnerHTML:{__html:L}}),React.createElement("input",{type:"text",value:o,onChange:k,placeholder:g,className:"inline-input"})))}const h=o.length>0,{style:y,className:a}=Q(e,"ts-form-group"),u=ce(e);return React.createElement("div",{className:a,style:y},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:i,className:`ts-filter ts-popup-target ${h?"ts-filled":""}`,onClick:S,onMouseDown:s=>s.preventDefault(),role:"button",tabIndex:0},L&&React.createElement("span",{dangerouslySetInnerHTML:{__html:L}}),React.createElement("div",{className:"ts-filter-text"},h?o:g)),React.createElement(le,{isOpen:c,target:i,title:"",icon:L,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:w,onClear:C,onClose:()=>b(!1),className:`${R}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:u.style},React.createElement("div",{className:"ts-input-icon ts-sticky-top flexify"},React.createElement("span",null,re.search),React.createElement("input",{ref:f,type:"text",value:d,onChange:$,onKeyDown:E,placeholder:g,className:"autofocus border-none"}))))}const Je=()=>window.noUiSlider;function Ie(e,t,n){if(e==null||e==="")return{min:t,max:n};if(typeof e=="string"&&e.includes("..")){const l=e.split(".."),m=l[0]!==""?Number(l[0]):t,R=l[1]!==""?Number(l[1]):n;return{min:isNaN(m)?t:m,max:isNaN(R)?n:R}}if(typeof e=="object"){const l=e;return{min:l.min??t,max:l.max??n}}return typeof e=="number"?{min:e,max:n}:{min:t,max:n}}function Qe({config:e,filterData:t,value:n,onChange:l,blockId:m,narrowedValues:R,isNarrowing:i}){const f=[m?`voxel-popup-${m}`:"",e.id?`elementor-repeater-item-${e.id}`:""].filter(Boolean).join(" "),c=q(null),b=q(null),d=q(null),[v,o]=P(!1),g=t.props||{},I=g.min??0,L=g.max??100,k=g.step??1,$=g.placeholder||t.label||"Range",S=e.displayAs||t.props?.display_as||"popup",w=g.handles||"double",C=g.compare||"in_range",E=e.filterKey,h=R?.ranges?.[E],y=h?.min??I,a=h?.max??L,u=g.format||"number",s=g.prefix||(typeof u=="object"?u.prefix:"")||"",p=g.suffix||(typeof u=="object"?u.suffix:"")||"",F=t.icon||"",z=Ie(n,y,a),[V,G]=P(z.min),[O,U]=P(z.max),D=T(M=>u==="price"?`${s}${M.toLocaleString()}${p}`:`${s}${M}${p}`,[u,s,p]),j=n!=null&&n!==""&&(z.min!==y||z.max!==a),ee=j?`${D(z.min)} — ${D(z.max)}`:$,se=`${D(V)} — ${D(O)}`,B=T(()=>{if(!b.current||d.current)return;const M=V,H=O;let fe,ue;w==="double"?(fe=[M,H],ue=!0):C==="in_range"?(fe=[H],ue=[!1,!0]):(fe=[M],ue=[!0,!1]);const A=Je();if(!A){console.error("noUiSlider not loaded - window.noUiSlider is undefined");return}A.create(b.current,{start:fe,connect:ue,range:{min:y,max:a},step:k,behaviour:"tap-drag"}),d.current=b.current.noUiSlider,d.current.on("update",te=>{w==="double"?(G(Math.round(Number(te[0]))),U(Math.round(Number(te[1])))):C==="in_range"?U(Math.round(Number(te[0]))):G(Math.round(Number(te[0])))}),requestAnimationFrame(()=>{d.current&&(w==="double"?d.current.set([M,H],!1):d.current.set([M],!1))})},[w,C,V,O,y,a,k]),X=T(()=>{d.current&&(d.current.destroy(),d.current=null)},[]);J(()=>{const M=Ie(n,y,a);if(G(M.min),U(M.max),d.current){const H=w==="double"?[M.min,M.max]:[M.min];d.current.set(H,!1),requestAnimationFrame(()=>{d.current&&d.current.set(H,!1)})}},[n,y,a,w]),J(()=>{if(v&&S==="popup"){const M=setTimeout(()=>{B()},100);return()=>clearTimeout(M)}return()=>{S==="popup"&&X()}},[v,S,B,X]),J(()=>{if(S==="inline")return B(),()=>X()},[S,B,X]),J(()=>{if(!d.current||!h)return;d.current.updateOptions({range:{min:y,max:a}},!0);let M=V,H=O;M<y&&(M=y),M>a&&(M=a),w==="double"&&(H<y&&(H=y),H>a&&(H=a),M>H&&(M=H)),w==="double"?d.current.set([M,H]):d.current.set([M]),G(M),U(H)},[h,y,a,w]);const Z=T(()=>{o(!0)},[]),_=T((M,H)=>M===y&&H===a?null:w==="double"?`${M}..${H}`:C==="greater_than"||C==="in_range"?`${M}..`:`..${H}`,[w,C,y,a]),r=M=>{const H=M.target.value===""?y:Number(M.target.value);G(H),d.current&&d.current.set(w==="double"?[H,O]:[H]),S==="minmax"&&l(_(H,O))},N=M=>{const H=M.target.value===""?a:Number(M.target.value);U(H),d.current&&d.current.set([V,H]),S==="minmax"&&l(_(V,H))},x=T(()=>{l(_(V,O)),o(!1)},[V,O,_,l]),W=T(()=>{G(y),U(a),d.current&&d.current.set(w==="double"?[y,a]:[y]),l(null)},[y,a,w,l]),Y=()=>React.createElement("div",{className:"ts-minmax"},React.createElement("input",{type:"number",className:"inline-input input-no-icon",placeholder:String(y),value:V,onChange:r,min:y,max:O,step:k}),w==="double"&&React.createElement("input",{type:"number",className:"inline-input input-no-icon",placeholder:String(a),value:O,onChange:N,min:V,max:a,step:k})),K=()=>React.createElement("div",{className:`range-slider-wrapper${i?" ts-loading":""}`},React.createElement("div",{className:"range-value"},se),React.createElement("div",{ref:b,className:"range-slider"}),h&&(h.min!==I||h.max!==L)&&React.createElement("div",{className:"range-narrowed-indicator"},React.createElement("small",null,"Showing ",D(y)," — ",D(a)," based on current results")));if(S==="minmax"&&w==="double"){const{style:M,className:H}=Q(e,"ts-form-group");return React.createElement("div",{className:H,style:M},!e.hideLabel&&React.createElement("label",null,t.label),Y())}if(S==="inline"){const{style:M,className:H}=Q(e,"ts-form-group ts-inline-filter");return React.createElement("div",{className:H,style:M},!e.hideLabel&&React.createElement("label",null,t.label),K())}const{style:ne,className:me}=Q(e,"ts-form-group"),ie=ce(e);return React.createElement("div",{className:me,style:ne},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:c,className:`ts-filter ts-popup-target ${j?"ts-filled":""}`,onClick:Z,onMouseDown:M=>M.preventDefault(),role:"button",tabIndex:0},F&&React.createElement("span",{dangerouslySetInnerHTML:{__html:F}}),React.createElement("div",{className:"ts-filter-text"},ee),React.createElement("div",{className:"ts-down-icon"})),React.createElement(le,{isOpen:v,target:c,title:"",icon:F,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:x,onClear:W,onClose:()=>o(!1),className:`${f}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:ie.style},React.createElement("div",{className:"ts-form-group"},React.createElement("label",null,t.label,t.description&&React.createElement("small",null,t.description)),K())))}function Ye(e,t){let n=null;return function(...l){n&&clearTimeout(n),n=setTimeout(()=>e.apply(this,l),t)}}function Xe({config:e,filterData:t,value:n,onChange:l,blockId:m}){const R=m?`voxel-popup-${m}`:"",i=t.props||{},f=i.min??0,c=i.max??99,b=i.step??1,d=i.default??f,v=i.placeholder||t.label||"Any",o=e.displayAs||t.props?.display_as||"popup",g=t.icon||"",I=q(null),[L,k]=P(!1),$=typeof n=="number"?n:d,[S,w]=P($),C=ae(()=>Ye(O=>l(O),300),[l]);J(()=>{w(typeof n=="number"?n:d)},[n,d]),J(()=>{L&&w($)},[L,$]);const E=O=>{O.preventDefault();const U=Math.max(f,S-b);w(U),o==="inline"&&C(U)},h=O=>{O.preventDefault();const U=Math.min(c,S+b);w(U),o==="inline"&&C(U)},y=O=>{const U=parseInt(O.target.value,10);if(!isNaN(U)){const D=Math.min(c,Math.max(f,U));w(D),o==="inline"&&C(D)}},a=T(()=>{k(!0)},[]),u=T(()=>{l(S),k(!1)},[S,l]),s=T(()=>{w(d),l(d)},[d,l]),p=()=>React.createElement("div",{className:"ts-stepper-input flexify"},React.createElement("button",{type:"button",className:"ts-stepper-left ts-icon-btn inline-btn-ts",onClick:E},React.createElement("i",{className:"las la-minus"})),React.createElement("input",{type:"number",className:"ts-input-box",min:f,max:c,step:b,value:S,onChange:y,placeholder:v}),React.createElement("button",{type:"button",className:"ts-stepper-right ts-icon-btn inline-btn-ts",onClick:h},React.createElement("i",{className:"las la-plus"})));if(o==="inline"){const{style:O,className:U}=Q(e,"ts-form-group ts-inline-filter");return React.createElement("div",{className:U,style:O},!e.hideLabel&&React.createElement("label",null,t.label),p())}const F=$!==d,{style:z,className:V}=Q(e,"ts-form-group"),G=ce(e);return React.createElement("div",{className:V,style:z},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:I,className:`ts-filter ts-popup-target ${F?"ts-filled":""}`,onClick:a,onMouseDown:O=>O.preventDefault(),role:"button",tabIndex:0},g&&React.createElement("span",{dangerouslySetInnerHTML:{__html:g}}),React.createElement("div",{className:"ts-filter-text"},F?S:v),React.createElement("div",{className:"ts-down-icon"})),React.createElement(le,{isOpen:L,target:I,title:"",icon:g,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:u,onClear:s,onClose:()=>k(!1),className:`${R}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:G.style},React.createElement("div",{className:"ts-form-group"},React.createElement("label",null,t.label,t.description&&React.createElement("small",null,t.description)),p())))}function Ze(e){return e==null||e===""?[]:typeof e=="string"?e.split(",").map(t=>t.trim()).filter(t=>t!==""):Array.isArray(e)?e.length>0&&typeof e[0]=="string"?e:e.length>0&&typeof e[0]=="number"?e.map(String):[]:[]}function Se(e){return e.length===0?null:e.join(",")}function et({config:e,filterData:t,value:n,onChange:l,blockId:m,narrowedValues:R,isNarrowing:i}){const f=m?`voxel-popup-${m}`:"",c=q(null),b=q(null),[d,v]=P(!1),[o,g]=P(""),I=t.props||{},L=I.multiple??!0,k=I.placeholder||t.label||"Select",$=e.displayAs||I.display_as||"popup",S=e.hideEmptyTerms??I.hide_empty_terms??!1,w=t.icon||"",C=I.taxonomy||e.filterKey,E=R?.terms?.[C],h=T(_=>{const r=(N,x,W)=>{const Y={...N,parentRef:x||void 0,hasSelection:!1,depth:W};return N.children&&N.children.length>0&&(Y.children=N.children.map(K=>r(K,Y,W+1))),Y};return _.map(N=>r(N,null,0))},[]),y=ae(()=>{const _=I.terms||[];return h(_)},[I,h]),a=ae(()=>{const _=new Map,r=N=>{_.set(N.slug,N),N.children&&N.children.forEach(x=>r(x))};return y.forEach(N=>r(N)),_},[y]),u=ae(()=>{const _=[],r=N=>{N.forEach(x=>{S&&E&&x.term_taxonomy_id&&E[x.term_taxonomy_id]===0||(_.push(x),x.children&&x.children.length>0&&r(x.children))})};return r(y),_},[y,S,E]),s=T(_=>!E||!_.term_taxonomy_id?null:E[_.term_taxonomy_id]??null,[E]),p=ae(()=>Ze(n),[n]),F=T(_=>_.slug?p.includes(_.slug):!1,[p]),z=ae(()=>u.filter(_=>_.slug&&p.includes(_.slug)),[u,p]),V=ae(()=>{if(!o)return u;const _=o.toLowerCase();return u.filter(r=>r.label.toLowerCase().includes(_))},[u,o]);J(()=>{d&&(g(""),u.length>=15&&setTimeout(()=>b.current?.focus(),50))},[d,u.length]);const G=T(()=>{v(!0)},[]),O=T(_=>{const r=_.slug;if(r)if(L){let N=[...p];if(N.includes(r)){N=N.filter(W=>W!==r);let x=_.parentRef;for(;x;)x.children?.some(Y=>N.includes(Y.slug)||Y.hasSelection)||(x.hasSelection=!1),x=x.parentRef;l(Se(N))}else{N.push(r);let x=_.parentRef;for(;x;)N=N.filter(Y=>Y!==x.slug),x.hasSelection=!0,x=x.parentRef;const W=new Set;N.forEach(Y=>{const K=a.get(Y);if(!K)return;let ne=K.parentRef;const me=[];let ie=!1;for(;ne;){if(ne.slug===r){ie=!0;break}me.push(ne),ne=ne.parentRef}ie&&(W.add(K.slug),me.forEach(M=>{M.hasSelection=!1}))}),N=N.filter(Y=>!W.has(Y)),l(Se(N))}}else l(Se([r])),$!=="inline"&&v(!1)},[L,p,l,a,$]),U=T(()=>{v(!1)},[]),D=T(()=>{l(null)},[l]),j=p.length>0,ee=j&&z[0]?.label||k,se=z.length>1?z.length-1:0;if($==="inline"){const{style:_,className:r}=Q(e,"ts-form-group inline-terms-wrapper ts-inline-filter min-scroll");return React.createElement("div",{className:`${r}${i?" ts-loading":""}`,style:_},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:"ts-term-dropdown ts-multilevel-dropdown inline-multilevel"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},u.map(N=>{const x=F(N),W=s(N),Y=W===0;return React.createElement("li",{key:N.slug,className:`${x?"ts-selected":""}${Y?" ts-disabled":""}`},React.createElement("a",{href:"#",className:"flexify",onClick:K=>{K.preventDefault(),Y||O(N)}},React.createElement("div",{className:"ts-checkbox-container"},React.createElement("label",{className:`container-${L?"checkbox":"radio"}`},React.createElement("input",{type:L?"checkbox":"radio",checked:x,readOnly:!0,disabled:!0,hidden:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,N.depth>0?"— ".repeat(N.depth):"",N.label),W!==null&&React.createElement("span",{className:"ts-term-count"},"(",W,")"),N.icon&&React.createElement("div",{className:"ts-term-icon",dangerouslySetInnerHTML:{__html:N.icon}})))}))))}if($==="buttons"){const{style:_,className:r}=Q(e,"ts-form-group");return React.createElement("div",{className:r,style:_},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("ul",{className:"simplify-ul addon-buttons flexify"},u.map(N=>{const x=F(N);return React.createElement("li",{key:N.slug,className:`flexify ${x?"adb-selected":""}`,onClick:()=>O(N)},N.label)})))}const{style:B,className:X}=Q(e,"ts-form-group"),Z=ce(e);return React.createElement("div",{className:X,style:B},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:c,className:`ts-filter ts-popup-target ${j?"ts-filled":""}`,onClick:G,onMouseDown:_=>_.preventDefault(),role:"button",tabIndex:0},w&&React.createElement("span",{dangerouslySetInnerHTML:{__html:w}}),React.createElement("div",{className:"ts-filter-text"},ee,se>0&&React.createElement("span",{className:"term-count"},"+",se)),React.createElement("div",{className:"ts-down-icon"})),React.createElement(le,{isOpen:d,target:c,title:"",icon:w,saveLabel:"Save",clearLabel:"Clear",showClear:!0,showSave:L,onSave:U,onClear:D,onClose:()=>v(!1),className:`${f}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:Z.style},u.length>=15&&React.createElement("div",{className:"ts-sticky-top uib b-bottom"},React.createElement("div",{className:"ts-input-icon flexify"},React.createElement("span",null,re.search),React.createElement("input",{ref:b,type:"text",value:o,onChange:_=>g(_.target.value),placeholder:"Search",className:"autofocus"}))),React.createElement("div",{className:`ts-term-dropdown ts-multilevel-dropdown ts-md-group${i?" ts-loading":""}`},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},V.map(_=>{const r=F(_),N=s(_),x=N===0;return React.createElement("li",{key:_.slug,className:`${r?"ts-selected":""}${x?" ts-disabled":""}`},React.createElement("a",{href:"#",className:"flexify",onClick:W=>{W.preventDefault(),x||O(_)}},React.createElement("div",{className:"ts-checkbox-container"},React.createElement("label",{className:`container-${L?"checkbox":"radio"}`},React.createElement("input",{type:L?"checkbox":"radio",checked:r,readOnly:!0,disabled:!0,hidden:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,_.depth>0?"— ".repeat(_.depth):"",_.label),N!==null&&React.createElement("span",{className:"ts-term-count"},"(",N,")"),_.icon&&React.createElement("div",{className:"ts-term-icon",dangerouslySetInnerHTML:{__html:_.icon}})))})),V.length===0&&React.createElement("div",{className:"ts-empty-user-tab"},w&&React.createElement("span",{dangerouslySetInnerHTML:{__html:w}}),React.createElement("p",null,"No results found")))))}const tt=()=>window.noUiSlider;function de(e){return!e||!e.address?null:e.swlat!==void 0&&e.swlng!==void 0&&e.nelat!==void 0&&e.nelng!==void 0?`${e.address};${e.swlat},${e.swlng}..${e.nelat},${e.nelng}`:e.lat!==void 0&&e.lng!==void 0?`${e.address};${e.lat},${e.lng},${e.radius||25}`:e.address}function nt(e,t){if(e==null||e==="")return null;if(typeof e=="string"){const n=e.indexOf(";");if(n===-1)return{address:e};const l=e.substring(0,n),m=e.substring(n+1);if(m.includes("..")){const i=m.split(".."),f=i[0].split(","),c=i[1].split(",");return{address:l,swlat:Number(f[0]),swlng:Number(f[1]),nelat:Number(c[0]),nelng:Number(c[1])}}const R=m.split(",");return{address:l,lat:Number(R[0]),lng:Number(R[1]),radius:R[2]?Number(R[2]):t}}return typeof e=="object"?e:null}function lt({config:e,filterData:t,value:n,onChange:l,blockId:m}){const R=m?`voxel-popup-${m}`:"",i=q(null),f=q(null),c=q(null),b=q(null),d=q(null),[v,o]=P(!1),[g,I]=P(!1),L=q(null),k=t.props||{},$=k.radius||{},S=$.default??25,w=$.min??1,C=$.max??100,E=$.step??1,h=k.units||"km",y=k.display_proximity_as||"popup",a=k.placeholder||t.label||"Location",u=e.displayAs||t.props?.display_as||"popup",s=t.icon||"",p=nt(n,S)||{},[F,z]=P(p.address||""),[V,G]=P(p.radius||S),O=T(A=>Math.round(A*1e6)/1e6,[]),U=T(A=>`${A}${h==="mi"?"mi":"km"}`,[h]),D=T(()=>{if(!b.current||d.current)return;const A=tt();if(!A){console.error("noUiSlider not loaded - window.noUiSlider is undefined");return}A.create(b.current,{start:V,connect:[!0,!1],step:E,range:{min:w,max:C},behaviour:"tap-drag"}),d.current=b.current.noUiSlider,d.current.on("update",te=>{G(Math.round(Number(te[0])))}),d.current.on("change",te=>{const oe=Math.round(Number(te[0]));y==="inline"&&p.lat&&l(de({...p,radius:oe}))})},[V,E,w,C,y,p,l]),j=T(()=>{d.current&&(d.current.destroy(),d.current=null)},[]);J(()=>{if(y==="inline"&&p.lat){const A=setTimeout(()=>D(),50);return()=>{clearTimeout(A),j()}}},[y,p.lat,D,j]),J(()=>{if(g){const A=setTimeout(()=>D(),50);return()=>clearTimeout(A)}return()=>j()},[g,D,j]),J(()=>{const A=p.radius||S;G(A),d.current&&d.current.set([A])},[p.radius,S]);const ee=T(()=>{if(c.current||!f.current||typeof window>"u")return;const A=window.Voxel?.Maps;if(!A){console.warn("Voxel.Maps not available for autocomplete");return}A.await(()=>{if(c.current)return;const te=e.autocomplete||{};c.current=new A.Autocomplete(f.current,oe=>{if(oe){const $e=oe.viewport.getSouthWest(),Le=oe.viewport.getNorthEast(),De={address:oe.address,swlat:O($e.getLatitude()),swlng:O($e.getLongitude()),nelat:O(Le.getLatitude()),nelng:O(Le.getLongitude()),lat:O(oe.latlng.getLatitude()),lng:O(oe.latlng.getLongitude()),radius:p.radius||S};z(oe.address),l(de(De)),u==="popup"&&o(!1)}else z(""),l(null)},te)})},[e.autocomplete,l,u,S,p.radius,O]);J(()=>{(v||u==="inline")&&(z(p.address||""),v&&setTimeout(()=>f.current?.focus(),50))},[v,u,p.address]);const se=T(()=>{o(!0)},[]),B=T(()=>{ee()},[ee]),X=A=>{z(A.target.value),u==="inline"&&(A.target.value?l(de({...p,address:A.target.value})):l(null))},Z=A=>{A.preventDefault(),A.stopPropagation(),"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(te=>{const oe={address:"Current Location",lat:te.coords.latitude,lng:te.coords.longitude,radius:S};z("Current Location"),l(de(oe)),u==="popup"&&o(!1)},te=>{console.error("Geolocation error:",te)})},_=T(()=>{l(F?de({...p,address:F}):null),o(!1)},[F,p,l]),r=T(()=>{z(""),l(null)},[l]),N=T(A=>{A.key==="Enter"&&(A.preventDefault(),_())},[_]),x=T(()=>{p.lat&&l(de({...p,radius:V})),I(!1)},[p,V,l]),W=T(()=>{G(S),d.current&&d.current.set([S]),p.lat&&l(de({...p,radius:S}))},[S,p,l]),Y=!!p.address||!!p.lat,K=Y?p.address||"Location set":a,ne=()=>React.createElement("div",{className:"ts-input-icon flexify",style:{position:"relative"}},s&&React.createElement("span",{dangerouslySetInnerHTML:{__html:s}}),React.createElement("input",{ref:f,type:"text",className:"inline-input",placeholder:a,value:F,onChange:X,onKeyDown:N,onFocus:B}),React.createElement("a",{href:"#",className:"inline-user-location ts-icon-btn",onClick:Z,title:"Use my location","aria-label":"Use my location"},re.crosshairs)),me=()=>React.createElement("div",{className:"range-slider-wrapper"},React.createElement("div",{className:"range-value"},U(V)),React.createElement("div",{ref:b,className:"range-slider"})),ie=()=>!p.lat||y==="inline"?null:React.createElement("div",{className:"ts-form-group ts-proximity-filter"},React.createElement("label",null,k.proximity_label||"Radius"),React.createElement("div",{ref:L,className:`ts-filter ts-popup-target ${p.radius?"ts-filled":""}`,onClick:()=>I(!0),onMouseDown:A=>A.preventDefault(),role:"button",tabIndex:0},React.createElement("div",{className:"ts-filter-text"},U(p.radius||S)),React.createElement("div",{className:"ts-down-icon"})),React.createElement(le,{isOpen:g,target:L,title:"",saveLabel:"Save",clearLabel:"Reset",showClear:!0,onSave:x,onClear:W,onClose:()=>I(!1),className:`${R}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:ue.style},React.createElement("div",{className:"ts-form-group"},React.createElement("label",null,k.proximity_label||"Search radius"),me()))),M=()=>y!=="inline"||!p.lat?null:React.createElement("div",{className:"ts-form-group ts-inline-proximity"},React.createElement("label",null,k.proximity_label||"Radius",": ",U(V)),React.createElement("div",{ref:b,className:"range-slider"}));if(u==="inline"){const{style:A,className:te}=Q(e,"ts-form-group ts-inline-filter");return React.createElement(React.Fragment,null,React.createElement("div",{className:te,style:A},!e.hideLabel&&React.createElement("label",null,t.label),ne()),M(),ie())}const{style:H,className:fe}=Q(e,"ts-form-group"),ue=ce(e);return React.createElement(React.Fragment,null,React.createElement("div",{className:fe,style:H},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:i,className:`ts-filter ts-popup-target ${Y?"ts-filled":""}`,onClick:se,onMouseDown:A=>A.preventDefault(),role:"button",tabIndex:0},s&&React.createElement("span",{dangerouslySetInnerHTML:{__html:s}}),React.createElement("div",{className:"ts-filter-text"},K),React.createElement("div",{className:"ts-down-icon"})),React.createElement(le,{isOpen:v,target:i,title:"",icon:s,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:_,onClear:r,onClose:()=>o(!1),className:`${R}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:ue.style},React.createElement("div",{className:"ts-form-group"},ne()))),M(),ie())}function st(e){if(e==null||e==="")return{date:"",slots:1};if(typeof e=="string")return{date:e,slots:1};if(typeof e=="object"){const t=e;return{date:t.date||"",slots:t.slots||1}}return{date:"",slots:1}}const he=e=>{if(!e)return null;try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t:null}catch{return null}},pe=e=>{if(!e)return null;const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${l}`},ye=e=>{if(!e)return"";try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):""}catch{return e}};function at({config:e,filterData:t,value:n,onChange:l,blockId:m}){const R=[m?`voxel-popup-${m}`:"",e.id?`elementor-repeater-item-${e.id}`:""].filter(Boolean).join(" "),i=q(null),f=q(null),[c,b]=P(!1),d=t.props||{},o=(d.inputMode||"date-range")==="date-range",g=d.l10n||{},I=g.pickDate||t.label||"Select dates",L=t.icon||"",k=st(n),$=k.date,S=k.slots;let w="",C="";o&&$&&$.includes("..")?[w,C]=$.split(".."):!o&&$&&(w=$);const[E,h]=P(()=>he(w)),[y,a]=P(()=>he(C)),[u,s]=P("start"),[p,F]=P(S);J(()=>{if(c){if(o&&$&&$.includes("..")){const[B,X]=$.split("..");h(he(B)),a(he(X))}else!o&&$&&h(he($));F(S),s("start")}},[c,o,$,S]);const z=T(()=>{b(!0)},[]),V=T(B=>{if(o&&B&&f.current)if(u==="start")h(B),s("end"),f.current.setStartRange(B),f.current.setEndRange(null),f.current.draw();else if(E&&B<E)h(B),a(null),f.current.setStartRange(B),f.current.setEndRange(null),f.current.draw();else{a(B),s("start"),f.current.setEndRange(B),f.current.draw();const X=pe(E),Z=pe(B);X&&Z&&(l(`${X}..${Z}`),b(!1))}else h(B)},[o,u,E,l]);T(B=>{F(Number(B.target.value)||1)},[]);const G=T(B=>{if(o){const X=pe(E),Z=pe(y);X&&Z&&l(`${X}..${Z}`)}else{const Z=pe(B!==void 0?B:E);Z&&l(Z)}b(!1)},[o,E,y,l]),O=T(()=>{h(null),a(null),F(1),l(null),f.current&&(f.current.setStartRange(null),f.current.setEndRange(null))},[l]),U=o?!!(w&&C):!!$,D=ae(()=>{if(!U)return I;if(o){const B=ye(w),X=ye(C),Z=`${B} — ${X}`;return S>1?`${Z} (${S})`:Z}else{const B=ye($);return S>1?`${B} (${S})`:B}},[o,U,w,C,$,S,I]),{style:j,className:ee}=Q(e,"ts-form-group"),se=ce(e);return React.createElement("div",{className:ee,style:j},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:i,className:`ts-filter ts-popup-target ${U?"ts-filled":""}`,onClick:z,onMouseDown:B=>B.preventDefault(),role:"button",tabIndex:0},L&&React.createElement("span",{dangerouslySetInnerHTML:{__html:L}}),React.createElement("div",{className:"ts-filter-text"},D),React.createElement("div",{className:"ts-down-icon"})),React.createElement(le,{isOpen:c,target:i,title:"",icon:L,saveLabel:g.save||"Save",clearLabel:g.clear||"Clear",showSave:o,onSave:G,onClear:O,onClose:()=>b(!1),className:`${R}${o?" ts-availability-wrapper xl-height xl-width":" md-width xl-height"}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:se.style},o&&React.createElement("div",{className:"ts-popup-head flexify"},React.createElement("div",{className:"ts-popup-name flexify"},L&&React.createElement("span",{dangerouslySetInnerHTML:{__html:L}}),React.createElement("span",null,React.createElement("span",{className:u==="start"?"chosen":"",onClick:()=>s("start"),style:{cursor:"pointer"}},E?ye(pe(E)):g.checkIn||"Check-in"),React.createElement("span",null," — "),React.createElement("span",{className:u==="end"?"chosen":"",onClick:()=>s("end"),style:{cursor:"pointer"}},y?ye(pe(y)):g.checkOut||"Check-out")))),React.createElement(Re,{value:E,onChange:V,...!o&&{onSelect:G},pickerConfig:{minDate:new Date,...o?{numberOfMonths:2,theme:"pika-range"}:{}},onPickerReady:B=>{f.current=B,o&&E&&(B.setStartRange(E),y&&B.setEndRange(y))}})))}function rt(e,t){if(e==null||e==="")return{from:"",to:""};if(typeof e=="string"){if(t&&e.includes("..")){const n=e.split("..");return{from:n[0]||"",to:n[1]||""}}return{from:e,to:""}}if(typeof e=="object"){const n=e;return{from:n.from||"",to:n.to||""}}return{from:"",to:""}}function Ee(e,t,n){return!e&&!t?null:n?e&&t?`${e}..${t}`:e?`${e}..`:t?`..${t}`:null:e||null}const ve=e=>{if(!e)return null;try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t:null}catch{return null}},Pe=e=>{if(!e)return null;const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${l}`},ge=e=>{if(!e)return"";try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}):""}catch{return e}};function ct({config:e,filterData:t,value:n,onChange:l,blockId:m}){const R=m?`voxel-popup-${m}`:"",i=q(null),f=t.props||{},c=f.enable_range??!1,b=f.placeholder||t.label||"Select date",d=t.icon||"",v=rt(n,c),o=v.from,g=v.to,[I,L]=P(!1),[k,$]=P(!1),[S,w]=P(()=>ve(o)),[C,E]=P(()=>ve(g)),h=T(()=>{w(ve(o)),L(!0)},[o]),y=T(()=>{E(ve(g)),$(!0)},[g]),a=T(j=>{w(j)},[]),u=T(j=>{E(j)},[]),s=T(j=>{const se=Pe(j!==void 0?j:S)||"";l(Ee(se,g,c)),L(!1)},[S,c,g,l]),p=T(j=>{const se=Pe(j!==void 0?j:C)||"";l(Ee(o,se,c)),$(!1)},[C,o,c,l]),F=T(()=>{w(null),l(Ee("",g,c))},[c,g,l]),z=T(()=>{E(null),l(Ee(o,"",c))},[o,c,l]),V=c?!!o||!!g:!!o,G=ae(()=>{if(!V)return b;if(c){const j=[];return o&&j.push(ge(o)),g&&j.push(ge(g)),j.join(" - ")||b}return ge(o)||b},[V,c,o,g,b]),{style:O,className:U}=Q(e,"ts-form-group"),D=ce(e);return React.createElement("div",{className:U,style:O},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:i,className:`ts-filter ts-popup-target ${V?"ts-filled":""}`,onClick:h,onMouseDown:j=>j.preventDefault(),role:"button",tabIndex:0},d&&React.createElement("span",{dangerouslySetInnerHTML:{__html:d}}),React.createElement("div",{className:"ts-filter-text"},G),React.createElement("div",{className:"ts-down-icon"})),React.createElement(le,{isOpen:I,target:i,title:c?"From":"",icon:d,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:s,onClear:F,onClose:()=>L(!1),className:`${R}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:D.style},React.createElement(Re,{value:S,onChange:a,onSelect:s}),c&&React.createElement("div",{className:"ts-form-group",style:{marginTop:"12px",borderTop:"1px solid var(--ts-shade-5)",paddingTop:"12px"}},React.createElement("label",null,"To"),React.createElement("div",{className:`ts-filter ts-popup-target ${g?"ts-filled":""}`,onClick:j=>{j.stopPropagation(),L(!1),setTimeout(()=>y(),100)},role:"button",tabIndex:0},d&&React.createElement("span",{dangerouslySetInnerHTML:{__html:d}}),React.createElement("div",{className:"ts-filter-text"},g?ge(g):"Select end date")))),c&&React.createElement(le,{isOpen:k,target:i,title:"To",icon:d,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:p,onClear:z,onClose:()=>$(!1),className:`${R}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:D.style},React.createElement(Re,{value:C,onChange:u,onSelect:p})))}const be=e=>{if(!e)return null;try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t:null}catch{return null}},Me=e=>{if(!e)return null;const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${l}`},Te=e=>{if(!e)return"";try{const t=new Date(e+"T00:00:00");return isFinite(t.getTime())?t.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}):""}catch{return e}};function ot({config:e,filterData:t,value:n,onChange:l,blockId:m}){const R=m?`voxel-popup-${m}`:"",i=q(null),c=(t.props||{}).placeholder||t.label||"Date",b=t.icon||"",d=n||{},v=d.from||"",o=d.to||"",[g,I]=P(!1),[L,k]=P(!1),[$,S]=P(()=>be(v)),[w,C]=P(()=>be(o)),E=T(()=>{S(be(v)),I(!0)},[v]),h=T(()=>{C(be(o)),k(!0)},[o]),y=T(D=>{S(D)},[]),a=T(D=>{C(D)},[]),u=T(D=>{const ee=Me(D!==void 0?D:$)||"";l({from:ee,to:o}),I(!1)},[$,o,l]),s=T(D=>{const ee=Me(D!==void 0?D:w)||"";l({from:v,to:ee}),k(!1)},[w,v,l]),p=T(()=>{S(null),l({from:"",to:o})},[o,l]),F=T(()=>{C(null),l({from:v,to:""})},[v,l]),z=!!v||!!o,V=ae(()=>{if(!z)return c;const D=[];return v&&D.push(Te(v)),o&&D.push(Te(o)),D.join(" - ")||c},[z,v,o,c]),{style:G,className:O}=Q(e,"ts-form-group"),U=ce(e);return React.createElement("div",{className:O,style:G},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:i,className:`ts-filter ts-popup-target ${z?"ts-filled":""}`,onClick:E,onMouseDown:D=>D.preventDefault(),role:"button",tabIndex:0},b&&React.createElement("span",{dangerouslySetInnerHTML:{__html:b}}),React.createElement("div",{className:"ts-filter-text"},V),React.createElement("div",{className:"ts-down-icon"})),React.createElement(le,{isOpen:g,target:i,title:"From",icon:b,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:u,onClear:p,onClose:()=>I(!1),className:`${R}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:U.style},React.createElement(Re,{value:$,onChange:y,onSelect:u}),React.createElement("div",{className:"ts-form-group",style:{marginTop:"12px",borderTop:"1px solid var(--ts-shade-5)",paddingTop:"12px"}},React.createElement("label",null,"To"),React.createElement("div",{className:`ts-filter ts-popup-target ${o?"ts-filled":""}`,onClick:D=>{D.stopPropagation(),I(!1),setTimeout(()=>h(),100)},role:"button",tabIndex:0},b&&React.createElement("span",{dangerouslySetInnerHTML:{__html:b}}),React.createElement("div",{className:"ts-filter-text"},o?Te(o):"Select end date")))),React.createElement(le,{isOpen:L,target:i,title:"To",icon:b,saveLabel:"Save",clearLabel:"Clear",showClear:!0,onSave:s,onClear:F,onClose:()=>k(!1),className:`${R}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:U.style},React.createElement(Re,{value:w,onChange:a,onSelect:s})))}function it({config:e,filterData:t,value:n,onChange:l}){const m=n===!0||n==="true"||n==="1",R=b=>{b.preventDefault(),l(!m)},i=t.props?.placeholder||t.label||"Open now",{style:f,className:c}=Q(e,"ts-form-group switcher-label ts-inline-filter");return React.createElement("div",{className:c,style:f},React.createElement("label",null,React.createElement("div",{className:"switch-slider"},React.createElement("div",{className:"onoffswitch",onClick:R},React.createElement("input",{type:"checkbox",className:"onoffswitch-checkbox",checked:m,readOnly:!0}),React.createElement("label",{className:"onoffswitch-label",onClick:R}))),i))}function ut({config:e,filterData:t,value:n,onChange:l,blockId:m}){const R=m?`voxel-popup-${m}`:"",i=q(null),[f,c]=P(!1),b=t.props||{},d=e.displayAs||t.props?.display_as||"popup",v=b.placeholder||t.label||"Order By",o=ae(()=>{const u=b.choices||{};return Array.isArray(u)?u:Object.entries(u).map(([s,p])=>({key:s,label:p.label||p,placeholder:p.placeholder||p.label||p,icon:p.icon||""}))},[b.choices]),g=t.icon||"",I=T(()=>{c(!0)},[]),L=T(u=>{l(u),d==="popup"&&c(!1)},[l,d]),k=T(()=>{l(null)},[l]),$=typeof n=="string"?n:"",S=!!$,w=o.find(u=>u.key===$),C=w?.placeholder||w?.label||v,E=()=>React.createElement("div",{className:"ts-term-dropdown ts-md-group"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list min-scroll"},o.map(u=>{const s=$===u.key;return React.createElement("li",{key:u.key,className:s?"ts-selected":""},React.createElement("a",{href:"#",className:"flexify",onClick:p=>{p.preventDefault(),L(u.key)}},React.createElement("div",{className:"ts-radio-container"},React.createElement("label",{className:"container-radio"},React.createElement("input",{type:"radio",value:u.key,checked:s,readOnly:!0,disabled:!0,hidden:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,u.label),u.icon&&React.createElement("div",{className:"ts-term-icon"},React.createElement("span",{dangerouslySetInnerHTML:{__html:u.icon}}))))})));if(d==="buttons"){const{style:u,className:s}=Q(e,"ts-form-group");return React.createElement("div",{className:s,style:u},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("ul",{className:"simplify-ul addon-buttons flexify"},o.map(p=>{const F=$===p.key;return React.createElement("li",{key:p.key,className:`flexify${F?" adb-selected":""}`,onClick:()=>L(p.key)},p.placeholder||p.label)})))}if(d==="alt-btn")return React.createElement(React.Fragment,null,o.map(u=>{const s=$===u.key,{style:p,className:F}=Q(e,"ts-form-group");return React.createElement("div",{key:u.key,className:F,style:p},!e.hideLabel&&React.createElement("label",null,u.label),React.createElement("div",{className:`ts-filter${s?" ts-filled":""}`,onClick:()=>L(u.key)},u.icon&&React.createElement("span",{dangerouslySetInnerHTML:{__html:u.icon}}),React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,u.placeholder||u.label))))}));const{style:h,className:y}=Q(e,"ts-form-group"),a=ce(e);return React.createElement("div",{className:y,style:h},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:i,className:`ts-filter ts-popup-target ${S?"ts-filled":""}`,onClick:I,onMouseDown:u=>u.preventDefault(),role:"button",tabIndex:0},g&&React.createElement("span",{dangerouslySetInnerHTML:{__html:g}}),React.createElement("div",{className:"ts-filter-text"},C),React.createElement("div",{className:"ts-down-icon"})),React.createElement(le,{isOpen:f,target:i,title:"",icon:g,saveLabel:"Save",clearLabel:"Clear",showClear:S,showSave:!1,onSave:()=>c(!1),onClear:k,onClose:()=>c(!1),className:`hide-head ${R}${e.popupCenterPosition?" ts-popup-centered":""}`.trim(),popupStyle:a.style},E()))}function dt({config:e,filterData:t,value:n,onChange:l,blockId:m}){const R=m?`voxel-popup-${m}`:"",[i,f]=P(!1),c=q(null),b=t.props||{},d=e.displayAs||t.props?.display_as||"popup",v=b.placeholder||t.label||"Status",o=ae(()=>{const a=b.choices||{};return Array.isArray(a)?a:Object.entries(a).map(([u,s])=>({key:u,label:s.label||s}))},[b.choices]),g=t.icon||"",I=T(a=>{l(a),f(!1)},[l]),L=T(()=>{f(!0)},[]),k=typeof n=="string"?n:"",$=!!k,S=o.find(a=>a.key===k),w=$&&S?.label||v,C=()=>React.createElement("div",{className:"ts-term-dropdown ts-md-group"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list min-scroll"},o.map(a=>{const u=k===a.key;return React.createElement("li",{key:a.key},React.createElement("a",{href:"#",className:"flexify",onClick:s=>{s.preventDefault(),I(a.key)}},React.createElement("div",{className:"ts-radio-container"},React.createElement("label",{className:"container-radio"},React.createElement("input",{type:"radio",value:a.key,checked:u,readOnly:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,a.label),g&&React.createElement("div",{className:"ts-term-icon"},React.createElement("span",{dangerouslySetInnerHTML:{__html:g}}))))})));if(d==="buttons")return React.createElement(React.Fragment,null,o.map(a=>{const u=k===a.key,{style:s,className:p}=Q(e,"ts-form-group");return React.createElement("div",{key:a.key,className:p,style:s},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter${u?" ts-filled":""}`,onClick:()=>l(a.key)},g&&React.createElement("span",{dangerouslySetInnerHTML:{__html:g}}),React.createElement("div",{className:"ts-filter-text"},React.createElement("span",null,a.label))))}));const{style:E,className:h}=Q(e,"ts-form-group"),y=ce(e);return React.createElement("div",{className:h,style:E},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:c,className:`ts-filter ts-popup-target ${$?"ts-filled":""}`,onClick:L,onMouseDown:a=>a.preventDefault(),role:"button",tabIndex:0},g&&React.createElement("span",{dangerouslySetInnerHTML:{__html:g}}),React.createElement("div",{className:"ts-filter-text"},w),React.createElement("div",{className:"ts-down-icon"})),React.createElement(le,{isOpen:i,target:c,title:"",icon:g,saveLabel:"Save",showSave:!1,showClear:!1,onSave:()=>f(!1),onClose:()=>f(!1),className:`hide-head ${R}${e.popupCenterPosition?" ts-popup-centered":""}`.trim(),popupStyle:y.style},C()))}function pt(e){const{userId:t,skip:n=!1}=e,[l,m]=P(null),[R,i]=P(!1),[f,c]=P(null),b=T(async()=>{if(!t||n){m(null);return}i(!0),c(null);try{const d=Oe(),v=await fetch(`${d}voxel-fse/v1/search-form/user-data?user_id=${t}`);if(v.ok){const o=await v.json();m({id:o.id,name:o.name,avatar:o.avatar||""})}else m({id:t,name:"Unknown",avatar:""}),c("User not found")}catch(d){console.error("useUserData: Error fetching user data:",d),m({id:t,name:"Unknown",avatar:""}),c(d instanceof Error?d.message:"Failed to fetch user data")}finally{i(!1)}},[t,n]);return J(()=>{b()},[b]),{userData:l,isLoading:R,error:f,refetch:b}}function mt({config:e,filterData:t,value:n}){const l=q(null),m=t.props||{},R=t.icon||"",i=m.user;let f;n!==void 0?f=n:t.value!==null&&t.value!==void 0?f=t.value:f=null;const c=f?Number(f):null,b=c!==null&&!isNaN(c)&&c>0,d=!!i?.name,{userData:v,isLoading:o}=pt({userId:b?c:null,skip:d}),g=d?{name:i.name,avatar:i.avatar||""}:v;if(!b)return null;const I=g?.name||(o?"Loading...":"Unknown"),{style:L,className:k}=Q(e,"ts-form-group");return React.createElement("div",{className:k,style:L},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:l,className:`ts-filter ts-popup-target ts-filled${o?" ts-loading":""}`},React.createElement("span",{dangerouslySetInnerHTML:{__html:R}}),React.createElement("div",{className:"ts-filter-text"},I)))}function ft({config:e,filterData:t,value:n,onChange:l,blockId:m}){const R=m?`voxel-popup-${m}`:"",i=q(null),f=q(null),[c,b]=P(!1),[d,v]=P(""),[o,g]=P([]),[I,L]=P(!1),k=t.props||{},$=k.placeholder||t.label||"Related",S=k.post,w=t.icon||"";J(()=>{c&&(v(""),g([]),setTimeout(()=>f.current?.focus(),50))},[c]);const C=T(()=>{b(!0)},[]),E=T(V=>{const G=V.target.value;v(G),G.length>=2?(L(!0),setTimeout(()=>{g([]),L(!1)},300)):g([])},[]),h=T((V,G)=>{l({id:V,title:G}),b(!1),v("")},[l]),y=T(()=>{l(null),v(""),g([])},[l]);let a=null;if(n!==void 0){const V=n;V===null?a=null:typeof V=="number"?a=V:typeof V=="object"&&V?.id&&(a=V.id)}else t.value!==null&&t.value!==void 0&&(a=typeof t.value=="number"?t.value:Number(t.value));const u=a!==null&&!isNaN(a)&&a>0;let s=$;if(u){const V=n;V&&typeof V=="object"&&V.title?s=V.title:S?.title&&(s=S.title)}const{style:p,className:F}=Q(e,"ts-form-group"),z=ce(e);return React.createElement("div",{className:F,style:p},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{ref:i,className:`ts-filter ts-popup-target ${u?"ts-filled":""}`,onClick:C,onMouseDown:V=>V.preventDefault(),role:"button",tabIndex:0},w&&React.createElement("span",{dangerouslySetInnerHTML:{__html:w}}),React.createElement("div",{className:"ts-filter-text"},s),React.createElement("div",{className:"ts-down-icon"})),React.createElement(le,{isOpen:c,target:i,title:"",icon:w,saveLabel:"Save",clearLabel:"Clear",showClear:u,showSave:!1,onSave:()=>b(!1),onClear:y,onClose:()=>b(!1),className:`${R}${e.popupCenterPosition?" ts-popup-centered":""}`,popupStyle:z.style},React.createElement("div",{className:"ts-form-group"},React.createElement("div",{className:"flexify ts-input-icon"},React.createElement("span",null,re.search),React.createElement("input",{ref:f,type:"text",className:"inline-input",value:d,onChange:E,placeholder:"Search..."}))),I?React.createElement("div",{className:"ts-loading"},React.createElement("span",{className:"ts-loader"})):o.length>0?React.createElement("div",{className:"ts-term-dropdown"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},o.map(V=>React.createElement("li",{key:V.id},React.createElement("a",{href:"#",className:"flexify",onClick:G=>{G.preventDefault(),h(V.id,V.title)}},React.createElement("span",null,V.title)))))):d.length>=2?React.createElement("div",{className:"ts-empty-user-tab"},w&&React.createElement("span",{dangerouslySetInnerHTML:{__html:w}}),React.createElement("p",null,"No results found")):null))}function xe({config:e,filterData:t,value:n,onChange:l}){const[m,R]=P(!1),[i,f]=P(""),[c,b]=P([]),[d,v]=P(!1),o=q(null),g=t.props||{},I=g.placeholder||t.label||"Following",L=g.user,k=t.icon||"",$=s=>{const p=s.target.value;f(p),p.length>=2?(v(!0),setTimeout(()=>{b([]),v(!1)},300)):b([])},S=(s,p)=>{l({id:s,name:p}),R(!1),f("")},w=s=>{s.preventDefault(),R(!m)};J(()=>{const s=p=>{o.current&&!o.current.contains(p.target)&&R(!1)};return m&&document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[m]);let C=null;if(n!==void 0){const s=n;s===null?C=null:typeof s=="number"?C=s:typeof s=="object"&&s?.id&&(C=s.id)}else t.value!==null&&t.value!==void 0&&(C=typeof t.value=="number"?t.value:Number(t.value));const E=C!==null&&!isNaN(C)&&C>0;let h=I;if(E){const s=n;s&&typeof s=="object"&&s.name?h=s.name:L?.name&&(h=L.name)}const{style:y,className:a}=Q(e,"ts-form-group"),u=ce(e);return React.createElement("div",{className:a,style:y,ref:o},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter ts-popup-target ${E?"ts-filled":""}`,onClick:w,onMouseDown:s=>s.preventDefault(),role:"button",tabIndex:0},k&&React.createElement("span",{dangerouslySetInnerHTML:{__html:k}}),React.createElement("div",{className:"ts-filter-text"},h),React.createElement("div",{className:"ts-down-icon"})),m&&React.createElement("div",{className:"ts-field-popup-container"},React.createElement("div",{className:u.className,style:u.style},React.createElement("div",{className:"ts-popup-content-wrapper min-scroll"},React.createElement("div",{className:"ts-form-group"},React.createElement("div",{className:"flexify ts-input-icon"},React.createElement("span",null,re.search),React.createElement("input",{type:"text",className:"inline-input",value:i,onChange:$,placeholder:"Search..."}))),d?React.createElement("div",{className:"ts-loading"},React.createElement("span",{className:"ts-loader"})):c.length>0?React.createElement("div",{className:"ts-term-dropdown"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},c.map(s=>React.createElement("li",{key:s.id},React.createElement("a",{href:"#",className:"flexify",onClick:p=>{p.preventDefault(),S(s.id,s.name)}},React.createElement("span",null,s.name)))))):i.length>=2?React.createElement("div",{className:"ts-empty-user-list"},React.createElement("span",null,"No results found")):null))))}function ht({config:e,filterData:t,value:n,onChange:l}){const[m,R]=P(!1),[i,f]=P(""),[c,b]=P([]),[d,v]=P(!1),o=q(null),g=t.props||{},I=g.placeholder||t.label||"Following Post",L=g.post,k=t.icon||"",$=s=>{const p=s.target.value;f(p),p.length>=2?(v(!0),setTimeout(()=>{b([]),v(!1)},300)):b([])},S=(s,p)=>{l({id:s,title:p}),R(!1),f("")},w=s=>{s.preventDefault(),R(!m)};J(()=>{const s=p=>{o.current&&!o.current.contains(p.target)&&R(!1)};return m&&document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[m]);let C=null;if(n!==void 0){const s=n;s===null?C=null:typeof s=="number"?C=s:typeof s=="object"&&s?.id&&(C=s.id)}else t.value!==null&&t.value!==void 0&&(C=typeof t.value=="number"?t.value:Number(t.value));const E=C!==null&&!isNaN(C)&&C>0;let h=I;if(E){const s=n;s&&typeof s=="object"&&s.title?h=s.title:L?.title&&(h=L.title)}const{style:y,className:a}=Q(e,"ts-form-group"),u=ce(e);return React.createElement("div",{className:a,style:y,ref:o},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("div",{className:`ts-filter ts-popup-target ${E?"ts-filled":""}`,onClick:w,onMouseDown:s=>s.preventDefault(),role:"button",tabIndex:0},k&&React.createElement("span",{dangerouslySetInnerHTML:{__html:k}}),React.createElement("div",{className:"ts-filter-text"},h),React.createElement("div",{className:"ts-down-icon"})),m&&React.createElement("div",{className:"ts-field-popup-container"},React.createElement("div",{className:u.className,style:u.style},React.createElement("div",{className:"ts-popup-content-wrapper min-scroll"},React.createElement("div",{className:"ts-form-group"},React.createElement("div",{className:"flexify ts-input-icon"},React.createElement("span",null,re.search),React.createElement("input",{type:"text",className:"inline-input",value:i,onChange:$,placeholder:"Search posts..."}))),d?React.createElement("div",{className:"ts-loading"},React.createElement("span",{className:"ts-loader"})):c.length>0?React.createElement("div",{className:"ts-term-dropdown"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list"},c.map(s=>React.createElement("li",{key:s.id},React.createElement("a",{href:"#",className:"flexify",onClick:p=>{p.preventDefault(),S(s.id,s.title)}},React.createElement("span",null,s.title)))))):i.length>=2?React.createElement("div",{className:"ts-empty-user-list"},React.createElement("span",null,"No posts found")):null))))}function yt({config:e,filterData:t,value:n,onChange:l}){const m=n===!0||n==="true"||n==="1",R=c=>{c.preventDefault(),l(!m)},{style:i,className:f}=Q(e,"ts-form-group switcher-label ts-inline-filter");return React.createElement("div",{className:f,style:i},!e.hideLabel&&React.createElement("label",null,t.label),React.createElement("label",{className:`onoffswitch ts-${m?"on":"off"}`,onClick:R},React.createElement("input",{type:"checkbox",className:"onoffswitch-checkbox",checked:m,readOnly:!0}),React.createElement("span",{className:"onoffswitch-trigger"})))}function Rt({config:e,filterData:t}){const n=t.props?.description||"",{style:l,className:m}=Q(e,"ts-form-group ui-heading");return React.createElement("div",{className:m,style:l},React.createElement("label",null,e.label||t.label,n&&React.createElement("small",null,n)))}function Et({postTypes:e,currentPostType:t,onChange:n,blockId:l,style:m}){const R=l?`voxel-popup-${l}`:"",[i,f]=P(!1),c=q(null),b=T(k=>{n(k),f(!1)},[n]),d=T(()=>{f(!0)},[]),v=e.find(k=>k.key===t),o=v?.label||"Select type",g=!!t,I=v?.icon||"",L=()=>React.createElement("div",{className:"ts-term-dropdown ts-md-group"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list min-scroll"},e.map(k=>{const $=t===k.key;return React.createElement("li",{key:k.key},React.createElement("a",{href:"#",className:"flexify",onClick:S=>{S.preventDefault(),b(k.key)}},React.createElement("div",{className:"ts-radio-container"},React.createElement("label",{className:"container-radio"},React.createElement("input",{type:"radio",checked:$,disabled:!0,hidden:!0,readOnly:!0}),React.createElement("span",{className:"checkmark"}))),React.createElement("span",null,k.label),React.createElement("div",{className:"ts-term-icon ts-pull-right"},k.icon&&React.createElement("span",{dangerouslySetInnerHTML:{__html:k.icon}}))))})));return React.createElement("div",{className:"ts-form-group choose-cpt-filter",style:m},React.createElement("label",null,"Post type"),React.createElement("div",{ref:c,className:`ts-filter ts-popup-target ${g?"ts-filled":""}`,onClick:d,onMouseDown:k=>k.preventDefault(),role:"button",tabIndex:0},I&&React.createElement("span",{dangerouslySetInnerHTML:{__html:I}}),React.createElement("div",{className:"ts-filter-text"},o),React.createElement("div",{className:"ts-down-icon"})),React.createElement(le,{isOpen:i,target:c,title:"",icon:I,saveLabel:"Save",showSave:!1,showClear:!1,onSave:()=>f(!1),onClose:()=>f(!1),className:`hide-head ${R}`.trim()},L()))}const vt={"common:is_empty":(e,t)=>t==null||t==="","common:is_not_empty":(e,t)=>t!=null&&t!=="","text:equals":(e,t)=>t===e.value,"text:not_equals":(e,t)=>t!==e.value,"text:contains":(e,t)=>typeof t!="string"||!e.value?!1:new RegExp(e.value,"i").test(t),"taxonomy:contains":(e,t)=>typeof t!="string"||!e.value?!1:t.split(",").includes(e.value),"taxonomy:not_contains":(e,t)=>typeof t!="string"||!e.value?!0:!t.split(",").includes(e.value),"number:equals":(e,t)=>{const n=parseFloat(String(t)),l=parseFloat(e.value||"0");return n===l},"number:not_equals":(e,t)=>{const n=parseFloat(String(t)),l=parseFloat(e.value||"0");return n!==l},"number:gt":(e,t)=>{const n=parseFloat(String(t)),l=parseFloat(e.value||"0");return n>l},"number:gte":(e,t)=>{const n=parseFloat(String(t)),l=parseFloat(e.value||"0");return n>=l},"number:lt":(e,t)=>{const n=parseFloat(String(t)),l=parseFloat(e.value||"0");return n<l},"number:lte":(e,t)=>{const n=parseFloat(String(t)),l=parseFloat(e.value||"0");return n<=l}};function gt(e,t,n){const l=vt[e.type];if(!l)return console.warn(`[filterConditions] Unknown condition type: ${e.type}`),!1;let m=t;return n==="order-by"&&typeof t=="string"&&t.length>0&&(m=t.split("(")[0]),l(e,m)}function bt(e,t="show",n,l){if(!e||e.length===0)return!0;let m=!1;return e.forEach(R=>{if(!R.length)return;let i=!0;R.forEach(f=>{const c=n[f.source],d=l[f.source]?.type;gt(f,c,d)||(i=!1)}),i&&(m=!0)}),t==="hide"?!m:m}function Nt(e,t,n){return bt(e.conditions,e.conditions_behavior||"show",t,n)}function wt(){const e=()=>{if(typeof window>"u")return"desktop";const l=window.innerWidth;return l<=767?"mobile":l<=1024?"tablet":"desktop"},[t,n]=P(e);return J(()=>{const l=()=>{n(e())};return l(),window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),t}function _t({attributes:e,postTypes:t,context:n,editorDeviceType:l,onSubmit:m,onPostTypeChange:R,onFilterChange:i}){q(null);const f=q(null),{state:c,setCurrentPostType:b,setFilterValue:d,togglePortal:v,submit:o,clearAll:g,narrowedValues:I,narrowingFilters:L}=We({attributes:e,postTypes:t,context:n,onSubmit:m,onPostTypeChange:R,onFilterChange:i}),[k,$]=P(""),[S,w]=P("");J(()=>{const r=async()=>{const x=e.searchButtonText??"";if(ke(x)){const W=Fe(x),Y=await _e(W);$(Y)}else $(x)},N=async()=>{const x=e.resetButtonText??"Reset";if(ke(x)){const W=Fe(x),Y=await _e(W);w(Y)}else w(x)};r(),N()},[e.searchButtonText,e.resetButtonText]),J(()=>{if(!c.portalActive)return;const r=N=>{N.key==="Escape"&&v()};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[c.portalActive,v]),J(()=>{if(!c.portalActive)return;const r=x=>{const W=x.target;f.current?.contains(W)||n==="editor"&&(W.closest(".interface-interface-skeleton__sidebar")||W.closest(".edit-post-sidebar")||W.closest(".block-editor-block-inspector")||W.closest(".components-popover")||W.closest(".components-modal"))||v()},N=requestAnimationFrame(()=>{document.addEventListener("mousedown",r)});return()=>{cancelAnimationFrame(N),document.removeEventListener("mousedown",r)}},[c.portalActive,v,n]),J(()=>{if(n!=="frontend")return;const r=N=>{const x=N;x.detail?.searchFormId&&x.detail.searchFormId!==e.blockId||g()};return window.addEventListener("voxel-search-clear",r),()=>window.removeEventListener("voxel-search-clear",r)},[n,e.blockId,g]);const C=t.find(r=>r.key===c.currentPostType),E=e.filterLists?.[c.currentPostType]||[],h=r=>{o()},y=(r=!1)=>{g(r)},a={};C?.filters?.forEach(r=>{a[r.key]=r});const u=r=>{if(!(n==="frontend"?ze(r):!0))return null;const x=r;if(n==="frontend"&&x.conditions&&!Nt(x,c.filterValues,a))return null;const W=C?.filters?.find(ne=>ne.key===r.filterKey);if(!W)return null;const Y={...W,value:r.defaultValueEnabled&&r.defaultValue!==void 0?r.defaultValue:W.value},K={config:r,filterData:Y,value:c.filterValues[r.filterKey],onChange:ne=>d(r.filterKey,ne),narrowedValues:I,isNarrowing:L,blockId:e.blockId,context:n};switch(W.type){case"keywords":return React.createElement(Ge,{key:r.id,...K});case"range":return React.createElement(Qe,{key:r.id,...K});case"stepper":return React.createElement(Xe,{key:r.id,...K});case"terms":return React.createElement(et,{key:r.id,...K});case"location":return React.createElement(lt,{key:r.id,...K});case"availability":return React.createElement(at,{key:r.id,...K});case"date":return React.createElement(ct,{key:r.id,...K});case"recurring-date":return React.createElement(ot,{key:r.id,...K});case"open-now":return React.createElement(it,{key:r.id,...K});case"order-by":return React.createElement(ut,{key:r.id,...K});case"post-status":return React.createElement(dt,{key:r.id,...K});case"user":return React.createElement(mt,{key:r.id,...K});case"relations":return React.createElement(ft,{key:r.id,...K});case"following":return React.createElement(xe,{key:r.id,...K});case"followed-by":return React.createElement(xe,{key:r.id,...K});case"following-user":return React.createElement(xe,{key:r.id,...K});case"following-post":return React.createElement(ht,{key:r.id,...K});case"switcher":return React.createElement(yt,{key:r.id,...K});case"ui-heading":return React.createElement(Rt,{key:r.id,...K});default:return null}},s=(r=!0)=>React.createElement("div",{className:"ts-filter-wrapper flexify"},e.showPostTypeFilter&&t.length>1&&React.createElement(Et,{postTypes:t,currentPostType:c.currentPostType,onChange:b,style:_()}),E.map(N=>u(N)),r&&e.showSearchButton&&React.createElement("div",{className:"ts-form-group flexify ts-form-submit",id:"sf_submit",style:Z("search")},React.createElement("button",{type:"button",onClick:()=>h(),className:`ts-btn ts-btn-2 ts-btn-large ts-search-btn ${c.loading&&!c.resetting?"ts-loading-btn":""}`},c.loading&&!c.resetting&&React.createElement("div",{className:"ts-loader-wrapper"},React.createElement("span",{className:"ts-loader"})),Ne(e.searchButtonIcon,re.search),k&&k)),r&&e.showResetButton&&React.createElement("div",{className:"ts-form-group flexify ts-form-reset",style:Z("reset")},React.createElement("a",{href:"#",onClick:N=>{N.preventDefault(),y(!1)},className:"ts-filter",role:"button"},Ne(e.resetButtonIcon,re.reload),S&&React.createElement("div",{className:"ts-filter-text"},S)))),p=wt(),F=n==="editor"&&l?l:p,z=F==="desktop"&&(e.mfSwitcherDesktop??!1)||F==="tablet"&&(e.mfSwitcherTablet??!1)||F==="mobile"&&(e.mfSwitcherMobile??!1),V=()=>F==="desktop"?e.mfSwitcherDesktopDefault??"feed":F==="tablet"?e.mfSwitcherTabletDefault??"feed":e.mfSwitcherMobileDefault??"feed",[G,O]=P(V);J(()=>{O(V())},[F,e.mfSwitcherDesktopDefault,e.mfSwitcherTabletDefault,e.mfSwitcherMobileDefault]);const U=()=>{O("feed");const r=F,N=document.getElementById(e.postToMapId||""),x=document.getElementById(e.postToFeedId||"");N&&N.classList.add(`vx-hidden-${r}`),x&&x.classList.remove(`vx-hidden-${r}`)},D=()=>{O("map");const r=F,N=document.getElementById(e.postToMapId||""),x=document.getElementById(e.postToFeedId||"");N&&N.classList.remove(`vx-hidden-${r}`),x&&x.classList.add(`vx-hidden-${r}`)},j=()=>{if(!z)return null;const r=[e.mfSwitcherDesktop?"":"vx-hidden-desktop",e.mfSwitcherTablet?"":"vx-hidden-tablet",e.mfSwitcherMobile?"":"vx-hidden-mobile"].filter(Boolean).join(" "),N=React.createElement("div",{className:`ts-switcher-btn ${r}`},React.createElement("a",{href:"#",className:`ts-btn ts-btn-1 ${G==="feed"?`vx-hidden-${F}`:""}`,onClick:x=>{x.preventDefault(),n!=="editor"&&U()},role:"button"},re.grid,"List view"),React.createElement("a",{href:"#",className:`ts-btn ts-btn-1 ${G==="map"?`vx-hidden-${F}`:""}`,onClick:x=>{x.preventDefault(),n!=="editor"&&D()},role:"button"},re.marker,"Map view"));return n==="editor"?N:Ce(React.createElement("div",{className:`voxel-fse-search-form-${e.blockId}`,"data-voxel-id":e.blockId},N),document.body)},ee=F==="desktop"&&(e.formToggleDesktop??!1)||F==="tablet"&&(e.formToggleTablet??!0)||F==="mobile"&&(e.formToggleMobile??!0),se=ee,B=!ee,X={postTypes:t.map(r=>({key:r.key,label:r.label,filters:r.filters})),currentPostType:c.currentPostType,filterLists:e.filterLists||{},portalMode:e.portalMode||{desktop:!1,tablet:!1,mobile:!1},showPostTypeFilter:e.showPostTypeFilter??!0,showSearchButton:e.showSearchButton??!0,showResetButton:e.showResetButton??!1,searchButtonText:e.searchButtonText||"",resetButtonText:e.resetButtonText||"",formToggleDesktop:e.formToggleDesktop??!1,formToggleTablet:e.formToggleTablet??!0,formToggleMobile:e.formToggleMobile??!0,searchButtonWidth:e.searchButtonWidth,searchButtonWidth_tablet:e.searchButtonWidth_tablet,searchButtonWidth_mobile:e.searchButtonWidth_mobile,searchButtonWidthUnit:e.searchButtonWidthUnit||"%",resetButtonWidth:e.resetButtonWidth,resetButtonWidth_tablet:e.resetButtonWidth_tablet,resetButtonWidth_mobile:e.resetButtonWidth_mobile,resetButtonWidthUnit:e.resetButtonWidthUnit||"%"},Z=r=>{const N=r==="search"?e.searchButtonWidthUnit||"%":e.resetButtonWidthUnit||"%";let x;return r==="search"?F==="mobile"?x=e.searchButtonWidth_mobile??e.searchButtonWidth_tablet??e.searchButtonWidth:F==="tablet"?x=e.searchButtonWidth_tablet??e.searchButtonWidth:x=e.searchButtonWidth:F==="mobile"?x=e.resetButtonWidth_mobile??e.resetButtonWidth_tablet??e.resetButtonWidth:F==="tablet"?x=e.resetButtonWidth_tablet??e.resetButtonWidth:x=e.resetButtonWidth,x!==void 0?{width:`${x}${N}`,flexGrow:0,flexShrink:0}:{}},_=()=>{let r;return F==="mobile"?r=e.postTypeFilterWidth_mobile??e.postTypeFilterWidth_tablet??e.postTypeFilterWidth:F==="tablet"?r=e.postTypeFilterWidth_tablet??e.postTypeFilterWidth:r=e.postTypeFilterWidth,r!==void 0?{width:`${r}%`,flexGrow:0,flexShrink:0}:{}};return React.createElement(React.Fragment,null,React.createElement("div",{className:"ts-form ts-search-widget","data-v-app":""},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(X)}}),se&&React.createElement("div",{className:"ts-filter-wrapper flexify"},React.createElement("a",{href:"#",onClick:r=>{r.preventDefault(),v()},onMouseDown:r=>r.preventDefault(),className:`ts-filter-toggle ts-btn ts-btn-1 ${c.activeFilterCount>0?"ts-filled":""}`,role:"button","aria-expanded":c.portalActive},re.filterslider,React.createElement("div",{className:"ts-toggle-text"},"Filter results"),c.activeFilterCount>0&&React.createElement("span",{className:"ts-filter-count"},c.activeFilterCount))),React.createElement("form",{method:"GET",onSubmit:r=>(r.preventDefault(),!1)},B&&React.createElement("div",{className:"ts-inline-filters"},s())),React.createElement("div",{className:"hidden"},React.createElement("div",{className:"ts-search-portal"}))),c.portalActive&&Ce(React.createElement("div",{className:`ts-search-portal vx-popup elementor voxel-fse-search-form-${e.blockId}`,"data-voxel-id":e.blockId},React.createElement("div",{className:"ts-popup-root elementor-element"},React.createElement("div",{className:"ts-form ts-search-widget no-render elementor-element"},React.createElement("div",{className:"ts-field-popup-container"},React.createElement("div",{className:"ts-field-popup triggers-blur",ref:f},React.createElement("div",{className:"ts-popup-content-wrapper min-scroll"},React.createElement("div",{className:"ts-form-group"},s())),React.createElement("div",{className:"ts-popup-controller"},React.createElement("ul",{className:"flexify simplify-ul"},React.createElement("li",{className:"flexify ts-popup-close"},React.createElement("a",{href:"#",onClick:r=>{r.preventDefault(),v()},className:"ts-icon-btn",role:"button","aria-label":"Close"},Ne(e.closeIcon,re.close))),React.createElement("li",{className:"flexify hide-d"},React.createElement("a",{href:"#",onClick:r=>{r.preventDefault(),y(!0)},className:"ts-icon-btn",role:"button"},re.reload)),React.createElement("li",{className:"flexify hide-m"},React.createElement("a",{href:"#",onClick:r=>{r.preventDefault(),y(!0)},className:"ts-btn ts-btn-1",role:"button"},"Clear")),React.createElement("li",{className:"flexify"},React.createElement("a",{href:"#",onClick:r=>{r.preventDefault(),h(),v()},className:"ts-btn ts-btn-2",role:"button"},"Search"))))))))),document.body),j())}export{_t as S};
