const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["VoxelLightbox-n8iTWunW.js","VoxelLightbox.css"])))=>i.map(i=>d[i]);
import{registerBlockType as Rt}from"@wordpress/blocks";import{useBlockProps as Ze,InspectorControls as wt}from"@wordpress/block-editor";import{__ as Z}from"@wordpress/i18n";import{useState as S,createContext as Et,useMemo as re,useContext as yt,useRef as T,useCallback as h,useEffect as q,Fragment as Ne,lazy as _t,Suspense as xt,useLayoutEffect as kt,forwardRef as bt,useImperativeHandle as Nt}from"react";import{A as St,a as He,e as Se,E as jt}from"../TypographyPopup-CAcEJ5NA.js";import{I as Lt}from"../InspectorTabs-Bq2wAh4W.js";import{SelectControl as je,TextControl as Mt,ToggleControl as It}from"@wordpress/components";import"@wordpress/data";import"@wordpress/api-fetch";/* empty css                            */import"../RepeaterControl-BnF4Wtgt.js";import{I as ne}from"../IconPickerControl-Lep6knGI.js";import{R as Ft,g as Pt,L as Vt}from"../RepeaterControl-Dbi7c87C.js";import{g as qe,a as Ht}from"../siteUrl-7x5eJEvc.js";import{createPortal as ze}from"react-dom";import{M as We}from"../MediaPopup-CdtMdouF.js";import"../voxelShim-DB_Ue-9R.js";import{g as Tt}from"../useAdvancedTabProps-BnJDQbKr.js";import{r as At}from"../backgroundElements-Ui-iCrLV.js";import{V as $t}from"../VoxelGridIcon-D5dF5acW.js";import"../FormPopup-jN8spfqy.js";import"../generateAdvancedStyles-CRpLcHXt.js";import"../generateVoxelStyles-oZeaeuKH.js";const Dt=[{value:"post_reviews",label:"Current post reviews"},{value:"post_wall",label:"Current post wall"},{value:"post_timeline",label:"Current post timeline"},{value:"author_timeline",label:"Current author timeline"},{value:"user_feed",label:"Logged-in user newsfeed"},{value:"global_feed",label:"Sitewide activity"}],Ot=[{value:"latest",label:"Latest"},{value:"earliest",label:"Earliest"},{value:"most_liked",label:"Most liked"},{value:"most_discussed",label:"Most discussed"},{value:"most_popular",label:"Most popular (likes+comments)"},{value:"best_rated",label:"Best rated (reviews only)"},{value:"worst_rated",label:"Worst rated (reviews only)"}],Bt=[{value:"today",label:"Today"},{value:"this_week",label:"This week"},{value:"this_month",label:"This month"},{value:"this_year",label:"This year"},{value:"all_time",label:"All time"},{value:"custom",label:"Custom"}];function Ut({attributes:e,setAttributes:n}){const[l,a]=S({isOpen:!1,itemId:null,rules:[]});return React.createElement(React.Fragment,null,React.createElement(St,{attributes:e,setAttributes:n,stateAttribute:"contentTabOpenPanel",defaultPanel:"timeline-settings"},React.createElement(He,{id:"timeline-settings",title:Z("Timeline settings","voxel-fse")},React.createElement(je,{label:Z("Display mode","voxel-fse"),value:e.mode,options:Dt,onChange:r=>n({mode:r})}),React.createElement(Ft,{label:Z("Ordering options","voxel-fse"),items:e.orderingOptions??[],onChange:r=>n({orderingOptions:r}),getItemLabel:r=>r.label||"Untitled",createItem:()=>({_id:Pt(),order:"latest",time:"all_time",timeCustom:7,label:"Latest",rowVisibility:"show",visibilityRules:[]}),renderContent:({item:r,onUpdate:t})=>React.createElement(React.Fragment,null,React.createElement(je,{label:Z("Order","voxel-fse"),value:r.order,options:Ot,onChange:o=>t({order:o})}),React.createElement(je,{label:Z("Timeframe","voxel-fse"),value:r.time,options:Bt,onChange:o=>t({time:o})}),r.time==="custom"&&React.createElement(Se,{label:Z("Show items from the past number of days","voxel-fse"),value:String(r.timeCustom??7),onChange:o=>{if(o.startsWith("@tags()"))t({timeCustom:o});else{const m=parseInt(o,10);t({timeCustom:isNaN(m)?7:Math.max(1,Math.min(365,m))})}}}),React.createElement(Se,{label:Z("Label","voxel-fse"),value:r.label,onChange:o=>t({label:o})}),React.createElement(Vt,{itemId:r._id,rowVisibility:r.rowVisibility||"show",visibilityRules:r.visibilityRules||[],onRowVisibilityChange:o=>t({rowVisibility:o}),onEditVisibilityRules:()=>{a({isOpen:!0,itemId:r._id,rules:r.visibilityRules||[]})},onClearVisibilityRules:()=>t({visibilityRules:[]}),showLoopSection:!1,inlineVisibilityLayout:!1})),addButtonText:Z("Add Item","voxel-fse"),showClone:!0,showDelete:!0}),React.createElement("div",{style:{marginTop:"16px"}},React.createElement(Mt,{label:Z("No posts text","voxel-fse"),value:e.noStatusText,onChange:r=>n({noStatusText:r}),placeholder:Z("Type your text","voxel-fse")})),React.createElement(It,{label:Z("Enable search input","voxel-fse"),checked:e.searchEnabled,onChange:r=>n({searchEnabled:r})}),e.searchEnabled&&React.createElement(Se,{label:Z("Default search value","voxel-fse"),value:e.searchValue,onChange:r=>n({searchValue:r}),placeholder:Z("@tags()@site().query_var(q)@endtags()","voxel-fse")})),React.createElement(He,{id:"timeline-icons",title:Z("Timeline icons","voxel-fse")},React.createElement(ne,{label:Z("Verified","voxel-fse"),value:e.verifiedIcon||void 0,onChange:r=>n({verifiedIcon:r})}),React.createElement(ne,{label:Z("Repost","voxel-fse"),value:e.repostIcon||void 0,onChange:r=>n({repostIcon:r})}),React.createElement(ne,{label:Z("More","voxel-fse"),value:e.moreIcon||void 0,onChange:r=>n({moreIcon:r})}),React.createElement(ne,{label:Z("Like","voxel-fse"),value:e.likeIcon||void 0,onChange:r=>n({likeIcon:r})}),React.createElement(ne,{label:Z("Liked","voxel-fse"),value:e.likedIcon||void 0,onChange:r=>n({likedIcon:r})}),React.createElement(ne,{label:Z("Comment","voxel-fse"),value:e.commentIcon||void 0,onChange:r=>n({commentIcon:r})}),React.createElement(ne,{label:Z("Reply","voxel-fse"),value:e.replyIcon||void 0,onChange:r=>n({replyIcon:r})}),React.createElement(ne,{label:Z("Gallery","voxel-fse"),value:e.galleryIcon||void 0,onChange:r=>n({galleryIcon:r})}),React.createElement(ne,{label:Z("Upload","voxel-fse"),value:e.uploadIcon||void 0,onChange:r=>n({uploadIcon:r})}),React.createElement(ne,{label:Z("Emoji","voxel-fse"),value:e.emojiIcon||void 0,onChange:r=>n({emojiIcon:r})}),React.createElement(ne,{label:Z("Search","voxel-fse"),value:e.searchIcon||void 0,onChange:r=>n({searchIcon:r})}),React.createElement(ne,{label:Z("Delete","voxel-fse"),value:e.trashIcon||void 0,onChange:r=>n({trashIcon:r})}),React.createElement(ne,{label:Z("External link","voxel-fse"),value:e.externalIcon||void 0,onChange:r=>n({externalIcon:r})}),React.createElement(ne,{label:Z("Load more","voxel-fse"),value:e.loadMoreIcon||void 0,onChange:r=>n({loadMoreIcon:r})}),React.createElement(ne,{label:Z("No posts","voxel-fse"),value:e.noPostsIcon||void 0,onChange:r=>n({noPostsIcon:r})}))),l.isOpen&&React.createElement(jt,{isOpen:l.isOpen,onClose:()=>a({isOpen:!1,itemId:null,rules:[]}),rules:l.rules,onSave:r=>{const t=e.orderingOptions.map(o=>o._id===l.itemId?{...o,visibilityRules:r}:o);n({orderingOptions:t}),a({isOpen:!1,itemId:null,rules:[]})}}))}class Q extends Error{constructor(n,l,a,r){super(n),this.name="VoxelApiError",this.code=l,this.status=a,this.data=r}}function Zt(){return window.voxelFseConfig?.restUrl?window.voxelFseConfig.restUrl:window.wpApiSettings?.root?window.wpApiSettings.root:"/wp-json/"}function qt(){return window.voxelFseConfig?.nonce?window.voxelFseConfig.nonce:window.wpApiSettings?.nonce?window.wpApiSettings.nonce:""}function Je(e,n){const l=Zt(),a=new URL(e,l);return n&&Object.entries(n).forEach(([r,t])=>{t!=null&&a.searchParams.append(r,String(t))}),a.toString()}async function Ge(e,n={}){const{method:l="GET",body:a,headers:r={},signal:t}=n,o=qt(),m={...r};o&&(m["X-WP-Nonce"]=o);const f={method:l,headers:m,credentials:"same-origin",signal:t};a&&l!=="GET"&&(a instanceof FormData?f.body=a:(m["Content-Type"]="application/json",f.body=JSON.stringify(a)));const p=Je(e);try{const g=await fetch(p,f),s=await g.json();if(!g.ok)throw new Q(s.message||`HTTP ${g.status}`,s.code||"http_error",g.status,s);if(s.success===!1)throw new Q(s.message||"Request failed",s.code||"api_error",g.status,s);return s.data}catch(g){throw g instanceof Q?g:g instanceof TypeError&&g.message.includes("fetch")?new Q("Network error. Please check your connection.","network_error",0):g instanceof DOMException&&g.name==="AbortError"?new Q("Request was cancelled","abort_error",0):new Q(g instanceof Error?g.message:"Unknown error","unknown_error",0,g)}}async function Xe(e,n,l){const a=n?Je(e,n):e;return Ge(a,{...l,method:"GET"})}async function zt(e,n,l){return Ge(e,{...l,method:"POST",body:n})}async function Fe(e,n={},l={}){const a=Object.entries(n).filter(([o,m])=>m!=null&&m!=="").map(([o,m])=>`${encodeURIComponent(o)}=${encodeURIComponent(String(m))}`),t=`${qe().replace("?vx=1","").replace(/\/$/,"")}/?vx=1&action=${e}${a.length?"&"+a.join("&"):""}`;console.log("[voxelAjax] Calling:",t);try{const o=await fetch(t,{method:"GET",credentials:"same-origin",signal:l.signal});if(!o.ok)throw new Q(`Voxel AJAX failed: HTTP ${o.status}`,"http_error",o.status);const m=await o.json();if(console.log("[voxelAjax] Response:",m),m.success===!1)throw new Q(m.message||"Voxel AJAX request failed",m.code||"voxel_error",o.status,m);return m}catch(o){throw o instanceof Q?o:o instanceof DOMException&&o.name==="AbortError"?new Q("Request was cancelled","abort_error",0):o instanceof TypeError?new Q("Network error. Please check your connection.","network_error",0):new Q(o instanceof Error?o.message:"Unknown error","unknown_error",0,o)}}async function oe(e,n={},l={}){const r=`${qe().replace("?vx=1","").replace(/\/$/,"")}/?vx=1&action=${e}`,t=new FormData;Object.entries(n).forEach(([o,m])=>{m!=null&&m!==""&&t.append(o,String(m))}),console.log("[voxelAjaxPost] Calling:",r,"with params:",n);try{const o=await fetch(r,{method:"POST",credentials:"same-origin",body:t,signal:l.signal});if(!o.ok)throw new Q(`Voxel AJAX POST failed: HTTP ${o.status}`,"http_error",o.status);const m=await o.json();if(console.log("[voxelAjaxPost] Response:",m),m.success===!1)throw new Q(m.message||"Voxel AJAX POST request failed",m.code||"voxel_error",o.status,m);return m}catch(o){throw o instanceof Q?o:o instanceof DOMException&&o.name==="AbortError"?new Q("Request was cancelled","abort_error",0):o instanceof TypeError?new Q("Network error. Please check your connection.","network_error",0):new Q(o instanceof Error?o.message:"Unknown error","unknown_error",0,o)}}const ye="voxel-fse/v1/timeline";async function Wt(){return Xe(`${ye}/config`)}async function Jt(e,n){const l={mode:e};return n&&(l.post_id=n),Xe(`${ye}/post-context`,l)}async function Gt(e,n){const l={feed:e.feed,post_id:e.post_id??null,content:e.content,files:e.files??[],rating:e.rating??{}};return e.link_preview&&(l.link_preview=e.link_preview),(await oe("timeline/v2/status.publish",{data:JSON.stringify(l),_wpnonce:n})).status}async function Xt(e,n){const l={status_id:e.status_id,content:e.content,files:e.files??[],rating:e.rating??{}};return(await oe("timeline/v2/status.edit",{data:JSON.stringify(l),_wpnonce:n})).status}async function Qt(e,n){return{deleted:(await oe("timeline/v2/status.delete",{status_id:e,_wpnonce:n})).success!==!1}}async function Yt(e,n){return oe("timeline/v2/status.like",{status_id:e,_wpnonce:n})}async function Kt(e,n){return oe("timeline/v2/status.repost",{status_id:e,_wpnonce:n})}async function en(e,n){const l={status_id:e.quote_of,content:e.content,files:e.files??[]};return(await oe("timeline/v2/status.quote",{data:JSON.stringify(l),_wpnonce:n})).status}async function tn(e){return zt(`${ye}/status/${e}/remove-link-preview`)}async function nn(e,n){return oe("timeline/v2/status.mark_approved",{status_id:e,_wpnonce:n})}async function an(e,n){return oe("timeline/v2/status.mark_pending",{status_id:e,_wpnonce:n})}async function rn(e){return Fe("timeline/v2/get_feed",{mode:e.mode,order_type:e.order,order_time:e.time,order_time_custom:e.time_custom,search:e.search,filter_by:e.filter,page:e.page,post_id:e.post_id,user_id:e.author_id,status_id:e.status_id})}async function on(e,n){const l={status_id:e.status_id,parent_id:e.parent_id??null,content:e.content,files:e.files??[]};return(await oe("timeline/v2/comment.publish",{data:JSON.stringify(l),_wpnonce:n})).comment}async function ln(e,n){const l={comment_id:e.comment_id,content:e.content,files:e.files??[]};return(await oe("timeline/v2/comment.edit",{data:JSON.stringify(l),_wpnonce:n})).comment}async function sn(e,n){return{deleted:(await oe("timeline/v2/comment.delete",{comment_id:e,_wpnonce:n})).success!==!1}}async function cn(e,n){return oe("timeline/v2/comment.like",{comment_id:e,_wpnonce:n})}async function mn(e,n){return(await oe("timeline/v2/comment.mark_approved",{comment_id:e,_wpnonce:n})).comment}async function dn(e,n){return(await oe("timeline/v2/comment.mark_pending",{comment_id:e,_wpnonce:n})).comment}async function un(e){return Fe("timeline/v2/comments/get_feed",{status_id:e.status_id,parent_id:e.parent_id,reply_id:e.reply_id,page:e.page,mode:e.mode})}async function fn(e,n){return new Promise((l,a)=>{const r=new FormData;r.append("file",e);const t=new XMLHttpRequest;n&&t.upload.addEventListener("progress",f=>{if(f.lengthComputable){const p=Math.round(f.loaded/f.total*100);n(p)}}),t.addEventListener("load",()=>{if(t.status>=200&&t.status<300)try{const f=JSON.parse(t.responseText);f.success?l(f.data):a(new Error(f.message||"Upload failed"))}catch{a(new Error("Invalid response from server"))}else a(new Error(`Upload failed with status ${t.status}`))}),t.addEventListener("error",()=>{a(new Error("Network error during upload"))}),t.addEventListener("abort",()=>{a(new Error("Upload cancelled"))});const o=window.wpApiSettings?.nonce||window.voxelFseConfig?.nonce||"",m=Ht();t.open("POST",`${m}${ye}/upload`),t.setRequestHeader("X-WP-Nonce",o),t.send(r)})}async function pn(e,n,l){try{return(await Fe("timeline.get_link_preview",{url:e,_wpnonce:n},{signal:l})).preview??null}catch{return null}}const gn={config:null,postContext:null,attributes:{},context:"frontend",isLoading:!0,error:null,refetch:async()=>{}},Qe=Et(gn);let Ee=null,ge=null;const Le=new Map;function hn({attributes:e,postId:n,context:l="frontend",children:a}){const[r,t]=S(Ee),[o,m]=S(null),[f,p]=S(!0),[g,s]=S(null),v=e.mode,_=`${v}:${n??"none"}`,y=JSON.stringify(e),u=T(e);u.current=e;const d=T(!1),i=h(async()=>{if(!d.current){d.current=!0,p(!0),s(null);try{let R=Ee;if(R||(ge?R=await ge:(ge=Wt(),R=await ge,Ee=R,ge=null)),t(R),l==="editor")m({visible:!0,reason:null,composer:{feed:v==="post_reviews"?"post_reviews":"user_timeline",can_post:!0,post_as:"current_user",placeholder:"What's on your mind?"},reviews:null,current_post:null,current_author:null,filtering_options:{all:"All"},show_usernames:!0});else{let x=Le.get(_);if(!x){const j=await Jt(v,n);x={visible:j.visible,reason:j.reason,composer:j.composer,reviews:j.reviews,current_post:j.current_post,current_author:j.current_author,filtering_options:j.filtering_options,show_usernames:j.show_usernames},Le.set(_,x)}m(x)}}catch(R){s(R instanceof Error?R.message:"Failed to load configuration")}finally{p(!1),d.current=!1}}},[v,n,_,l]),c=h(async()=>{Ee=null,ge=null,Le.delete(_),d.current=!1,await i()},[i,_]);q(()=>{i()},[i]);const E=re(()=>({config:r,postContext:o,attributes:u.current,context:l,isLoading:f,error:g,refetch:c}),[r,o,l,f,g,c,y]);return React.createElement(Qe.Provider,{value:E},a)}function ue(){const e=yt(Qe);if(!e)throw new Error("useTimelineContext must be used within a TimelineProvider");return e}function fe(){const{config:e,isLoading:n,error:l,refetch:a}=ue();return re(()=>({config:e,isLoading:n,error:l,refetch:a}),[e,n,l,a])}function Ye(){const{attributes:e}=ue();return e}function he(){const{config:e}=ue();return e?.current_user??null}const vn={can_post:!1,can_upload:!1,can_moderate:!1,is_logged_in:!1};function Cn(){const{config:e}=ue();return e?.permissions??vn}const Rn={all:"All"};function wn(){const{postContext:e}=ue();return e?.filtering_options??Rn}function ve(){const{config:e}=ue();return e?.strings?e.strings:{compose_placeholder:"What's on your mind?",compose_submit:"Post",compose_submitting:"Posting...",like:"Like",unlike:"Unlike",comment:"Comment",comments:"Comments",reply:"Reply",replies:"Replies",repost:"Repost",unrepost:"Unrepost",quote:"Quote",edit:"Edit",delete:"Delete",share:"Share",loading:"Loading...",load_more:"Load more",no_posts:"No posts available",no_comments:"No comments yet",error_generic:"Something went wrong",error_network:"Network error. Please try again.",just_now:"Just now",minutes_ago:"%d minutes ago",hours_ago:"%d hours ago",days_ago:"%d days ago",edited:"Edited",pending_approval:"Pending approval",approve:"Approve",mark_pending:"Mark as pending",delete_confirm:"Are you sure you want to delete this post?",delete_comment_confirm:"Are you sure you want to delete this comment?",content_too_short:"Content is too short",content_too_long:"Content is too long",file_too_large:"File is too large",file_type_not_allowed:"File type not allowed",search_placeholder:"Search posts...",search_no_results:"No results found"}}const En={mode:"user_feed",order:"latest",time:"all_time"};function yn(e="user_feed",n={},l={}){const[a,r]=S({...En,...n,mode:e}),[t,o]=S({statuses:[],isLoading:!0,isLoadingMore:!1,hasMore:!1,error:null,page:1}),m=T(!0),f=T(null),p=T(e),[g,s]=S(!1),v=T(null),_=3e4,y=h(C=>{const N={mode:e,order:a.order,time:a.time,time_custom:a.timeCustom,search:a.search,filter:a.filter,post_id:a.postId,author_id:a.authorId,page:C};return console.log("[useStatusFeed] Building feed params:",N),N},[e,a.order,a.time,a.timeCustom,a.search,a.filter,a.postId,a.authorId]),u=h(async(C,N=!1)=>{f.current&&f.current.abort(),f.current=new AbortController,o(N?L=>({...L,isLoadingMore:!0,error:null}):L=>({...L,isLoading:!0,error:null,statuses:[],page:1}));try{const L=y(C),H=await rn(L);if(!m.current)return;const D=Array.isArray(H)?H:Array.isArray(H?.data)?H.data:[],B=Array.isArray(H)?!1:H?.has_more??!1;o(U=>({...U,statuses:N?[...U.statuses,...D]:D,hasMore:B,page:C,isLoading:!1,isLoadingMore:!1}))}catch(L){if(!m.current||L instanceof Error&&L.name==="AbortError")return;o(H=>({...H,isLoading:!1,isLoadingMore:!1,error:L instanceof Error?L.message:"Failed to load feed"}))}},[y]),d=h(async()=>{t.isLoadingMore||!t.hasMore||await u(t.page+1,!0)},[t.isLoadingMore,t.hasMore,t.page,u]),i=h(async()=>{await u(1,!1)},[u]),c=h(C=>{r(N=>({...N,...C,mode:e}))},[e]),E=h(C=>{o(N=>({...N,statuses:[C,...N.statuses]}))},[]),R=h(C=>{o(N=>({...N,statuses:N.statuses.map(L=>L.id===C.id?C:L)}))},[]),x=h(C=>{o(N=>({...N,statuses:N.statuses.filter(L=>L.id!==C)}))},[]);q(()=>{p.current!==e&&(console.log("[useStatusFeed] Mode changed:",{from:p.current,to:e,willRefetch:!0}),p.current=e,r(C=>({...C,mode:e})),u(1,!1))},[e,u]),q(()=>{u(1,!1)},[]),q(()=>{p.current===e&&u(1,!1)},[a.order,a.time,a.timeCustom,a.search,a.filter]);const j=h((C=_)=>{v.current||(s(!0),console.log(`[useStatusFeed] Starting polling every ${C}ms`),v.current=setInterval(()=>{!t.isLoading&&!t.isLoadingMore&&(console.log("[useStatusFeed] Polling refresh"),u(1,!1))},C))},[u,t.isLoading,t.isLoadingMore]),I=h(()=>{v.current&&(clearInterval(v.current),v.current=null,s(!1),console.log("[useStatusFeed] Stopped polling"))},[]);return q(()=>(l.enabled&&l.intervalMs&&j(l.intervalMs),()=>I()),[l.enabled,l.intervalMs,j,I]),q(()=>(m.current=!0,()=>{m.current=!1,f.current&&f.current.abort(),v.current&&clearInterval(v.current)}),[]),{statuses:t.statuses,isLoading:t.isLoading,isLoadingMore:t.isLoadingMore,hasMore:t.hasMore,error:t.error,loadMore:d,refresh:i,setFilters:c,addStatus:E,updateStatus:R,removeStatus:x,startPolling:j,stopPolling:I,isPolling:g,filters:{...a,mode:e}}}function _n(e,n,l){const{config:a}=fe(),r=he(),[t,o]=S({isLiking:!1,isReposting:!1,isDeleting:!1,isApproving:!1,isMarkingPending:!1,isRemovingPreview:!1}),[m,f]=S({}),p=T({}),g=h(()=>{f({}),p.current={}},[]);q(()=>{const i=x=>{const{action:j}=x.detail,I=m.current_user?.has_liked??e.current_user.has_liked,C=m.likes?.count??e.likes.count,N=m.likes?.last3??e.likes.last3??[];if(j==="like"&&I||j==="unlike"&&!I)return;const L=j==="like",H=Math.max(0,C+(L?1:-1));let D=[...N];L&&r?(D.unshift({id:r.id,type:"user",display_name:r.display_name,link:r.link??"",avatar_url:r.avatar_url}),D=D.slice(0,3)):!L&&r&&(D=D.filter(B=>!(B.type==="user"&&B.id===r.id))),f(B=>({...B,likes:{...e.likes,count:H,last3:D},current_user:{...B.current_user??e.current_user,has_liked:L}}))},c=x=>{const{action:j}=x.detail,I=j==="repost";f(C=>({...C,current_user:{...C.current_user??e.current_user,has_reposted:I}}))},E=`voxel/tl/status/${e.id}/like`,R=`voxel/tl/status/${e.id}/repost`;return document.addEventListener(E,i),document.addEventListener(R,c),()=>{document.removeEventListener(E,i),document.removeEventListener(R,c)}},[e.id,e.current_user,e.likes,m,r]);const s=h(async()=>{if(t.isLiking)return{success:!1,message:"Action in progress"};const i=a?.nonces?.status_like;if(!i)return{success:!1,message:"Configuration not loaded"};const c=m.current_user?.has_liked??e.current_user.has_liked;m.likes?.count??e.likes.count,m.likes?.last3??e.likes.last3,p.current={likes:m.likes??{...e.likes},current_user:m.current_user??{...e.current_user}};const E=c?"unlike":"like";document.dispatchEvent(new CustomEvent(`voxel/tl/status/${e.id}/like`,{detail:{action:E}})),o(R=>({...R,isLiking:!0}));try{return await Yt(e.id,i)}catch(R){const x=E==="unlike"?"like":"unlike";return document.dispatchEvent(new CustomEvent(`voxel/tl/status/${e.id}/like`,{detail:{action:x}})),{success:!1,message:R instanceof Error?R.message:"Failed to like status"}}finally{o(R=>({...R,isLiking:!1}))}},[e,m,t.isLiking,a?.nonces?.status_like]),v=h(async()=>{if(t.isReposting)return{success:!1,message:"Action in progress",action:"repost"};const i=a?.nonces?.status_repost;if(!i)return{success:!1,message:"Configuration not loaded",action:"repost"};const c=m.current_user?.has_reposted??e.current_user.has_reposted;p.current={current_user:m.current_user??{...e.current_user}};const E=c?"unrepost":"repost";document.dispatchEvent(new CustomEvent(`voxel/tl/status/${e.id}/repost`,{detail:{action:E}})),o(R=>({...R,isReposting:!0}));try{return await Kt(e.id,i)}catch(R){const x=E==="unrepost"?"repost":"unrepost";return document.dispatchEvent(new CustomEvent(`voxel/tl/status/${e.id}/repost`,{detail:{action:x}})),{success:!1,message:R instanceof Error?R.message:"Failed to repost",action:"repost"}}finally{o(R=>({...R,isReposting:!1}))}},[e,m,t.isReposting,a?.nonces?.status_repost]),_=h(async()=>{if(t.isDeleting)return!1;const i=a?.nonces?.status_delete??a?.nonces?.status_edit??"";if(!i)return console.error("[handleDelete] No nonce available for delete"),!1;o(c=>({...c,isDeleting:!0}));try{const c=await Qt(e.id,i);return c.deleted&&l&&l(e.id),c.deleted}catch(c){return console.error("[handleDelete] Error:",c),!1}finally{o(c=>({...c,isDeleting:!1}))}},[e.id,t.isDeleting,l,a?.nonces?.status_delete,a?.nonces?.status_edit]),y=h(async()=>{if(t.isApproving)return null;const i=a?.nonces?.status_edit??a?.nonces?.status_moderate??"";if(!i)return console.error("[handleApprove] No nonce available for moderation"),null;o(c=>({...c,isApproving:!0}));try{const c=await nn(e.id,i);if(c.success&&n){const E={...e,is_pending:!1,badges:c.badges||[]};return n(E),E}return null}catch(c){return console.error("[handleApprove] Error:",c),null}finally{o(c=>({...c,isApproving:!1}))}},[e,t.isApproving,a?.nonces?.status_edit,a?.nonces?.status_moderate,n]),u=h(async()=>{if(t.isMarkingPending)return null;const i=a?.nonces?.status_edit??a?.nonces?.status_moderate??"";if(!i)return console.error("[handleMarkPending] No nonce available for moderation"),null;o(c=>({...c,isMarkingPending:!0}));try{const c=await an(e.id,i);if(c.success&&n){const E={...e,is_pending:!0,badges:c.badges||[]};return n(E),E}return null}catch(c){return console.error("[handleMarkPending] Error:",c),null}finally{o(c=>({...c,isMarkingPending:!1}))}},[e,t.isMarkingPending,a?.nonces?.status_edit,a?.nonces?.status_moderate,n]),d=h(async()=>{if(t.isRemovingPreview)return!1;p.current={link_preview:e.link_preview},f(i=>({...i,link_preview:null})),o(i=>({...i,isRemovingPreview:!0}));try{return(await tn(e.id)).removed}catch{return f(c=>({...c,link_preview:p.current.link_preview})),!1}finally{o(i=>({...i,isRemovingPreview:!1}))}},[e.id,e.link_preview,t.isRemovingPreview]);return{actionState:t,optimisticStatus:m,handleLike:s,handleRepost:v,handleDelete:_,handleApprove:y,handleMarkPending:u,handleRemoveLinkPreview:d,resetOptimisticState:g}}function xn(e,n,l=!0){const[a,r]=S({comments:[],isLoading:l,isLoadingMore:!1,hasMore:!0,error:null,page:1}),t=T(!0),o=T(null),m=T(!1),f=h(u=>({status_id:e,parent_id:n,page:u}),[e,n]),p=h(async(u,d=!1)=>{o.current&&o.current.abort(),o.current=new AbortController,r(d?i=>({...i,isLoadingMore:!0,error:null}):i=>({...i,isLoading:!0,error:null,comments:[],page:1}));try{const i=f(u);console.log("[useCommentFeed] Fetching comments:",i);const c=await un(i);if(!t.current)return;const E=Array.isArray(c)?c:Array.isArray(c?.data)?c.data:[],R=Array.isArray(c)?!1:c?.has_more??!1;console.log("[useCommentFeed] Got comments:",{count:E.length,hasMore:R}),r(x=>({...x,comments:d?[...x.comments,...E]:E,hasMore:R,page:u,isLoading:!1,isLoadingMore:!1}))}catch(i){if(!t.current||i instanceof Error&&i.name==="AbortError")return;console.error("[useCommentFeed] Error fetching comments:",i),r(c=>({...c,isLoading:!1,isLoadingMore:!1,error:i instanceof Error?i.message:"Failed to load comments"}))}},[f]),g=h(async()=>{a.isLoadingMore||!a.hasMore||await p(a.page+1,!0)},[a.isLoadingMore,a.hasMore,a.page,p]),s=h(async()=>{await p(1,!1)},[p]),v=h(u=>{r(d=>({...d,comments:[...d.comments,u]}))},[]),_=h(u=>{r(d=>({...d,comments:d.comments.map(i=>i.id===u.id?u:i)}))},[]),y=h(u=>{r(d=>({...d,comments:d.comments.filter(i=>i.id!==u)}))},[]);return q(()=>{l&&!m.current&&(m.current=!0,p(1,!1))},[l,p]),q(()=>{m.current&&p(1,!1)},[e,n]),q(()=>(t.current=!0,()=>{t.current=!1,o.current&&o.current.abort()}),[]),{comments:a.comments,isLoading:a.isLoading,isLoadingMore:a.isLoadingMore,hasMore:a.hasMore,error:a.error,loadMore:g,refresh:s,addComment:v,updateComment:_,removeComment:y}}function kn(e,n,l){const{config:a}=fe(),r=he(),[t,o]=S({isLiking:!1,isDeleting:!1,isApproving:!1}),[m,f]=S({}),p=T({}),g=h(()=>{f({}),p.current={}},[]),s=h(async()=>{if(t.isLiking)return{success:!1,message:"Action in progress"};const u=a?.nonces?.comment_like;if(!u)return{success:!1,message:"Configuration not loaded"};const d=m.current_user?.has_liked??e.current_user.has_liked,i=m.likes?.count??e.likes.count,c=m.likes?.last3??e.likes.last3??[];p.current={likes:m.likes??{...e.likes},current_user:m.current_user??{...e.current_user}};const E=!d,R=Math.max(0,i+(E?1:-1));let x=[...c];E&&r?(x.unshift({id:r.id,type:"user",display_name:r.display_name,link:r.link??"",avatar_url:r.avatar_url}),x=x.slice(0,3)):!E&&r&&(x=x.filter(C=>!(C.type==="user"&&C.id===r.id)));const j={...e.likes,count:R,last3:x},I={...e.current_user,has_liked:E};f(C=>({...C,likes:j,current_user:I})),o(C=>({...C,isLiking:!0}));try{return await cn(e.id,u)}catch(C){return f(N=>({...N,likes:p.current.likes,current_user:p.current.current_user})),{success:!1,message:C instanceof Error?C.message:"Failed to like comment"}}finally{o(C=>({...C,isLiking:!1}))}},[e,m,t.isLiking,a?.nonces?.comment_like,r]),v=h(async()=>{if(t.isDeleting)return!1;const u=a?.nonces?.comment_delete;if(!u)return console.error("[useCommentActions] No comment_delete nonce available"),!1;o(d=>({...d,isDeleting:!0}));try{const d=await sn(e.id,u);return d.deleted&&l&&l(e.id),d.deleted}catch(d){return console.error("[useCommentActions] Delete failed:",d),!1}finally{o(d=>({...d,isDeleting:!1}))}},[e.id,t.isDeleting,a?.nonces?.comment_delete,l]),_=h(async()=>{if(t.isApproving)return null;const u=a?.nonces?.comment_edit;if(!u)return console.error("[useCommentActions] No comment_edit nonce available"),null;o(d=>({...d,isApproving:!0}));try{const d=await mn(e.id,u);return n&&n(d),d}catch(d){return console.error("[useCommentActions] Approve failed:",d),null}finally{o(d=>({...d,isApproving:!1}))}},[e.id,t.isApproving,a?.nonces?.comment_edit,n]),y=h(async()=>{if(t.isApproving)return null;const u=a?.nonces?.comment_edit;if(!u)return console.error("[useCommentActions] No comment_edit nonce available"),null;o(d=>({...d,isApproving:!0}));try{const d=await dn(e.id,u);return n&&n(d),d}catch(d){return console.error("[useCommentActions] Mark pending failed:",d),null}finally{o(d=>({...d,isApproving:!1}))}},[e.id,t.isApproving,a?.nonces?.comment_edit,n]);return{actionState:t,optimisticComment:m,handleLike:s,handleDelete:v,handleApprove:_,handleMarkPending:y,resetOptimisticState:g}}const bn={maxFiles:5,maxFileSize:2*1024*1024,allowedTypes:["image/jpeg","image/png","image/gif","image/webp"],allowedExtensions:["jpg","jpeg","png","gif","webp"]};function Nn(){return`upload-${Date.now()}-${Math.random().toString(36).slice(2,9)}`}function Sn(e){return e.split(".").pop()?.toLowerCase()||""}function Ke(e={}){const n={...bn,...e},[l,a]=S([]),[r,t]=S([]),o=T(new Map),m=h(u=>{if(u.size>n.maxFileSize)return{valid:!1,error:`File is too large. Maximum size is ${(n.maxFileSize/1048576).toFixed(1)}MB.`};if(!n.allowedTypes.includes(u.type))return{valid:!1,error:`File type "${u.type}" is not allowed.`};const d=Sn(u.name);return n.allowedExtensions.includes(d)?{valid:!0}:{valid:!1,error:`File extension ".${d}" is not allowed.`}},[n]),f=h(u=>{const d=Array.from(u),i=l.length+r.length,c=n.maxFiles-i;if(c<=0){console.warn(`Maximum ${n.maxFiles} files allowed.`);return}const R=d.slice(0,c).map(x=>{const j=m(x);return{id:Nn(),file:x,progress:0,status:j.valid?"pending":"error",error:j.error}});a(x=>[...x,...R])},[l.length,r.length,n.maxFiles,m]),p=h(u=>{const d=o.current.get(u);d&&(d.abort(),o.current.delete(u)),a(i=>i.filter(c=>c.id!==u)),t(i=>i.filter(c=>c.id!==parseInt(u)))},[]),g=h(()=>{o.current.forEach(u=>u.abort()),o.current.clear(),a([]),t([])},[]),s=h(async u=>{if(u.status==="completed"||u.status==="error")return null;a(d=>d.map(i=>i.id===u.id?{...i,status:"uploading",progress:0}:i));try{const d=await fn(u.file,c=>{a(E=>E.map(R=>R.id===u.id?{...R,progress:c}:R))});return a(c=>c.map(E=>E.id===u.id?{...E,status:"completed",progress:100,result:d}:E)),{id:d.id,url:d.url,alt:d.name,type:d.mime_type.startsWith("image/")?"image":"file",mime_type:d.mime_type,thumbnail_url:d.url}}catch(d){return a(i=>i.map(c=>c.id===u.id?{...c,status:"error",error:d instanceof Error?d.message:"Upload failed"}:c)),null}},[]),v=h(async()=>{const u=l.filter(c=>c.status==="pending"),i=(await Promise.all(u.map(c=>s(c)))).filter(c=>c!==null);return t(c=>[...c,...i]),i},[l,s]),_=h(async u=>{const d=l.find(c=>c.id===u);if(!d||d.status!=="error")return;a(c=>c.map(E=>E.id===u?{...E,status:"pending",error:void 0}:E));const i=await s({...d,status:"pending"});i&&t(c=>[...c,i])},[l,s]),y=l.some(u=>u.status==="uploading");return{uploads:l,isUploading:y,completedFiles:r,addFiles:f,removeFile:p,clearAll:g,uploadAll:v,retryUpload:_,validateFile:m}}const le={mention:/@\[([^\]]+)\]\((?:user|post):(\d+)\)|@(\w+)/g,hashtag:/#(\w+)/g,url:/https?:\/\/[^\s<>"{}|\\^`[\]]+/gi,inlineCode:/`([^`]+)`/g,codeBlock:/```([\s\S]*?)```/g,bold:/\*\*([^*]+)\*\*/g,italic:/\*([^*]+)\*/g,strikethrough:/~~([^~]+)~~/g};function et(e){if(!e)return[];const n=[];let l=e;const a=[...e.matchAll(le.codeBlock)];for(const r of a){const t=l.indexOf(r[0]);t>0&&n.push(...Te(l.slice(0,t))),n.push({type:"code",content:r[1].trim(),raw:r[0]}),l=l.slice(t+r[0].length)}return l&&n.push(...Te(l)),n}function Te(e){const n=[];let l=0;const a=[];for(const t of e.matchAll(le.mention)){const o=t[1]!==void 0;a.push({type:"mention",index:t.index,length:t[0].length,content:o?t[1]:t[3],raw:t[0],metadata:o?{userId:parseInt(t[2])}:void 0})}for(const t of e.matchAll(le.hashtag))a.push({type:"hashtag",index:t.index,length:t[0].length,content:t[1],raw:t[0],metadata:{hashtag:t[1]}});for(const t of e.matchAll(le.url))a.push({type:"link",index:t.index,length:t[0].length,content:t[0],raw:t[0],metadata:{url:t[0]}});for(const t of e.matchAll(le.inlineCode))a.push({type:"code",index:t.index,length:t[0].length,content:t[1],raw:t[0]});for(const t of e.matchAll(le.bold))a.push({type:"bold",index:t.index,length:t[0].length,content:t[1],raw:t[0]});for(const t of e.matchAll(le.italic)){const o=e[t.index-1],m=e[t.index+t[0].length];o!=="*"&&m!=="*"&&a.push({type:"italic",index:t.index,length:t[0].length,content:t[1],raw:t[0]})}for(const t of e.matchAll(le.strikethrough))a.push({type:"strikethrough",index:t.index,length:t[0].length,content:t[1],raw:t[0]});a.sort((t,o)=>t.index-o.index);const r=[];for(const t of a)r.some(m=>t.index<m.index+m.length&&t.index+t.length>m.index)||r.push(t);for(const t of r){if(t.index>l){const o=e.slice(l,t.index);o&&n.push({type:"text",content:o,raw:o})}n.push({type:t.type,content:t.content,raw:t.raw,metadata:t.metadata}),l=t.index+t.length}if(l<e.length){const t=e.slice(l);t&&n.push({type:"text",content:t,raw:t})}return n}function jn(e){return e.replace(le.codeBlock,"$1").replace(le.inlineCode,"$1").replace(le.bold,"$1").replace(le.italic,"$1").replace(le.strikethrough,"$1").replace(/@\[([^\]]+)\]\([^)]+\)/g,"@$1").replace(/#(\w+)/g,"#$1")}function Ln(e,n,l=!0){if(e.length<=n)return{text:e,isTruncated:!1};let a=e.slice(0,n);if(l){const r=a.lastIndexOf(" ");r>n*.5&&(a=a.slice(0,r))}return{text:a.trim()+"...",isTruncated:!0}}function tt(e){return jn(e).length}function Mn(e,n){return e.length<=n?e:e.slice(0,n-3).trim()+"..."}const Ae={smileys:[{emoji:"ðŸ˜€",name:"grinning face happy smile"},{emoji:"ðŸ˜ƒ",name:"grinning face big eyes happy"},{emoji:"ðŸ˜„",name:"grinning face smiling eyes happy"},{emoji:"ðŸ˜",name:"beaming face grin happy"},{emoji:"ðŸ˜…",name:"grinning face sweat nervous"},{emoji:"ðŸ˜‚",name:"face tears joy laughing lol"},{emoji:"ðŸ¤£",name:"rolling floor laughing rofl lol"},{emoji:"ðŸ˜Š",name:"smiling face blush happy"},{emoji:"ðŸ˜‡",name:"smiling face halo angel innocent"},{emoji:"ðŸ™‚",name:"slightly smiling face"},{emoji:"ðŸ™ƒ",name:"upside down face silly"},{emoji:"ðŸ˜‰",name:"winking face wink"},{emoji:"ðŸ˜Œ",name:"relieved face peaceful"},{emoji:"ðŸ˜",name:"heart eyes love smitten"},{emoji:"ðŸ¥°",name:"smiling face hearts love"},{emoji:"ðŸ˜˜",name:"face blowing kiss love"},{emoji:"ðŸ˜‹",name:"face savoring food yummy delicious"},{emoji:"ðŸ˜›",name:"face tongue out playful"},{emoji:"ðŸ˜œ",name:"winking face tongue playful crazy"},{emoji:"ðŸ¤ª",name:"zany face crazy wild silly"},{emoji:"ðŸ˜Ž",name:"face sunglasses cool"},{emoji:"ðŸ¤©",name:"star struck excited amazing"},{emoji:"ðŸ¥³",name:"partying face celebration party"},{emoji:"ðŸ˜",name:"smirking face smirk"},{emoji:"ðŸ˜’",name:"unamused face annoyed"},{emoji:"ðŸ˜”",name:"pensive face sad thoughtful"},{emoji:"ðŸ˜¢",name:"crying face sad tear"},{emoji:"ðŸ˜­",name:"loudly crying face sob"},{emoji:"ðŸ˜±",name:"face screaming fear shocked"},{emoji:"ðŸ˜¡",name:"pouting face angry mad"},{emoji:"ðŸ¤”",name:"thinking face hmm wonder"},{emoji:"ðŸ¤—",name:"hugging face hug"},{emoji:"ðŸ¤«",name:"shushing face quiet secret"},{emoji:"ðŸ¤­",name:"face hand over mouth giggle oops"},{emoji:"ðŸ¤",name:"zipper mouth face quiet secret"},{emoji:"ðŸ¥±",name:"yawning face tired sleepy bored"},{emoji:"ðŸ˜´",name:"sleeping face zzz sleep tired"}],people:[{emoji:"ðŸ‘‹",name:"waving hand wave hello hi bye"},{emoji:"ðŸ¤š",name:"raised back hand stop"},{emoji:"âœ‹",name:"raised hand high five stop"},{emoji:"ðŸ–ï¸",name:"hand fingers splayed"},{emoji:"ðŸ‘Œ",name:"ok hand okay perfect"},{emoji:"ðŸ¤Œ",name:"pinched fingers italian"},{emoji:"âœŒï¸",name:"victory hand peace"},{emoji:"ðŸ¤ž",name:"crossed fingers luck hope"},{emoji:"ðŸ¤Ÿ",name:"love you gesture hand"},{emoji:"ðŸ¤˜",name:"sign horns rock metal"},{emoji:"ðŸ‘",name:"thumbs up good like yes approve"},{emoji:"ðŸ‘Ž",name:"thumbs down bad dislike no"},{emoji:"âœŠ",name:"raised fist power"},{emoji:"ðŸ‘Š",name:"oncoming fist punch bump"},{emoji:"ðŸ¤",name:"handshake deal agree"},{emoji:"ðŸ‘",name:"clapping hands applause bravo"},{emoji:"ðŸ™Œ",name:"raising hands celebration hooray"},{emoji:"ðŸ’ª",name:"flexed biceps strong muscle"},{emoji:"ðŸ™",name:"folded hands pray please thanks"}],animals:[{emoji:"ðŸ±",name:"cat face kitty meow"},{emoji:"ðŸ¶",name:"dog face puppy woof"},{emoji:"ðŸ­",name:"mouse face rat"},{emoji:"ðŸ°",name:"rabbit face bunny"},{emoji:"ðŸ¦Š",name:"fox face"},{emoji:"ðŸ»",name:"bear face teddy"},{emoji:"ðŸ¼",name:"panda face"},{emoji:"ðŸ¨",name:"koala face"},{emoji:"ðŸ¯",name:"tiger face"},{emoji:"ðŸ¦",name:"lion face"},{emoji:"ðŸ®",name:"cow face moo"},{emoji:"ðŸ·",name:"pig face oink"},{emoji:"ðŸ¸",name:"frog face ribbit"},{emoji:"ðŸµ",name:"monkey face"},{emoji:"ðŸ”",name:"chicken face hen"},{emoji:"ðŸ¦„",name:"unicorn face magic"},{emoji:"ðŸ",name:"honeybee bee buzz"},{emoji:"ðŸ¦‹",name:"butterfly insect"}],food:[{emoji:"ðŸŽ",name:"red apple fruit"},{emoji:"ðŸ•",name:"pizza slice"},{emoji:"ðŸ”",name:"hamburger burger"},{emoji:"ðŸŸ",name:"french fries"},{emoji:"ðŸŒ­",name:"hot dog"},{emoji:"ðŸ¿",name:"popcorn movie snack"},{emoji:"ðŸ©",name:"doughnut donut"},{emoji:"ðŸª",name:"cookie biscuit"},{emoji:"ðŸŽ‚",name:"birthday cake celebration"},{emoji:"ðŸ°",name:"shortcake cake slice"},{emoji:"â˜•",name:"hot beverage coffee tea"},{emoji:"ðŸº",name:"beer mug drink"},{emoji:"ðŸ·",name:"wine glass drink"},{emoji:"ðŸ¸",name:"cocktail glass martini drink"}],travel:[{emoji:"âœˆï¸",name:"airplane plane flight travel"},{emoji:"ðŸš—",name:"automobile car vehicle"},{emoji:"ðŸš•",name:"taxi cab car"},{emoji:"ðŸšŒ",name:"bus vehicle"},{emoji:"ðŸš€",name:"rocket space launch"},{emoji:"ðŸ ",name:"house home building"},{emoji:"ðŸ¢",name:"office building"},{emoji:"ðŸŒ",name:"globe earth world planet"},{emoji:"ðŸ—½",name:"statue liberty new york"},{emoji:"ðŸ—¼",name:"tokyo tower"},{emoji:"ðŸ°",name:"castle palace"},{emoji:"ðŸ–ï¸",name:"beach umbrella vacation"},{emoji:"â›°ï¸",name:"mountain nature"}],activities:[{emoji:"âš½",name:"soccer ball football sport"},{emoji:"ðŸ€",name:"basketball sport"},{emoji:"ðŸˆ",name:"american football sport"},{emoji:"âš¾",name:"baseball sport"},{emoji:"ðŸŽ¾",name:"tennis sport"},{emoji:"ðŸŽ®",name:"video game controller gaming"},{emoji:"ðŸŽ¯",name:"bullseye target dart"},{emoji:"ðŸŽ¸",name:"guitar music instrument rock"},{emoji:"ðŸŽ¤",name:"microphone singing karaoke"},{emoji:"ðŸŽ¬",name:"clapper board movie film"},{emoji:"ðŸŽ¨",name:"artist palette painting art"},{emoji:"ðŸŽ­",name:"performing arts theater drama"}],objects:[{emoji:"ðŸ’¡",name:"light bulb idea"},{emoji:"ðŸ“±",name:"mobile phone smartphone"},{emoji:"ðŸ’»",name:"laptop computer"},{emoji:"ðŸ“·",name:"camera photo"},{emoji:"ðŸ“š",name:"books reading study"},{emoji:"ðŸ“",name:"memo note write"},{emoji:"âœï¸",name:"pencil write draw"},{emoji:"ðŸ”‘",name:"key unlock"},{emoji:"ðŸ’°",name:"money bag cash"},{emoji:"ðŸ’Ž",name:"gem stone diamond jewel"},{emoji:"ðŸŽ",name:"wrapped gift present"},{emoji:"ðŸ””",name:"bell notification alert"}],symbols:[{emoji:"â¤ï¸",name:"red heart love"},{emoji:"ðŸ§¡",name:"orange heart love"},{emoji:"ðŸ’›",name:"yellow heart love"},{emoji:"ðŸ’š",name:"green heart love"},{emoji:"ðŸ’™",name:"blue heart love"},{emoji:"ðŸ’œ",name:"purple heart love"},{emoji:"ðŸ–¤",name:"black heart love dark"},{emoji:"ðŸ’”",name:"broken heart sad"},{emoji:"âœ¨",name:"sparkles stars magic"},{emoji:"â­",name:"star"},{emoji:"ðŸŒŸ",name:"glowing star shine"},{emoji:"ðŸ’¯",name:"hundred points perfect score"},{emoji:"âœ…",name:"check mark yes done complete"},{emoji:"âŒ",name:"cross mark no wrong"},{emoji:"âš ï¸",name:"warning sign alert caution"},{emoji:"ðŸ”¥",name:"fire hot flame lit"},{emoji:"ðŸ’¥",name:"collision boom explosion"},{emoji:"ðŸŽ‰",name:"party popper celebration confetti"}],flags:[{emoji:"ðŸ³ï¸",name:"white flag surrender"},{emoji:"ðŸ´",name:"black flag"},{emoji:"ðŸš©",name:"triangular flag red flag"}]},In={smileys:"Smileys & Emotion",people:"People & Body",animals:"Animals & Nature",food:"Food & Drink",travel:"Travel & Places",activities:"Activities",objects:"Objects",symbols:"Symbols",flags:"Flags"},nt="vxfeed_emoji_recents",Fn=20,Me=()=>{try{const e=localStorage.getItem(nt);return e?JSON.parse(e):[]}catch{return[]}},Pn=e=>{try{const n=Me().filter(l=>l!==e);n.unshift(e),localStorage.setItem(nt,JSON.stringify(n.slice(0,Fn)))}catch{}},Vn=()=>React.createElement("svg",{width:"80",height:"80",viewBox:"0 0 24 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",transform:"rotate(0 0 0)"},React.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.25 2.75C6.14154 2.75 2 6.89029 2 11.998C2 17.1056 6.14154 21.2459 11.25 21.2459C13.5335 21.2459 15.6238 20.4187 17.2373 19.0475L20.7182 22.5287C21.011 22.8216 21.4859 22.8217 21.7788 22.5288C22.0717 22.2359 22.0718 21.761 21.7789 21.4681L18.2983 17.9872C19.6714 16.3736 20.5 14.2826 20.5 11.998C20.5 6.89029 16.3585 2.75 11.25 2.75ZM3.5 11.998C3.5 7.71905 6.96962 4.25 11.25 4.25C15.5304 4.25 19 7.71905 19 11.998C19 16.2769 15.5304 19.7459 11.25 19.7459C6.96962 19.7459 3.5 16.2769 3.5 11.998Z",fill:"#343C54"}));function Pe({isOpen:e,onClose:n,onSelect:l,target:a,widthElement:r}){const[t,o]=S(""),[m,f]=S([]),p=T(null),g=T(null),s=T(null),[v,_]=S({});q(()=>{f(Me())},[]),q(()=>{e&&p.current&&setTimeout(()=>{p.current?.focus()},100)},[e]),q(()=>{e||o("")},[e]);const y=re(()=>{if(!t.trim())return[];const i=t.toLowerCase();return Object.values(Ae).flat().filter(E=>E.name.toLowerCase().includes(i))},[t]),u=h(i=>{Pn(i),f(Me()),l(i)},[l]),d=h(()=>{if(!g.current||!s.current||!a)return;const i=a.getBoundingClientRect(),c={left:i.left+window.scrollX,top:i.top+window.scrollY},R=(r||a).getBoundingClientRect(),x=R.width,I={left:R.left+window.scrollX}.left;let C=c.top+i.height;const N=window.innerHeight,H=s.current.getBoundingClientRect().height,D=i.bottom+H>N,B=i.top-H>=0;D&&B&&(C=c.top-H),_({position:"absolute",top:`${C}px`,left:`${I}px`,width:`${x}px`})},[a,r]);return q(()=>{if(!e)return;d();const i=()=>d(),c=()=>d();return window.addEventListener("scroll",i,!0),window.addEventListener("resize",c,!0),()=>{window.removeEventListener("scroll",i,!0),window.removeEventListener("resize",c,!0)}},[e,d]),q(()=>{e&&requestAnimationFrame(d)},[e,d]),q(()=>{if(!e)return;const i=c=>{const E=c.target;s.current?.contains(E)||a&&a.contains(E)||n()};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[e,a,n]),!e||!a?null:ze(React.createElement("div",{className:"elementor vx-popup ts-emoji-popup"},React.createElement("div",{className:"ts-popup-root elementor-element elementor-element-2168fda-wrap"},React.createElement("div",{ref:g,className:"ts-form elementor-element elementor-element-2168fda",style:v},React.createElement("div",{className:"ts-field-popup-container"},React.createElement("div",{ref:s,className:"ts-field-popup triggers-blur"},React.createElement("div",{className:"ts-popup-content-wrapper min-scroll"},React.createElement("div",{className:"ts-sticky-top uib b-bottom"},React.createElement("div",{className:"ts-input-icon flexify"},React.createElement(Vn,null),React.createElement("input",{ref:p,type:"text",value:t,onChange:i=>o(i.target.value),placeholder:"Search emojis",className:"autofocus"}))),React.createElement("div",{className:"ts-emoji-list"},t.trim()?React.createElement("div",{className:"ts-form-group"},React.createElement("label",null,y.length>0?"Search results":"No emojis found"),React.createElement("ul",{className:"flexify simplify-ul"},y.map((i,c)=>React.createElement("li",{key:`search-${c}`},React.createElement("span",{onClick:()=>u(i.emoji)},i.emoji))))):React.createElement(React.Fragment,null,m.length>0&&React.createElement("div",{className:"ts-form-group"},React.createElement("label",null,"Recently used"),React.createElement("ul",{className:"flexify simplify-ul"},m.map((i,c)=>React.createElement("li",{key:`recent-${c}`},React.createElement("span",{onClick:()=>u(i)},i))))),Object.entries(Ae).map(([i,c])=>React.createElement("div",{key:i,className:"ts-form-group"},React.createElement("label",{className:"hidden"},In[i]||i),React.createElement("ul",{className:"flexify simplify-ul"},c.map((E,R)=>React.createElement("li",{key:`${i}-${R}`},React.createElement("span",{onClick:()=>u(E.emoji)},E.emoji))))))))),React.createElement("template",null)))))),document.body)}function Hn({config:e,value:n,onChange:l,className:a=""}){const[r,t]=S(n);q(()=>{t(n)},[n]);const o=h((s,v)=>{t(_=>{const y={..._};return _[s]===v?delete y[s]:y[s]=v,l(y),y})},[l]),m=h((s,v)=>r[s]===v,[r]),f=h((s,v)=>{const _=r[s];return typeof _=="number"&&_>=v},[r]),p=h(s=>{const v=r[s];if(typeof v!="number")return null;const _=v+2;return _>=0&&_<e.rating_levels.length?e.rating_levels[_]:null},[r,e.rating_levels]),g=e.categories||[];return React.createElement("div",{className:`rev-score-input ${a}`},g.map(s=>{const v=p(s.key);return React.createElement("div",{key:s.key,className:"rev-category",style:v?{"--ts-accent-1":v.color}:void 0},React.createElement("div",{className:"rev-category-label"},React.createElement("span",null,s.label),v&&React.createElement("span",{className:"rev-active-label"},v.label)),e.input_mode==="stars"?React.createElement("ul",{className:"rev-star-input flexify simplify-ul"},e.rating_levels.map((_,y)=>{const u=y-2,d=f(s.key,u),i=m(s.key,u);return React.createElement("li",{key:_.score,className:`${d?"active":""} ${i?"selected":""}`,onClick:()=>o(s.key,u)},React.createElement("span",{dangerouslySetInnerHTML:{__html:d?e.active_icon??e.default_icon??"":e.default_icon??""}}))})):React.createElement("ul",{className:"rev-num-input flexify simplify-ul"},e.rating_levels.map((_,y)=>{const u=y-2,d=m(s.key,u);return React.createElement("li",{key:_.score,className:d?"active":"",onClick:()=>o(s.key,u),style:d?{"--ts-accent-1":_.color}:void 0},React.createElement("span",null,_.label))})))}))}const Tn=()=>React.createElement("svg",{width:"80",height:"80",viewBox:"0 0 25 24",xmlns:"http://www.w3.org/2000/svg",transform:"rotate(0 0 0)"},React.createElement("path",{d:"M8.25016 10.5C7.5598 10.5 7.00016 11.0596 7.00016 11.75C7.00016 12.4404 7.5598 13 8.25016 13H8.26016C8.95051 13 9.51016 12.4404 9.51016 11.75C9.51016 11.0596 8.95051 10.5 8.26016 10.5H8.25016Z",fill:"currentColor"}),React.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.75016 5.5C7.75016 4.25736 8.75751 3.25 10.0002 3.25H19.0002C20.2428 3.25 21.2502 4.25736 21.2502 5.5V14.5C21.2502 15.7426 20.2428 16.75 19.0002 16.75H17.2502V18.5C17.2502 19.7426 16.2428 20.75 15.0002 20.75H6.00016C4.75751 20.75 3.75016 19.7426 3.75016 18.5V17.6916C3.74995 17.6814 3.74995 17.6712 3.75016 17.6611V9.5C3.75016 8.25736 4.75751 7.25 6.00016 7.25H7.75016V5.5ZM15.7502 9.5V15.9558L13.4851 13.8525C12.789 13.206 11.7619 13.0665 10.9186 13.5037L5.25016 16.4421L5.25016 9.5C5.25016 9.08579 5.58594 8.75 6.00016 8.75H15.0002C15.4144 8.75 15.7502 9.08579 15.7502 9.5ZM5.25016 18.5V18.1317L11.6089 14.8354C11.89 14.6896 12.2324 14.7362 12.4644 14.9516L15.7502 18.0028V18.5C15.7502 18.9142 15.4144 19.25 15.0002 19.25H6.00016C5.58594 19.25 5.25016 18.9142 5.25016 18.5ZM9.25016 7.25H15.0002C16.2428 7.25 17.2502 8.25736 17.2502 9.5V15.25H19.0002C19.4144 15.25 19.7502 14.9142 19.7502 14.5V5.5C19.7502 5.08579 19.4144 4.75 19.0002 4.75H10.0002C9.58594 4.75 9.25016 5.08579 9.25016 5.5V7.25Z",fill:"currentColor"})),An=()=>React.createElement("svg",{viewBox:"0 0 25 24",xmlns:"http://www.w3.org/2000/svg",transform:"rotate(0 0 0)"},React.createElement("path",{d:"M6.80747 9.56843C6.80747 6.46718 9.32153 3.95312 12.4228 3.95312C15.524 3.95312 18.0381 6.46718 18.0381 9.56843V9.87773H18.098C20.9007 9.87773 23.1727 12.1498 23.1727 14.9524C23.1727 17.7551 20.9007 20.0272 18.098 20.0272H14.2524C14.5162 19.6585 14.6715 19.2069 14.6715 18.719V18.5272H18.098C20.0723 18.5272 21.6727 16.9267 21.6727 14.9524C21.6727 12.9782 20.0723 11.3777 18.098 11.3777H17.2881C16.8739 11.3777 16.5381 11.0419 16.5381 10.6277V9.56843C16.5381 7.29561 14.6956 5.45312 12.4228 5.45312C10.15 5.45312 8.30747 7.29561 8.30747 9.56843L8.30747 10.6277C8.30747 11.0419 7.97169 11.3777 7.55747 11.3777H6.74659C4.77233 11.3777 3.17188 12.9782 3.17188 14.9524C3.17188 16.9267 4.77233 18.5272 6.74659 18.5272H10.1715V18.719C10.1715 19.2069 10.3268 19.6585 10.5906 20.0272H6.74659C3.94391 20.0272 1.67188 17.7551 1.67188 14.9524C1.67188 12.1498 3.9439 9.87773 6.74659 9.87773H6.80747V9.56843Z",fill:"currentColor"}),React.createElement("path",{d:"M12.4246 11.0874C12.2107 11.0874 12.0178 11.1768 11.8812 11.3204L9.24138 13.9585C8.94839 14.2513 8.94824 14.7262 9.24104 15.0192C9.53384 15.3122 10.0087 15.3123 10.3017 15.0195L11.6746 13.6475V18.718C11.6746 19.1322 12.0104 19.468 12.4246 19.468C12.8388 19.468 13.1746 19.1322 13.1746 18.718V13.6499L14.5452 15.0196C14.8382 15.3124 15.3131 15.3122 15.6059 15.0192C15.8987 14.7262 15.8985 14.2513 15.6055 13.9585L12.9916 11.3465C12.8541 11.1878 12.6511 11.0874 12.4246 11.0874Z",fill:"currentColor"})),$n=()=>React.createElement("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",transform:"rotate(0 0 0)"},React.createElement("path",{d:"M12 2C6.49 2 2 6.49 2 12C2 17.51 6.49 22 12 22C17.51 22 22 17.51 22 12C22 6.49 17.51 2 12 2ZM12 20.5C7.31 20.5 3.5 16.69 3.5 12C3.5 7.31 7.31 3.5 12 3.5C16.69 3.5 20.5 7.31 20.5 12C20.5 16.69 16.69 20.5 12 20.5Z",fill:"currentColor"}),React.createElement("path",{d:"M17.6 13.19C17.37 13.04 17.07 13.02 16.83 13.15C16.81 13.16 14.56 14.35 12 14.35C9.44 14.35 7.19 13.16 7.17 13.15C6.93 13.02 6.63 13.03 6.4 13.19C6.17 13.34 6.04 13.61 6.07 13.89C6.3 16.26 8.46 18.78 12 18.78C15.54 18.78 17.69 16.26 17.93 13.89C17.96 13.61 17.83 13.35 17.6 13.19ZM12 17.27C10.07 17.27 8.7 16.31 8.02 15.13C9.04 15.48 10.45 15.85 12 15.85C13.55 15.85 14.96 15.49 15.98 15.13C15.3 16.31 13.93 17.27 12 17.27Z",fill:"currentColor"}),React.createElement("path",{d:"M7.33 10.14C7.36 10.22 7.4 10.29 7.44 10.36C7.49 10.43 7.54 10.49 7.6 10.55C7.65 10.61 7.72 10.66 7.79 10.7C7.85 10.75 7.93 10.79 8 10.82C8.08 10.85 8.16 10.87 8.24 10.89C8.32 10.91 8.4 10.92 8.48 10.92C8.56 10.92 8.64 10.92 8.72 10.89C8.8 10.86 8.88 10.85 8.96 10.82C9.03 10.79 9.11 10.75 9.17 10.7C9.24 10.66 9.31 10.61 9.36 10.55C9.6 10.32 9.73 9.99 9.73 9.67C9.73 9.35 9.6 9.01 9.36 8.78C9.31 8.72 9.24 8.67 9.17 8.63C9.11 8.58 9.03 8.54 8.96 8.51C8.88 8.48 8.8 8.46 8.72 8.44C8.56 8.41 8.4 8.41 8.24 8.44C8.16 8.46 8.08 8.48 8 8.51C7.93 8.54 7.85 8.58 7.79 8.63C7.72 8.67 7.65 8.72 7.6 8.78C7.36 9.01 7.23 9.33 7.23 9.67C7.23 9.75 7.23 9.83 7.26 9.91C7.27 9.99 7.29 10.07 7.33 10.14Z",fill:"currentColor"}),React.createElement("path",{d:"M12.99 11.02C13.38 11.16 13.8 10.95 13.94 10.56C13.97 10.48 14.25 9.76 14.97 9.76C15.69 9.76 15.97 10.48 16 10.55C16.1 10.86 16.4 11.06 16.71 11.06C16.79 11.06 16.87 11.05 16.95 11.02C17.34 10.89 17.55 10.46 17.42 10.07C17.19 9.4 16.42 8.25 14.97 8.25C13.52 8.25 12.75 9.39 12.52 10.07C12.39 10.46 12.6 10.88 12.99 11.01V11.02Z",fill:"currentColor"})),$e=()=>React.createElement("svg",{width:"80",height:"80",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",transform:"rotate(0 0 0)"},React.createElement("path",{d:"M10 9.75C10.4142 9.75 10.75 10.0858 10.75 10.5V16.5C10.75 16.9142 10.4142 17.25 10 17.25C9.58579 17.25 9.25 16.9142 9.25 16.5V10.5C9.25 10.0858 9.58579 9.75 10 9.75Z",fill:"currentColor"}),React.createElement("path",{d:"M14.75 10.5C14.75 10.0858 14.4142 9.75 14 9.75C13.5858 9.75 13.25 10.0858 13.25 10.5V16.5C13.25 16.9142 13.5858 17.25 14 17.25C14.4142 17.25 14.75 16.9142 14.75 16.5V10.5Z",fill:"currentColor"}),React.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.99951 4.25C7.99951 3.00736 9.00687 2 10.2495 2H13.7495C14.9922 2 15.9995 3.00736 15.9995 4.25V5H19.999C20.4132 5 20.749 5.33579 20.749 5.75C20.749 6.16421 20.4132 6.5 19.999 6.5H19.5V19.75C19.5 20.9926 18.4926 22 17.25 22H6.75C5.50736 22 4.5 20.9926 4.5 19.75V6.5H4C3.58579 6.5 3.25 6.16421 3.25 5.75C3.25 5.33579 3.58579 5 4 5H7.99951V4.25ZM18 6.5H6V19.75C6 20.1642 6.33579 20.5 6.75 20.5H17.25C17.6642 20.5 18 20.1642 18 19.75V6.5ZM9.49951 5H14.4995V4.25C14.4995 3.83579 14.1637 3.5 13.7495 3.5H10.2495C9.8353 3.5 9.49951 3.83579 9.49951 4.25V5Z",fill:"currentColor"})),De=()=>React.createElement("svg",{viewBox:"0 0 25 24",xmlns:"http://www.w3.org/2000/svg",transform:"rotate(0 0 0)"},React.createElement("path",{d:"M6.80747 9.56843C6.80747 6.46718 9.32153 3.95312 12.4228 3.95312C15.524 3.95312 18.0381 6.46718 18.0381 9.56843V9.87773H18.098C20.9007 9.87773 23.1727 12.1498 23.1727 14.9524C23.1727 17.7551 20.9007 20.0272 18.098 20.0272H14.2524C14.5162 19.6585 14.6715 19.2069 14.6715 18.719V18.5272H18.098C20.0723 18.5272 21.6727 16.9267 21.6727 14.9524C21.6727 12.9782 20.0723 11.3777 18.098 11.3777H17.2881C16.8739 11.3777 16.5381 11.0419 16.5381 10.6277V9.56843C16.5381 7.29561 14.6956 5.45312 12.4228 5.45312C10.15 5.45312 8.30747 7.29561 8.30747 9.56843L8.30747 10.6277C8.30747 11.0419 7.97169 11.3777 7.55747 11.3777H6.74659C4.77233 11.3777 3.17188 12.9782 3.17188 14.9524C3.17188 16.9267 4.77233 18.5272 6.74659 18.5272H10.1715V18.719C10.1715 19.2069 10.3268 19.6585 10.5906 20.0272H6.74659C3.94391 20.0272 1.67188 17.7551 1.67188 14.9524C1.67188 12.1498 3.9439 9.87773 6.74659 9.87773H6.80747V9.56843Z",fill:"currentColor"}),React.createElement("path",{d:"M12.4246 11.0874C12.2107 11.0874 12.0178 11.1768 11.8812 11.3204L9.24138 13.9585C8.94839 14.2513 8.94824 14.7262 9.24104 15.0192C9.53384 15.3122 10.0087 15.3123 10.3017 15.0195L11.6746 13.6475V18.718C11.6746 19.1322 12.0104 19.468 12.4246 19.468C12.8388 19.468 13.1746 19.1322 13.1746 18.718V13.6499L14.5452 15.0196C14.8382 15.3124 15.3131 15.3122 15.6059 15.0192C15.8987 14.7262 15.8985 14.2513 15.6055 13.9585L12.9916 11.3465C12.8541 11.1878 12.6511 11.0874 12.4246 11.0874Z",fill:"currentColor"}));function at({feed:e="user_timeline",postId:n,placeholder:l,onStatusCreated:a,className:r="",status:t,onCancel:o,onUpdate:m}){const{config:f}=ue(),p=Cn(),g=ve(),s=!!t,v=s?t?.current_user.can_edit:!0,_=s?!0:p.can_post,[y,u]=S(s),[d,i]=S(t?.content??""),[c,E]=S(!1),[R,x]=S(null),[j,I]=S(t?.files??[]),[C,N]=S(t?.review?.rating??{}),[L,H]=S(!1),[D,B]=S(!1),[U,F]=S({url:null,loading:!1,data:null}),Y=T(null),{uploads:J,completedFiles:$,isUploading:ie,addFiles:P,removeFile:ce,clearAll:se,uploadAll:me}=Ke({maxFiles:f?.upload_config.max_files??5,maxFileSize:f?.upload_config.max_file_size??2*1024*1024,allowedTypes:f?.upload_config.allowed_types??["image/jpeg","image/png","image/gif","image/webp"]});q(()=>{s&&t&&(i(t.content),I(t.files??[]),N(t.review?.rating??{}),u(!0))},[s,t]);const k=re(()=>/(https?:\/\/[^\s]+)/g,[]);q(()=>{if(s)return;const M=setTimeout(()=>{const V=d.match(k);if(V&&V[0]!==U.url){const z=V[0];F(te=>({...te,url:z,loading:!0})),Y.current?.abort();const X=new AbortController;Y.current=X;const ee=f?.nonces?.status_publish??"";pn(z,ee,X.signal).then(te=>{X.signal.aborted||F({url:z,loading:!1,data:te})}).catch(()=>{X.signal.aborted||F({url:z,loading:!1,data:null})})}else!V&&U.url&&F({url:null,loading:!1,data:null})},500);return()=>{clearTimeout(M)}},[d,k,U.url,s,f?.nonces?.status_publish]),q(()=>()=>{Y.current?.abort()},[]);const w=T(null),A=T(null),O=T(null),W=T(null),K=tt(d),de=f?.character_limits.status_max??5e3,we=K>de,G=s?t?.current_user.can_edit:p.can_post,_e=d.trim().length>0||j.length>0||$.length>0,b=G&&_e&&!we&&!c&&!ie,Ce=h(()=>{u(!0)},[]),xe=h(M=>{i(M.target.value),x(null);const V=M.target;V.style.height="auto",V.style.height=`${V.scrollHeight}px`},[]),ct=h(M=>{const V=M.target.files;V&&V.length>0&&P(V),M.target.value=""},[P]),mt=h(M=>{if(M.preventDefault(),s&&o){o();return}i(""),se(),I([]),u(!1),x(null),w.current&&(w.current.style.height="auto",w.current.blur())},[s,o,se]),ke=h(async M=>{if(M?.preventDefault(),!!b){E(!0),x(null);try{let V=[];J.some(ee=>ee.status==="pending")?V=(await me()).map(te=>te.id):V=$.map(ee=>ee.id);const X=[...j.map(ee=>ee.id),...V];if(s&&t){const ee=f?.nonces?.status_edit??"",te={status_id:t.id,content:d.trim(),files:X,rating:C},be=await Xt(te,ee);m?.(be)}else{const ee=f?.nonces?.status_publish??"";if(!ee)throw new Error("Configuration not loaded");const te={feed:e,content:d.trim(),files:X,rating:Object.keys(C).length>0?C:void 0};n&&(te.post_id=n),U.data&&U.url&&(te.link_preview=U.url);const be=await Gt(te,ee);i(""),se(),I([]),N({}),F({url:null,loading:!1,data:null}),u(!1),w.current&&(w.current.style.height="auto"),a?.(be)}}catch(V){x(V instanceof Error?V.message:g.error_generic)}finally{E(!1)}}},[b,d,e,n,J,$,j,me,se,s,t,f?.nonces?.status_edit,f?.nonces?.status_publish,a,m,g.error_generic,U,C]),dt=h(M=>{(M.metaKey||M.ctrlKey)&&M.key==="Enter"&&(M.preventDefault(),ke())},[ke]),ut=h(M=>{M.preventDefault(),A.current?.click()},[]),ft=h(M=>{const V=w.current;if(!V)return;const z=V.selectionStart,X=V.selectionEnd,ee=d.substring(0,z)+M+d.substring(X);i(ee),requestAnimationFrame(()=>{V.focus(),V.setSelectionRange(z+M.length,z+M.length)})},[d]),pt=h(M=>{M.preventDefault(),H(V=>!V)},[]),gt=h(M=>{I(V=>V.filter(z=>z.id!==M))},[]),Ve=re(()=>{const M=e==="post_reviews",V=s&&t?.feed==="post_reviews"&&t?.review;if(!M&&!V)return null;const z=f?.review_config;if(!z)return null;let X;return V&&t?.review?.post_type?X=t.review.post_type:X=f?.current_post?.post_type,!X||!z[X]?null:z[X]},[e,s,t,f?.review_config,f?.current_post]),pe=f?.current_user,ht=re(()=>{const M=g.compose_placeholder??"What's on your mind?";let V=l??M;return V==="What's on your mind?"&&pe?.display_name&&(V=`What's on your mind, ${pe.display_name}?`),V},[l,g.compose_placeholder,pe?.display_name]);if(s&&!v||!s&&!_||!pe)return null;const vt=pe.avatar_url??"",Ct=pe.display_name??"";return React.createElement("div",{style:{minHeight:"61px"}},React.createElement("div",{ref:W,className:`vxf-create-post flexify ${y?"vxf-expanded":""} ${r}`},pe&&React.createElement("div",{className:"vxf-avatar flexify"},React.createElement("img",{src:vt,alt:Ct})),React.createElement("div",{className:"vxf-create-post__content"},React.createElement("div",{className:"vxf-content__highlighter"}),React.createElement("textarea",{ref:w,className:"vxf-content__textarea",value:d,onChange:xe,onFocus:Ce,onKeyDown:dt,placeholder:ht,maxLength:de,disabled:c})),y&&React.createElement("div",{className:"vxf-footer-wrapper",style:{height:"auto"}},Ve&&React.createElement("div",{className:"vxf-review-score-section"},React.createElement(Hn,{config:Ve,value:C,onChange:N})),(J.length>0||$.length>0||j.length>0)&&React.createElement("div",{className:"ts-form-group ts-file-upload vxf-create-section"},React.createElement("div",{className:"ts-file-list"},j.map(M=>{const V=M.url?.match(/\.(jpg|jpeg|png|gif|webp)$/i);return React.createElement("div",{key:`existing-${M.id}`,className:`ts-file ${V?"ts-file-img":""}`,style:V?{backgroundImage:`url(${M.preview||M.url})`}:{}},React.createElement("div",{className:"ts-file-info"},React.createElement(De,null),React.createElement("code",null,M.alt||"File")),React.createElement("a",{href:"#",className:"ts-remove-file flexify",onClick:z=>{z.preventDefault(),gt(M.id)}},React.createElement($e,null)))}),J.map(M=>{const V=M.file.type.startsWith("image/"),z=V?URL.createObjectURL(M.file):"";return React.createElement("div",{key:M.id,className:`ts-file ${V?"ts-file-img":""}`,style:V?{backgroundImage:`url(${z})`}:{}},React.createElement("div",{className:"ts-file-info"},React.createElement(De,null),React.createElement("code",null,M.file.name)),React.createElement("a",{href:"#",className:"ts-remove-file flexify",onClick:X=>{X.preventDefault(),ce(M.id)}},React.createElement($e,null)),M.status==="uploading"&&React.createElement("div",{className:"vxf-file-progress",style:{width:`${M.progress}%`}}))}))),React.createElement("div",{className:"vxf-footer flexify"},React.createElement("div",{className:"vxf-actions flexify"},p.can_upload&&f?.features.file_upload&&React.createElement(React.Fragment,null,React.createElement(We,{multiple:!0,saveLabel:"Insert",target:W.current,onSave:M=>{const V=M.map(z=>({id:z.id,url:z.preview||"",preview:z.preview||"",alt:z.name}));I(z=>{const X=new Set(z.map(te=>te.id)),ee=V.filter(te=>!X.has(te.id));return[...z,...ee]}),console.log("[StatusComposer] Media added:",V)}},React.createElement("a",{href:"#",onClick:M=>M.preventDefault(),className:"vxf-icon vxf-media-target"},React.createElement(Tn,null))),React.createElement("a",{href:"#",onClick:ut,className:"vxf-icon"},React.createElement(An,null))),React.createElement("a",{href:"#",ref:O,className:"vxf-icon vxf-emoji-picker",onClick:pt},React.createElement($n,null)),React.createElement(Pe,{isOpen:L,onClose:()=>H(!1),onSelect:ft,target:O.current,widthElement:W.current})),React.createElement("div",{className:"vxf-buttons flexify"},React.createElement("a",{href:"#",onClick:mt,className:"ts-btn ts-btn-1"},g.cancel??"Cancel"),React.createElement("a",{href:"#",onClick:ke,className:`ts-btn ts-btn-2 ${c?"vx-pending":""}`},c?React.createElement("div",{className:"ts-loader-wrapper"},React.createElement("span",{className:"ts-loader"})):s?g.update??"Update":g.compose_submit??"Publish")))),p.can_upload&&f?.features.file_upload&&React.createElement("input",{ref:A,type:"file",accept:f.upload_config.allowed_types.join(","),multiple:!0,onChange:ct,style:{display:"none"},"aria-hidden":"true"})),R&&React.createElement("div",{className:"vxf-create-post__error ts-form-error"},R))}function rt(e,n,l,a,r){const t=`${e.type}-${n}`;switch(e.type){case"text":return React.createElement(Ne,{key:t},e.content.split(`
`).map((g,s,v)=>React.createElement(Ne,{key:s},g,s<v.length-1&&React.createElement("br",null))));case"mention":const o=e.metadata?.userId?`${l}?user_id=${e.metadata.userId}`:`${l}?username=${encodeURIComponent(e.content)}`;return React.createElement("a",{key:t,href:o,className:"vxf-mention","data-user-id":e.metadata?.userId},"@",e.content);case"hashtag":const m=`${a}?search=${encodeURIComponent("#"+e.content)}`;return React.createElement("a",{key:t,href:m,className:"vxf-hashtag"},"#",e.content);case"link":const f=e.content.replace(/^https?:\/\//,"").replace(/\/$/,""),p=f.length>40?f.slice(0,37)+"...":f;return React.createElement("a",{key:t,href:e.metadata?.url||e.content,className:"vxf-link",target:r,rel:r==="_blank"?"noopener noreferrer":void 0},p);case"code":return e.content.includes(`
`)?React.createElement("pre",{key:t,className:"vxf-code-block"},React.createElement("code",null,e.content)):React.createElement("code",{key:t,className:"vxf-code-inline"},e.content);case"bold":return React.createElement("strong",{key:t,className:"vxf-bold"},e.content);case"italic":return React.createElement("em",{key:t,className:"vxf-italic"},e.content);case"strikethrough":return React.createElement("del",{key:t,className:"vxf-strikethrough"},e.content);default:return React.createElement(Ne,{key:t},e.content)}}function ot({content:e,maxLength:n,onToggleExpand:l,isExpanded:a=!0,mentionBaseUrl:r="/members/",hashtagBaseUrl:t="/search/",className:o="",linkTarget:m="_blank"}){const{displayContent:f,isTruncated:p}=re(()=>{if(!n||a||e.length<=n)return{displayContent:e,isTruncated:!1};const s=Ln(e,n,!0);return{displayContent:s.text,isTruncated:s.isTruncated}},[e,n,a]),g=re(()=>et(f),[f]);return React.createElement("div",{className:`vxf-content ${o}`},g.map((s,v)=>rt(s,v,r,t,m)),p&&!a&&l&&React.createElement("button",{type:"button",className:"vxf-content-toggle vxf-content-toggle--more",onClick:l},"Read more"),a&&n&&e.length>n&&l&&React.createElement("button",{type:"button",className:"vxf-content-toggle vxf-content-toggle--less",onClick:l},"Show less"))}function Dn({content:e,className:n=""}){const l=re(()=>et(e),[e]);return React.createElement("span",{className:n},l.map((a,r)=>rt(a,r,"/members/","/search/","_blank")))}const On="modulepreload",Bn=function(e){return"/"+e},Oe={},Un=function(n,l,a){let r=Promise.resolve();if(l&&l.length>0){let f=function(p){return Promise.all(p.map(g=>Promise.resolve(g).then(s=>({status:"fulfilled",value:s}),s=>({status:"rejected",reason:s}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),m=o?.nonce||o?.getAttribute("nonce");r=f(l.map(p=>{if(p=Bn(p),p in Oe)return;Oe[p]=!0;const g=p.endsWith(".css"),s=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${s}`))return;const v=document.createElement("link");if(v.rel=g?"stylesheet":On,g||(v.as="script"),v.crossOrigin="",v.href=p,m&&v.setAttribute("nonce",m),document.head.appendChild(v),g)return new Promise((_,y)=>{v.addEventListener("load",_),v.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${p}`)))})}))}function t(o){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=o,window.dispatchEvent(m),!m.defaultPrevented)throw o}return r.then(o=>{for(const m of o||[])m.status==="rejected"&&t(m.reason);return n().catch(t)})},Zn=_t(()=>Un(()=>import("../VoxelLightbox-n8iTWunW.js"),__vite__mapDeps([0,1])).then(e=>({default:e.VoxelLightbox})));function lt({files:e,galleryIcon:n,statusId:l,className:a=""}){const[r,t]=S(!1),[o,m]=S(0),f=re(()=>e.map(s=>({src:s.url,alt:s.alt||""})),[e]),p=h((s,v)=>{s.preventDefault(),m(v),t(!0)},[]);if(e.length===0)return null;const g=l&&e.length>1?`vxtl_${l}`:null;return React.createElement(React.Fragment,null,React.createElement("ul",{className:`vxf-gallery simplify-ul ${a}`},e.map((s,v)=>React.createElement("li",{key:s.id||v},React.createElement("a",{href:s.url,"data-elementor-open-lightbox":"yes","data-elementor-lightbox-slideshow":g,onClick:_=>p(_,v)},React.createElement("img",{src:s.preview||s.url,alt:s.alt||"",loading:"lazy"}))))),r&&React.createElement(xt,{fallback:null},React.createElement(Zn,{open:r,close:()=>t(!1),slides:f,index:o})))}function qn({preview:e,externalIcon:n,className:l=""}){const{config:a}=fe();return e.type==="youtube"&&e.embed_url&&e.video_id?React.createElement("div",{className:`vxf-youtube-embed ${l}`},React.createElement("iframe",{src:`${e.embed_url}?rel=0&modestbranding=1&showinfo=0&controls=1&disablekb=1&iv_load_policy=3&fs=1&autoplay=0&mute=0&loop=0&playlist=${e.video_id}`,frameBorder:0,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,loading:"lazy",className:"vxf-youtube-iframe"})):React.createElement("a",{href:e.url,target:"_blank",rel:"noopener noreferrer nofollow",className:`vxf-link flexify ${l}`},e.image&&React.createElement("img",{src:e.image,alt:"",loading:"lazy"}),React.createElement("div",{className:"vxf-link-details flexify"},React.createElement("b",null,e.title),React.createElement("span",{className:"vxf-icon vxf-link-source"},e.domain,React.createElement("span",{dangerouslySetInnerHTML:{__html:a?.icons?.["external-link"]??""}}))))}function zn({status:e,truncateAt:n=140,className:l=""}){const{config:a}=fe(),r=e.publisher,t=re(()=>{const s=[];return r?.username&&s.push(`@${r.username}`),e.post?.title&&s.push(e.post.title),e.created_at&&s.push(e.created_at),s.join(" Â· ")},[r?.username,e.post?.title,e.created_at]),o=re(()=>e.content?Mn(e.content,n):"",[e.content,n]);if(!r||e.private)return React.createElement("div",{className:`vxf-post vxf__quoted-post vx-inert ${l}`},React.createElement("div",{className:"vxf-body-text",style:{opacity:.5}},e.private?"This post has restricted visibility.":"This post is unavailable."));const m=r.avatar_url??"",f=r.display_name??"",p=r.link??"#",g=e.link??"#";return React.createElement("a",{href:g,className:l},React.createElement("div",{className:"vxf-post vxf__quoted-post"},React.createElement("div",{className:"vxf-head flexify"},React.createElement("a",{href:p,className:"vxf-avatar flexify"},React.createElement("img",{src:m,alt:f})),React.createElement("div",{className:"vxf-user flexify"},React.createElement("a",{href:p},f,r.is_verified&&React.createElement("div",{className:"vxf-icon vxf-verified",dangerouslySetInnerHTML:{__html:a?.icons?.verified??""}})),React.createElement("span",null,t))),React.createElement("div",{className:"vxf-body"},e.review&&e.review.level&&React.createElement("div",{className:"rev-score",style:{"--ts-accent-1":e.review.level.color}},React.createElement("div",{className:"rev-num-score flexify"},e.review.formatted_score),React.createElement("span",null,e.review.level.label)),e.content&&React.createElement("div",{className:"vxf-body-text"},React.createElement(Dn,{content:o})),e.files&&e.files.length>0&&React.createElement("ul",{className:"vxf-gallery simplify-ul"},e.files.map((s,v)=>React.createElement("li",{key:s.id||v},React.createElement("a",{href:s.url},React.createElement("img",{src:s.preview||s.url,alt:s.alt||""}))))))))}function Re({target:e,onBlur:n,children:l,className:a=""}){const r=T(null),t=T(null),[o,m]=S({}),f=h(()=>{if(!r.current||!t.current||!e)return;const p=document.body.clientWidth,g=e.getBoundingClientRect(),s=t.current,v=e.offsetWidth,_={left:g.left+window.scrollX,top:g.top+window.scrollY},y=s.getBoundingClientRect(),u=window.getComputedStyle(s),d=parseFloat(u.minWidth)||180,i=Math.max(g.width,d),c=_.left+v/2,E=p/2;let R;c>E+1?R=_.left-i+v:R=_.left,R<10&&(R=10),R+i>p-10&&(R=p-i-10);let x=_.top+g.height;const j=window.innerHeight,I=y.height,C=g.bottom+I>j,N=g.top-I>=0;C&&N&&(x=_.top-I),m({position:"absolute",top:`${x}px`,left:`${R}px`,width:`${i}px`})},[e]);return q(()=>{const p=s=>{const v=s.target;t.current?.contains(v)||e?.contains(v)||n()},g=requestAnimationFrame(()=>{document.addEventListener("mousedown",p)});return()=>{cancelAnimationFrame(g),document.removeEventListener("mousedown",p)}},[e,n]),q(()=>{const p=g=>{g.key==="Escape"&&n()};return document.addEventListener("keydown",p),()=>document.removeEventListener("keydown",p)},[n]),kt(()=>{f()},[f]),q(()=>{const p=()=>f(),g=()=>f();window.addEventListener("scroll",p,!0),window.addEventListener("resize",g,!0);let s=null;return t.current&&(s=new ResizeObserver(()=>f()),s.observe(t.current)),()=>{window.removeEventListener("scroll",p,!0),window.removeEventListener("resize",g,!0),s?.disconnect()}},[f]),e?ze(React.createElement("div",{className:`elementor vx-popup xs-width ${a}`},React.createElement("div",{className:"ts-popup-root elementor-element"},React.createElement("div",{ref:r,className:"ts-form elementor-element",style:o},React.createElement("div",{className:"ts-field-popup-container"},React.createElement("div",{className:"ts-field-popup triggers-blur",ref:t},React.createElement("div",{className:"ts-popup-content-wrapper min-scroll"},React.createElement("div",{className:"ts-term-dropdown ts-md-group"},React.createElement("ul",{className:"simplify-ul ts-term-dropdown-list min-scroll"},l)))))))),document.body):null}const Wn=()=>React.createElement("svg",{width:"80",height:"80",viewBox:"0 0 25 24",xmlns:"http://www.w3.org/2000/svg",transform:"rotate(0 0 0)"},React.createElement("path",{d:"M8.25016 10.5C7.5598 10.5 7.00016 11.0596 7.00016 11.75C7.00016 12.4404 7.5598 13 8.25016 13H8.26016C8.95051 13 9.51016 12.4404 9.51016 11.75C9.51016 11.0596 8.95051 10.5 8.26016 10.5H8.25016Z",fill:"currentColor"}),React.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.75016 5.5C7.75016 4.25736 8.75751 3.25 10.0002 3.25H19.0002C20.2428 3.25 21.2502 4.25736 21.2502 5.5V14.5C21.2502 15.7426 20.2428 16.75 19.0002 16.75H17.2502V18.5C17.2502 19.7426 16.2428 20.75 15.0002 20.75H6.00016C4.75751 20.75 3.75016 19.7426 3.75016 18.5V17.6916C3.74995 17.6814 3.74995 17.6712 3.75016 17.6611V9.5C3.75016 8.25736 4.75751 7.25 6.00016 7.25H7.75016V5.5ZM15.7502 9.5V15.9558L13.4851 13.8525C12.789 13.206 11.7619 13.0665 10.9186 13.5037L5.25016 16.4421L5.25016 9.5C5.25016 9.08579 5.58594 8.75 6.00016 8.75H15.0002C15.4144 8.75 15.7502 9.08579 15.7502 9.5ZM5.25016 18.5V18.1317L11.6089 14.8354C11.89 14.6896 12.2324 14.7362 12.4644 14.9516L15.7502 18.0028V18.5C15.7502 18.9142 15.4144 19.25 15.0002 19.25H6.00016C5.58594 19.25 5.25016 18.9142 5.25016 18.5ZM9.25016 7.25H15.0002C16.2428 7.25 17.2502 8.25736 17.2502 9.5V15.25H19.0002C19.4144 15.25 19.7502 14.9142 19.7502 14.5V5.5C19.7502 5.08579 19.4144 4.75 19.0002 4.75H10.0002C9.58594 4.75 9.25016 5.08579 9.25016 5.5V7.25Z",fill:"currentColor"})),Jn=()=>React.createElement("svg",{viewBox:"0 0 25 24",xmlns:"http://www.w3.org/2000/svg",transform:"rotate(0 0 0)"},React.createElement("path",{d:"M6.80747 9.56843C6.80747 6.46718 9.32153 3.95312 12.4228 3.95312C15.524 3.95312 18.0381 6.46718 18.0381 9.56843V9.87773H18.098C20.9007 9.87773 23.1727 12.1498 23.1727 14.9524C23.1727 17.7551 20.9007 20.0272 18.098 20.0272H14.2524C14.5162 19.6585 14.6715 19.2069 14.6715 18.719V18.5272H18.098C20.0723 18.5272 21.6727 16.9267 21.6727 14.9524C21.6727 12.9782 20.0723 11.3777 18.098 11.3777H17.2881C16.8739 11.3777 16.5381 11.0419 16.5381 10.6277V9.56843C16.5381 7.29561 14.6956 5.45312 12.4228 5.45312C10.15 5.45312 8.30747 7.29561 8.30747 9.56843L8.30747 10.6277C8.30747 11.0419 7.97169 11.3777 7.55747 11.3777H6.74659C4.77233 11.3777 3.17188 12.9782 3.17188 14.9524C3.17188 16.9267 4.77233 18.5272 6.74659 18.5272H10.1715V18.719C10.1715 19.2069 10.3268 19.6585 10.5906 20.0272H6.74659C3.94391 20.0272 1.67188 17.7551 1.67188 14.9524C1.67188 12.1498 3.9439 9.87773 6.74659 9.87773H6.80747V9.56843Z",fill:"currentColor"}),React.createElement("path",{d:"M12.4246 11.0874C12.2107 11.0874 12.0178 11.1768 11.8812 11.3204L9.24138 13.9585C8.94839 14.2513 8.94824 14.7262 9.24104 15.0192C9.53384 15.3122 10.0087 15.3123 10.3017 15.0195L11.6746 13.6475V18.718C11.6746 19.1322 12.0104 19.468 12.4246 19.468C12.8388 19.468 13.1746 19.1322 13.1746 18.718V13.6499L14.5452 15.0196C14.8382 15.3124 15.3131 15.3122 15.6059 15.0192C15.8987 14.7262 15.8985 14.2513 15.6055 13.9585L12.9916 11.3465C12.8541 11.1878 12.6511 11.0874 12.4246 11.0874Z",fill:"currentColor"})),Gn=()=>React.createElement("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",transform:"rotate(0 0 0)"},React.createElement("path",{d:"M12 2C6.49 2 2 6.49 2 12C2 17.51 6.49 22 12 22C17.51 22 22 17.51 22 12C22 6.49 17.51 2 12 2ZM12 20.5C7.31 20.5 3.5 16.69 3.5 12C3.5 7.31 7.31 3.5 12 3.5C16.69 3.5 20.5 7.31 20.5 12C20.5 16.69 16.69 20.5 12 20.5Z",fill:"currentColor"}),React.createElement("path",{d:"M17.6 13.19C17.37 13.04 17.07 13.02 16.83 13.15C16.81 13.16 14.56 14.35 12 14.35C9.44 14.35 7.19 13.16 7.17 13.15C6.93 13.02 6.63 13.03 6.4 13.19C6.17 13.34 6.04 13.61 6.07 13.89C6.3 16.26 8.46 18.78 12 18.78C15.54 18.78 17.69 16.26 17.93 13.89C17.96 13.61 17.83 13.35 17.6 13.19ZM12 17.27C10.07 17.27 8.7 16.31 8.02 15.13C9.04 15.48 10.45 15.85 12 15.85C13.55 15.85 14.96 15.49 15.98 15.13C15.3 16.31 13.93 17.27 12 17.27Z",fill:"currentColor"}),React.createElement("path",{d:"M7.33 10.14C7.36 10.22 7.4 10.29 7.44 10.36C7.49 10.43 7.54 10.49 7.6 10.55C7.65 10.61 7.72 10.66 7.79 10.7C7.85 10.75 7.93 10.79 8 10.82C8.08 10.85 8.16 10.87 8.24 10.89C8.32 10.91 8.4 10.92 8.48 10.92C8.56 10.92 8.64 10.92 8.72 10.89C8.8 10.86 8.88 10.85 8.96 10.82C9.03 10.79 9.11 10.75 9.17 10.7C9.24 10.66 9.31 10.61 9.36 10.55C9.6 10.32 9.73 9.99 9.73 9.67C9.73 9.35 9.6 9.01 9.36 8.78C9.31 8.72 9.24 8.67 9.17 8.63C9.11 8.58 9.03 8.54 8.96 8.51C8.88 8.48 8.8 8.46 8.72 8.44C8.56 8.41 8.4 8.41 8.24 8.44C8.16 8.46 8.08 8.48 8 8.51C7.93 8.54 7.85 8.58 7.79 8.63C7.72 8.67 7.65 8.72 7.6 8.78C7.36 9.01 7.23 9.33 7.23 9.67C7.23 9.75 7.23 9.83 7.26 9.91C7.27 9.99 7.29 10.07 7.33 10.14Z",fill:"currentColor"}),React.createElement("path",{d:"M12.99 11.02C13.38 11.16 13.8 10.95 13.94 10.56C13.97 10.48 14.25 9.76 14.97 9.76C15.69 9.76 15.97 10.48 16 10.55C16.1 10.86 16.4 11.06 16.71 11.06C16.79 11.06 16.87 11.05 16.95 11.02C17.34 10.89 17.55 10.46 17.42 10.07C17.19 9.4 16.42 8.25 14.97 8.25C13.52 8.25 12.75 9.39 12.52 10.07C12.39 10.46 12.6 10.88 12.99 11.01V11.02Z",fill:"currentColor"}));function Ie({statusId:e,parentId:n,onCommentPublished:l,onCancel:a,placeholder:r,autoFocus:t=!1,comment:o,onCommentUpdated:m}){const f=he(),{config:p}=fe(),g=ve(),[s,v]=S(o?.content??""),[_,y]=S(t||!!o),[u,d]=S(!1),[i,c]=S(null),[E,R]=S(!1),[x,j]=S(o?.files??[]),[I,C]=S([]),[N,L]=S(!1),H=!!o,D=T(null),B=T(null),U=T(null),F=p?.strings??{},Y=h(w=>{v(w.target.value),c(null);const A=w.target;A.style.height="auto",A.style.height=`${A.scrollHeight}px`},[]),J=h(()=>{y(!0)},[]),$=h(()=>{H?(v(o?.content??""),j(o?.files??[])):(v(""),j([])),y(H),c(null),B.current&&(B.current.style.height="auto"),a&&a()},[a]),ie=h(w=>{(w.metaKey||w.ctrlKey)&&w.key==="Enter"&&s.trim()&&(w.preventDefault(),P()),w.key==="Escape"&&a&&(w.preventDefault(),$())},[s,a]),P=h(async()=>{const w=s.trim();if(!w){c(g.content_too_short??"Please enter some content");return}const A=p?.nonces?.comment_publish;if(!A){c("Configuration not loaded");return}d(!0),c(null);try{const O=x.map(W=>W.id);if(H&&o){const W={comment_id:o.id,content:w,files:O};console.log("[CommentComposer] Updating comment:",W);const K=await ln(W,A);console.log("[CommentComposer] Comment updated:",K),m&&m(K),a&&a()}else{const W={status_id:e,parent_id:n,content:w,files:O};console.log("[CommentComposer] Publishing comment:",W);const K=await on(W,A);console.log("[CommentComposer] Comment published:",K),v(""),j([]),y(!1),B.current&&(B.current.style.height="auto"),l&&l(K)}}catch(O){console.error("[CommentComposer] Failed to publish:",O),c(O instanceof Error?O.message:"Failed to publish comment")}finally{d(!1)}},[s,e,n,p?.nonces?.comment_publish,g,l,H,o,x,m,a]),ce=h(w=>{j(A=>A.filter(O=>O.id!==w))},[]),se=h(w=>{const A=B.current;if(!A)return;const O=A.selectionStart,W=A.selectionEnd,K=s.substring(0,O)+w+s.substring(W);v(K),requestAnimationFrame(()=>{A.focus(),A.setSelectionRange(O+w.length,O+w.length)})},[s]),me=h(w=>{w.preventDefault(),R(A=>!A)},[]);if(!f)return null;const k=["vxf-create-post","vxf-create-comment","flexify",_?"vxf-expanded":""].filter(Boolean).join(" ");return React.createElement("div",{ref:D,className:k},React.createElement("div",{className:"vxf-avatar flexify"},React.createElement("img",{src:f.avatar_url,alt:f.display_name})),React.createElement("div",{className:"vxf-create-post__content"},React.createElement("div",{className:"vxf-content__highlighter"}),React.createElement("textarea",{ref:B,className:"vxf-content__textarea",placeholder:r??F.post_reply??"Post a reply",value:s,onChange:Y,onFocus:J,onKeyDown:ie,disabled:u,autoFocus:t}),x.length>0&&React.createElement("div",{className:"vxf-composer-files"},x.map(w=>React.createElement("div",{key:w.id,className:"vxf-composer-file"},React.createElement("div",{className:"vxf-file-preview",style:{backgroundImage:`url(${w.preview||w.url})`}}),React.createElement("a",{href:"#",className:"vxf-remove-file",onClick:A=>{A.preventDefault(),ce(w.id)}},React.createElement("svg",{viewBox:"0 0 24 24"},React.createElement("path",{d:"M18.984 6.412l-1.408-1.412-5.576 5.576-5.576-5.576-1.412 1.412 5.576 5.576-5.576 5.576 1.412 1.412 5.576-5.576 5.576 5.576 1.408-1.412-5.576-5.576z",fill:"currentColor"}))))))),_&&React.createElement("div",{className:"vxf-footer-wrapper",style:{height:"auto"}},i&&React.createElement("div",{className:"vxf-error",style:{color:"var(--ts-shade-5)",padding:"0 10px 10px",fontSize:"13px"}},i),React.createElement("div",{className:"vxf-footer flexify"},React.createElement("div",{className:"vxf-actions flexify"},p?.features?.file_upload&&React.createElement(React.Fragment,null,React.createElement(We,{multiple:!0,saveLabel:"Insert",target:D.current,onSave:w=>{const A=w.map(O=>({id:O.id,url:O.preview||"",preview:O.preview||"",alt:O.name}));j(O=>{const W=new Set(O.map(de=>de.id)),K=A.filter(de=>!W.has(de.id));return[...O,...K]})}},React.createElement("a",{href:"#",onClick:w=>w.preventDefault(),className:"vxf-icon vxf-media-target"},React.createElement(Wn,null))),React.createElement("a",{href:"#",className:"vxf-icon",onClick:w=>{w.preventDefault(),console.log("[CommentComposer] Upload clicked - not yet implemented")}},React.createElement(Jn,null))),React.createElement("a",{href:"#",ref:U,className:"vxf-icon vxf-emoji-picker",onClick:me},React.createElement(Gn,null)),React.createElement(Pe,{isOpen:E,onClose:()=>R(!1),onSelect:se,target:U.current})),React.createElement("div",{className:"vxf-buttons flexify"},React.createElement("a",{href:"#",className:"ts-btn ts-btn-1",onClick:w=>{w.preventDefault(),$()}},F.cancel??"Cancel"),React.createElement("a",{href:"#",className:`ts-btn ts-btn-2 ${u?"vx-pending":""}`,onClick:w=>{w.preventDefault(),P()}},u?React.createElement("span",{className:"ts-loader"}):F.reply??(H?"Update":"Reply"))))))}const Xn=()=>React.createElement("div",{className:"ray-holder"},[...Array(8)].map((e,n)=>React.createElement("div",{key:n,className:"ray"})));function Qn({comment:e,status:n,depth:l,maxDepth:a=2,onCommentUpdate:r,onCommentDelete:t,onShowReplies:o,onReplyClick:m,showRepliesButton:f=!0}){const{config:p}=fe(),g=ve(),s=p?.strings??{},v=he(),_=T(null),[y,u]=S(!1),[d,i]=S(!1),[c,E]=S(!1),{actionState:R,optimisticComment:x,handleLike:j,handleDelete:I,handleApprove:C,handleMarkPending:N}=kn(e,r,t),L=re(()=>({...e,...x,likes:{...e.likes,...x.likes},current_user:{...e.current_user,...x.current_user}}),[e,x]),H=e.publisher;if(!H)return null;const D=H.avatar_url??"",B=H.display_name??"",U=H.username??"",F=H.link??"#",Y=e.created_at,J=L.current_user?.has_liked??!1,$=e.replies?.count>0,ie=l<a,P=h(k=>{k.preventDefault(),j()},[j]),ce=h(async()=>{const k=window.Voxel_Config?.l10n?.confirmAction??g.delete_comment_confirm??"Are you sure you want to proceed with this action?",w=window.Voxel_Config?.l10n?.yes??"Yes",A=window.Voxel_Config?.l10n?.no??"No";if(typeof window<"u"&&window.Voxel?.dialog)window.Voxel.dialog({message:k,type:"warning",actions:[{label:w,onClick:async()=>{u(!1),await I(),window.Voxel?.alert&&window.Voxel.alert("Deleted")}},{label:A,onClick:()=>{u(!1)}}],hideClose:!0,timeout:7500});else{if(!confirm(k))return;u(!1),await I()}},[I,g.delete_comment_confirm]),se=h(()=>{E(!0),u(!1)},[]),me=["vxf-post","vxf-comment",R.isDeleting?"vx-pending":""].filter(Boolean).join(" ");return React.createElement("div",{className:me},React.createElement("div",{className:"vxf-head flexify"},React.createElement("a",{href:F,className:"vxf-avatar flexify"},React.createElement("img",{src:D,alt:B})),React.createElement("div",{className:"vxf-user flexify"},React.createElement("a",{href:F},B,H.is_verified&&React.createElement("div",{className:"vxf-icon vxf-verified",dangerouslySetInnerHTML:{__html:p?.icons?.verified??""}})),React.createElement("span",null,U&&React.createElement("a",{href:F},"@",U),React.createElement("a",{href:e.link??"#",title:e.edited_at?s.editedOn?.replace("@date",e.edited_at):void 0},Y),e.badges?.map(k=>React.createElement("span",{key:k.key,"data-badge":k.key,className:"vxf-badge"},k.label)))),(L.current_user?.can_edit||L.current_user?.can_delete||L.current_user?.can_moderate)&&React.createElement(React.Fragment,null,React.createElement("a",{href:"#",className:"vxf-icon vxf-more",ref:_,onClick:k=>k.preventDefault(),onMouseDown:()=>u(k=>!k),dangerouslySetInnerHTML:{__html:p?.icons?.more??""}}),y&&React.createElement(Re,{target:_.current,onBlur:()=>u(!1)},L.current_user?.can_edit&&React.createElement("li",null,React.createElement("a",{href:"#",className:"flexify",onClick:k=>{k.preventDefault(),se()}},React.createElement("span",null,s.edit??"Edit"))),L.current_user?.can_moderate&&e.is_pending&&React.createElement("li",null,React.createElement("a",{href:"#",className:"flexify",onClick:async k=>{k.preventDefault(),await C(),u(!1)}},React.createElement("span",null,s.approve??"Approve"))),L.current_user?.can_moderate&&!e.is_pending&&React.createElement("li",null,React.createElement("a",{href:"#",className:"flexify",onClick:async k=>{k.preventDefault(),await N(),u(!1)}},React.createElement("span",null,s.mark_pending??"Mark as pending"))),L.current_user?.can_delete&&React.createElement("li",null,React.createElement("a",{href:"#",className:"flexify",onClick:k=>{k.preventDefault(),ce()}},React.createElement("span",null,s.delete??"Delete")))))),React.createElement("div",{className:"vxf-body"},c?React.createElement(Ie,{statusId:n.id,parentId:e.parent_id??void 0,comment:e,onCommentUpdated:k=>{E(!1),r?.(k)},onCancel:()=>E(!1),autoFocus:!0}):React.createElement(React.Fragment,null,e.content&&React.createElement("div",{className:"vxf-body-text"},React.createElement(ot,{content:e.content,maxLength:280,isExpanded:d,onToggleExpand:()=>i(!d)})),e.files&&e.files.length>0&&React.createElement(lt,{files:e.files,statusId:e.id}))),React.createElement("div",{className:"vxf-footer flexify"},React.createElement("div",{className:"vxf-actions flexify"},React.createElement("a",{href:"#",onClick:P,className:`vxf-icon ${J?"vxf-liked":""} ${R.isLiking?"vx-inert":""} ${e.is_pending&&!J?"vx-pending":""}`},React.createElement("span",{dangerouslySetInnerHTML:{__html:J?p?.icons?.liked??"":p?.icons?.like??""}}),React.createElement(Xn,null)),v&&ie&&React.createElement("a",{href:"#",onClick:k=>{k.preventDefault(),m?.()},className:`vxf-icon ${e.is_pending?"vx-pending":""}`,dangerouslySetInnerHTML:{__html:p?.icons?.reply??""}}),$&&f&&React.createElement("a",{href:"#",onClick:k=>{k.preventDefault(),o?.()},className:"vxf-icon vxf-has-replies"},React.createElement("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},React.createElement("path",{d:"M7 10.5957C7 10.1815 7.33579 9.8457 7.75 9.8457H16.25C16.6642 9.8457 17 10.1815 17 10.5957C17 11.0099 16.6642 11.3457 16.25 11.3457H7.75C7.33579 11.3457 7 11.0099 7 10.5957Z"}),React.createElement("path",{d:"M7.75 12.8457C7.33579 12.8457 7 13.1815 7 13.5957C7 14.0099 7.33579 14.3457 7.75 14.3457H12.75C13.1642 14.3457 13.5 14.0099 13.5 13.5957C13.5 13.1815 13.1642 12.8457 12.75 12.8457H7.75Z"}),React.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 4C7.58172 4 4 7.58172 4 12V20H12C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2.5 12C2.5 6.75329 6.75329 2.5 12 2.5C17.2467 2.5 21.5 6.75329 21.5 12C21.5 17.2467 17.2467 21.5 12 21.5H3.25C2.83579 21.5 2.5 21.1642 2.5 20.75V12Z"})))),(L.likes?.count>0||e.replies?.count>0)&&React.createElement("div",{className:"vxf-details flexify"},L.likes?.last3?.length>0&&React.createElement("div",{className:"vxf-recent-likes flexify"},L.likes.last3.filter(k=>k&&k.avatar_url).map((k,w)=>React.createElement("img",{key:w,src:k.avatar_url,alt:k.display_name,title:k.display_name}))),React.createElement("span",null,L.likes?.count>0&&React.createElement("span",null,L.likes.count===1?s.oneLike??"1 like":s.countLikes?.replace("@count",String(L.likes.count))??`${L.likes.count} likes`),e.replies?.count>0&&React.createElement("a",{href:"#",onClick:k=>{k.preventDefault(),o?.()}},e.replies.count===1?s.oneReply??"1 reply":s.countReplies?.replace("@count",String(e.replies.count))??`${e.replies.count} replies`)))))}function st({status:e,parentComment:n=null,depth:l=0,maxDepth:a=2,focusComposer:r=!1}){const{config:t}=fe(),o=he(),[m,f]=S(null),[p,g]=S(new Set),{comments:s,isLoading:v,isLoadingMore:_,hasMore:y,error:u,loadMore:d,addComment:i,updateComment:c,removeComment:E}=xn(e.id,n?.id??void 0),R=t?.strings??{},x=l>0,j=l<a,I=!!o,C=h(F=>{i(F),f(null)},[i]),N=h(F=>{c(F)},[c]),L=h(F=>{E(F)},[E]),H=h(F=>{F.preventDefault(),d()},[d]),D=h(F=>{f(Y=>Y===F?null:F)},[]),B=h(F=>{g(Y=>{const J=new Set(Y);return J.has(F)?J.delete(F):J.add(F),J})},[]),U=["vxf-comment-level","vxf-subgrid",x?"vxf-second-level":""].filter(Boolean).join(" ");return React.createElement("div",{className:U},s.map(F=>React.createElement("div",{key:F.id,className:"vxf-comment-wrapper"},React.createElement(Qn,{comment:F,status:e,depth:l,maxDepth:a,onCommentUpdate:N,onCommentDelete:L,onReplyClick:()=>D(F.id),onShowReplies:()=>B(F.id),showRepliesButton:j&&F.replies?.count>0&&!p.has(F.id)}),m===F.id&&j&&React.createElement(Ie,{statusId:e.id,parentId:F.id,onCommentPublished:C,onCancel:()=>f(null),autoFocus:!0}),j&&p.has(F.id)&&F.replies?.count>0&&React.createElement(st,{status:e,parentComment:F,depth:l+1,maxDepth:a}))),y&&!v&&s.length>0&&React.createElement("a",{href:"#",className:`ts-btn ts-btn-4 ${_?"vx-pending":""}`,onClick:H},_?React.createElement("span",{className:"ts-loader"}):R.load_more_replies??"Load more replies"),v&&React.createElement("div",{className:"ts-no-posts"},React.createElement("span",{className:"ts-loader"})),u&&React.createElement("div",{className:"ts-no-posts"},React.createElement("p",null,u)),!x&&I&&!e.is_pending&&React.createElement(Ie,{statusId:e.id,onCommentPublished:C,autoFocus:r}))}const Yn=()=>React.createElement("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",transform:"rotate(0 0 0)"},React.createElement("path",{d:"M12 2C6.49 2 2 6.49 2 12C2 17.51 6.49 22 12 22C17.51 22 22 17.51 22 12C22 6.49 17.51 2 12 2ZM12 20.5C7.31 20.5 3.5 16.69 3.5 12C3.5 7.31 7.31 3.5 12 3.5C16.69 3.5 20.5 7.31 20.5 12C20.5 16.69 16.69 20.5 12 20.5Z",fill:"currentColor"}),React.createElement("path",{d:"M17.6 13.19C17.37 13.04 17.07 13.02 16.83 13.15C16.81 13.16 14.56 14.35 12 14.35C9.44 14.35 7.19 13.16 7.17 13.15C6.93 13.02 6.63 13.03 6.4 13.19C6.17 13.34 6.04 13.61 6.07 13.89C6.3 16.26 8.46 18.78 12 18.78C15.54 18.78 17.69 16.26 17.93 13.89C17.96 13.61 17.83 13.35 17.6 13.19ZM12 17.27C10.07 17.27 8.7 16.31 8.02 15.13C9.04 15.48 10.45 15.85 12 15.85C13.55 15.85 14.96 15.49 15.98 15.13C15.3 16.31 13.93 17.27 12 17.27Z",fill:"currentColor"}),React.createElement("path",{d:"M7.33 10.14C7.36 10.22 7.4 10.29 7.44 10.36C7.49 10.43 7.54 10.49 7.6 10.55C7.65 10.61 7.72 10.66 7.79 10.7C7.85 10.75 7.93 10.79 8 10.82C8.08 10.85 8.16 10.87 8.24 10.89C8.32 10.91 8.4 10.92 8.48 10.92C8.56 10.92 8.64 10.92 8.72 10.89C8.8 10.86 8.88 10.85 8.96 10.82C9.03 10.79 9.11 10.75 9.17 10.7C9.24 10.66 9.31 10.61 9.36 10.55C9.6 10.32 9.73 9.99 9.73 9.67C9.73 9.35 9.6 9.01 9.36 8.78C9.31 8.72 9.24 8.67 9.17 8.63C9.11 8.58 9.03 8.54 8.96 8.51C8.88 8.48 8.8 8.46 8.72 8.44C8.56 8.41 8.4 8.41 8.24 8.44C8.16 8.46 8.08 8.48 8 8.51C7.93 8.54 7.85 8.58 7.79 8.63C7.72 8.67 7.65 8.72 7.6 8.78C7.36 9.01 7.23 9.33 7.23 9.67C7.23 9.75 7.23 9.83 7.26 9.91C7.27 9.99 7.29 10.07 7.33 10.14Z",fill:"currentColor"}),React.createElement("path",{d:"M12.99 11.02C13.38 11.16 13.8 10.95 13.94 10.56C13.97 10.48 14.25 9.76 14.97 9.76C15.69 9.76 15.97 10.48 16 10.55C16.1 10.86 16.4 11.06 16.71 11.06C16.79 11.06 16.87 11.05 16.95 11.02C17.34 10.89 17.55 10.46 17.42 10.07C17.19 9.4 16.42 8.25 14.97 8.25C13.52 8.25 12.75 9.39 12.52 10.07C12.39 10.46 12.6 10.88 12.99 11.01V11.02Z",fill:"currentColor"})),Kn=()=>React.createElement("svg",{width:"80",height:"80",viewBox:"0 0 25 24",xmlns:"http://www.w3.org/2000/svg",transform:"rotate(0 0 0)"},React.createElement("path",{d:"M8.25016 10.5C7.5598 10.5 7.00016 11.0596 7.00016 11.75C7.00016 12.4404 7.5598 13 8.25016 13H8.26016C8.95051 13 9.51016 12.4404 9.51016 11.75C9.51016 11.0596 8.95051 10.5 8.26016 10.5H8.25016Z",fill:"currentColor"}),React.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.75016 5.5C7.75016 4.25736 8.75751 3.25 10.0002 3.25H19.0002C20.2428 3.25 21.2502 4.25736 21.2502 5.5V14.5C21.2502 15.7426 20.2428 16.75 19.0002 16.75H17.2502V18.5C17.2502 19.7426 16.2428 20.75 15.0002 20.75H6.00016C4.75751 20.75 3.75016 19.7426 3.75016 18.5V17.6916C3.74995 17.6814 3.74995 17.6712 3.75016 17.6611V9.5C3.75016 8.25736 4.75751 7.25 6.00016 7.25H7.75016V5.5ZM15.7502 9.5V15.9558L13.4851 13.8525C12.789 13.206 11.7619 13.0665 10.9186 13.5037L5.25016 16.4421L5.25016 9.5C5.25016 9.08579 5.58594 8.75 6.00016 8.75H15.0002C15.4144 8.75 15.7502 9.08579 15.7502 9.5ZM5.25016 18.5V18.1317L11.6089 14.8354C11.89 14.6896 12.2324 14.7362 12.4644 14.9516L15.7502 18.0028V18.5C15.7502 18.9142 15.4144 19.25 15.0002 19.25H6.00016C5.58594 19.25 5.25016 18.9142 5.25016 18.5ZM9.25016 7.25H15.0002C16.2428 7.25 17.2502 8.25736 17.2502 9.5V15.25H19.0002C19.4144 15.25 19.7502 14.9142 19.7502 14.5V5.5C19.7502 5.08579 19.4144 4.75 19.0002 4.75H10.0002C9.58594 4.75 9.25016 5.08579 9.25016 5.5V7.25Z",fill:"currentColor"})),ea=()=>React.createElement("svg",{viewBox:"0 0 25 24",xmlns:"http://www.w3.org/2000/svg",transform:"rotate(0 0 0)"},React.createElement("path",{d:"M6.80747 9.56843C6.80747 6.46718 9.32153 3.95312 12.4228 3.95312C15.524 3.95312 18.0381 6.46718 18.0381 9.56843V9.87773H18.098C20.9007 9.87773 23.1727 12.1498 23.1727 14.9524C23.1727 17.7551 20.9007 20.0272 18.098 20.0272H14.2524C14.5162 19.6585 14.6715 19.2069 14.6715 18.719V18.5272H18.098C20.0723 18.5272 21.6727 16.9267 21.6727 14.9524C21.6727 12.9782 20.0723 11.3777 18.098 11.3777H17.2881C16.8739 11.3777 16.5381 11.0419 16.5381 10.6277V9.56843C16.5381 7.29561 14.6956 5.45312 12.4228 5.45312C10.15 5.45312 8.30747 7.29561 8.30747 9.56843L8.30747 10.6277C8.30747 11.0419 7.97169 11.3777 7.55747 11.3777H6.74659C4.77233 11.3777 3.17188 12.9782 3.17188 14.9524C3.17188 16.9267 4.77233 18.5272 6.74659 18.5272H10.1715V18.719C10.1715 19.2069 10.3268 19.6585 10.5906 20.0272H6.74659C3.94391 20.0272 1.67188 17.7551 1.67188 14.9524C1.67188 12.1498 3.9439 9.87773 6.74659 9.87773H6.80747V9.56843Z",fill:"currentColor"}),React.createElement("path",{d:"M12.4246 11.0874C12.2107 11.0874 12.0178 11.1768 11.8812 11.3204L9.24138 13.9585C8.94839 14.2513 8.94824 14.7262 9.24104 15.0192C9.53384 15.3122 10.0087 15.3123 10.3017 15.0195L11.6746 13.6475V18.718C11.6746 19.1322 12.0104 19.468 12.4246 19.468C12.8388 19.468 13.1746 19.1322 13.1746 18.718V13.6499L14.5452 15.0196C14.8382 15.3124 15.3131 15.3122 15.6059 15.0192C15.8987 14.7262 15.8985 14.2513 15.6055 13.9585L12.9916 11.3465C12.8541 11.1878 12.6511 11.0874 12.4246 11.0874Z",fill:"currentColor"}));function ta({quoteOf:e,onQuotePublished:n,onCancel:l,className:a=""}){const{config:r}=ue(),t=ve(),[o,m]=S(""),[f,p]=S(!1),[g,s]=S(null),[v,_]=S(!1),{uploads:y,completedFiles:u,isUploading:d,addFiles:i,removeFile:c,clearAll:E,uploadAll:R}=Ke({maxFiles:r?.upload_config.max_files??5,maxFileSize:r?.upload_config.max_file_size??2*1024*1024,allowedTypes:r?.upload_config.allowed_types??["image/jpeg","image/png","image/gif","image/webp"]}),x=T(null),j=T(null),I=T(null),C=tt(o),N=r?.character_limits.status_max??5e3,H=!(C>N)&&!f&&!d;q(()=>{x.current?.focus()},[]);const D=h(k=>{m(k.target.value),s(null);const w=k.target;w.style.height="auto",w.style.height=`${w.scrollHeight}px`},[]),B=h(k=>{const w=k.target.files;w&&w.length>0&&i(w),k.target.value=""},[i]),U=h(()=>{m(""),E(),s(null),x.current&&(x.current.style.height="auto")},[E]),F=h(k=>{k.preventDefault(),U(),l()},[U,l]),Y=h(async k=>{if(k?.preventDefault(),!!H){p(!0),s(null);try{let w=[];y.some(W=>W.status==="pending")?w=(await R()).map(K=>K.id):w=u.map(W=>W.id);const A=r?.nonces?.status_quote??r?.nonces?.status_publish??"";if(!A)throw new Error("Configuration not loaded");const O=await en({quote_of:e.id,content:o.trim(),files:w},A);U(),n(O)}catch(w){s(w instanceof Error?w.message:t.error_generic)}finally{p(!1)}}},[H,o,e.id,y,u,R,r?.nonces?.status_quote,r?.nonces?.status_publish,U,n,t.error_generic]),J=h(k=>{k.preventDefault(),I.current?.click()},[]),$=h(k=>{const w=x.current;if(!w)return;const A=w.selectionStart,O=w.selectionEnd,W=o.substring(0,A)+k+o.substring(O);m(W),requestAnimationFrame(()=>{w.focus(),w.setSelectionRange(A+k.length,A+k.length)})},[o]),ie=h(k=>{k.preventDefault(),_(w=>!w)},[]),P=r?.current_user;if(!P)return null;const ce=P.avatar_url??"",se=P.display_name??"",me=r?.strings.compose_placeholder??"What's on your mind?";return React.createElement(React.Fragment,null,React.createElement("div",{className:"vxf-split flexify"},React.createElement("span",null,"Quote post")),React.createElement("div",{ref:j,className:`vxf-create-post flexify vxf-expanded ${a}`},P&&React.createElement("div",{className:"vxf-avatar flexify"},React.createElement("img",{src:ce,alt:se})),React.createElement("div",{className:"vxf-create-post__content"},React.createElement("div",{className:"vxf-content__highlighter"}),React.createElement("textarea",{ref:x,className:"vxf-content__textarea",value:o,onChange:D,placeholder:me,maxLength:N,disabled:f})),React.createElement("div",{className:"vxf-footer-wrapper",style:{height:"auto"}},(y.length>0||u.length>0)&&React.createElement("div",{className:"ts-form-group ts-file-upload vxf-create-section"},React.createElement("div",{className:"ts-file-list"},y.map(k=>{const w=k.file.type.startsWith("image/"),A=w?URL.createObjectURL(k.file):"";return React.createElement("div",{key:k.id,className:`ts-file ${w?"ts-file-img":""}`,style:w?{backgroundImage:`url(${A})`}:{}},React.createElement("div",{className:"ts-file-info"},React.createElement("code",null,k.file.name)),React.createElement("a",{href:"#",className:"ts-remove-file flexify",onClick:O=>{O.preventDefault(),c(k.id)}},"Ã—"),k.status==="uploading"&&React.createElement("div",{className:"vxf-file-progress",style:{width:`${k.progress}%`}}))}))),React.createElement("div",{className:"vxf-footer flexify"},React.createElement("div",{className:"vxf-actions flexify"},r?.features.file_upload&&React.createElement(React.Fragment,null,React.createElement("a",{href:"#",onClick:J,className:"vxf-icon"},React.createElement(Kn,null)),React.createElement("a",{href:"#",onClick:J,className:"vxf-icon"},React.createElement(ea,null))),React.createElement("a",{href:"#",className:"vxf-icon vxf-emoji-picker",onClick:ie},React.createElement(Yn,null)),React.createElement(Pe,{isOpen:v,onClose:()=>_(!1),onSelect:$,target:j.current})),React.createElement("div",{className:"vxf-buttons flexify"},React.createElement("a",{href:"#",onClick:F,className:"ts-btn ts-btn-1"},t.cancel??"Cancel"),React.createElement("a",{href:"#",onClick:Y,className:`ts-btn ts-btn-2 ${f?"vx-pending":""}`},f?React.createElement("div",{className:"ts-loader-wrapper"},React.createElement("span",{className:"ts-loader"})):"Publish")))),r?.features.file_upload&&React.createElement("input",{ref:I,type:"file",accept:r.upload_config.allowed_types.join(","),multiple:!0,onChange:B,style:{display:"none"},"aria-hidden":"true"}),g&&React.createElement("div",{className:"vxf-create-post__error ts-form-error"},g)))}const Be=()=>React.createElement("div",{className:"ray-holder"},[...Array(8)].map((e,n)=>React.createElement("div",{key:n,className:"ray"})));function it({status:e,onStatusUpdate:n,onStatusDelete:l,onQuote:a,repostedBy:r,isQuoted:t=!1,className:o=""}){const m=Ye(),f=ve(),p=he(),{config:g}=fe(),s=T(null),v=T(null),[_,y]=S(!1),[u,d]=S(!1),[i,c]=S(!1),[E,R]=S(!1),[x,j]=S(!1),[I,C]=S("view"),[N,L]=S(!1),{actionState:H,optimisticStatus:D,handleLike:B,handleRepost:U,handleDelete:F,handleApprove:Y,handleMarkPending:J}=_n(e,n,l),$=re(()=>({...e,...D,likes:{...e.likes,...D.likes},current_user:{...e.current_user,...D.current_user}}),[e,D]),ie=h(b=>{b.preventDefault(),B()},[B]),P=h(b=>{b.preventDefault(),U(),d(!1)},[U]),ce=h(async()=>{const b=window.Voxel_Config?.l10n?.confirmAction??f.delete_confirm??"Are you sure you want to proceed with this action?",Ce=window.Voxel_Config?.l10n?.yes??"Yes",xe=window.Voxel_Config?.l10n?.no??"No";if(typeof window<"u"&&window.Voxel?.dialog)window.Voxel.dialog({message:b,type:"warning",actions:[{label:Ce,onClick:async()=>{y(!1),await F(),window.Voxel?.alert&&window.Voxel.alert("Deleted")}},{label:xe,onClick:()=>{y(!1)}}],hideClose:!0,timeout:7500});else{if(!confirm(b))return;y(!1),await F()}},[F,f.delete_confirm]),se=h(async()=>{try{const b=e.link??window.location.href;await navigator.clipboard.writeText(b),typeof window<"u"&&window.Voxel?.alert&&window.Voxel.alert(f.copied??"Copied to clipboard")}catch(b){console.error("Failed to copy link:",b)}y(!1)},[e.link,f.copied]),me=h(()=>{const b=navigator;b.share&&b.share({url:e.link??window.location.href}),y(!1)},[e.link]),k=e.created_at,w=e.publisher;if(!w)return null;const A=w.avatar_url??"",O=w.display_name??"",W=w.username??"",K=w.link??"#",de=$.current_user?.has_liked??!1,we=$.current_user?.has_reposted??!1,G=g?.strings??{},_e=["vxf-post",H.isDeleting?"vx-pending":"",o].filter(Boolean).join(" ");return e.repost_of?React.createElement(it,{status:e.repost_of,onStatusUpdate:b=>{n?.({...e,repost_of:b})},repostedBy:e,onStatusDelete:l}):React.createElement("div",{className:"vxf-subgrid"},React.createElement("div",{className:_e},e.annotation&&React.createElement("div",{className:"vxf-highlight flexify"},React.createElement("div",{className:"vxf-icon",dangerouslySetInnerHTML:{__html:e.annotation.icon??""}}),React.createElement("span",null,e.annotation.text)),!e.annotation&&r&&React.createElement("div",{className:"vxf-highlight flexify"},r.annotation?React.createElement(React.Fragment,null,React.createElement("div",{className:"vxf-icon",dangerouslySetInnerHTML:{__html:r.annotation.icon??""}}),React.createElement("span",null,r.annotation.text)):React.createElement(React.Fragment,null,React.createElement("div",{className:"vxf-icon",dangerouslySetInnerHTML:{__html:g?.icons?.repost??""}}),React.createElement("span",null,React.createElement("a",{href:r.publisher.link},r.publisher.display_name)," ",G.reposted??"reposted"))),React.createElement("div",{className:"vxf-head flexify"},React.createElement("a",{href:K,className:"vxf-avatar flexify"},React.createElement("img",{src:A,alt:O})),React.createElement("div",{className:"vxf-user flexify"},React.createElement("a",{href:K},O,w.is_verified&&React.createElement("div",{className:"vxf-icon vxf-verified",dangerouslySetInnerHTML:{__html:g?.icons?.verified??""}})),React.createElement("span",null,W&&React.createElement("a",{href:K},"@",W),e.post?.link&&e.post?.title&&React.createElement("a",{href:e.post.link},e.post.title),React.createElement("a",{href:e.link??"#",title:e.edited_at?G.editedOn?.replace("@date",e.edited_at):void 0},k),e.badges?.map(b=>React.createElement("span",{key:b.key,"data-badge":b.key,className:"vxf-badge"},b.label)))),React.createElement("a",{href:"#",className:"vxf-icon vxf-more",ref:s,onClick:b=>b.preventDefault(),onMouseDown:()=>y(b=>!b),dangerouslySetInnerHTML:{__html:g?.icons?.more??""}}),_&&React.createElement(Re,{target:s.current,onBlur:()=>y(!1)},React.createElement("li",null,React.createElement("a",{href:"#",className:"flexify",onClick:b=>{b.preventDefault(),se(),y(!1)}},React.createElement("span",null,G.copy_link??"Copy link"))),navigator.share&&React.createElement("li",null,React.createElement("a",{href:"#",className:"flexify",onClick:b=>{b.preventDefault(),me(),y(!1)}},React.createElement("span",null,G.share_via??"Share via"))),$.current_user?.can_edit&&e.link_preview&&React.createElement("li",null,React.createElement("a",{href:"#",className:"flexify",onClick:b=>{b.preventDefault(),y(!1)}},React.createElement("span",null,G.remove_link_preview??"Remove link preview"))),$.current_user?.can_edit&&g?.features?.posts_editable&&React.createElement("li",null,React.createElement("a",{href:"#",className:"flexify",onClick:b=>{b.preventDefault(),C("edit"),y(!1)}},React.createElement("span",null,G.edit??"Edit"))),$.current_user?.can_moderate&&e.is_pending&&React.createElement("li",null,React.createElement("a",{href:"#",className:"flexify",onClick:async b=>{b.preventDefault(),await Y(),y(!1)}},React.createElement("span",null,G.approve??"Approve"))),$.current_user?.can_moderate&&!e.is_pending&&React.createElement("li",null,React.createElement("a",{href:"#",className:"flexify",onClick:async b=>{b.preventDefault(),await J(),y(!1)}},React.createElement("span",null,G.mark_pending??"Mark as pending"))),$.current_user?.can_delete&&React.createElement("li",null,React.createElement("a",{href:"#",className:"flexify",onClick:b=>{b.preventDefault(),ce()}},React.createElement("span",null,G.delete??"Delete"))))),React.createElement("div",{className:"vxf-body"},I==="edit"&&React.createElement(at,{status:e,onCancel:()=>C("view"),onUpdate:b=>{n?.(b),C("view")},className:"vxf-edit-mode"}),I==="view"&&e.review&&React.createElement("div",{className:"rev-score",style:{"--ts-accent-1":e.review.level?.color}},e.review.config?.input_mode==="stars"?React.createElement("ul",{className:"rev-star-score flexify simplify-ul"},[-2,-1,0,1,2].map(b=>React.createElement("li",{key:b,className:e.review.score>=b-.5?"active":""},React.createElement("span",{dangerouslySetInnerHTML:{__html:e.review.score>=b-.5?e.review.config?.active_icon??e.review.config?.default_icon??"":e.review.config?.default_icon??""}})))):React.createElement("div",{className:"rev-num-score flexify"},e.review.formatted_score),React.createElement("span",null,e.review.level?.label)),I==="view"&&e.content&&e.link_preview?.type!=="youtube"&&React.createElement(React.Fragment,null,React.createElement("div",{className:"vxf-body-text"},React.createElement(ot,{content:e.content,maxLength:280,isExpanded:N,onToggleExpand:()=>L(!N)}))),I==="view"&&e.link_preview?.type==="youtube"&&React.createElement("div",{className:"vxf-body-text"}),I==="view"&&e.private&&React.createElement("div",{className:"vxf-body-text",style:{opacity:.5}},G.restricted_visibility??"This post has restricted visibility."),I==="view"&&e.files&&e.files.length>0&&React.createElement(lt,{files:e.files,galleryIcon:m.galleryIcon,statusId:e.id}),I==="view"&&e.link_preview&&React.createElement(qn,{preview:e.link_preview,externalIcon:m.externalIcon}),I==="view"&&e.quote_of&&React.createElement(zn,{status:e.quote_of,truncateAt:140})),!t&&React.createElement("div",{className:"vxf-footer flexify"},React.createElement("div",{className:"vxf-actions flexify"},React.createElement("a",{href:"#",onClick:ie,className:`vxf-icon ${de?"vxf-liked":""} ${H.isLiking?"vx-inert":""} ${e.is_pending&&!de?"vx-pending":""}`},React.createElement("span",{dangerouslySetInnerHTML:{__html:de?g?.icons?.liked??"":g?.icons?.like??""}}),React.createElement(Be,null)),g?.features?.reposts&&React.createElement("a",{href:"#",className:`vxf-icon ${we?"vxf-reposted":""} ${H.isReposting?"vx-inert":""} ${e.is_pending?"vx-pending":""}`,ref:v,onClick:b=>b.preventDefault(),onMouseDown:()=>d(b=>!b)},React.createElement("svg",{viewBox:"0 0 25 24",xmlns:"http://www.w3.org/2000/svg"},React.createElement("path",{d:"M18.5324 16.7804C18.2395 16.4875 18.2394 16.0126 18.5323 15.7197C18.8252 15.4268 19.3001 15.4268 19.593 15.7196L22.0931 18.2195C22.2338 18.3601 22.3128 18.5509 22.3128 18.7498C22.3128 18.9487 22.2338 19.1395 22.0932 19.2802L19.593 21.7803C19.3001 22.0732 18.8252 22.0732 18.5323 21.7803C18.2394 21.4874 18.2394 21.0126 18.5323 20.7197L19.752 19.5H5.06267C3.82003 19.5 2.81267 18.4926 2.81267 17.25V12C2.81267 11.5858 3.14846 11.25 3.56267 11.25C3.97688 11.25 4.31267 11.5858 4.31267 12V17.25C4.31267 17.6642 4.64846 18 5.06267 18H19.7522L18.5324 16.7804Z"}),React.createElement("path",{d:"M21.0627 12.75C20.6485 12.75 20.3127 12.4142 20.3127 12V6.75C20.3127 6.33579 19.9769 6 19.5627 6H4.87316L6.09296 7.21963C6.38588 7.51251 6.38591 7.98738 6.09304 8.28029C5.80016 8.57321 5.32529 8.57324 5.03238 8.28037L2.53221 5.78054C2.39154 5.63989 2.31251 5.44912 2.3125 5.2502C2.31249 5.05127 2.39151 4.8605 2.53217 4.71984L5.03234 2.21967C5.32523 1.92678 5.80011 1.92678 6.093 2.21967C6.38589 2.51256 6.38589 2.98744 6.093 3.28033L4.87333 4.5H19.5627C20.8053 4.5 21.8127 5.50736 21.8127 6.75V12C21.8127 12.4142 21.4769 12.75 21.0627 12.75Z"})),React.createElement(Be,null)),React.createElement("a",{href:"#",onClick:b=>{b.preventDefault(),p&&(E?(R(!1),j(!1)):(R(!0),j(!0)))},className:`vxf-icon ${e.is_pending?"vx-pending":""}`,dangerouslySetInnerHTML:{__html:g?.icons?.reply??""}}),e.replies?.count>0&&React.createElement("a",{href:"#",onClick:b=>{b.preventDefault(),R(!E),j(!1)},className:"vxf-icon vxf-has-replies"},React.createElement("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},React.createElement("path",{d:"M7 10.5957C7 10.1815 7.33579 9.8457 7.75 9.8457H16.25C16.6642 9.8457 17 10.1815 17 10.5957C17 11.0099 16.6642 11.3457 16.25 11.3457H7.75C7.33579 11.3457 7 11.0099 7 10.5957Z"}),React.createElement("path",{d:"M7.75 12.8457C7.33579 12.8457 7 13.1815 7 13.5957C7 14.0099 7.33579 14.3457 7.75 14.3457H12.75C13.1642 14.3457 13.5 14.0099 13.5 13.5957C13.5 13.1815 13.1642 12.8457 12.75 12.8457H7.75Z"}),React.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 4C7.58172 4 4 7.58172 4 12V20H12C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2.5 12C2.5 6.75329 6.75329 2.5 12 2.5C17.2467 2.5 21.5 6.75329 21.5 12C21.5 17.2467 17.2467 21.5 12 21.5H3.25C2.83579 21.5 2.5 21.1642 2.5 20.75V12Z"})))),($.likes?.count>0||$.replies?.count>0)&&React.createElement("div",{className:"vxf-details flexify"},$.likes?.last3?.length>0&&React.createElement("div",{className:"vxf-recent-likes flexify"},$.likes.last3.filter(b=>b&&b.avatar_url).map((b,Ce)=>React.createElement("img",{key:Ce,src:b.avatar_url,alt:b.display_name,title:b.display_name}))),React.createElement("span",null,$.likes?.count>0&&React.createElement("span",null,$.likes.count===1?G.oneLike??"1 like":G.countLikes?.replace("@count",String($.likes.count))??`${$.likes.count} likes`),$.replies?.count>0&&React.createElement("a",{href:"#",onClick:b=>{b.preventDefault(),R(!E)}},$.replies.count===1?G.oneReply??"1 reply":G.countReplies?.replace("@count",String($.replies.count))??`${$.replies.count} replies`))),u&&React.createElement(Re,{target:v.current,onBlur:()=>d(!1)},React.createElement("li",null,React.createElement("a",{href:"#",className:"flexify",onClick:P},React.createElement("span",null,we?G.unrepost??"Unrepost":G.repost??"Repost"))),React.createElement("li",null,React.createElement("a",{href:"#",className:"flexify",onClick:b=>{if(b.preventDefault(),d(!1),!window.Voxel_Config?.is_logged_in){window.Voxel?.authRequired?.();return}c(!0)}},React.createElement("span",null,G.quote??"Quote")))))),i&&React.createElement("div",{className:"vxf__quote-composer vxf-subgrid"},React.createElement(ta,{quoteOf:e,onQuotePublished:b=>{c(!1),a?.(b)},onCancel:()=>c(!1)})),E&&React.createElement(st,{status:e,depth:0,maxDepth:g?.features?.comment_depth??2,focusComposer:x}))}const na=()=>React.createElement("svg",{width:"80",height:"80",viewBox:"0 0 24 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",transform:"rotate(0 0 0)"},React.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.25 2.75C6.14154 2.75 2 6.89029 2 11.998C2 17.1056 6.14154 21.2459 11.25 21.2459C13.5335 21.2459 15.6238 20.4187 17.2373 19.0475L20.7182 22.5287C21.011 22.8216 21.4859 22.8217 21.7788 22.5288C22.0717 22.2359 22.0718 21.761 21.7789 21.4681L18.2983 17.9872C19.6714 16.3736 20.5 14.2826 20.5 11.998C20.5 6.89029 16.3585 2.75 11.25 2.75ZM3.5 11.998C3.5 7.71905 6.96962 4.25 11.25 4.25C15.5304 4.25 19 7.71905 19 11.998C19 16.2769 15.5304 19.7459 11.25 19.7459C6.96962 19.7459 3.5 16.2769 3.5 11.998Z",fill:"#343C54"}));function aa({filters:e,onFiltersChange:n,orderingOptions:l=[],showSearch:a=!0,showFilterTabs:r=!0,className:t=""}){const o=Array.isArray(l)?l:[],[m,f]=S(e.search??""),p=T(null),[g,s]=S(!1),[v,_]=S(!1),y=T(null),u=T(null),d=e.orderId?o.find(C=>C._id===e.orderId)??o[0]:o[0],i=e.filter??"all",c=wn(),E=h(C=>{const N=C.target.value;f(N),p.current&&clearTimeout(p.current),p.current=window.setTimeout(()=>{n({search:N||void 0})},300)},[n]),R=h((C,N)=>{C.preventDefault(),n({filter:N==="all"?void 0:N}),s(!1)},[n]),x=h((C,N)=>{C.preventDefault(),n({orderId:N._id,order:N.order,time:N.time,timeCustom:N.time==="custom"?N.timeCustom:void 0}),_(!1)},[n]),j=h(C=>{C.preventDefault(),s(N=>!N),_(!1)},[]),I=h(C=>{C.preventDefault(),_(N=>!N),s(!1)},[]);return q(()=>()=>{p.current&&clearTimeout(p.current)},[]),React.createElement("div",{className:`vxf-filters ${t}`},a&&React.createElement("div",{className:"ts-form"},React.createElement("div",{className:"ts-input-icon flexify"},React.createElement(na,null),React.createElement("input",{type:"text",value:m,onChange:E,placeholder:"Search",className:"autofocus",maxLength:128}))),r&&Object.keys(c).length>=2&&React.createElement(React.Fragment,null,React.createElement("a",{href:"#",ref:y,onClick:C=>C.preventDefault(),onMouseDown:j},c[i]||"All",React.createElement("div",{className:"ts-down-icon"})),g&&React.createElement(Re,{target:y.current,onBlur:()=>s(!1)},Object.entries(c).map(([C,N])=>React.createElement("li",{key:C},React.createElement("a",{href:"#",className:"flexify",onClick:L=>R(L,C)},React.createElement("span",null,N)))))),o.length>0&&d&&React.createElement(React.Fragment,null,React.createElement("a",{href:"#",ref:u,onClick:C=>C.preventDefault(),onMouseDown:I},d.label,React.createElement("div",{className:"ts-down-icon"})),v&&React.createElement(Re,{target:u.current,onBlur:()=>_(!1)},o.map(C=>React.createElement("li",{key:C._id},React.createElement("a",{href:"#",className:"flexify",onClick:N=>x(N,C)},React.createElement("span",null,C.label)))))))}const ra=()=>React.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},React.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})),oa=()=>React.createElement("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},React.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.5 3.75C6.21979 3.75 2.75 7.21979 2.75 11.5C2.75 15.7802 6.21979 19.25 10.5 19.25C12.4067 19.25 14.1566 18.5645 15.5146 17.4227L19.2197 21.1278C19.5126 21.4207 19.9875 21.4207 20.2804 21.1278C20.5733 20.8349 20.5733 20.36 20.2804 20.0671L16.5753 16.362C17.717 15.0041 18.4025 13.2542 18.4025 11.3475C18.4025 7.06729 14.9327 3.5975 10.6525 3.5975L10.5 3.75ZM4.25 11.5C4.25 8.04822 7.04822 5.25 10.5 5.25C13.9518 5.25 16.75 8.04822 16.75 11.5C16.75 14.9518 13.9518 17.75 10.5 17.75C7.04822 17.75 4.25 14.9518 4.25 11.5Z",fill:"currentColor"})),la=bt(function({mode:n,postId:l,authorId:a,showFilters:r=!0,showSearch:t=!0,emptyMessage:o,className:m="",onLoadingChange:f},p){const g=Ye(),s=ve(),{config:v}=fe(),_=n??g.mode??"user_feed";console.log("[StatusFeed] Render with mode:",{propMode:n,attributeMode:g.mode,finalMode:_,currentPost:v?.current_post,postIdProp:l,authorIdProp:a});const y={};if(["post_timeline","post_wall","post_reviews"].includes(_)){const P=l??v?.current_post?.id;P?(y.postId=P,console.log(`[StatusFeed] Mode "${_}" requires post_id, using:`,P)):console.warn(`[StatusFeed] Mode "${_}" requires post_id but none available!`)}else l&&(y.postId=l);if(_==="author_timeline"){const P=a??v?.current_post?.author_id;P?(y.authorId=P,console.log('[StatusFeed] Mode "author_timeline" requires author_id, using:',P)):console.warn('[StatusFeed] Mode "author_timeline" requires author_id but none available!')}else a&&(y.authorId=a);if(g.orderingOptions?.length>0){const P=g.orderingOptions[0];y.orderId=P._id,y.order=P.order,y.time=P.time,P.time==="custom"&&(y.timeCustom=P.timeCustom)}const{statuses:i,isLoading:c,isLoadingMore:E,hasMore:R,loadMore:x,refresh:j,setFilters:I,addStatus:C,updateStatus:N,removeStatus:L,filters:H}=yn(_,y),D=g.orderingOptions?.[0]?._id??null,B=T(D);q(()=>{if(D&&D!==B.current){B.current=D;const P=g.orderingOptions[0];I({orderId:P._id,order:P.order,time:P.time,timeCustom:P.time==="custom"?P.timeCustom:void 0})}},[D,g.orderingOptions,I]),q(()=>{f?.(c)},[c,f]),Nt(p,()=>({addStatus:C,refresh:j}),[C,j]);const U=T(null);q(()=>{if(!U.current||!R||E)return;const P=new IntersectionObserver(ce=>{ce[0].isIntersecting&&R&&!E&&x()},{rootMargin:"200px",threshold:0});return P.observe(U.current),()=>{P.disconnect()}},[R,E,x]);const F=h(P=>{I(P)},[I]),Y=h(P=>{N(P)},[N]),J=h(P=>{L(P)},[L]),$=o??v?.strings?.no_activity??g.noStatusText??s.no_posts,ie=()=>c?React.createElement("div",{className:"ts-no-posts"},React.createElement("span",{className:"ts-loader"})):React.createElement("div",{className:"ts-no-posts"},React.createElement(oa,null),React.createElement("p",null,$));return React.createElement(React.Fragment,null,r&&React.createElement(aa,{filters:H,onFiltersChange:F,orderingOptions:g.orderingOptions,showSearch:t&&g.searchEnabled}),i.length>0?React.createElement(React.Fragment,null,i.map(P=>React.createElement(it,{key:P.id,status:P,onStatusUpdate:Y,onStatusDelete:J,onQuote:C})),R&&!c&&React.createElement("a",{ref:U,href:"#",onClick:P=>{P.preventDefault(),x()},className:`ts-load-more ts-btn ts-btn-1 ${E?"vx-pending":""}`},React.createElement(ra,null),s.load_more??"Load more")):ie())});function sa({reason:e}){const l=e?{login_required:"Please log in to view this content.",followers_only:"Only followers can view this content.",customers_only:"Only customers can view this content.",private:"This content is private.",no_post_context:"Post not found.",no_author_context:"Author not found."}[e]??"Content not available.":"Content not available.";return React.createElement("div",{className:"ts-no-posts"},React.createElement("p",null,l))}function ia({attributes:e,context:n,className:l=""}){const{config:a,postContext:r,context:t}=ue(),o=t==="editor"?!0:r?.visible??!0,m=t==="editor"?null:r?.reason??null,f=t==="editor"?{feed:"user_timeline",can_post:!0,placeholder:"What's on your mind?"}:r?.composer??null,p=T(null),[g,s]=S(!1),v=T(!1),_=h(R=>{v.current?s(R):R||(v.current=!0)},[]),y=e?.orderingOptions,u=re(()=>(Array.isArray(y)?y:[]).map(x=>({_id:x._id??"default",order:x.order??"latest",time:x.time??"all_time",timeCustom:x.timeCustom??7,label:x.label??"Latest"})),[y]),d=R=>{p.current?.addStatus(R)};if(!o)return React.createElement("div",{className:`vxfeed ${l}`},React.createElement(sa,{reason:m}));const c=n==="editor"?!0:f?.can_post??!1,E=f?.placeholder;return React.createElement(React.Fragment,null,a&&React.createElement(React.Fragment,null,React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify({timeline:{mode:e.mode},current_user:a.current_user,current_post:a.current_post??null,settings:{character_limits:a.character_limits,upload_config:a.upload_config,features:a.features,statuses_per_page:a.statuses_per_page,comments_per_page:a.comments_per_page},l10n:a.strings,reviews:a.review_config,nonce:a.nonces.status_publish,composer:{post_types:a.post_types,default_order:a.default_order}})}}),React.createElement("script",{type:"text/json",className:"vxconfig__icons",dangerouslySetInnerHTML:{__html:JSON.stringify(a.icons||{})}})),React.createElement("div",{className:`vxfeed ${g?"vxfeed--loading":""} ${l}`},c&&React.createElement(at,{feed:f?.feed,placeholder:E,onStatusCreated:d}),React.createElement(la,{ref:p,mode:e.mode,showFilters:u.length>0||e.searchEnabled,showSearch:e.searchEnabled,emptyMessage:e.noStatusText,onLoadingChange:_})))}function ca({attributes:e,context:n,postId:l,className:a=""}){return React.createElement(hn,{attributes:e,postId:l,context:n},React.createElement(ia,{attributes:e,context:n,className:a}))}function ma({attributes:e,setAttributes:n}){q(()=>{const a="voxel-social-feed-css";if(!document.getElementById(a)){const r=document.createElement("link");r.id=a,r.rel="stylesheet";const o=(window.Voxel_Config?.site_url||window.location.origin).replace(/\/$/,"");r.href=`${o}/wp-content/themes/voxel/assets/dist/social-feed.css?ver=1.7.5.2`,document.head.appendChild(r)}},[]);const l=Ze({className:"voxel-fse-timeline-block-editor"});return React.createElement(React.Fragment,null,React.createElement(wt,null,React.createElement(Lt,{tabs:[{id:"content",label:Z("Content","voxel-fse"),icon:"î¤¬",render:()=>React.createElement(Ut,{attributes:e,setAttributes:n})}],includeAdvancedTab:!0,includeVoxelTab:!0,attributes:e,setAttributes:n})),React.createElement("div",{...l},React.createElement(ca,{attributes:e,context:"editor",className:"voxel-fse-timeline-editor"})))}function ae(e){return!e||!e.library||!e.value?"":e.library==="svg"?`<img src="${e.value}" class="ts-svg-icon" alt="" />`:e.library==="icon"?`<i class="${e.value}"></i>`:""}function da(e){return{timeline:{mode:e.mode},block_settings:{no_status_text:e.noStatusText,search_enabled:e.searchEnabled,search_value:e.searchValue,ordering_options:e.orderingOptions.map(n=>({_id:n._id,label:n.label,order:n.order,time:n.time,time_custom:n.timeCustom}))}}}function ua(e){return{verified:ae(e.verifiedIcon),repost:ae(e.repostIcon),more:ae(e.moreIcon),like:ae(e.likeIcon),liked:ae(e.likedIcon),comment:ae(e.commentIcon),reply:ae(e.replyIcon),gallery:ae(e.galleryIcon),upload:ae(e.uploadIcon),emoji:ae(e.emojiIcon),search:ae(e.searchIcon),trash:ae(e.trashIcon),"external-link":ae(e.externalIcon),loading:ae(e.loadMoreIcon),"no-post":ae(e.noPostsIcon)}}function fa({attributes:e}){const n=Tt(e,{blockId:e.blockId||"timeline",baseClass:"voxel-fse-timeline-frontend"}),l=Ze.save({id:n.elementId,className:n.className,style:n.styles,"data-mode":e.mode,"data-visibility-behavior":e.visibilityBehavior||void 0,"data-visibility-rules":e.visibilityRules?.length?JSON.stringify(e.visibilityRules):void 0,"data-loop-source":e.loopSource||void 0,"data-loop-limit":e.loopLimit||void 0,"data-loop-offset":e.loopOffset||void 0,...n.customAttrs}),a=da(e),r=ua(e);return React.createElement("div",{...l},n.responsiveCSS&&React.createElement("style",{dangerouslySetInnerHTML:{__html:n.responsiveCSS}}),At(e,!1,void 0,void 0,n.uniqueSelector),React.createElement("script",{type:"text/json",className:"vxconfig-block",dangerouslySetInnerHTML:{__html:JSON.stringify(a)}}),React.createElement("script",{type:"text/json",className:"vxconfig-icons",dangerouslySetInnerHTML:{__html:JSON.stringify(r)}}),React.createElement("div",{className:"voxel-fse-timeline-placeholder"},React.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"40px 20px",backgroundColor:"#f5f5f5",borderRadius:"4px",color:"#666",gap:"8px"}},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24",fill:"currentColor",style:{opacity:.5}},React.createElement("path",{d:"M13.5 2c-5.288 0-9.649 3.914-10.377 9h-3.123l4 5.917 4-5.917h-2.847c.711-3.972 4.174-7 8.347-7 4.687 0 8.5 3.813 8.5 8.5s-3.813 8.5-8.5 8.5c-3.015 0-5.662-1.583-7.171-3.957l-1.2 1.775c1.916 2.536 4.948 4.182 8.371 4.182 5.79 0 10.5-4.71 10.5-10.5s-4.71-10.5-10.5-10.5z"})),React.createElement("span",null,"Timeline (VX) - Loading..."))))}const pa="https://schemas.wp.org/trunk/block.json",ga=3,ha="voxel-fse/timeline",va="1.0.0",Ca="Timeline (VX)",Ra="voxel-fse",wa="Social timeline feed with posts, comments, likes, and reposts. Converted from Voxel Timeline widget.",Ea=["timeline","feed","social","posts","voxel","newsfeed","activity"],ya="voxel-fse",_a="file:./index.js",xa="file:./frontend.js",ka="file:./render.php",ba="file:./frontend.css",Na={html:!1,anchor:!0,className:!0},Sa={mode:{type:"string",default:"user_feed"},orderingOptions:{type:"array",default:[]},noStatusText:{type:"string",default:"No posts available"},searchEnabled:{type:"boolean",default:!0},searchValue:{type:"string",default:"@tags()@site().query_var(q)@endtags()"},verifiedIcon:{type:"object",default:null},repostIcon:{type:"object",default:null},moreIcon:{type:"object",default:null},likeIcon:{type:"object",default:null},likedIcon:{type:"object",default:null},commentIcon:{type:"object",default:null},replyIcon:{type:"object",default:null},galleryIcon:{type:"object",default:null},uploadIcon:{type:"object",default:null},emojiIcon:{type:"object",default:null},searchIcon:{type:"object",default:null},trashIcon:{type:"object",default:null},externalIcon:{type:"object",default:null},loadMoreIcon:{type:"object",default:null},noPostsIcon:{type:"object",default:null},contentTabOpenPanel:{type:"string",default:"timeline-settings"},_comment_voxel_tab:"VoxelTab attributes for visibility and loop features",visibilityBehavior:{type:"string",default:"show",enum:["show","hide"]},visibilityRules:{type:"array",default:[],items:{type:"object"}},loopEnabled:{type:"boolean",default:!1},loopSource:{type:"string",default:""},loopProperty:{type:"string",default:""},loopLimit:{type:"string",default:""},loopOffset:{type:"string",default:""}},Ue={$schema:pa,apiVersion:ga,name:ha,version:va,title:Ca,category:Ra,description:wa,keywords:Ea,textdomain:ya,editorScript:_a,viewScript:xa,render:ka,style:ba,supports:Na,attributes:Sa};Rt(Ue.name,{...Ue,icon:$t,edit:ma,save:fa});
