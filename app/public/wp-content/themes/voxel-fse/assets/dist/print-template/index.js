import{registerBlockType as S}from"@wordpress/blocks";import{useBlockProps as x,InspectorControls as N}from"@wordpress/block-editor";import{__ as f}from"@wordpress/i18n";import{useRef as b,useEffect as T,useState as u}from"react";import{useSelect as k}from"@wordpress/data";import h from"@wordpress/api-fetch";import{A as B,a as P}from"../TypographyPopup-BXz72zyZ.js";import{I as C}from"../InspectorTabs-DmdaThza.js";import"@wordpress/components";/* empty css                            */import"../RepeaterControl-BJok1GGr.js";import{P as _}from"../PostSelectControl-CwUQHJkX.js";import{a as M}from"../siteUrl-7x5eJEvc.js";import{E as g}from"../EmptyPlaceholder-BsL18qxN.js";import{S as W}from"../SearchFormComponent-LE9uDL09.js";import"../voxelShim-DB_Ue-9R.js";import{g as L}from"../useAdvancedTabProps-BnJDQbKr.js";import{r as j}from"../backgroundElements-Ui-iCrLV.js";import{V as H}from"../VoxelGridIcon-D5dF5acW.js";import"react-dom";import"../voxelIcons-gVyOSQ_B.js";import"../MediaPopup-CXePoOCG.js";import"../FormPopup-DDYHzYWU.js";import"../DatePicker-NCeMpzfF.js";import"nouislider";import"../generateAdvancedStyles-CRpLcHXt.js";import"../generateVoxelStyles-oZeaeuKH.js";function O({attributes:e,setAttributes:n}){return React.createElement(B,{attributes:e,setAttributes:n,stateAttribute:"contentTabOpenPanel",defaultPanel:"print-template"},React.createElement(P,{id:"print-template",title:f("Print an Elementor template","voxel-fse")},React.createElement(_,{label:f("Template","voxel-fse"),value:e.templateId,onChange:t=>n({templateId:t}),postTypes:["page","wp_block"],placeholder:f("Search templates","voxel-fse"),enableDynamicTags:!0,context:"post"})))}function D(){return M()}async function F(e){if(!e||e.length===0)return[];const t=`${D()}voxel-fse/v1/search-form/frontend-config?post_types=${encodeURIComponent(e.join(","))}`;try{const o=await fetch(t,{credentials:"same-origin",headers:{"X-WP-Nonce":window.wpApiSettings?.nonce||""}});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){return console.error("Failed to fetch post types:",o),[]}}function $(e){const n=e.querySelector("script.vxconfig");if(!n?.textContent)return null;try{const t=JSON.parse(n.textContent),o=Array.isArray(t.postTypes)?t.postTypes.map(s=>s.key):[];return{blockId:e.id||"",postTypes:o,showPostTypeFilter:t.showPostTypeFilter??!0,filterLists:t.filterLists||{},onSubmit:"refresh",postToFeedId:"",postToMapId:"",searchOn:"submit",showSearchButton:t.showSearchButton??!0,searchButtonText:t.searchButtonText||"Search",searchButtonIcon:{library:"",value:""},searchButtonWidth:t.searchButtonWidth,searchButtonWidth_tablet:t.searchButtonWidth_tablet,searchButtonWidth_mobile:t.searchButtonWidth_mobile,searchButtonWidthUnit:t.searchButtonWidthUnit||"%",showResetButton:t.showResetButton??!1,resetButtonText:t.resetButtonText||"Reset",resetButtonIcon:{library:"",value:""},resetButtonWidth:t.resetButtonWidth,resetButtonWidth_tablet:t.resetButtonWidth_tablet,resetButtonWidth_mobile:t.resetButtonWidth_mobile,resetButtonWidthUnit:t.resetButtonWidthUnit||"%",voxelIntegration:!0,adaptiveFiltering:!1,portalMode:t.portalMode||{desktop:!1,tablet:!0,mobile:!0},formToggleDesktop:t.formToggleDesktop??!1,formToggleTablet:t.formToggleTablet??!0,formToggleMobile:t.formToggleMobile??!0,toggleText:"Filter results",toggleIcon:{library:"",value:""}}}catch(t){return console.error("Failed to parse search form vxconfig:",t),null}}function U({attributes:e}){const[n,t]=u([]),[o,s]=u(!0),[i,r]=u(null);if(T(()=>{let a=!1;async function d(){s(!0),r(null);try{const p=await F(e.postTypes||[]);a||t(p)}catch(p){a||r(p instanceof Error?p.message:"Failed to load")}finally{a||s(!1)}}return d(),()=>{a=!0}},[e.postTypes]),o)return React.createElement("div",{className:"ts-form ts-search-widget"},React.createElement("div",{className:"ts-filter-wrapper flexify"},React.createElement("div",{className:"ts-no-posts"},React.createElement("span",{className:"ts-loader"}))));if(i)return React.createElement("div",{className:"ts-form ts-search-widget voxel-fse-error"},React.createElement("div",{className:"ts-filter-wrapper flexify"},React.createElement("span",null,"Error loading search form")));const l=n.filter(a=>e.postTypes?.includes(a.key)),c=a=>{console.log("Search form submitted (editor preview):",a)};return React.createElement(W,{attributes:e,postTypes:l,context:"frontend",onSubmit:c})}const E=new Set;function J(e){if(!e)return;e.querySelectorAll(".ts-search-widget, .voxel-fse-search-form").forEach(t=>{if(t.dataset.hydrated==="true")return;const o=$(t);o&&(t.innerHTML="",t.dataset.hydrated="true",wp.element.render(React.createElement(U,{attributes:o}),t),E.add(t))})}function V(e){if(!e)return;e.querySelectorAll(".ts-search-widget, .voxel-fse-search-form").forEach(t=>{E.has(t)&&(wp.element.unmountComponentAtNode(t),E.delete(t))})}function A({attributes:e,templateContent:n,isLoading:t,error:o,context:s}){const i=b(null),r=["ts-print-template-content"];e.hideDesktop&&r.push("hide-desktop"),e.hideTablet&&r.push("hide-tablet"),e.hideMobile&&r.push("hide-mobile"),e.customClasses&&r.push(e.customClasses);const l={templateId:e.templateId||"",hideDesktop:e.hideDesktop??!1,hideTablet:e.hideTablet??!1,hideMobile:e.hideMobile??!1,customClasses:e.customClasses||""};return T(()=>{if(!n||!i.current)return;const c=setTimeout(()=>{J(i.current)},50);return()=>{clearTimeout(c),V(i.current)}},[n]),t?React.createElement("div",{className:r.join(" ")},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(l)}}),React.createElement(g,null)):o?React.createElement("div",{className:r.join(" ")},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(l)}}),React.createElement(g,null)):e.templateId?s==="editor"&&typeof e.templateId=="string"&&e.templateId.startsWith("@tags()")?React.createElement("div",{className:r.join(" ")},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(l)}}),React.createElement(g,null)):React.createElement("div",{className:r.join(" "),ref:i},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(l)}}),n?React.createElement("div",{className:"ts-print-template-rendered",dangerouslySetInnerHTML:{__html:n}}):React.createElement(g,null)):React.createElement("div",{className:r.join(" ")},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(l)}}),React.createElement(g,null))}async function q(e){if(typeof e=="string"&&e.includes("//")){try{const t=await h({path:`/wp/v2/templates/${encodeURIComponent(e)}`});return{title:t.title?.rendered||t.slug||"FSE Template",content:t.content?.rendered||t.content?.raw||"",type:"fse-template"}}catch{}try{const t=await h({path:`/wp/v2/template-parts/${encodeURIComponent(e)}`});return{title:t.title?.rendered||t.slug||"Template Part",content:t.content?.rendered||t.content?.raw||"",type:"template-part"}}catch{}return null}const n=typeof e=="string"?parseInt(e,10):e;if(isNaN(n))return null;try{const t=await h({path:`/wp/v2/pages/${n}`});return{title:t.title?.rendered||`Page #${n}`,content:t.content?.rendered||t.content?.raw||"",type:"page"}}catch{}try{const t=await h({path:`/wp/v2/blocks/${n}`});return{title:t.title?.rendered||`Block #${n}`,content:t.content?.rendered||t.content?.raw||"",type:"block"}}catch{}try{const t=await h({path:`/wp/v2/posts/${n}`});return{title:t.title?.rendered||`Post #${n}`,content:t.content?.rendered||t.content?.raw||"",type:"post"}}catch{}return null}function X(e,n){if(!e.startsWith("@tags()"))return e;const t=e.match(/@tags\(\)(.*?)@endtags\(\)/s);return t&&t[1].trim()==="@post(id)"&&n?String(n):null}function G({attributes:e,setAttributes:n,clientId:t}){const o=x({className:"voxel-fse-print-template"}),s=k(v=>v("core/editor")?.getCurrentPostId?.()||null,[]),[i,r]=u(null),[l,c]=u(!1),[a,d]=u(null),p=typeof e.templateId=="string"&&e.templateId.startsWith("@tags()");return T(()=>{e.blockId||n({blockId:t})},[e.blockId,t,n]),T(()=>{let v=!1;async function R(){let m=e.templateId;if(p&&(m=X(e.templateId,s),!m)){r(null),d(null),c(!1);return}if(!m||m.trim()===""){r(null),d(null),c(!1);return}if(!m.includes("//")){const I=parseInt(m,10);if(!I||isNaN(I)){r(null),d(null),c(!1);return}}c(!0),d(null);const w=await q(m);v||(w?(r(w.content),d(null)):d(f("Template not found","voxel-fse")),c(!1))}return R(),()=>{v=!0}},[e.templateId,p,s]),React.createElement("div",{...o},React.createElement(N,null,React.createElement(C,{tabs:[{id:"content",label:f("Content","voxel-fse"),icon:"î¤¬",render:()=>React.createElement(O,{attributes:e,setAttributes:n})}],includeAdvancedTab:!0,includeVoxelTab:!0,attributes:e,setAttributes:n})),React.createElement(A,{attributes:e,templateContent:i,isLoading:l,error:a,context:"editor"}))}function z({attributes:e}){const n=L(e,{blockId:e.blockId||"print-template",baseClass:"voxel-fse-print-template ts-print-template"}),t=x.save({id:n.elementId,className:n.className,style:n.styles,"data-template-id":e.templateId||"","data-visibility-behavior":e.visibilityBehavior||void 0,"data-visibility-rules":e.visibilityRules?.length?JSON.stringify(e.visibilityRules):void 0,"data-loop-source":e.loopSource||void 0,"data-loop-limit":e.loopLimit||void 0,"data-loop-offset":e.loopOffset||void 0,...n.customAttrs}),o={templateId:e.templateId||"",hideDesktop:e.hideDesktop??!1,hideTablet:e.hideTablet??!1,hideMobile:e.hideMobile??!1,customClasses:e.customClasses||""};return React.createElement("div",{...t},n.responsiveCSS&&React.createElement("style",{dangerouslySetInnerHTML:{__html:n.responsiveCSS}}),j(e,!1,void 0,void 0,n.uniqueSelector),React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(o)}}),React.createElement("div",{className:"voxel-fse-block-placeholder",style:{display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#e0e0e0",padding:"16px",minHeight:"48px"}},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24",fill:"currentColor",style:{opacity:.4}},React.createElement("rect",{x:"4",y:"4",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"10",y:"4",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"16",y:"4",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"4",y:"10",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"10",y:"10",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"16",y:"10",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"4",y:"16",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"10",y:"16",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"16",y:"16",width:"4",height:"4",rx:"0.5"}))))}const Q="https://schemas.wp.org/trunk/block.json",Y=3,Z="voxel-fse/print-template",K="1.0.0",ee="Print Template (VX)",te="voxel-fse",ne="Render a WordPress Reusable Block or Block Pattern. FSE equivalent of Voxel's Print Template widget.",oe=["template","reusable","pattern","embed","voxel"],re="voxel-fse",ae={html:!1,align:["wide","full"],anchor:!0,className:!0,customClassName:!0},se="file:./index.js",le="file:./frontend.js",ce="file:./render.php",ie="file:./style.css",de={blockId:{type:"string",default:""},templateId:{type:"string",default:""},contentTabOpenPanel:{type:"string",default:"print-template"},customClasses:{type:"string",default:""},_comment_voxel_tab:"VoxelTab attributes for visibility and loop features",visibilityBehavior:{type:"string",default:"show",enum:["show","hide"]},visibilityRules:{type:"array",default:[],items:{type:"object"}},loopEnabled:{type:"boolean",default:!1},loopSource:{type:"string",default:""},loopProperty:{type:"string",default:""},loopLimit:{type:"string",default:""},loopOffset:{type:"string",default:""}},y={$schema:Q,apiVersion:Y,name:Z,version:K,title:ee,category:te,description:ne,keywords:oe,textdomain:re,supports:ae,editorScript:se,viewScript:le,render:ce,style:ie,attributes:de},pe=[{attributes:y.attributes,save(){return null}},{attributes:y.attributes,save({attributes:e}){const n=x.save({className:"voxel-fse-print-template ts-print-template"}),t={templateId:e.templateId||"",hideDesktop:e.hideDesktop??!1,hideTablet:e.hideTablet??!1,hideMobile:e.hideMobile??!1,customClasses:e.customClasses||""};return React.createElement("div",{...n},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(t)}}),React.createElement("div",{className:"voxel-fse-block-placeholder"},React.createElement("span",{className:"placeholder-icon"},"ðŸ“„"),React.createElement("span",{className:"placeholder-text"},"Print Template (VX)")))}},{attributes:y.attributes,save({attributes:e}){const n=x.save({className:"voxel-fse-print-template","data-template-id":e.templateId||""}),t={templateId:e.templateId||"",hideDesktop:e.hideDesktop??!1,hideTablet:e.hideTablet??!1,hideMobile:e.hideMobile??!1,customClasses:e.customClasses||""};return React.createElement("div",{...n},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(t)}}),React.createElement("div",{className:"voxel-fse-print-template-placeholder"},React.createElement("span",{className:"dashicons dashicons-media-document"}),React.createElement("span",null,"Select a template from the sidebar")))}}];S(y.name,{...y,icon:H,title:f("Print Template (VX)","voxel-fse"),description:f("Render a WordPress Reusable Block or Block Pattern.","voxel-fse"),edit:G,save:z,deprecated:pe});
