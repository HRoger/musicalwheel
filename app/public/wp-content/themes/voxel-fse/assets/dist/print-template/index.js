import{registerBlockType as N}from"@wordpress/blocks";import{useBlockProps as x,InspectorControls as b}from"@wordpress/block-editor";import{__ as u}from"@wordpress/i18n";import{useRef as B,useEffect as E,useState as h}from"react";import{useSelect as P}from"@wordpress/data";import g from"@wordpress/api-fetch";import{A as k,a as C}from"../TypographyPopup-CAcEJ5NA.js";import{I as _}from"../InspectorTabs-Bq2wAh4W.js";import"@wordpress/components";/* empty css                            */import"../RepeaterControl-C7JnAhZL.js";import{P as W}from"../PostSelectControl-DfkHxd67.js";import{a as L}from"../siteUrl-7x5eJEvc.js";import{E as y}from"../EmptyPlaceholder-CnO9R1NI.js";import{S as j}from"../SearchFormComponent-BFYciIO2.js";import"../voxelShim-DB_Ue-9R.js";import{g as M}from"../useAdvancedTabProps-BnJDQbKr.js";import{r as F}from"../backgroundElements-Ui-iCrLV.js";import{V as H}from"../VoxelGridIcon-D5dF5acW.js";import"react-dom";import"../voxelIcons-B76o57vm.js";import"../MediaPopup-BnHnsf_s.js";import"../FormPopup-C_Yd8wPI.js";import"../DatePicker-pD2Z7qly.js";import"../generateAdvancedStyles-CRpLcHXt.js";import"../generateVoxelStyles-oZeaeuKH.js";function O({attributes:t,setAttributes:n}){return React.createElement(k,{attributes:t,setAttributes:n,stateAttribute:"contentTabOpenPanel",defaultPanel:"print-template"},React.createElement(C,{id:"print-template",title:u("Print an Elementor template","voxel-fse")},React.createElement(W,{label:u("Template","voxel-fse"),value:t.templateId,onChange:e=>n({templateId:e}),postTypes:["page","wp_block"],placeholder:u("Search templates","voxel-fse"),enableDynamicTags:!0,context:"post"})))}function $(){return L()}async function U(t){if(!t||t.length===0)return[];const e=`${$()}voxel-fse/v1/search-form/frontend-config?post_types=${encodeURIComponent(t.join(","))}`;try{const r=await fetch(e,{credentials:"same-origin",headers:{"X-WP-Nonce":window.wpApiSettings?.nonce||""}});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return await r.json()}catch(r){return console.error("Failed to fetch post types:",r),[]}}function J(t){const n=t.querySelector("script.vxconfig");if(!n?.textContent)return null;try{const e=JSON.parse(n.textContent),r=Array.isArray(e.postTypes)?e.postTypes.map(o=>o.key):[];return{blockId:t.id||"",postTypes:r,showPostTypeFilter:e.showPostTypeFilter??!0,filterLists:e.filterLists||{},onSubmit:"refresh",postToFeedId:"",postToMapId:"",searchOn:"submit",showSearchButton:e.showSearchButton??!0,searchButtonText:e.searchButtonText||"Search",searchButtonIcon:{library:"",value:""},searchButtonWidth:e.searchButtonWidth,searchButtonWidth_tablet:e.searchButtonWidth_tablet,searchButtonWidth_mobile:e.searchButtonWidth_mobile,searchButtonWidthUnit:e.searchButtonWidthUnit||"%",showResetButton:e.showResetButton??!1,resetButtonText:e.resetButtonText||"Reset",resetButtonIcon:{library:"",value:""},resetButtonWidth:e.resetButtonWidth,resetButtonWidth_tablet:e.resetButtonWidth_tablet,resetButtonWidth_mobile:e.resetButtonWidth_mobile,resetButtonWidthUnit:e.resetButtonWidthUnit||"%",voxelIntegration:!0,adaptiveFiltering:!1,portalMode:e.portalMode||{desktop:!1,tablet:!0,mobile:!0},formToggleDesktop:e.formToggleDesktop??!1,formToggleTablet:e.formToggleTablet??!0,formToggleMobile:e.formToggleMobile??!0,toggleText:"Filter results",toggleIcon:{library:"",value:""}}}catch(e){return console.error("Failed to parse search form vxconfig:",e),null}}function V({attributes:t}){const[n,e]=h([]),[r,o]=h(!0),[s,a]=h(null);if(E(()=>{let l=!1;async function m(){o(!0),a(null);try{const p=await U(t.postTypes||[]);l||e(p)}catch(p){l||a(p instanceof Error?p.message:"Failed to load")}finally{l||o(!1)}}return m(),()=>{l=!0}},[t.postTypes]),r)return React.createElement("div",{className:"ts-form ts-search-widget"},React.createElement("div",{className:"ts-filter-wrapper flexify"},React.createElement("div",{className:"ts-no-posts"},React.createElement("span",{className:"ts-loader"}))));if(s)return React.createElement("div",{className:"ts-form ts-search-widget voxel-fse-error"},React.createElement("div",{className:"ts-filter-wrapper flexify"},React.createElement("span",null,"Error loading search form")));const c=n.filter(l=>t.postTypes?.includes(l.key)),i=l=>{console.log("Search form submitted (editor preview):",l)};return React.createElement(j,{attributes:t,postTypes:c,context:"frontend",onSubmit:i})}const R=new Set;function A(t){if(!t)return;t.querySelectorAll(".ts-search-widget, .voxel-fse-search-form").forEach(e=>{if(e.dataset.hydrated==="true")return;const r=J(e);r&&(e.innerHTML="",e.dataset.hydrated="true",wp.element.render(React.createElement(V,{attributes:r}),e),R.add(e))})}function D(t){if(!t)return;t.querySelectorAll(".ts-search-widget, .voxel-fse-search-form").forEach(e=>{R.has(e)&&(wp.element.unmountComponentAtNode(e),R.delete(e))})}function q({attributes:t,templateContent:n,isLoading:e,error:r,context:o}){const s=B(null),a=["ts-print-template-content"];t.customClasses&&a.push(t.customClasses);const c={templateId:t.templateId||"",customClasses:t.customClasses||""};return E(()=>{if(!n||!s.current)return;const i=setTimeout(()=>{A(s.current)},50);return()=>{clearTimeout(i),D(s.current)}},[n]),e?React.createElement("div",{className:a.join(" ")},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(c)}}),o==="editor"&&React.createElement(y,null)):r?React.createElement("div",{className:a.join(" ")},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(c)}}),o==="editor"&&React.createElement(y,null)):t.templateId?o==="editor"&&typeof t.templateId=="string"&&t.templateId.startsWith("@tags()")?React.createElement("div",{className:a.join(" ")},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(c)}}),React.createElement(y,null)):React.createElement("div",{className:a.join(" "),ref:s},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(c)}}),n?React.createElement("div",{className:"ts-print-template-rendered",dangerouslySetInnerHTML:{__html:n}}):o==="editor"?React.createElement(y,null):null):React.createElement("div",{className:a.join(" ")},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(c)}}),o==="editor"&&React.createElement(y,null))}async function X(t){if(typeof t=="string"&&t.includes("//")){try{const e=await g({path:`/wp/v2/templates/${encodeURIComponent(t)}`});return{title:e.title?.rendered||e.slug||"FSE Template",content:e.content?.rendered||e.content?.raw||"",type:"fse-template"}}catch{}try{const e=await g({path:`/wp/v2/template-parts/${encodeURIComponent(t)}`});return{title:e.title?.rendered||e.slug||"Template Part",content:e.content?.rendered||e.content?.raw||"",type:"template-part"}}catch{}return null}const n=typeof t=="string"?parseInt(t,10):t;if(isNaN(n))return null;try{const e=await g({path:`/wp/v2/pages/${n}`});return{title:e.title?.rendered||`Page #${n}`,content:e.content?.rendered||e.content?.raw||"",type:"page"}}catch{}try{const e=await g({path:`/wp/v2/blocks/${n}`});return{title:e.title?.rendered||`Block #${n}`,content:e.content?.rendered||e.content?.raw||"",type:"block"}}catch{}try{const e=await g({path:`/wp/v2/posts/${n}`});return{title:e.title?.rendered||`Post #${n}`,content:e.content?.rendered||e.content?.raw||"",type:"post"}}catch{}return null}function G(t,n){if(!t.startsWith("@tags()"))return t;const e=t.match(/@tags\(\)(.*?)@endtags\(\)/s);return e&&e[1].trim()==="@post(id)"&&n?String(n):null}function z({attributes:t,setAttributes:n,clientId:e}){const r=x({className:"voxel-fse-print-template"}),o=P(v=>v("core/editor")?.getCurrentPostId?.()||null,[]),[s,a]=h(null),[c,i]=h(!1),[l,m]=h(null),p=typeof t.templateId=="string"&&t.templateId.startsWith("@tags()");return E(()=>{t.blockId||n({blockId:e})},[t.blockId,e,n]),E(()=>{let v=!1;async function T(){let d=t.templateId;if(p&&(d=G(t.templateId,o),!d)){a(null),m(null),i(!1);return}if(!d||d.trim()===""){a(null),m(null),i(!1);return}if(!d.includes("//")){const I=parseInt(d,10);if(!I||isNaN(I)){a(null),m(null),i(!1);return}}i(!0),m(null);const w=await X(d);v||(w?(a(w.content),m(null)):m(u("Template not found","voxel-fse")),i(!1))}return T(),()=>{v=!0}},[t.templateId,p,o]),React.createElement("div",{...r},React.createElement(b,null,React.createElement(_,{tabs:[{id:"content",label:u("Content","voxel-fse"),icon:"î¤¬",render:()=>React.createElement(O,{attributes:t,setAttributes:n})}],includeAdvancedTab:!0,includeVoxelTab:!0,attributes:t,setAttributes:n})),React.createElement(q,{attributes:t,templateContent:s,isLoading:c,error:l,context:"editor"}))}function S(t){return function({attributes:e}){const r=M(e,{blockId:e.blockId||"print-template",baseClass:"voxel-fse-print-template ts-print-template"}),o=x.save({id:r.elementId,className:r.className,style:r.styles,"data-template-id":e.templateId||"","data-visibility-behavior":e.visibilityBehavior||void 0,"data-visibility-rules":e.visibilityRules?.length?JSON.stringify(e.visibilityRules):void 0,"data-loop-source":e.loopSource||void 0,"data-loop-limit":e.loopLimit||void 0,"data-loop-offset":e.loopOffset||void 0,...r.customAttrs}),s={templateId:e.templateId||"",hideDesktop:e.hideDesktop??!1,hideTablet:e.hideTablet??!1,hideMobile:e.hideMobile??!1,customClasses:e.customClasses||""};return React.createElement("div",{...o},r.responsiveCSS&&React.createElement("style",{dangerouslySetInnerHTML:{__html:r.responsiveCSS}}),F(e,!1,void 0,void 0,r.uniqueSelector),React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(s)}}),t&&React.createElement("div",{className:"voxel-fse-block-placeholder",style:{display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#e0e0e0",padding:"16px",minHeight:"48px"}},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24",fill:"currentColor",style:{opacity:.4}},React.createElement("rect",{x:"4",y:"4",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"10",y:"4",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"16",y:"4",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"4",y:"10",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"10",y:"10",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"16",y:"10",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"4",y:"16",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"10",y:"16",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"16",y:"16",width:"4",height:"4",rx:"0.5"}))))}}const Q=S(!1),Y=S(!0),Z="https://schemas.wp.org/trunk/block.json",K=3,ee="voxel-fse/print-template",te="1.0.0",ne="Print Template (VX)",re="voxel-fse",oe="Render a WordPress Reusable Block or Block Pattern. FSE equivalent of Voxel's Print Template widget.",ae=["template","reusable","pattern","embed","voxel"],se="voxel-fse",le={html:!1,align:["wide","full"],anchor:!0,className:!0,customClassName:!0},ce="file:./index.js",ie="file:./frontend.js",me="file:./render.php",pe="file:./style.css",de={blockId:{type:"string",default:""},templateId:{type:"string",default:""},contentTabOpenPanel:{type:"string",default:"print-template"},customClasses:{type:"string",default:""},_comment_voxel_tab:"VoxelTab attributes for visibility and loop features",visibilityBehavior:{type:"string",default:"show",enum:["show","hide"]},visibilityRules:{type:"array",default:[],items:{type:"object"}},loopEnabled:{type:"boolean",default:!1},loopSource:{type:"string",default:""},loopProperty:{type:"string",default:""},loopLimit:{type:"string",default:""},loopOffset:{type:"string",default:""}},f={$schema:Z,apiVersion:K,name:ee,version:te,title:ne,category:re,description:oe,keywords:ae,textdomain:se,supports:le,editorScript:ce,viewScript:ie,render:me,style:pe,attributes:de},ue=[{attributes:f.attributes,save(){return null}},{attributes:f.attributes,save({attributes:t}){const n=x.save({className:"voxel-fse-print-template ts-print-template"}),e={templateId:t.templateId||"",customClasses:t.customClasses||""};return React.createElement("div",{...n},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(e)}}),React.createElement("div",{className:"voxel-fse-block-placeholder"},React.createElement("span",{className:"placeholder-icon"},"ðŸ“„"),React.createElement("span",{className:"placeholder-text"},"Print Template (VX)")))}},{attributes:f.attributes,save({attributes:t}){const n=x.save({className:"voxel-fse-print-template","data-template-id":t.templateId||""}),e={templateId:t.templateId||"",customClasses:t.customClasses||""};return React.createElement("div",{...n},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(e)}}),React.createElement("div",{className:"voxel-fse-print-template-placeholder"},React.createElement("span",{className:"dashicons dashicons-media-document"}),React.createElement("span",null,"Select a template from the sidebar")))}},{attributes:f.attributes,save:Y}];N(f.name,{...f,icon:H,title:u("Print Template (VX)","voxel-fse"),description:u("Render a WordPress Reusable Block or Block Pattern.","voxel-fse"),edit:z,save:Q,deprecated:ue});
