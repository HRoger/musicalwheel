import{registerBlockType as S}from"@wordpress/blocks";import{useBlockProps as x,InspectorControls as N}from"@wordpress/block-editor";import{__ as f}from"@wordpress/i18n";import{useRef as b,useEffect as E,useState as u}from"react";import{useSelect as B}from"@wordpress/data";import h from"@wordpress/api-fetch";import{A as P,a as k}from"../TypographyPopup-CAcEJ5NA.js";import{I as C}from"../InspectorTabs-Bq2wAh4W.js";import"@wordpress/components";/* empty css                            */import"../RepeaterControl-C7JnAhZL.js";import{P as _}from"../PostSelectControl-DfkHxd67.js";import{a as W}from"../siteUrl-7x5eJEvc.js";import{E as g}from"../EmptyPlaceholder-BsL18qxN.js";import{S as L}from"../SearchFormComponent-DVWWxpns.js";import"../voxelShim-DB_Ue-9R.js";import{g as j}from"../useAdvancedTabProps-BnJDQbKr.js";import{r as M}from"../backgroundElements-Ui-iCrLV.js";import{V as H}from"../VoxelGridIcon-D5dF5acW.js";import"react-dom";import"../voxelIcons-B76o57vm.js";import"../MediaPopup-M_962PvX.js";import"../FormPopup-DDYHzYWU.js";import"../DatePicker-pD2Z7qly.js";import"../generateAdvancedStyles-CRpLcHXt.js";import"../generateVoxelStyles-oZeaeuKH.js";function O({attributes:t,setAttributes:n}){return React.createElement(P,{attributes:t,setAttributes:n,stateAttribute:"contentTabOpenPanel",defaultPanel:"print-template"},React.createElement(k,{id:"print-template",title:f("Print an Elementor template","voxel-fse")},React.createElement(_,{label:f("Template","voxel-fse"),value:t.templateId,onChange:e=>n({templateId:e}),postTypes:["page","wp_block"],placeholder:f("Search templates","voxel-fse"),enableDynamicTags:!0,context:"post"})))}function F(){return W()}async function $(t){if(!t||t.length===0)return[];const e=`${F()}voxel-fse/v1/search-form/frontend-config?post_types=${encodeURIComponent(t.join(","))}`;try{const r=await fetch(e,{credentials:"same-origin",headers:{"X-WP-Nonce":window.wpApiSettings?.nonce||""}});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return await r.json()}catch(r){return console.error("Failed to fetch post types:",r),[]}}function U(t){const n=t.querySelector("script.vxconfig");if(!n?.textContent)return null;try{const e=JSON.parse(n.textContent),r=Array.isArray(e.postTypes)?e.postTypes.map(s=>s.key):[];return{blockId:t.id||"",postTypes:r,showPostTypeFilter:e.showPostTypeFilter??!0,filterLists:e.filterLists||{},onSubmit:"refresh",postToFeedId:"",postToMapId:"",searchOn:"submit",showSearchButton:e.showSearchButton??!0,searchButtonText:e.searchButtonText||"Search",searchButtonIcon:{library:"",value:""},searchButtonWidth:e.searchButtonWidth,searchButtonWidth_tablet:e.searchButtonWidth_tablet,searchButtonWidth_mobile:e.searchButtonWidth_mobile,searchButtonWidthUnit:e.searchButtonWidthUnit||"%",showResetButton:e.showResetButton??!1,resetButtonText:e.resetButtonText||"Reset",resetButtonIcon:{library:"",value:""},resetButtonWidth:e.resetButtonWidth,resetButtonWidth_tablet:e.resetButtonWidth_tablet,resetButtonWidth_mobile:e.resetButtonWidth_mobile,resetButtonWidthUnit:e.resetButtonWidthUnit||"%",voxelIntegration:!0,adaptiveFiltering:!1,portalMode:e.portalMode||{desktop:!1,tablet:!0,mobile:!0},formToggleDesktop:e.formToggleDesktop??!1,formToggleTablet:e.formToggleTablet??!0,formToggleMobile:e.formToggleMobile??!0,toggleText:"Filter results",toggleIcon:{library:"",value:""}}}catch(e){return console.error("Failed to parse search form vxconfig:",e),null}}function J({attributes:t}){const[n,e]=u([]),[r,s]=u(!0),[i,o]=u(null);if(E(()=>{let a=!1;async function m(){s(!0),o(null);try{const p=await $(t.postTypes||[]);a||e(p)}catch(p){a||o(p instanceof Error?p.message:"Failed to load")}finally{a||s(!1)}}return m(),()=>{a=!0}},[t.postTypes]),r)return React.createElement("div",{className:"ts-form ts-search-widget"},React.createElement("div",{className:"ts-filter-wrapper flexify"},React.createElement("div",{className:"ts-no-posts"},React.createElement("span",{className:"ts-loader"}))));if(i)return React.createElement("div",{className:"ts-form ts-search-widget voxel-fse-error"},React.createElement("div",{className:"ts-filter-wrapper flexify"},React.createElement("span",null,"Error loading search form")));const l=n.filter(a=>t.postTypes?.includes(a.key)),c=a=>{console.log("Search form submitted (editor preview):",a)};return React.createElement(L,{attributes:t,postTypes:l,context:"frontend",onSubmit:c})}const R=new Set;function V(t){if(!t)return;t.querySelectorAll(".ts-search-widget, .voxel-fse-search-form").forEach(e=>{if(e.dataset.hydrated==="true")return;const r=U(e);r&&(e.innerHTML="",e.dataset.hydrated="true",wp.element.render(React.createElement(J,{attributes:r}),e),R.add(e))})}function A(t){if(!t)return;t.querySelectorAll(".ts-search-widget, .voxel-fse-search-form").forEach(e=>{R.has(e)&&(wp.element.unmountComponentAtNode(e),R.delete(e))})}function D({attributes:t,templateContent:n,isLoading:e,error:r,context:s}){const i=b(null),o=["ts-print-template-content"];t.customClasses&&o.push(t.customClasses);const l={templateId:t.templateId||"",customClasses:t.customClasses||""};return E(()=>{if(!n||!i.current)return;const c=setTimeout(()=>{V(i.current)},50);return()=>{clearTimeout(c),A(i.current)}},[n]),e?React.createElement("div",{className:o.join(" ")},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(l)}}),React.createElement(g,null)):r?React.createElement("div",{className:o.join(" ")},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(l)}}),React.createElement(g,null)):t.templateId?s==="editor"&&typeof t.templateId=="string"&&t.templateId.startsWith("@tags()")?React.createElement("div",{className:o.join(" ")},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(l)}}),React.createElement(g,null)):React.createElement("div",{className:o.join(" "),ref:i},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(l)}}),n?React.createElement("div",{className:"ts-print-template-rendered",dangerouslySetInnerHTML:{__html:n}}):React.createElement(g,null)):React.createElement("div",{className:o.join(" ")},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(l)}}),React.createElement(g,null))}async function q(t){if(typeof t=="string"&&t.includes("//")){try{const e=await h({path:`/wp/v2/templates/${encodeURIComponent(t)}`});return{title:e.title?.rendered||e.slug||"FSE Template",content:e.content?.rendered||e.content?.raw||"",type:"fse-template"}}catch{}try{const e=await h({path:`/wp/v2/template-parts/${encodeURIComponent(t)}`});return{title:e.title?.rendered||e.slug||"Template Part",content:e.content?.rendered||e.content?.raw||"",type:"template-part"}}catch{}return null}const n=typeof t=="string"?parseInt(t,10):t;if(isNaN(n))return null;try{const e=await h({path:`/wp/v2/pages/${n}`});return{title:e.title?.rendered||`Page #${n}`,content:e.content?.rendered||e.content?.raw||"",type:"page"}}catch{}try{const e=await h({path:`/wp/v2/blocks/${n}`});return{title:e.title?.rendered||`Block #${n}`,content:e.content?.rendered||e.content?.raw||"",type:"block"}}catch{}try{const e=await h({path:`/wp/v2/posts/${n}`});return{title:e.title?.rendered||`Post #${n}`,content:e.content?.rendered||e.content?.raw||"",type:"post"}}catch{}return null}function X(t,n){if(!t.startsWith("@tags()"))return t;const e=t.match(/@tags\(\)(.*?)@endtags\(\)/s);return e&&e[1].trim()==="@post(id)"&&n?String(n):null}function G({attributes:t,setAttributes:n,clientId:e}){const r=x({className:"voxel-fse-print-template"}),s=B(v=>v("core/editor")?.getCurrentPostId?.()||null,[]),[i,o]=u(null),[l,c]=u(!1),[a,m]=u(null),p=typeof t.templateId=="string"&&t.templateId.startsWith("@tags()");return E(()=>{t.blockId||n({blockId:e})},[t.blockId,e,n]),E(()=>{let v=!1;async function T(){let d=t.templateId;if(p&&(d=X(t.templateId,s),!d)){o(null),m(null),c(!1);return}if(!d||d.trim()===""){o(null),m(null),c(!1);return}if(!d.includes("//")){const I=parseInt(d,10);if(!I||isNaN(I)){o(null),m(null),c(!1);return}}c(!0),m(null);const w=await q(d);v||(w?(o(w.content),m(null)):m(f("Template not found","voxel-fse")),c(!1))}return T(),()=>{v=!0}},[t.templateId,p,s]),React.createElement("div",{...r},React.createElement(N,null,React.createElement(C,{tabs:[{id:"content",label:f("Content","voxel-fse"),icon:"î¤¬",render:()=>React.createElement(O,{attributes:t,setAttributes:n})}],includeAdvancedTab:!0,includeVoxelTab:!0,attributes:t,setAttributes:n})),React.createElement(D,{attributes:t,templateContent:i,isLoading:l,error:a,context:"editor"}))}function z({attributes:t}){const n=j(t,{blockId:t.blockId||"print-template",baseClass:"voxel-fse-print-template ts-print-template"}),e=x.save({id:n.elementId,className:n.className,style:n.styles,"data-template-id":t.templateId||"","data-visibility-behavior":t.visibilityBehavior||void 0,"data-visibility-rules":t.visibilityRules?.length?JSON.stringify(t.visibilityRules):void 0,"data-loop-source":t.loopSource||void 0,"data-loop-limit":t.loopLimit||void 0,"data-loop-offset":t.loopOffset||void 0,...n.customAttrs}),r={templateId:t.templateId||"",hideDesktop:t.hideDesktop??!1,hideTablet:t.hideTablet??!1,hideMobile:t.hideMobile??!1,customClasses:t.customClasses||""};return React.createElement("div",{...e},n.responsiveCSS&&React.createElement("style",{dangerouslySetInnerHTML:{__html:n.responsiveCSS}}),M(t,!1,void 0,void 0,n.uniqueSelector),React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(r)}}),React.createElement("div",{className:"voxel-fse-block-placeholder",style:{display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#e0e0e0",padding:"16px",minHeight:"48px"}},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24",fill:"currentColor",style:{opacity:.4}},React.createElement("rect",{x:"4",y:"4",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"10",y:"4",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"16",y:"4",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"4",y:"10",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"10",y:"10",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"16",y:"10",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"4",y:"16",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"10",y:"16",width:"4",height:"4",rx:"0.5"}),React.createElement("rect",{x:"16",y:"16",width:"4",height:"4",rx:"0.5"}))))}const Q="https://schemas.wp.org/trunk/block.json",Y=3,Z="voxel-fse/print-template",K="1.0.0",ee="Print Template (VX)",te="voxel-fse",ne="Render a WordPress Reusable Block or Block Pattern. FSE equivalent of Voxel's Print Template widget.",re=["template","reusable","pattern","embed","voxel"],oe="voxel-fse",ae={html:!1,align:["wide","full"],anchor:!0,className:!0,customClassName:!0},se="file:./index.js",le="file:./frontend.js",ce="file:./render.php",ie="file:./style.css",me={blockId:{type:"string",default:""},templateId:{type:"string",default:""},contentTabOpenPanel:{type:"string",default:"print-template"},customClasses:{type:"string",default:""},_comment_voxel_tab:"VoxelTab attributes for visibility and loop features",visibilityBehavior:{type:"string",default:"show",enum:["show","hide"]},visibilityRules:{type:"array",default:[],items:{type:"object"}},loopEnabled:{type:"boolean",default:!1},loopSource:{type:"string",default:""},loopProperty:{type:"string",default:""},loopLimit:{type:"string",default:""},loopOffset:{type:"string",default:""}},y={$schema:Q,apiVersion:Y,name:Z,version:K,title:ee,category:te,description:ne,keywords:re,textdomain:oe,supports:ae,editorScript:se,viewScript:le,render:ce,style:ie,attributes:me},pe=[{attributes:y.attributes,save(){return null}},{attributes:y.attributes,save({attributes:t}){const n=x.save({className:"voxel-fse-print-template ts-print-template"}),e={templateId:t.templateId||"",customClasses:t.customClasses||""};return React.createElement("div",{...n},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(e)}}),React.createElement("div",{className:"voxel-fse-block-placeholder"},React.createElement("span",{className:"placeholder-icon"},"ðŸ“„"),React.createElement("span",{className:"placeholder-text"},"Print Template (VX)")))}},{attributes:y.attributes,save({attributes:t}){const n=x.save({className:"voxel-fse-print-template","data-template-id":t.templateId||""}),e={templateId:t.templateId||"",customClasses:t.customClasses||""};return React.createElement("div",{...n},React.createElement("script",{type:"text/json",className:"vxconfig",dangerouslySetInnerHTML:{__html:JSON.stringify(e)}}),React.createElement("div",{className:"voxel-fse-print-template-placeholder"},React.createElement("span",{className:"dashicons dashicons-media-document"}),React.createElement("span",null,"Select a template from the sidebar")))}}];S(y.name,{...y,icon:H,title:f("Print Template (VX)","voxel-fse"),description:f("Render a WordPress Reusable Block or Block Pattern.","voxel-fse"),edit:G,save:z,deprecated:pe});
